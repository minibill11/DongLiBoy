@model JianHeMES.Models.EquipmentBasicInfo

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/axios.min.js"></script>
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>

<style>
    .tabletop,thead,th,td,.tablebottom{
        text-align:center;
    }
    .tabletop tr,.tablebottom tr{
        height:34px;
    }
    .tabletop tr td:nth-child(1){
        width:100px;
    }
    .tabletop tr td:nth-child(2){
        width:150px;
    }
    .tabletop tr td:nth-child(3){
        width:100px;
    }
    .tabletop tr td:nth-child(4){
        width:150px;
    }
    .tabletop tr td:nth-child(5){
        width:100px;
    }
    .tabletop tr td:nth-child(6){
        width:350px;
    }

    .tablebottom tr td:nth-child(1){

    }
    .tablebottom tr td:nth-child(2){

    }
    .tablebottom tr td:nth-child(3){

    }
    .tablebottom tr td:nth-child(4){

    }
    .tablebottom tr td:nth-child(5){

    }
    .tablebottom tr td:nth-child(6){

    }
    .tablebottom tr td:nth-child(7){

    }
    .tablebottom tr td:nth-child(8){

    }
    .tablebottom tr td:nth-child(9){
        width:150px;
    }
    
</style>
<h2>Details</h2>
@Html.ActionLink("批量添加维修记录", "InputEquipmentRepairRecord")||@Html.ActionLink("单个添加维修记录", "InputEquipmentRepairRecordSingle")
<div id="app">
    <form id="myform"  style="display:none;" action="/Equipment/UploadEquipmentPicture" method="post"> 
        <input class="upload" v-model="file" name="uploadfile" type="file" />
        <input class="upload1" v-model="AssetNumber" name="assetNumber" type="text" />
        <input type="reset" class="reset" />
    </form>
    <table class="tabletop" border="1" style="width:100%">
        <thead>
            <tr>
                <th colspan="6">
                    SMT部设备保养、维修履历资料汇总表
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>资产编号</td>
                <td>{{tabletop.AssetNumber}}</td>
                <td>设备名称</td>
                <td>{{tabletop.EquipmentName}}</td>
                <td>使用部门</td>
                <td>{{tabletop.UserDepartment}}</td>
            </tr>
            <tr>
                <td>设备编码</td>
                <td>{{tabletop.EquipmentNumber}}</td>
                <td>型号规格</td>
                <td>{{tabletop.ModelSpecification}}</td>
                <td rowspan="3">设备图片<br /><button v-on:click="chiose">选择</button>||<button v-on:click="postImgs">上传</button></td>
                <td rowspan="3">
                    <el-carousel height="150px">
                        <el-carousel-item v-for="item in imgArr" key="item">
                            <img v-bind:src="item.FullPath" />
                        </el-carousel-item>
                    </el-carousel>
                </td>
            </tr>
            <tr>
                <td>出厂编号</td>
                <td>{{tabletop.ManufacturingNumber}}</td>
                <td>生产厂家</td>
                <td>{{tabletop.Brand}}</td>
            </tr>
            <tr>
                <td>购入日期</td>
                <td>{{tabletop.CreateTime}}</td>
                <td>启用日期</td>
                <td>{{tabletop.ActionDate}}</td>
            </tr>
            <tr>
                <td colspan="6">
                    <strong>
                        设备维修记录
                    </strong>
                </td>
            </tr>
        </tbody>
    </table>
    <img src="/MES_Data/AssembleSample_Files/2017-TEST-1/2017-TEST-1_AssembleSample1.jpg" />
    <table class="tablebottom" border="1" style="width:100%">
        <thead>
            <tr>
                <th>
                    序号
                </th>
                <th>
                    故障现象描述
                </th>
                <th>
                    原因分析
                </th>
                <th>
                    维修或检测内容
                </th>
                <th>
                    接单时间
                </th>
                <th>
                    计划完成时间
                </th>
                <th>
                    实际完成时间
                </th>
                <th>
                    维修人
                </th>
                <th>
                    备注
                </th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="i in 5">
                <td>{{i}}</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
            </tr>
        </tbody>
    </table>
    <button onclick="goback()">返回</button>
</div>

<script>

    function GMTToStr(time) {
        let date = new Date(time)
        //console.log(date);
        let Str = date.getFullYear() + '-' +
            (date.getMonth() + 1) + '-' +
            date.getDate() + ' ' +
            date.getHours() + ':' +
            date.getMinutes() + ':' +
            date.getSeconds()
        return Str
    }
    function goback() {
        window, history.back();
    }

    let vm = new Vue({
        el: "#app",
        data: {
            AssetNumber: null,
            tabletop: '',
            imgs: null,
            file: null,
            imgArr:[]
        },
        mounted(){
            let hrefStr = window.location.href;
            let indexofequl = hrefStr.indexOf("=")+1;
            this.AssetNumber = hrefStr.slice(indexofequl) // 获取index传过来的资产编号
            this.getDefaultInfos(this.AssetNumber)
            //console.log(this.AssetNumber)
        },
        methods: {
            getDefaultInfos(nums) {
                axios.post("/Equipment/Details", { assetNumber: this.AssetNumber }).then(res=> {
                    console.log(res.data)
                    // 获取基本信息
                    let basicInfos = JSON.parse(res.data.basicinfo);
                    basicInfos.ActionDate = GMTToStr(basicInfos.ActionDate);
                    basicInfos.CreateTime = GMTToStr(basicInfos.CreateTime);
                    //console.log(basicInfos)
                    this.tabletop = basicInfos;

                    // 获取图片 
                    if (res.data.picture != '未上传图片。') {
                        let img = JSON.parse(res.data.picture);
                        this.imgArr = img
                        console.log(img)
                    } else {

                    }

                    //获取维修记录

                    let statusrecord = JSON.parse(res.data.statusrecord);
                    console.log(statusrecord)

                }).catch(err=> {

                })
            },
            postImgs() {
                let tt = $('.upload')[0].files[0];
                if (tt != null) {
                    console.log($('.upload'))
                    let f = new FormData();
                    let tt = $('.upload')[0].files[0];
                    f.append("assetNumber", this.AssetNumber);
                    f.append("uploadfile", tt);
                    console.log(tt)
                    axios.post("/Equipment/UploadEquipmentPicture", f).then(res=> {  // 
                        console.log(res.data)
                        if (res.data == '上传成功！') {
                            this.$message({
                                message: res.data,
                                type: 'success'
                            });
                            $('.reset').click();
                        } else {
                            this.$message({
                                message: res.data,
                                type: 'success'
                            })
                        }
                    }).catch(err=> {
                        this.$message({
                            message: "连接服务器失败!",
                            type: 'warning'
                        })
                    })
                    
                } else {
                    this.$message({
                        message: "请选择需要上传的图片！",
                        type: 'warning'
                    })
                }                
            },
            chiose() {
                $(".upload").click();  // 用户选择图片
            },
        }
    })
</script>

@*<div>
    <h4>EquipmentBasicInfo</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.SerialNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.SerialNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EquipmentNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EquipmentNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.AssetNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.AssetNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EquipmentName)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EquipmentName)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Brand)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Brand)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ModelSpecification)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ModelSpecification)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.InfoPlate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.InfoPlate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ManufacturingNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ManufacturingNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Quantity)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Quantity)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ActionDate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ActionDate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.DepreciableLife)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.DepreciableLife)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.UserDepartment)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.UserDepartment)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.StoragePlace)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.StoragePlace)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.WorkShop)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.WorkShop)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.LineNum)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.LineNum)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Section)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Section)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.FunctionDiscription)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.FunctionDiscription)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Status)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Status)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Creator)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Creator)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.CreateTime)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.CreateTime)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Modifier)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Modifier)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ModifyTime)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ModifyTime)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Remark)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Remark)
        </dd>

    </dl>
</div>
<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.Id }) |
    @Html.ActionLink("Back to List", "Index")
</p>*@
