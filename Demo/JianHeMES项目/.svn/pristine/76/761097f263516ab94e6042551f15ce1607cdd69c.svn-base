
@{
    ViewBag.Title = "Display";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/styleFile/packaging/index.css" rel="stylesheet" />
<script src="~/Content/styleFile/packaging/index.js"></script>
<script src="~/Scripts/axios.min.js"></script>

<style>
    table td {
        font-size: 13px;
        text-align: center;
        line-height: 28px;
    }

    .red {
        color: red;
        border-color:black;
    }

    .pass {
        color: green;
    }

    .tdco {
        border-left: solid 1px #ffffff;
        border-right: solid 1px #ffffff;
    }

    .el-upload__input {
        display: none !important;
    }

    .bt {
        margin-left: 430px;
        margin-top: 20px;
        margin-bottom: 10px;
    }

    .el-upload-list__item:first-child {
        margin-left: 50px;
        height: 20px;
        margin-top: 2px;
    }

    .color {
        color: red;
    }
</style>
@*<h4 style="text-align:center;">小样报告详细</h4>*@
<div id="app">
    <h3 class="bt">小样光电参数测试报告</h3>
    <span id="testid" style="margin-left:160px; margin-top:40px;margin-bottom:10px">{{list.ReportDate | timeFilter}}</span>
    <table border="1" cellspacing="0" style="margin:0 auto">
        <colgroup>
            <col width="30">
            <col width="75">
            <col width="75">
            <col width="55">
            <col width="60">
            <col width="68">
            <col width="68">
            <col width="80">
            <col width="90">
            <col width="70">
            <col width="70">
            <col width="80">
        </colgroup>
        <tr>
            <td colspan="2">客户名称</td>
            <td colspan="2">{{list.Customer}}</td>
            <td>生产单号</td>
            <td colspan="2">{{list.OrderNumber}}</td>
            <td>规格型号</td>
            <td>{{list.Mo1}}</td>
            <td colspan="2">模块数量(单位：PCS)</td>
            <td>{{list.Module_Number}}</td>
        </tr>
        <tr>
            <td colspan="12" class="tdco">&nbsp</td>
        </tr>

        <tr>
            <td colspan="7" style="text-align:left">{{list.Te1}}</td>
            <td>实际点间距</td>
            <td>{{list.Actual_point}}</td>
            <td colspan="3"></td>
        </tr>
        <tr>
            <td colspan="8" style="text-align:left">{{list.Te2}}</td>
            <td>订单接收卡：</td>
            <td colspan="3">{{list.ReceivingCard}}</td>
        </tr>
        <tr>
            <td colspan="2">模块型号：</td>
            <td colspan="2">{{list.Mo2}}</td>
            <td>点数：</td>
            <td>{{list.Points}}</td>
            <td>扫描数</td>
            <td>{{list.Scanningway}}</td>
            <td>调试系统</td>
            <td colspan="3">{{list.system}}</td>
        </tr>
        <tr>
            <td colspan="2">测试条件:</td>
            <td>{{list.Te3}}</td>
            <td>{{list.fixed_value}}</td>
            <td colspan="2">驱动板电压(V)</td>
            <td>{{list.Driveplate}}</td>
            <td colspan="5">电源型号</td>
        </tr>

        <tr>
            <td colspan="12" class="tdco">样品参数实测值</td>
        </tr>
        <tr>
            <td colspan="2">角度</td>
            <td>颜色</td>
            <td colspan="2">R</td>
            <td colspan="2">G</td>
            <td colspan="2">B</td>
            <td colspan="3">W</td>
        </tr>
        <tr>
            <td colspan="2" rowspan="2">0°</td>
            <td>亮度</td>
            <td colspan="2" class="luminance">{{list.Angle_R1}}</td>
            <td colspan="2" class="luminance">{{list.Angle_G1}}</td>
            <td colspan="2" class="luminance">{{list.Angle_B1}}</td>
            <td colspan="3">{{list.Angle_W1}}</td>
        </tr>
        <tr>
            <td>坐标</td>
            <td>{{list.Angle_R2}}</td>
            <td>{{list.Angle_R3}}</td>
            <td>{{list.Angle_G2}}</td>
            <td>{{list.Angle_G3}}</td>
            <td>{{list.Angle_B2}}</td>
            <td>{{list.Angle_B3}}</td>
            <td colspan="2" class="colorTmin">{{list.Angle_W2}}</td>
            <td class="colorTmax">{{list.Angle_W3}}</td>
        </tr>
        <tr>
            <td colspan="2" rowspan="2">客户要求</td>
            <td>亮度</td>
            <td colspan="2"></td>
            <td colspan="2"></td>
            <td colspan="2"></td>
            <td>{{list.Client_W1}}</td>
            <td class="front">{{list.Client_W1_V}}</td>
            <td>{{list.Client_W2}}</td>
        </tr>
        <tr>
            <td>坐标</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td colspan="2">{{list.Client_W3}}</td>
            <td>{{list.Client_W4}}</td>
        </tr>
        <tr>
            <td colspan="3">分压电/排阻阻值(欧)</td>
            <td colspan="2">{{list.Points_R}}</td>
            <td colspan="2">/</td>
            <td colspan="2">/</td>
            <td colspan="3">/</td>
        </tr>
        <tr>
            <td colspan="3">可调用电阻阻值(欧)</td>
            <td colspan="2">{{list.Adju_R}}</td>
            <td colspan="2">{{list.Adju_G}}</td>
            <td colspan="2">{{list.Adju_B}}</td>
            <td colspan="3">/</td>
        </tr>
        <tr>
            <td colspan="3">单IC引脚电流(mA)</td>
            <td class="targetOne" colspan="2">{{list.IC_R1}}</td>
            <td class="targetTwo" colspan="2">{{list.IC_G1}}</td>
            <td class="targetThree" colspan="2">{{list.IC_B1}}</td>
            <td colspan="3"></td>
        </tr>
        <tr>
            <td colspan="3">IC   VDS</td>
            <td colspan="2">{{list.IC_R2}}</td>
            <td colspan="2">{{list.IC_G2}}</td>
            <td colspan="2">{{list.IC_B2}}</td>
            <td colspan="3"></td>
        </tr>
        <tr>
            <td colspan="3">模 块 电 流(A)</td>
            <td colspan="4" class="electricity">{{list.Module_current}}</td>
            <td colspan="2">IC 型号</td>
            <td colspan="3">{{list.IC3}}</td>
        </tr>
        <tr>
            <td colspan="3">刷新频率</td>
            <td colspan="2">{{list.R1}}</td>
            <td colspan="2">接收卡Data包</td>
            <td colspan="5">{{list.R2}}</td>
        </tr>
        <tr>
            <td colspan="3">接收卡带载点数</td>
            <td>{{list.R3}}</td>
            <td>{{list.R4}}</td>
            <td colspan="2">LCT版本</td>
            <td colspan="5">{{list.LCT}}</td>
        </tr>
        <tr>
            <td colspan="3">亮度有效率(%)</td>
            <td colspan="2">{{list.De1_dec}}</td>
            <td colspan="2">灰度等级</td>
            <td colspan="2">{{list.De2}}</td>
            <td>DCLK</td>
            <td colspan="2">{{list.DCLK}}</td>
        </tr>
        <tr>
            <td colspan="3">电源带载率(%)</td>
            <td colspan="2">{{list.Load}}</td>
            <td colspan="2">每平方最大功耗(W/m²)</td>
            <td colspan="2">{{list.Per}}</td>
            <td>GCLK</td>
            <td colspan="2">{{list.GCLK}}</td>
        </tr>
        <tr>
            <td colspan="3">MOS管型号</td>
            <td colspan="2">{{list.MOS1}}</td>
            <td colspan="2">MOS压降(V)</td>
            <td colspan="2">{{list.MOS2}}</td>
            <td>电流增益</td>
            <td colspan="2">{{list.Current}}</td>
        </tr>

        <tr>
            <td colspan="12" class="tdco">小样灯管及参数(供应商测试值)</td>
        </tr>
        <tr>
            <td colspan="3">LED厂家及型号</td>
            <td colspan="2"></td>
            <td colspan="2">IV(mcd)</td>
            <td colspan="2">WD(nm)</td>
            <td colspan="2">正向电压（vf）</td>
            <td>IV@IF(mA)</td>
        </tr>
        <tr>
            <td rowspan="2">R</td>
            <td colspan="2" rowspan="2">{{list.LED_R1}}</td>
            <td colspan="2">实际范围</td>
            <td>{{list.LED_R2}}</td>
            <td>{{list.LED_R4}}</td>
            <td>{{list.LED_R6}}</td>
            <td>{{list.LED_R7}}</td>
            <td rowspan="2">{{list.LED_R9}}</td>
            <td rowspan="2">{{list.LED_R10}}</td>
            <td rowspan="2">{{list.LED_R11}}</td>
        </tr>
        <tr>
            <td colspan="2">Min:Max</td>
            <td>{{list.LED_R3}}</td>
            <td>{{list.LED_R5}}</td>
            <td colspan="2">{{list.LED_R8}}</td>
        </tr>

        <tr>
            <td rowspan="2">G</td>
            <td colspan="2" rowspan="2">{{list.LED_G1}}</td>
            <td colspan="2">实际范围</td>
            <td>{{list.LED_G2}}</td>
            <td>{{list.LED_G4}}</td>
            <td>{{list.LED_G6}}</td>
            <td>{{list.LED_G7}}</td>
            <td rowspan="2">{{list.LED_G9}}</td>
            <td rowspan="2">{{list.LED_G10}}</td>
            <td rowspan="2">{{list.LED_G11}}</td>
        </tr>
        <tr>
            <td colspan="2">Min:Max</td>
            <td>{{list.LED_G3}}</td>
            <td>{{list.LED_G5}}</td>
            <td colspan="2">{{list.LED_G8}}</td>
        </tr>

        <tr>
            <td rowspan="2">B</td>
            <td colspan="2" rowspan="2">{{list.LED_B1}}</td>
            <td colspan="2">实际范围</td>
            <td>{{list.LED_B2}}</td>
            <td>{{list.LED_B4}}</td>
            <td>{{list.LED_B6}}</td>
            <td>{{list.LED_B7}}</td>
            <td rowspan="2">{{list.LED_B9}}</td>
            <td rowspan="2">{{list.LED_B10}}</td>
            <td rowspan="2">{{list.LED_B11}}</td>
        </tr>
        <tr>
            <td colspan="2">Min:Max</td>
            <td>{{list.LED_B3}}</td>
            <td>{{list.LED_B5}}</td>
            <td colspan="2">{{list.LED_B8}}</td>
        </tr>

        <tr>
            <td colspan="12" class="tdco">小样灯管及参数(联建测试值)</td>
        </tr>
        <tr>
            <td colspan="3">LED厂家及型号</td>
            <td colspan="2"></td>
            <td colspan="2">IV(mcd)</td>
            <td colspan="2">WD(nm)</td>
            <td colspan="2">正向电压（vf）</td>
            <td>IV@IF(mA)</td>
        </tr>
        <tr>
            <td rowspan="2">R</td>
            <td colspan="2" rowspan="2">{{list.Small_R1}}</td>
            <td colspan="2">实际范围</td>
            <td>{{list.Small_R2}}</td>
            <td>{{list.Small_R4}}</td>
            <td>{{list.Small_R6}}</td>
            <td>{{list.Small_R7}}</td>
            <td rowspan="2">{{list.Small_R9}}</td>
            <td rowspan="2">{{list.Small_R10}}</td>
            <td rowspan="2">{{list.Small_R11}}</td>
        </tr>
        <tr>
            <td colspan="2">Min:Max</td>
            <td>{{list.Small_R3}}</td>
            <td>{{list.Small_R5}}</td>
            <td colspan="2">{{list.Small_R8}}</td>
        </tr>

        <tr>
            <td rowspan="2">G</td>
            <td colspan="2" rowspan="2">{{list.Small_G1}}</td>
            <td colspan="2">实际范围</td>
            <td>{{list.Small_G2}}</td>
            <td>{{list.Small_G4}}</td>
            <td>{{list.Small_G6}}</td>
            <td>{{list.Small_G7}}</td>
            <td rowspan="2">{{list.Small_G9}}</td>
            <td rowspan="2">{{list.Small_G10}}</td>
            <td rowspan="2">{{list.Small_G11}}</td>
        </tr>
        <tr>
            <td colspan="2">Min:Max</td>
            <td>{{list.Small_G3}}</td>
            <td>{{list.Small_G5}}</td>
            <td colspan="2">{{list.Small_G8}}</td>
        </tr>

        <tr>
            <td rowspan="2">B</td>
            <td colspan="2" rowspan="2">{{list.Small_B1}}</td>
            <td colspan="2">实际范围</td>
            <td>{{list.Small_B2}}</td>
            <td>{{list.Small_B4}}</td>
            <td>{{list.Small_B6}}</td>
            <td>{{list.Small_B7}}</td>
            <td rowspan="2">{{list.Small_B9}}</td>
            <td rowspan="2">{{list.Small_B10}}</td>
            <td rowspan="2">{{list.Small_B11}}</td>
        </tr>
        <tr>
            <td colspan="2">Min:Max</td>
            <td>{{list.Small_B3}}</td>
            <td>{{list.Small_B5}}</td>
            <td colspan="2">{{list.Small_B8}}</td>
        </tr>

        <tr>
            <td colspan="12" style="text-align:left">备注：{{list.ReportRemark}}</td>
        </tr>
    </table>
    <br />
    <div style="float:inherit">
        <span style="margin-left:180px">
            核准：{{list.Approved}}
        </span>
        <span style="margin-left:240px">
            审核：{{list.Assessor}}
        </span>
        <span style="margin-left:240px">
            测试：{{list.Tester}}
        </span>
    </div>
    <el-button size="small" style="margin-left:160px;margin-top:10px;" type="primary" v-on:click="goback">返回</el-button>

</div>

<script>
    Vue.filter("timeFilter", function (val) {
        if (!val) return '';
        let dd = val.split("T")
        return dd[0]
    })
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
    let app = new Vue({
        el: "#app",
        data: {
            id: null,
            list: {},
        },
        methods: {
            goback() {
                window.history.back();
            },
            geTableData() {
                axios.post("/Small_Sample/Display", { id: this.id }).then(res=> {
                    console.log(res.data)
                    this.list = res.data
                    this.checkInfos();
                }).catch(err=> {
                    this.$message({
                        message: "连接失败",
                        type: "warning"
                    })
                })
            },
            checkInfos() {
                //白色亮度确认
                var rgbs = ((this.list.Angle_R1 + this.list.Angle_G1 + this.list.Angle_B1) * 0.98).toFixed(2);
                console.log(this.list)
                var rgb1 = ((this.list.Angle_R1 + this.list.Angle_G1 + this.list.Angle_B1) * 1.02).toFixed(2);
                console.log(rgb1)
                if (rgbs > this.list.Angle_W1 || this.list.Angle_W1 > rgb1) {
                    $(".luminance").removeClass("pass")
                    $(".luminance").addClass("red")
                    $(".luminance").attr("title", 'R+G+B之和应在' + rgbs + '-' + rgb1 + '之间')
                } else {
                    $(".luminance").removeClass("red")
                    $(".luminance").addClass("pass")
                    $(".luminance").removeAttr("title")
                };

                //白色温度确认
                if (this.list.Client_W2 === 8500) { //8500K
                    if (0.285 > this.list.Angle_W2 || this.list.Angle_W2 > 0.291) {
                        $(".colorTmin").removeClass("pass")
                        $(".colorTmin").addClass("red")
                        $(".colorTmin").attr("title", '色温范围应在0.285-0.291之间')
                    } else {
                        $(".colorTmin").removeClass("red")
                        $(".colorTmin").addClass("pass")
                        $(".colorTmin").removeAttr("title")
                    };
                    if (0.302 > this.list.Angle_W3 || this.list.Angle_W3 > 0.308) {
                        $(".colorTmax").removeClass("pass")
                        $(".colorTmax").addClass("red")
                        $(".colorTmax").attr("title", '色温范围应在0.302-0.308之间')
                    } else {
                        $(".colorTmax").removeClass("red")
                        $(".colorTmax").addClass("pass")
                        $(".colorTmax").removeAttr("title")
                    };
                } else if (this.list.Client_W2 === 6500) { //6500K
                    if (0.310 > this.list.Angle_W2 || this.list.Angle_W2 > 0.316) {
                        $(".colorTmin").removeClass("pass")
                        $(".colorTmin").addClass("red")
                        $(".colorTmin").attr("title", '色温范围应在0.310-0.316之间')
                    } else {
                        $(".colorTmin").removeClass("red")
                        $(".colorTmin").addClass("pass")
                        $(".colorTmin").removeAttr("title")

                    };
                    if (0.325 > this.list.Angle_W3 || this.list.Angle_W3 > 0.331) {
                        $(".colorTmax").removeClass("pass")
                        $(".colorTmax").addClass("red")
                        $(".colorTmax").attr("title", '色温范围应在0.325-0.331之间')
                    } else {
                        $(".colorTmax").removeClass("red")
                        $(".colorTmax").addClass("pass")
                        $(".colorTmax").removeAttr("title")

                    }
                } else { };

                //白平衡确认
                if (this.list.Client_W1 === '校正前') {
                    //console.log("这是校正前")
                    var minq = (this.list.Client_W1_V * 1.1 * 0.97).toFixed(2);
                    var maxq = (this.list.Client_W1_V * 1.1 * 1.03).toFixed(2);
                    if (minq > this.list.Angle_W1 || this.list.Angle_W1 > maxq) {
                        $(".front").removeClass("pass")
                        $(".front").addClass("red")
                        $(".front").attr("title", '白平衡范围应在' + minq + '-' + maxq + '之间')
                    } else {
                        $(".front").removeClass("red")
                        $(".front").addClass("pass")
                        $(".front").removeAttr("title")
                    }
                } else if (this.list.Client_W1 === '校正后') {
                    //console.log("这是校正后")
                    var minh = (this.list.Client_W1_V * 1.17 * 0.97).toFixed(2);
                    var maxh = (this.list.Client_W1_V * 1.17 * 1.03).toFixed(2);
                    if (minh > this.list.Angle_W1 || this.list.Angle_W1 > maxh) {
                        $(".front").removeClass("pass")
                        $(".front").addClass("red")
                        $(".front").attr("title", '白平衡范围应在' + minh + '-' + maxh + '之间')
                    } else {
                        $(".front").removeClass("red")
                        $(".front").addClass("pass")
                        $(".front").removeAttr("title")
                    }
                } else { };

                //单板电流确认
                if (this.list.Mo2 != null) {
                    let theMax = 4;
                    let theMin = -4
                    if (theMin > this.list.Module_current || this.list.Module_current > theMax) {
                        $(".electricity").removeClass("pass")
                        $(".electricity").addClass("red")
                        $(".electricity").attr("title", '单板电流应在' + "6" + '-' + "-6" + '之间')
                    } else {
                        $(".electricity").removeClass("red")
                        $(".electricity").addClass("pass")
                        $(".electricity").removeAttr("title")
                    }
                } else {
                    this.$message({
                        message: "没有模组型号,无法计算单IC引脚电流!",
                        type:"warning"
                    })
                };

            }
        },
        mounted() {
            this.id = getUrlParam("id")
            this.geTableData();
            
        }
    });

  
</script>
