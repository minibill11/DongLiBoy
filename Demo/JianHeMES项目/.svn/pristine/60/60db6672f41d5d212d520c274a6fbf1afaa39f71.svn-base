@{
    ViewBag.Title = "仓库入库信息";
}

<link href="~/Content/styleFile/packaging/index.css" rel="stylesheet" />@*2.13版本 elementui css文件*@
<link rel="stylesheet/less" type="text/css" href="~/Content/styleFile/warehouseMaterial/warehouse.less" />

<div id="app" v-cloak>
    <el-container>
        <el-header class="text-center">
            @*菜单*@
            <module-menu-component name="MaterialBasicInfo" title="@ViewBag.Title" :limit="limitsRole"></module-menu-component>
        </el-header>
        <el-main v-loading="loading">
            <el-row class="main">
                <el-col :span="12" :xs="24">
                    <div class="flex-item">
                        <label>班组</label>
                        <div>
                            <el-select v-model="Group"
                                       placeholder="请选择班组"
                                       @*:disabled="disabledState"*@
                                       size="medium">
                                <el-option v-for="item in groupOptions"
                                           :key="item"
                                           :label="item"
                                           :value="item">
                                </el-option>
                            </el-select>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>物料编号</label>
                        <div>
                            <el-input placeholder="请输入物料编号"
                                      v-model.trim="Material.MaterialNumber"
                                      size="medium"
                                      autofocus
                                      clearable>
                            </el-input>
                        </div>
                    </div>

                    <div class="flex-item">
                        <label>物料类型</label>
                        <div>
                            <el-input placeholder="请输入物料类型"
                                      v-model.trim="Material.MaterialType"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>单位</label>
                        <div>
                            <el-input placeholder="请输入单位"
                                      v-model.trim="Material.Unit"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>供应商</label>
                        <div>
                            <el-input placeholder="请输入供应商"
                                      v-model.trim="Material.Supplier"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>生产日期</label>
                        <div>
                            <el-date-picker v-model="Material.LeaveFactoryTime"
                                            type="date"
                                            placeholder="选择生产日期"
                                            size="medium">
                            </el-date-picker>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>来料数量</label>
                        <div>
                            <el-input-number v-model.trim="Material.MaterialNum"
                                             size="mudium"
                                             :min="0"
                                             style="width:auto"
                                             clearable>
                            </el-input-number>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>来料日期</label>
                        <div>
                            <el-date-picker v-model="Material.InvoiceDate"
                                            type="date"
                                            placeholder="选择来料日期"
                                            size="medium">
                            </el-date-picker>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>收料人姓名</label>
                        <div>
                            <el-input placeholder="请输入收料人姓名"
                                      v-model.trim="Material.ReceivingClerk"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>批次</label>
                        <div>
                            <el-input placeholder="请输入批次"
                                      v-model.trim="Material.Batch"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>物料规格描述</label>
                        <div>
                            <el-input placeholder="请输入物料规格描述"
                                      v-model.trim="Material.MaterialDiscription"
                                      type="textarea"
                                      autofocus
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>有效期(天)</label>
                        <div>
                            <el-input-number v-model.trim="Material.EffectiveDay"
                                             size="medium"
                                             :min="0"
                                             style="width:auto"
                                             clearable>
                            </el-input-number>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>追加有效期(天)</label>
                        <div>
                            <el-input-number v-model.trim="Material.AddEffectiveDay"
                                             size="medium"
                                             :min="0"
                                             style="width:auto"
                                             clearable>
                            </el-input-number>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>物料条码所包含物料个数</label>
                        <div>
                            <el-input-number v-model.trim="materialContainNum"
                                             size="medium"
                                             :min="0"
                                             style="width:auto"
                                             clearable>
                            </el-input-number>
                        </div>
                    </div>

                    <print-component v-model="printInfo"></print-component>
                    <div class="flex-item">
                        <div>
                            <el-button v-on:click="clear" type="primary" size="small">重置</el-button>
                            <el-button v-on:click="postPrint" type="primary" size="small">确认</el-button>
                        </div>
                    </div>
                    @Html.ActionLink("返回", "Index")
                </el-col>
                <el-col :span="12" :xs="24">

                </el-col>
            </el-row>
        </el-main>
    </el-container>
</div>
@*  引入组件  *@
@RenderPage("_warehouseMenu.cshtml")
@RenderPage("~/Views/ModuleManagement/_print.cshtml")
<script src="~/Scripts/printJS/JsBarcode.all.min.js"></script>
<script src="~/Content/styleFile/packaging/index.js"></script>@*2.13版本 elementui js文件*@
<script src="~/Content/styleFile/less.min.js"></script>
<script src="~/Content/styleFile/warehouseMaterial/warehouse.js"></script>
<script>
    //通过mixins将代码注入vue实例
    var app = new Vue({
        el: "#app",
        mixins: [mixin],
        data: {
            //入库
            Material: {
                MaterialNumber: "",
                MaterialDiscription: "",
                Batch: "",
                MaterialNum: 0,
                Unit: "",
                Department: "",
                Group: "",
                ReceivingClerk: "",
                InvoiceDate: "",
                LeaveFactoryTime: "",
                Supplier: "",
                MaterialType: "",
                EffectiveDay: 180,
                AddEffectiveDay: 0,
            },
            materialContainNum: 0,
            printList:[]
        },
        mounted: function () {
        },
        methods: {
            printBarcode(list) {
                axios.post('/SMT_Sulderpaster/InsideBoxLable_Print', {
                    barcodelist: list,
                    pagecount: this.printInfo.pagecount,
                    concentration: this.printInfo.concentration,
                    ip: this.printInfo.ip,
                    port: this.printInfo.port,
                    leftdissmenion: this.printInfo.leftdissmenion
                }).then(res => {
                    console.log(res.data)
                    let rtm = res.data[0].message;
                    //成功存储和打印
                    if (rtm == '打印成功！') {
                        this.$confirm('打印完成，是否进行下一组录入?', "入库成功", {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'success',
                            center: true,
                        }).then(() => {
                            this.clear();
                        }).catch(() => {
                        });
                        this.loading = false;
                    } else {
                        this.$confirm(rtm + "稍后请重新打印条码。", "入库已成功,未完成打印！", {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning',
                            center: true,
                        }).then(() => {
                            this.clear();
                        }).catch(() => {
                        });
                        this.loading = false;
                    };
                }).catch(err => {
                    console.warn("打印出错");
                    this.loading = false;
                });
            },
            //验证条码，录入信息，打印条码，
            postPrint() {
                this.loading = true;
                this.Material.Group = this.Group;
                this.Material.Department = this.Department;
                //录入数据
                axios.post('/Warehouse_Material/MaterialBasicInfo', {
                    materialBasicInfo_Collection: this.Material,
                    materialContainNum: this.materialContainNum
                }).then(res => {

                    //this.printList = ["2020AHCJ0014DSA001", "2020AHCJ0014DSA002", "2020AHCJ0014DSA003", "2020AHCJ0014DSA004", "2020AHCJ0014DSA005",
                    //    "2020AHCJ0014DSA006", "2020AHCJ0014DSA007", "2020AHCJ0014DSA008", "2020AHCJ0014DSA009", "2020AHCJ0014DSA010",
                    //    "2020AHCJ0014DSA011", "2020AHCJ0014DSA012", "2020AHCJ0014DSA013", "2020AHCJ0014DSA014", "2020AHCJ0014DSA015",
                    //    "2020AHCJ0014DSA016", "2020AHCJ0014DSA017", "2020AHCJ0014DSA018", "2020AHCJ0014DSA019", "2020AHCJ0014DSA020"]



                    if (res.data.Res) {
                        console.log(res.data.BarcodeList);
                        console.log(res.data.MaterialDiscription);
                        //this.printBarcode(res.data.BarcodeList,res.data.MaterialDiscription);
                        this.message.success("录入成功");
                        this.loading = false;
                    } else {
                        this.$alert(res.data.Meg, {
                            closeOnClickModal: true,
                            closeOnPressEscape: true,
                            type: "error",
                        });
                        this.loading = false;
                    };
                }).catch(err => {
                    console.warn("post失败")
                    this.loading = false;
                });
            },
            //清空
            clear() {
                this.Material = {
                    MaterialNumber: "",
                    MaterialDiscription: "",
                    Batch: "",
                    MaterialNum: 0,
                    Unit: "",
                    Department: this.Department,
                    Group: this.Group,
                    ReceivingClerk: "",
                    InvoiceDate: "",
                    LeaveFactoryTime: "",
                    Supplier: "",
                    MaterialType: "",
                    EffectiveDay: 180,
                    AddEffectiveDay: 0,
                };
                this.materialContainNum = 0;
            },
        },
    });
</script>