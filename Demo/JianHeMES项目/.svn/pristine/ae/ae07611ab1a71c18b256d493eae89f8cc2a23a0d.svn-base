@model JianHeMES.Models.EquipmentStatusRecord

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/axios.min.js"></script>
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>

<style>

    table{
        width:1139px;
    }
    .popoverforimg img{
        width:auto;
        height:100%;
    }
   .popoverforimg .el-dialog__body{
       padding:0;
   }
  .popoverforimg .el-dialog__header{
      display:none;
  }
   .popoverforimg .el-dialog{
       margin:15px auto !important;
       height:auto !important;
   }
    .fuck{
        display:flex;
        justify-content:space-between;
        margin-top:4px;
    }
    .fuck span{
        display:inline-block;
        width:40%;
        text-align:right;
        vertical-align:middle;
        padding:4px;
    }
    .el-dialog__body{
        padding:5px;
    }
    .el-dialog__body>div{
        display:inline-block;
        width:46%;
    }
    .el-input{
        display:inline-block;
        width:60%;
        padding:0;
    }
    .el-input input{
        padding:0 !important;
    }
    .tabletop,thead,th,td,.tablebottom{
        text-align:center;
    }
    .tabletop tr,.tablebottom tr{
        height:34px;
    }
    .tabletop tr td:nth-child(1){
        width:100px;
    }
    .tabletop tr td:nth-child(2){
        width:150px;
    }
    .tabletop tr td:nth-child(3){
        width:100px;
    }
    .tabletop tr td:nth-child(4){
        width:150px;
    }
    .tabletop tr td:nth-child(5){
        width:170px;
    }
    .tabletop tr td:nth-child(6){
        width:280px;
    }

    .tablebottom tr td:nth-child(1){
        width:42px;
    }
    .tablebottom tr td:nth-child(2){
        width:123px;
    }
    .tablebottom tr td:nth-child(3){
        width:123px;
    }
    .tablebottom tr td:nth-child(4){
        width:165px;
    }
    .tablebottom tr td:nth-child(5){
         width:167px;
    }
    .tablebottom tr td:nth-child(6){
         width:165px;
    }
    .tablebottom tr td:nth-child(7){
        width:165px;
    }
    .tablebottom tr td:nth-child(8){
        width:70px;
    }
    .tablebottom tr td:nth-child(9){
        width:150px;
    }
    .changecolor{
        background-color:#66b1ff;
        border-color:#66b1ff;
        color:white;
    }
    .changebgc{
        background-color:#66b1ff
    }
</style>
<h2>Details</h2>
<div id="app">
    <el-button type="primary" size="mini" plain><span>@Html.ActionLink("批量添加维修记录", "InputEquipmentRepairRecord")</span></el-button>
    <el-button type="primary" size="mini" plain><span>@Html.ActionLink("单个添加维修记录", "InputEquipmentRepairRecordSingle")</span></el-button>
    <form id="myform"  style="display:none;" action="/Equipment/UploadEquipmentPicture" method="post"> 
        <input class="upload" v-model="file" name="uploadfile" type="file" />
        <input class="upload1" v-model="AssetNumber" name="assetNumber" type="text" />
        <input type="reset" class="reset" />
    </form>
    <table class="tabletop" border="1">
        <thead>
            <tr>
                <th colspan="6">
                    SMT部设备保养、维修履历资料汇总表
                    <select id="selectChange" style="margin-left:150px;height:100%;width:120px;">
                        <option>{{tabletop.Status}}</option>
                        <option>运行</option>
                        <option>调机</option>
                        <option>保养</option>
                        <option>停机</option>
                        <option>维修</option>
                    </select>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>资产编号</td>
                <td>{{tabletop.AssetNumber}}</td>
                <td>设备名称</td>
                <td>{{tabletop.EquipmentName}}</td>
                <td>使用部门</td>
                <td colspan="4" rowspan="4">
                    <el-carousel height="150px" trigger="click" v-bind:interval="4000">
                        <el-carousel-item v-for="(item,index) in imgArr" key="item">
                            <img style="width:100%;height:100%;" v-on:click="showBigImg(index)" v-bind:src="item.FullPath" />
                        </el-carousel-item>
                    </el-carousel>
                </td>
            </tr>
            <tr>
                <td>设备编码</td>
                <td>{{tabletop.EquipmentNumber}}</td>
                <td>型号规格</td>
                <td>{{tabletop.ModelSpecification}}</td>
                <td>{{tabletop.UserDepartment}}</td>
                
                
            </tr>
            <tr>
                <td>出厂编号</td>
                <td>{{tabletop.ManufacturingNumber}}</td>
                <td>生产厂家</td>
                <td>{{tabletop.Brand}}</td>
                <td rowspan="2"><button v-on:click="chiose">选择</button>&nbsp;&nbsp;&nbsp;&nbsp;<button v-on:click="postImgs">上传图片</button>{{fname}}</td>
            </tr>
            <tr>
                <td>购入日期</td>
                <td>{{tabletop.CreateTime}}</td>
                <td>启用日期</td>
                <td>{{tabletop.ActionDate}}</td>
            </tr>
            <tr>
                <td colspan="6">
                    <strong>
                        <button v-on:click="addRecord">增加维修记录</button>   

                        <span style="margin: auto 245px;font-size:15px;">设备维修记录 </span>  
                        
                        <span>请选择需要修改的序号：</span>
                        <select v-model="selectVal">
                            <option v-for="(item,index) in statusrecord">{{index+1}}</option>
                        </select>  
                        <button v-on:click="shangeInfos" v-bind:class="flags3==true?'changecolor':''">修改维修记录</button>
                    </strong>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="tablebottom" border="1">
        <thead>
            <tr>
                <th>
                    序号
                </th>
                <th>
                    故障现象描述
                </th>
                <th>
                    原因分析
                </th>
                <th>
                    维修或检测内容
                </th>
                <th>
                    接单时间
                </th>
                <th>
                    计划完成时间
                </th>
                <th>
                    实际完成时间
                </th>
                <th>
                    维修人
                </th>
                <th>
                    备注
                </th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="(item,index) in statusrecord" v-bind:class="item.addcolor==200?'':'changebgc'"  v-on:click.stop="getSelectVal(index)">
                <td>{{index + 1}}</td>
                <td>{{item.FailureDescription}}</td>
                <td>{{item.Reason}}</td>
                <td>{{item.RepairOrTestContent}}</td>
                <td>{{item.GetJobTime}}</td>
                <td>{{item.PlanFinishTime}}</td>
                <td>{{item.ActualFinishTime}}</td>
                <td>{{item.RepairMan}}</td>
                <td>{{item.Remark}}</td>
            </tr>
        </tbody>
    </table>
    <el-button onclick="goback()" type="primary" size="mini" plain>返回</el-button>
    <el-dialog title="提示"
               v-bind:visible.sync="dialogVisible"
               width="60%"
               style="text-align:center;"
               v-bind:before-close="handleClose">
        <span>新增设备维修记录</span>
        <hr />
        
        <div>
            <div class="fuck">
               <span> 设备编号：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-bind:disabled="true"
                          v-model="form1.input1"
                          clearable>
                </el-input>
            </div>
        </div>
        <div>
            <div class="fuck">
                <span>资产编号：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-bind:disabled="true"
                          v-model="form1.input2"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>设备名称：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-bind:disabled="true"
                          v-model="form1.input3"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>订单号：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input4"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>设备状态：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input5"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>状态开始时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input6"
                          clearable>
                </el-input>

            </div>

            
        </div>
        <div>
            <div class="fuck">
                <span>状态结束时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input7"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>报修人：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input8"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>故障现象描述：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input9"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>原因分析：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input10"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>维修或检测内容：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input11"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>维修接单时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input12"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>计划完成时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input13"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>实际完成时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input14"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>维修人：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input15"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>配件信息：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input16"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>使用部门：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input17"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>车间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input18"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>产线号：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input19"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>工段：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input20"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>记录修改人：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-bind:disabled="true"
                          v-model="form1.input21"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                <span>备注：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input22"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <span slot="footer" class="dialog-footer">
            <el-button v-on:click="dialogVisible = false">取 消</el-button>
            <el-button type="primary" v-on:click="addRepiaInfo">保存</el-button>
        </span>
    </el-dialog>

    <el-dialog title="提示"
               v-bind:visible.sync="dialogVisibles"
               width="65%"
               v-bind:before-close="handleClose">
        <span>修改设备维修记录</span>
        <hr />

        <div>
            <div class="fuck">
                <span>设备编号：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-bind:disabled="true"
                          v-model="form2.input1"
                          clearable>
                </el-input>
            </div>
        </div>
        <div>
            <div class="fuck">
                <span>资产编号：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-bind:disabled="true"
                          v-model="form2.input2"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>设备名称：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-bind:disabled="true"
                          v-model="form2.input3"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>订单号：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input4"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>设备状态：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input5"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>状态开始时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input6"
                          clearable>
                </el-input>
            </div>


        </div>
        <div>
            <div class="fuck">
                <span>状态结束时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input7"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>报修人：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input8"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>故障现象描述：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input9"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>原因分析：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input10"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>维修或检测内容：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input11"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>维修接单时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input12"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>计划完成时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input13"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>实际完成时间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input14"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>维修人：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input15"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>配件信息：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input16"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>使用部门：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input17"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>车间：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input18"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>产线号：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input19"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>工段：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input20"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>记录修改人：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-bind:disabled="true"
                          v-model="form2.input21"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                <span>备注：</span>
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input22"
                          clearable>
                </el-input>
            </div>

        </div>
        <span slot="footer" class="dialog-footer">
            <el-button v-on:click="dialogVisibles = false">取 消</el-button>
            <el-button type="primary" v-on:click="addChangedInfos">保存</el-button>
        </span>
    </el-dialog>

    <el-dialog class="popoverforimg"
               v-bind:visible.sync="dialogVisible3"
               width="68%"
               >
        <img v-bind:src="showImg" />
    </el-dialog>
</div>

@{
    var UserName = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).UserName;
    var UserRole = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).Role;
    var UserId = Session["User"] == null ? 0 : ((JianHeMES.Models.Users)Session["User"]).UserNum;
    var ischeck = ViewBag.editinfo;
}

<script>
    //时间格式化
    function GMTToStr(time) {
        if (time != null) {
            let date = new Date(time)
            //console.log(date);
            let Str = date.getFullYear() + '-' +
                (date.getMonth() + 1).toString().padStart(2,'0') + '-' +
                date.getDate().toString().padStart(2, '0') + ' ' +
                date.getHours().toString().padStart(2, '0') + ':' +
                date.getMinutes().toString().padStart(2, '0')
            return Str
        } else {
            return ''
        }
    }

    //返回历史记录
    function goback() {
        window, history.back();
    }

    // 增加维修记录
    function addIndos() {

    }

    

    let vm = new Vue({
        el: "#app",
        data: {
            flags3:false,
            selectVal:null,
            username: '@UserName',
            dialogVisible3:false,
            AssetNumber: null,
            tabletop: '',
            imgs: null,
            file: null,
            fname:'',
            imgArr: [],
            statusrecord: [],
            status: null,
            dialogVisible: false,
            dialogVisibles: false,
            showImg:null,
            form1: {
                input1: null,
                input2: null,
                input3: null,
                input4: null,
                input5: null,
                input6: null,
                input7: null,
                input8: null,
                input9: null,
                input10: null,
                input11: null,
                input12: null,
                input13: null,
                input14: null,
                input15: null,
                input16: null,
                input17: null,
                input18: null,
                input19: null,
                input20: null,
                input21: null,
                input22: null,
            },
            form2: {
                input1: null,
                input2: null,
                input3: null,
                input4: null,
                input5: null,
                input6: null,
                input7: null,
                input8: null,
                input9: null,
                input10: null,
                input11: null,
                input12: null,
                input13: null,
                input14: null,
                input15: null,
                input16: null,
                input17: null,
                input18: null,
                input19: null,
                input20: null,
                input21: null,
                input22: null,
            }

        },
        mounted() {
            let hrefStr = window.location.href;
            let indexofequl = hrefStr.indexOf("=") + 1;
            this.AssetNumber = hrefStr.slice(indexofequl) // 获取index传过来的资产编号
            this.getDefaultInfos(this.AssetNumber)
            //console.log(this.AssetNumber)
        },
        methods: {
            handleClose(done) {
                this.$confirm('确认关闭？')
                  .then(_ => {
                      done();
                  })
                  .catch(_ => {});
            },
            getDefaultInfos(nums) {
                axios.post("/Equipment/Details", { assetNumber: this.AssetNumber }).then(res=> {
                    //console.log(res.data)
                    // 获取基本信息
                    let basicInfos = JSON.parse(res.data.basicinfo);
                    basicInfos.ActionDate = GMTToStr(basicInfos.ActionDate);
                    basicInfos.CreateTime = GMTToStr(basicInfos.CreateTime);
                    //console.log(basicInfos)
                    this.tabletop = basicInfos;

                    // 获取图片 
                    if (res.data.picture != '未上传图片。') {
                        let img = JSON.parse(res.data.picture);
                        
                        img.forEach(item=> {
                            item.FullPath=item.FullPath.replace(/D:/, '')
                        })
                        //console.log(img)
                        this.imgArr = img
                       
                    } else {

                    }

                    //获取维修记录

                    let statusrecord = JSON.parse(res.data.statusrecord);
                    
                    statusrecord.forEach(item=> {
                        item.GetJobTime = GMTToStr(item.GetJobTime)
                        item.PlanFinishTime = GMTToStr(item.PlanFinishTime)
                        item.ActualFinishTime = GMTToStr(item.ActualFinishTime)
                        item.addcolor = 200
                    })
                    this.statusrecord = statusrecord;
                }).catch(err=> {

                })
            },
            postImgs() {
                let tt = $('.upload')[0].files[0];
                if (tt != null) {
                    console.log($('.upload'))
                    let f = new FormData();
                    let tt = $('.upload')[0].files[0];
                    f.append("assetNumber", this.AssetNumber);
                    f.append("uploadfile", tt);
                    console.log(tt)
                    axios.post("/Equipment/UploadEquipmentPicture", f).then(res=> {  // 
                        console.log(res.data)
                        if (res.data == '上传成功！') {
                            this.$message({
                                message: res.data,
                                type: 'success'
                            });
                            $('.reset').click();

                        } else {
                            this.$message({
                                message: res.data,
                                type: 'success'
                            })
                        }; 
                    }).catch(err=> {
                        this.$message({
                            message: "连接服务器失败!",
                            type: 'warning'
                        })
                    })

                } else {
                    this.$message({
                        message: "请选择需要上传的图片！",
                        type: 'warning'
                    })
                }
            },
            chiose() {
                $(".upload").click();  // 用户选择图片
            },
            addRepiaInfo() {
                if (true) {
                    let form = new FormData();
                    form.append('EquipmentNumber', this.form1.input1);  // 设备编号
                    form.append('AssetNumber', this.form1.input2);  // 资产编号
                    form.append('EquipmentName', this.form1.input3);  // 设备名称
                    form.append('OrderNum', this.form1.input4);  // 订单号
                    form.append('Status', this.form1.input5);  // 设备状态
                    form.append('StatusStarTime', this.form1.input6);  // 状态开始时间
                    form.append('StatusEndTime', this.form1.input7);  // 状态结束时间
                    form.append('ReportRepairMan', this.form1.input8);  // 报修人
                    form.append('FailureDescription', this.form1.input9);  // 故障现象描述
                    form.append('Reason', this.form1.input10);  // 原因分析
                    form.append('RepairOrTestContent', this.form1.input11);  // 维修或检测内容
                    form.append('GetJobTime', this.form1.input12);  // 维修接单时间
                    form.append('PlanFinishTime', this.form1.input13);  // 计划完成时间
                    form.append('ActualFinishTime', this.form1.input14);  // 实际完成时间
                    form.append('RepairMan', this.form1.input15);  // 维修人
                    form.append('SparePartsInfo', this.form1.input16);  // 配件信息
                    form.append('UserDepartment', this.form1.input17);  // 使用部门
                    form.append('WorkShop', this.form1.input18);  // 车间
                    form.append('LineNum', this.form1.input19);  // 产线号
                    form.append('Section', this.form1.input20);  // 工段
                    form.append('Modifier', this.form1.input21);  // 记录修改人
                    form.append('Remark', this.form1.input22);  // 备注
                    axios.post("/Equipment/AddEquipmentStatusRecordAsync", form).then(res=> {
                        console.log(res.data)
                        if (res.data == 'False') {
                            this.$message({
                                message: "上传失败！",
                                type:'warning'
                            })

                        } else {
                            this.$message({
                                message: "上传成功！",
                                type: 'success'
                            });
                            this.dialogVisible = false   // 关闭弹框
                            this.getDefaultInfos()  // 重新获取数据
                            this.form1.input1 = null;
                            this.form1.input2 = null;
                            this.form1.input3 = null;
                            this.form1.input4 = null;
                            this.form1.input5 = null;
                            this.form1.input6 = null;
                            this.form1.input7 = null;
                            this.form1.input8 = null;
                            this.form1.input9 = null;
                            this.form1.input10 = null;
                            this.form1.input11 = null;
                            this.form1.input12 = null;
                            this.form1.input13 = null;
                            this.form1.input14 = null;
                            this.form1.input15 = null;
                            this.form1.input16 = null;
                            this.form1.input17 = null;
                            this.form1.input18 = null;
                            this.form1.input19 = null;
                            this.form1.input20 = null;
                            this.form1.input21 = null;
                            this.form1.input22 = null;
                        }

                    }).catch(err=> {

                    })
                }
                
            },
            showBigImg(index) {
                this.showImg = this.imgArr[index].FullPath;
                this.dialogVisible3 = true;
            },
            addRecord() {
                this.dialogVisible = true;
                this.form1.input2 = this.tabletop.AssetNumber
                this.form1.input1 = this.tabletop.EquipmentNumber
                this.form1.input3 = this.tabletop.EquipmentName
                this.form1.input21 = this.username
            },
            shangeInfos() {
                if (this.selectVal == null) {
                    this.$message({
                        message: "请选择需要修改的记录!",
                        type:"warning"
                    })
                } else {
                    this.dialogVisibles = true
                    this.form2.input2 = this.tabletop.AssetNumber
                    this.form2.input1 = this.tabletop.EquipmentNumber
                    this.form2.input3 = this.tabletop.EquipmentName
                    this.form2.input21 = this.username

                    let chiosedInfo = this.statusrecord[this.selectVal - 1];
                    this.form2.input4 = chiosedInfo.OrderNum
                    this.form2.input5 = chiosedInfo.Status
                    this.form2.input6 = chiosedInfo.StatusStarTime
                    this.form2.input7 = chiosedInfo.StatusEndTime
                    this.form2.input8 = chiosedInfo.ReportRepairMan
                    this.form2.input9 = chiosedInfo.FailureDescription
                    this.form2.input10 = chiosedInfo.Reason
                    this.form2.input11 = chiosedInfo.RepairOrTestContent
                    this.form2.input12 = chiosedInfo.GetJobTime
                    this.form2.input13 = chiosedInfo.PlanFinishTime
                    this.form2.input14 = chiosedInfo.ActualFinishTime
                    this.form2.input15 = chiosedInfo.RepairMan
                    this.form2.input16 = chiosedInfo.SparePartsInfo
                    this.form2.input17 = chiosedInfo.UserDepartment
                    this.form2.input18 = chiosedInfo.WorkShop
                    this.form2.input19 = chiosedInfo.LineNum
                    this.form2.input20 = chiosedInfo.Section
                    this.form2.input22 = chiosedInfo.Remark
                    console.log(chiosedInfo)
                    
                }
                
            },
            addChangedInfos() {
                let form = new FormData();
                form.append('EquipmentNumber', this.form1.input1);  // 设备编号
                form.append('AssetNumber', this.form1.input2);  // 资产编号
                form.append('EquipmentName', this.form1.input3);  // 设备名称
                form.append('OrderNum', this.form1.input4);  // 订单号
                form.append('Status', this.form1.input5);  // 设备状态
                form.append('StatusStarTime', this.form1.input6);  // 状态开始时间
                form.append('StatusEndTime', this.form1.input7);  // 状态结束时间
                form.append('ReportRepairMan', this.form1.input8);  // 报修人
                form.append('FailureDescription', this.form1.input9);  // 故障现象描述
                form.append('Reason', this.form1.input10);  // 原因分析
                form.append('RepairOrTestContent', this.form1.input11);  // 维修或检测内容
                form.append('GetJobTime', this.form1.input12);  // 维修接单时间
                form.append('PlanFinishTime', this.form1.input13);  // 计划完成时间
                form.append('ActualFinishTime', this.form1.input14);  // 实际完成时间
                form.append('RepairMan', this.form1.input15);  // 维修人
                form.append('SparePartsInfo', this.form1.input16);  // 配件信息
                form.append('UserDepartment', this.form1.input17);  // 使用部门
                form.append('WorkShop', this.form1.input18);  // 车间
                form.append('LineNum', this.form1.input19);  // 产线号
                form.append('Section', this.form1.input20);  // 工段
                form.append('Modifier', this.form1.input21);  // 记录修改人
                form.append('Remark', this.form1.input22);  // 备注

                axios.post("/Equipment/AddEquipmentStatusRecordAsync", form).then(res=> {
                    console.log(res.data);
                    if (res.data == "True") {
                        this.$message({
                            message: "修改成功!",
                            type: "success"
                        });
                        this.dialogVisibles = false
                    } else {
                        this.$message({
                            message: "修改失败!",
                            type: "warning"
                        })
                    }
                }).catch(err=> {
                    this.$message({
                        message: "连接服务器失败!",
                        type: "warning"
                    })
                })
            },
            getSelectVal(indexs) {
                this.statusrecord.forEach((item, index) => {
                    if (indexs == index) {
                        item.addcolor = 202
                    } else {
                        item.addcolor = 200
                    }
                });
                this.selectVal = indexs + 1
            }

        },
        watch: {
            selectVal() {
                if (this.selectVal != null) {
                    this.flags3 = true
                }
            }
        }
    });


    // 修改设备状态
    window.onload = function () {
        $("#selectChange").change(function () {
            axios.post("/Equipment/ModifyEquipmentStatusAsync", { id: vm.tabletop.Id, status: $("#selectChange").val() }).then(res=> {
                console.log(res.data)
                if (res.data == 'False') {
                    vm.$message({
                        message: "修改设备状态失败！",
                        type: "warning"
                    })
                } else {
                    vm.$message({
                        message: "修改成功！",
                        type: "success"
                    })
                }
            }).catch(err=> {

            })
        });

        // 监听输入框的改变
        $(".upload").bind('input porpertychange', function () {
            vm.fname = ''
            let tt = $('.upload')[0].files[0];
            vm.fname = tt.name
            console.log("it changed")
        });

    }
    
</script>

@*<div>
    <h4>EquipmentBasicInfo</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.SerialNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.SerialNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EquipmentNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EquipmentNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.AssetNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.AssetNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EquipmentName)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EquipmentName)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Brand)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Brand)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ModelSpecification)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ModelSpecification)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.InfoPlate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.InfoPlate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ManufacturingNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ManufacturingNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Quantity)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Quantity)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ActionDate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ActionDate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.DepreciableLife)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.DepreciableLife)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.UserDepartment)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.UserDepartment)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.StoragePlace)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.StoragePlace)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.WorkShop)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.WorkShop)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.LineNum)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.LineNum)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Section)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Section)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.FunctionDiscription)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.FunctionDiscription)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Status)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Status)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Creator)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Creator)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.CreateTime)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.CreateTime)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Modifier)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Modifier)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ModifyTime)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ModifyTime)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Remark)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Remark)
        </dd>

    </dl>
</div>
<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.Id }) |
    @Html.ActionLink("Back to List", "Index")
</p>*@
