
@{
    ViewBag.Title = "汇总表";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Scripts/axios.min.js"></script>

<style>

        table .cell,table td {
        text-align: center;
        padding:2px !important;
    }
        .timeinputcontainer{
            margin:12px auto;
            text-align:center;
        }

</style>

@*<h3>汇总表</h3>*@

<div id="app">
    <div class="timeinputcontainer">
        <el-date-picker size="mini"
                        v-model="times"
                        type="month"
                        placeholder="选择月">
        </el-date-picker>
        月度优秀班组评优汇总表
        @*{{times}}*@
    </div>
    <el-table v-bind:data="tableData"
              style="width: 100%">
        <el-table-column type="index"
                         label="序号"
                         fixed
                         width="54"
                         v-bind:index="indexMethod">
        </el-table-column>
        <el-table-column prop="assetDepar"
                         label="被考核部门"
                         fixed
                         width="130">
        </el-table-column>
        <el-table-column prop="group"
                         width="130"
                         fixed
                         label="班组">
        </el-table-column>
        <el-table-column label="效率指标35%"
                         >
            <el-table-column prop="oneIndexName"
                             label="指标名称"
                             width="130">
            </el-table-column>
            <el-table-column prop="oneTarget_value"
                             label="目标值"
                             width="80">
            </el-table-column>
            <el-table-column prop="oneActual_completion_value"
                             label="实际完成值"
                             width="90">
            </el-table-column>
            <el-table-column prop="oneAdanx"
                             label="单项得分"
                             width="80">
            </el-table-column>
            <el-table-column prop="oneAdefen"
                             label="得分小计"
                             width="80">
            </el-table-column>
            <el-table-column prop="oneDepartmentData"
                             label="数据来源和提供部门"
                             width="140">
            </el-table-column>
            
        </el-table-column>
        <el-table-column label="品质指标35%">
            <el-table-column prop="twoIndexName"
                             label="指标名称"
                             width="130">
            </el-table-column>
            <el-table-column prop="twoTarget_value"
                             label="目标值"
                             width="80">
            </el-table-column>
            <el-table-column prop="twoActual_completion_value"
                             label="实际完成值"
                             width="90">
            </el-table-column>
            <el-table-column prop="twoAdanx"
                             label="单项得分"
                             width="80">
            </el-table-column>
            <el-table-column prop="twoAdefen"
                             label="得分小计"
                             width="80">
            </el-table-column>
            <el-table-column prop="twoDepartmentData"
                             label="数据来源和提供部门"
                             width="140">
            </el-table-column>

        </el-table-column>
        
        <el-table-column label="月度流失率指标15%">
            <el-table-column prop="threeIndexName"
                             label="指标名称"
                             width="130">
            </el-table-column>
            <el-table-column prop="threeTarget_value"
                             label="目标值"
                             width="80">
            </el-table-column>
            <el-table-column prop="threeActual_completion_value"
                             label="实际完成值"
                             width="90">
            </el-table-column>
            <el-table-column prop="threeEdanx"
                             label="单项得分"
                             width="80">
            </el-table-column>
            <el-table-column prop="threeEdefen"
                             label="得分小计"
                             width="80">
            </el-table-column>
            <el-table-column prop="threeDepartmentData"
                             label="数据来源和提供部门"
                             width="140">
            </el-table-column>

        </el-table-column>
        <el-table-column label="7S评比指标15%">
            <el-table-column prop="fourIndexName"
                             label="指标名称"
                             width="130">
            </el-table-column>
            <el-table-column prop="fourTarget_value"
                             label="目标值"
                             width="80">
            </el-table-column>
            <el-table-column prop="fourActual_completion_value"
                             label="实际完成值"
                             width="90">
            </el-table-column>
            <el-table-column prop="fourFdanx"
                             label="单项得分"
                             width="80">
            </el-table-column>
            <el-table-column prop="fourFdefen"
                             label="得分小计"
                             width="80">
            </el-table-column>
            <el-table-column prop="fourDepartmentData"
                             label="数据来源和提供部门"
                             width="140">
            </el-table-column>

        </el-table-column>
        <el-table-column prop="totalScouce"
                         label="总得分"
                         width="100">
        </el-table-column>
        <el-table-column prop="name"
                         label="当月排名"
                         width="100">
        </el-table-column>
        <el-table-column prop="name"
                         label="当月积分"
                         width="100">
        </el-table-column>
        <el-table-column prop="name"
                         label="备注"
                         width="100">
        </el-table-column>

    </el-table>
</div>

<script>
    let app = new Vue({
        el: "#app",
        data: {
            tableData: [],
            times: null,
            tableData3: [{
                date: '2016-05-03',
                name: '王小虎',
                province: '上海',
                city: '普陀区',
                address: '上海市普陀区金沙江路 1518 弄',
                zip: 200333
            }, {
                date: '2016-05-02',
                name: '王小虎',
                province: '上海',
                city: '普陀区',
                address: '上海市普陀区金沙江路 1518 弄',
                zip: 200333
            }, {
                date: '2016-05-04',
                name: '王小虎',
                province: '上海',
                city: '普陀区',
                address: '上海市普陀区金沙江路 1518 弄',
                zip: 200333
            }, {
                date: '2016-05-01',
                name: '王小虎',
                province: '上海',
                city: '普陀区',
                address: '上海市普陀区金沙江路 1518 弄',
                zip: 200333
            }, {
                date: '2016-05-08',
                name: '王小虎',
                province: '上海',
                city: '普陀区',
                address: '上海市普陀区金沙江路 1518 弄',
                zip: 200333
            }, {
                date: '2016-05-06',
                name: '王小虎',
                province: '上海',
                city: '普陀区',
                address: '上海市普陀区金沙江路 1518 弄',
                zip: 200333
            }, {
                date: '2016-05-07',
                name: '王小虎',
                province: '上海',
                city: '普陀区',
                address: '上海市普陀区金沙江路 1518 弄',
                zip: 200333
            }]
        },
        methods: {
            indexMethod(index) {
                return index + 1;
            },
            compare(property){
                return function(a,b){
                    var value1 = a[property];
                    var value2 = b[property];
                    return value1 - value2;
                }
            }
        },
        watch: {
            times() {
                if (this.times != null) {
                    let year = new Date(this.times).getFullYear();
                    let month = new Date(this.times).getMonth() + 1;
                    axios.post("/Personnel_Quality_objectives/Excellent", { year, month}).then(res=> {
                        console.log(res.data)
                        let middleArr =[];
                        for (let i = 0; i < res.data.length; i++) {

                            let sortArr = { id: res.data[i].Id, assetDepar: res.data[i].AssetDepartment, group: res.data[i].DP_Group, totalScouce:res.data[i].total_points };

                            res.data[i].merge.forEach(item=> {
                                if (item.Project == "效率指标") {
                                    sortArr.oneIndexName = item.IndexName;
                                    sortArr.oneTarget_value = item.Target_value;
                                    sortArr.oneActual_completion_value = item.Actual_completion_value;
                                    sortArr.oneAdanx = item.Adanx;
                                    sortArr.oneAdefen = item.Adefen;
                                    sortArr.oneDepartmentData = item.DepartmentData.substr(0, item.DepartmentData.length - 1);
                                }
                                if (item.Project == "品质指标") {
                                    sortArr.twoIndexName = item.IndexName;
                                    sortArr.twoTarget_value = item.Target_value;
                                    sortArr.twoActual_completion_value = item.Actual_completion_value;
                                    sortArr.twoAdanx = item.Adanx;
                                    sortArr.twoAdefen = item.Adefen;
                                    sortArr.twoDepartmentData = item.DepartmentData.substr(0, item.DepartmentData.length - 1);
                                }
                                if (item.Project == "月度流失率指标") {
                                    sortArr.threeIndexName = item.IndexName;
                                    sortArr.threeTarget_value = item.Target_value;
                                    sortArr.threeActual_completion_value = item.Actual_completion_value;
                                    sortArr.threeEdanx = item.Edanx;
                                    sortArr.threeEdefen = item.Edefen;
                                    sortArr.threeDepartmentData = item.DepartmentData.substr(0, item.DepartmentData.length - 1);
                                }
                                if (item.Project == "7S评比指标") {
                                    sortArr.fourIndexName = item.IndexName;
                                    sortArr.fourTarget_value = item.Target_value;
                                    sortArr.fourActual_completion_value = item.Actual_completion_value;
                                    sortArr.fourFdanx = item.Gdanx;
                                    sortArr.fourFdefen = item.Gdefen;
                                    sortArr.fourDepartmentData = item.DepartmentData.substr(0, item.DepartmentData.length - 1);
                                }
                            });
                            middleArr.push(sortArr);
                        };

                        middleArr.sort(this.compare('totalScouce'))
                        this.tableData = middleArr
                        console.log(this.tableData);
                        this.$message({
                            message: "获取数据成功！",
                            type: "success"
                        })
                    }).catch(err=> {
                        this.$message({
                            message: "连接失败！",
                            type: "warning"
                        })
                    })
                } else {
                    this.tableData = [];
                }
            }
        }
    });
    


</script>
