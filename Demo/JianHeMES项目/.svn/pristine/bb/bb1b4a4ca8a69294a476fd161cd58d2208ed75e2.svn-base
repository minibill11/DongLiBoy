@model IEnumerable<JianHeMES.Models.EquipmentBasicInfo>

@{
    ViewBag.Title = "设备首页";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/axios.min.js"></script>
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Content/styleFile/solder/solderJavascript.js"></script>
<style>
    .cell{
        padding:2px !important;
    }
    .el-input__inner{
        padding:1px !important;
    }
    .el-input{
        width:120px !important;
        display:inline-block !important;
        margin:4px;
    }
    .equipment-index-inputcontainer{
        display:flex;
        justify-content:center;
    }
    .equipment-index-inputcontainer div{
         display:inline;
    }
    .container {
        padding: 0;
    }

    .color2 {
        color: red;
        font-size: 16px;
    }

    .has-gutter tr th .cell, .el-table__row td .cell {
        text-align: center;
    }

    .el-table__header tr,
    .el-table__header th {
        font-size: 13px;
        padding: 0;
        height: 30px;
    }

    .el-table__body tr,
    .el-table__body td {
        padding: 0;
        font-size: 12px;
        height: 30px;
    }

    textarea {
        height: 30px;
        width: 15%;
    }

    .inputtext {
        margin-top: 25px;
        display: inline-flex;
        width: 100%;
    }

    h4 {
        width: 75%;
        font-size: 20px;
        text-align: center;
    }

    .bottomInfo {
        display: flex;
        justify-content: space-between;
    }

    .pone {
        align-self: flex-end;
        font-size: 14px;
    }
    a:visited {color: palevioletred}  /* 已访问的链接 */
</style>

<h2 style="text-align:center;margin-top:15px;margin-bottom:5px;font-size:21px;">设备管理首页</h2>

@*<span>@Html.ActionLink("产线查看", "Index2")</span>*@
<div id="app" >
    @*<p style="display:flex;justify-content:center;margin-top:10px;">
        <a class="checkLines" href="/Equipment/Index2"><el-button type="primary" size="mini" plain>产线查看</el-button></a>
        <a class="batvhInputEquipments" href="/Equipment/BatchInputEquipment"><el-button type="primary" size="mini" plain>批量添加</el-button></a>
        <a class="checkRepiabill" href="/Equipment/EquipmentRepairbill_Query"><el-button type="primary" size="mini" plain>报修单查询</el-button></a>
        <a class="checkTally" href="/Equipment/Equipment_Tally"><el-button type="primary" size="mini" plain>点检表查询</el-button></a>
        <a class="chechTimePlan" href="/Equipment/Equipment_MonthlyMaintenance_plan"><el-button type="primary" size="mini" plain>月保养时间计划表</el-button></a>
        <a class="targetSumary" href="/Equipment/Equipment_Quality_target"><el-button type="primary" size="mini" plain>指标达成统计汇总</el-button></a>
    </p>*@
    <p style="display:flex;justify-content:center;margin-top:10px;">
        <a class="shebeitaizhang" href="/Equipment/First_equipment"><el-button type="primary" size="mini" plain>设备台账</el-button></a>
        <a class="chechTimePlan" href="/Equipment/Equipment_MonthlyMaintenance_plan"><el-button type="primary" size="mini" plain>月保养计划</el-button></a>
        <a class="checkTally" href="/Equipment/Equipment_Tally"><el-button type="primary" size="mini" plain>点检表记录表</el-button></a>
        <a class="checkRepiabill" href="/Equipment/EquipmentRepairbill_Query"><el-button type="primary" size="mini" plain>仪器设备报修单</el-button></a>
        <a class="checkRepiabill" href="#"><el-button type="primary" size="mini" plain>安全库存清单</el-button></a>
        <a class="targetSumary" href="/Equipment/Equipment_Quality_target"><el-button type="primary" size="mini" plain>指标达成率</el-button></a>
        @*<a class="checkLines" href="/Equipment/Index2"><el-button type="primary" size="mini" plain>产线查看</el-button></a>*@
        @*<a class="batvhInputEquipments" href="/Equipment/BatchInputEquipment"><el-button type="primary" size="mini" plain>批量添加</el-button></a>*@
        
        
        
        
    </p>

</div>


<script>

    var roles = JSON.parse(localStorage.getItem("rigths"))   //
    function checkRoles(list, roleName) {   //检测权限
        var flag = false
        if (list && roleName) {
            for (let item in list) {
                if (list[item] == roleName) {
                    flag = true
                }
            }
        }
        return flag
    }
    
    
    document.onkeydown = function (event) {
        var e = event || window.event;    // 兼容IE
        if (e && e.keyCode == 13) { //回车键的键值为13
            $("#search").click();
        }
    };
    function GMTToStr(time) {
        if (time != null) {
            let date = new Date(time)
            console.log(date);
            let Str = date.getFullYear() + '-' +
                (date.getMonth() + 1) + '-' +
                date.getDate()
                //+ ' ' +
                //date.getHours() + ':' +
                //date.getMinutes() + ':' +
                //date.getSeconds()
            return Str
        } else {
            return ''
        }
    }

    let vm = new Vue({
        el: "#app",
        data: {
            showindex:false,
            trindex:null,
            loading:false,
            basehref:'/Equipment/Details',
            inputInfo: null,
            flag: false,
            flags: false,
            count: null,
            tableData: [],
            equipmentnumber: null,
            assetnumber: null,
            equipmentname: null,
            modelspecification: null,
            userdepartment: null,
            storageplace: null,
            workshop: null,
            section: null,
            brand:null,
            status: null,
            remark: '',
            options: [{
                value: '正常',
                label: '正常'
            }, {
                value: '运行',
                label: '运行'
            }, {
                value: '调机',
                label: '调机'
            }, {
                value: '保养',
                label: '保养'
            }, {
                value: '停机',
                label: '停机'
            }, {
                value: '维修',
                label: '维修'
            }],
            deparOpions:[],
            equipmentnumberoptions: [],
            assetnumberoptions:[]
        },
        methods: {
            postdata() {

            },
            indexMethod(){
                return index +1;
            },
            goinsede(){
                console.log("clicked!")
            },
            showDetials(index) {
                this.$message({
                    message: "跳转到详细页面！---id",
                    type: "success"
                })
            },
            checkinfos() {
                if (this.brand != null|| this.equipmentnumber != null || this.assetnumber != null || this.equipmentname != null || this.modelspecification != null || this.userdepartment != null || this.storageplace != null || this.workshop != null || this.section != null || this.status != null || this.remark != null) {
                    this.loading = true;
                    axios.post("/Equipment/Index", {
                        equipmentnumber: this.equipmentnumber,brand:this.brand, assetnumber: this.assetnumber, equipmentname: this.equipmentname, modelspecification: this.modelspecification, userdepartment: this.userdepartment,
                        storageplace: this.storageplace, workshop: this.workshop, section: this.section, status: this.status, remark: this.remark
                    }).then(res=> {
                        //console.log(res.data)
                        let arr = []
                        for (let item in res.data) {
                            arr.push(res.data[item])
                        }
                        let arr2 = []
                        for (let i = 0; i < arr.length; i++) {
                            arr2.push(JSON.parse(arr[i].replace(/\\/g, '')))

                            arr2[i].ActionDate = GMTToStr(arr2[i].ActionDate)
                            arr2[i].index = i+1
                        }
                        //console.log(arr2)
                        this.tableData = arr2;
                        this.loading = false;
                        //console.log(arr2)
                    }).catch(err=> {
                        this.$message({
                            message: "连接服务器失败！",
                            type: "warning"
                        })
                    })
                } else {
                    this.$message({
                        message: "请输入需要查询讯息！",
                        type:"warning"
                    })
                }
            },

            // 获取设备使用部门
            getDeparList() {
                axios.post("/Equipment/Userdepartment_list").then(res=> {
                    
                    res.data.forEach(item=> {
                        let obj = {
                            value: item,
                            label: item
                        };
                        this.deparOpions.push(obj);
                    })
                })
            },
            getequipmentnumberoptions() {
                axios.post("/Equipment/EQNumberList").then(res=> {
                    //console.log(res.data)
                    res.data.forEach(item=> {
                        let obj = { label: item, value: item }
                        this.equipmentnumberoptions.push(obj)
                    })
                })
            },
            getassetnumberoptions() {
                axios.post("/Equipment/AssetNumberList").then(res=> {
                    console.log(res.data)
                    res.data.forEach(item=> {
                        let obj = { label: item, value: item }
                        this.assetnumberoptions.push(obj)
                    })
                })
            },
            // 点击行变色标记
            changeTrColor(row,index) {
                this.trindex = index
            },
            //tableRowClassName({row, rowIndex,this.trindex}) {
            //    if (rowIndex === index) {
            //        return 'success-row';
            //    } 
            //    return '';
            //}
        },
        mounted(){
            this.getDeparList();
            this.getequipmentnumberoptions()
            this.getassetnumberoptions();
        },
        watch: {
        }
    })
    if (checkRoles(roles, '设备添加')) {
        $('.tianjiashebei').show()
    } else {
        $('.tianjiashebei').hide()
    }
    
</script>

