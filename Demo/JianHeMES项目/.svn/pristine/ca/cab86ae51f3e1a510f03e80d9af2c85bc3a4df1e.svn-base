
@{
    ViewBag.Title = "Small_Sample_Arguments";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/styleFile/packaging/index.css" rel="stylesheet" />
<script src="~/Content/styleFile/packaging/index.js"></script>
<script src="~/Scripts/axios.min.js"></script>

<style>
    body {
        text-align: center !important;
    }
    
    .table-container {
        width: 48%;
        margin-top: 5px;
    }

    .table-container0 {
        width: 48%;
        margin-top: 5px;
    }

    .table-container1 {
        width: 42%;
        margin-top: 5px;
        
    }

    .tb {
        display: inline-flex;
        margin-bottom: 5px;
        
    }

    .table .cell, .el-table th, .el-table td {
        text-align: center;
        padding: 4px;
    }

    .el-form-item {
        margin-bottom: 10px;
    }

    .corparationBtn {
        margin: 0;
        padding: 5px;
        float: left;
        height: 100%;
    }
    .el-dialog__headerbtn .el-dialog__close {
        display:none;
    }
    .el-form-item__content {
        margin-left: 0px !important;
    }
    .pp {
        text-align:left;
    }
</style>
<p class="pp">
    @Html.ActionLink("返回首页", "Index")
    @Html.ActionLink("新建小样报告", "Create")
</p>

<div id="app">
    <h3 style="text-align:center">小样参数</h3>
    <el-dialog title="提示" v-bind:visible.sync="icVisible" width="16%">
        <span slot="title">
            <h3 style="text-align:center;">添加IC型号</h3>
            <el-form label-position="labelPosition" label-width="80px">
                <el-form-item label="IC型号">
                    <el-input v-model="IC_Model" size="small" style="width:150px;"></el-input>
                </el-form-item>
                <el-form-item label="V值">
                    <el-input v-model="V_REXT" size="small" style="width:150px;"></el-input>
                </el-form-item>
                <el-form-item label="N值">
                    <el-input v-model="N_Value" size="small" style="width:150px;" ></el-input>
                </el-form-item>
                <el-form-item label="G值">
                    <el-input v-model="Gain" size="small" style="width:150px;"></el-input>
                </el-form-item>
            </el-form>
        </span>
        <span slot="footer" class="dialog-footer">
            <el-button v-on:click="quxiaoIC"size="small">取 消</el-button>
            <el-button type="primary" v-on:click="addIC" size="small" v-bind:disabled="bind">添 加</el-button>
        </span>
    </el-dialog>

    <el-dialog title="提示" v-bind:visible.sync="jjVisible" width="16%">
        <span slot="title">
            <h3 style="text-align:center;">添加PH间距</h3>
            <el-form label-position="labelPosition" label-width="80px">
                <el-form-item label="间距">
                    <el-input v-model="Spacing" size="small" style="width:150px;"></el-input>
                </el-form-item>
                <el-form-item label="最低值">
                    <el-input v-model="Least" size="small" style="width:150px;"></el-input>
                </el-form-item>
                <el-form-item label="最高值">
                    <el-input v-model="Maximum" size="small" style="width:150px;"></el-input>
                </el-form-item>
            </el-form>
        </span>
        <span slot="footer" class="dialog-footer">
            <el-button v-on:click="quxiaoJj" size="small">取 消</el-button>
            <el-button type="primary" v-on:click="addJj" size="small" v-bind:disabled="bind1">添 加</el-button>
        </span>
    </el-dialog>

    <el-dialog title="提示" v-bind:visible.sync="mxVisible" width="19%">
        <span slot="title">
            <h3 style="text-align:center;">添加模块型号</h3>
            <el-form label-position="labelPosition" label-width="70px">
                <el-form-item label="模块型号" style="display:flex">
                    <el-input v-model="Mo2" size="small" style="width:100px;"></el-input>
                    <span>-</span>
                    <el-input v-model="Mo1" size="small" style="width:100px"></el-input>
                </el-form-item>
                <el-form-item label="间距">
                    <el-select v-model="Spacing1" size="small" placeholder="请选择">
                        <el-option v-for="item in options"
                                   v-bind:key="item.value"
                                   v-bind:label="item.label"
                                   v-bind:value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item>
        </span>
        <span slot="footer" class="dialog-footer">
            <el-button v-on:click="quxiaoMx" size="small">取 消</el-button>
            <el-button type="primary" v-on:click="addMx" size="small" v-bind:disabled="bind2">添 加</el-button>
        </span>
    </el-dialog>
    <div>
        <span style="margin-right:230px">IC型号计算参数</span>
        <span style="margin-left:140px">间距对应参数范围</span>
    </div>
    <div class="tb">
        <el-table v-bind:data="tableData"
                  border max-height="260"
                  class="table-container" key='oneTable'>
            <el-table-column prop="IC_Model"
                             label="IC型号"
                             width="113">
            </el-table-column>
            <el-table-column prop="V_REXT"
                             label="V值"
                             width="80">
            </el-table-column>
            <el-table-column prop="N_Value"
                             label="N值"
                             width="80">
            </el-table-column>
            <el-table-column prop="Gain"
                             label="G值"
                             width="77">
            </el-table-column>
            <el-table-column prop="operation"
                             label="操作"
                             width="123">
                <template slot-scope="scope">
                    <el-button v-show="showbtn" size="small" class="corparationBtn btnone" type="primary" v-on:click="edit(scope.$index, scope.row)">编辑</el-button>
                    <el-button v-show="showbtn" size="small" class="corparationBtn btnfour" type="danger" v-on:click="remove(scope.$index, scope.row)">删除</el-button>
                    <el-button size="small" class="corparationBtn" style="display:none;" type="primary" v-on:click="postData(scope.$index, scope.row)">保存</el-button>
                    <el-button size="small" class="corparationBtn" style="display:none;" type="danger" v-on:click="cancelSave(scope.$index, scope.row)">取消</el-button>
                </template>
            </el-table-column>
        </el-table>

        <el-table v-bind:data="tableData1"
                  border max-height="260"
                  class="table-container0" style="margin-left:20px" key='twoTable'>
            <el-table-column prop="Spacing"
                             label="间距"
                             width="136">
            </el-table-column>
            <el-table-column prop="Least"
                             label="最低值"
                             width="98">
            </el-table-column>
            <el-table-column prop="Maximum"
                             label="最高值"
                             width="98">
            </el-table-column>
            <el-table-column prop="operation1"
                             label="操作"
                             width="140">
                <template slot-scope="scope">
                    <el-button v-show="showbtn" size="small" class="corparationBtn btnone" type="primary" v-on:click="edit1(scope.$index, scope.row)">编辑</el-button>
                    <el-button v-show="showbtn" size="small" class="corparationBtn btnfour" type="danger" v-on:click="remove1(scope.$index, scope.row)">删除</el-button>
                    <el-button size="small" class="corparationBtn" style="display:none;" type="primary" v-on:click="postData1(scope.$index, scope.row)">保存</el-button>
                    <el-button size="small" class="corparationBtn" style="display:none;" type="danger" v-on:click="cancelSaveph(scope.$index, scope.row)">取消</el-button>
                </template>
            </el-table-column>
        </el-table>
    </div>
    <el-row>
        <el-button type="primary" size="mini" v-on:click="icVisible = true" style="margin:3px">添加IC</el-button>
        <el-button type="primary" size="mini" v-on:click="jjVisible = true" style="margin:3px;margin-left:420px">添加间距</el-button>
    </el-row>
    <div style="text-align:center;margin-top:20px;margin-bottom:2px">
        <span >型号间距对应表</span>       
    </div>
    <div class="btt">
        <el-table v-bind:data="tableData2"
                  border max-height="260"
                  class="table-container1" key='threeTable' style="margin:0 auto;">
            <el-table-column prop="Mo2"
                             label="模块型号"
                             width="167">
            </el-table-column>
            <el-table-column prop="Spacing"
                             label="间距"
                             width="160">
            </el-table-column>
            <el-table-column prop="operation2"
                             label="操作"
                             width="150">
                <template slot-scope="scope">
                    <el-button v-show="showbtn" size="small" class="corparationBtn btnone" type="primary" v-on:click="edit2(scope.$index, scope.row)">编辑</el-button>
                    <el-button v-show="showbtn" size="small" class="corparationBtn btnfour" type="danger" v-on:click="remove2(scope.$index, scope.row)">删除</el-button>
                    <el-button size="small" class="corparationBtn" style="display:none;" type="primary" v-on:click="postData2(scope.$index, scope.row)">保存</el-button>
                    <el-button size="small" class="corparationBtn" style="display:none;" type="danger" v-on:click="cancelSavemx(scope.$index, scope.row)">取消</el-button>
                </template>
            </el-table-column>
        </el-table>
        <el-row>
            <el-button type="primary" size="mini" v-on:click="mxVisible = true" style="margin:5px">添加模型</el-button>
        </el-row>
    </div>
</div>
@{
    var UserName = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).UserName;
}
<script>
    var app = new Vue({
        el: "#app",
        data: {
            tableData: [],
            tableData1: [],
            tableData2: [],
            showbtn: true,
            icVisible: false,
            jjVisible: false,
            mxVisible: false,
            bind: true,
            bind1: true,
            bind2:true,
            labelPosition: 'right',
            IC_Model: null,
            V_REXT: null,
            N_Value: null,
            Gain: null,
            Spacing: null,
            Least: null,
            Maximum: null,
            Mo2: null,
            Mo1: null,
            Spacing1: null,
            options: '',
            oldTrVal: '',
            oldTrVal1: '',
            oldTrVal2: '',
        },
        created: function () {
            this.gettableData()
        },
        methods: {
            gettableData: function () {  //获取三个表格数据
                axios.post('/small_Sample/Small_Sample_Arguments_Getdata').then(res => {
                    let tone = JSON.parse(res.data.Small_Sample_IC_Model_Arguments_list);
                    let ttwo = JSON.parse(res.data.Small_Sample_Spacing_Value_list);
                    let tthree = JSON.parse(res.data.Small_Sample_ICmodel_Spacing_list);
                    this.tableData = tone;
                    this.tableData1 = ttwo;
                    var arr = [];
                    this.tableData1.forEach(item => {
                        let obj = { value: item.Spacing, label: item.Spacing }
                        arr.push(obj)
                    })
                    this.options = arr;
                    this.tableData2 = tthree;
                }).catch(err => { console.log("获取数据失败") })
            },           
            addIC: function () {  //添加IC
                let icarr = { IC_Model: this.IC_Model, V_REXT: this.V_REXT, N_Value: this.N_Value, Gain: this.Gain, CreatedDate: new Date(), Creator: "@UserName" }
                axios.post('/Small_Sample/Small_Sample_IC_Model_Arguments_add', { record: icarr }).then(res => {
                    this.icVisible = false;
                    this.$message({ message: res.data, type: 'success' });
                    this.gettableData()
                    this.IC_Model = null, this.V_REXT = null, this.N_Value =null, this.Gain = null;
                    this.bind = true;
                }).catch(err => {
                })
            },
            quxiaoIC() {
                this.icVisible = false;
                this.IC_Model = null; this.V_REXT = null; this.N_Value = null; this.Gain = null;
            },
            addJj: function () {  //添加PH间距               
                let jjarr = { Spacing: this.Spacing, Least: this.Least, Maximum: this.Maximum, CreatedDate: new Date(), Creator: "@UserName" }
                axios.post('/Small_Sample/Small_Sample_Spacing_Value_add', { record: jjarr }).then(res => {
                    this.jjVisible = false;
                    this.$message({ message: res.data, type: 'success' });
                    this.gettableData()
                    this.Spacing = null, this.Least = null, this.Maximum = null;
                    this.bind1 = true;
                }).catch(err => {
                })
            },
            quxiaoJj() {
                this.jjVisible = false;
                this.Spacing = null, this.Least = null, this.Maximum = null;
            },
            addMx: function () { //添加模块型号
                this.Mo1; this.Mo2;
                let a = this.Mo2 + '-' + this.Mo1
                let mxarr = { Mo2: a, Spacing: this.Spacing1, CreatedDate: new Date(), Creator: "@UserName" }
                axios.post('/Small_Sample/Small_Sample_ICmodel_Spacing_add', { record_add: mxarr }).then(res => {
                    this.mxVisible = false;
                    this.$message({ message: res.data, type: 'success' });
                    this.gettableData()
                    this.Mo1 = null; this.Mo2 = null, this.Spacing1 = null;                       
                }).catch(err => { })
            },
            quxiaoMx() {
                this.mxVisible = false;
                this.Mo1 = null; this.Mo2 = null, this.Spacing = null;  
            },
            edit(index, row) { this.oldTrVal = row; changeInput(index, row) },
            edit1(index, row) { this.oldTrVal1 = row; changeInput1(index, row) },
            edit2(index, row) { this.oldTrVal2 = row; changeInput2(index, row) },
            remove(index, row) {
                var comfirm = confirm(`确认删除IC型号为${row.IC_Model}这条信息吗？`);
                if (comfirm) {
                    axios.post("/Small_Sample/Small_Sample_IC_Model_Arguments_delete", { id: row.Id }).then(res => {
                        this.$message({ message: '已删除!', type: 'success' });
                        this.tableData.forEach((item, index) => {
                            if (item.Id == row.Id) {
                                this.tableData.splice(index, 1);
                            }
                        })
                    }).catch(err => {
                        this.$message({ message: '无法删除!', type: 'warning' });
                    })
                }
            },
            remove1(index, row) {
                var comfirm = confirm(`确认删除间距为${row.Spacing}这条信息吗？`);
                if (comfirm) {
                    axios.post("/Small_Sample/Small_Sample_Spacing_Value_delete", { id: row.Id }).then(res => {
                        this.$message({ message: '已删除!', type: 'success' });
                        this.tableData1.forEach((item, index) => {
                            if (item.Id == row.Id) {
                                this.tableData1.splice(index, 1);
                            }
                        })
                    }).catch(err => {
                        this.$message({ message: '无法删除!', type: 'warning' });
                    })
                }
            },
            remove2(index, row) {
                var comfirm = confirm(`确认删除模块型号为${row.Mo2}这条信息吗？`);
                if (comfirm) {
                    axios.post("/Small_Sample/Small_Sample_ICmodel_Spacing_delete", { id: row.Id }).then(res => {
                        this.$message({ message: '已删除!', type: 'success' });
                        this.tableData2.forEach((item, index) => {
                            if (item.Id == row.Id) {
                                this.tableData2.splice(index, 1);
                            }
                        })
                    }).catch(err => {
                        this.$message({ message: '无法删除!', type: 'warning' });
                    })
                }
            },
            postData(index, row) {
                saveICdata(index, row)
            },
            postData1(index, row) {
                saveJjdata(index, row)
            },
            postData2(index, row) {
                saveMxdata(index, row)
            },
            cancelSave(index, row) {
                cancelData(index, row)
            },
            cancelSaveph(index, row) {
                cancelDataph(index, row)
            },
            cancelSavemx(index, row) {
                cancelDatamx(index, row)
            }
        },
        watch: {
            IC_Model() {             
                if (this.IC_Model != null && this.V_REXT != null && this.N_Value != null && this.Gain != null) {
                    this.bind = false;   
                } else { this.bind = true; };
                if (this.IC_Model != this.IC_Model.replace(/[\W]/g, '')) {
                    this.$message({ message: '只能输入字母和数字', type: 'success' })
                    this.bind = true;
                };
            },
            V_REXT() {
                if (this.IC_Model != null && this.V_REXT != null && this.N_Value != null && this.Gain != null) {
                    this.bind = false;
                } else { this.bind = true; };                          
            },
            N_Value() {
                if (this.IC_Model != null && this.V_REXT != null && this.N_Value != null && this.Gain != null) {
                    this.bind = false;
                } else { this.bind = true; };
            },
            Gain() {
                if (this.IC_Model != null && this.V_REXT != null && this.N_Value != null && this.Gain != null) {
                    this.bind = false;
                } else { this.bind = true; };
            },           
            Mo2() {
                if (this.Mo2 != null && this.Mo1 != null && this.Spacing1 != null) {
                    this.bind2 = false;
                } else { this.bind2 = true }
            },
            Mo1() {
                if (this.Mo2 != null && this.Mo1 != null && this.Spacing1 != null) {
                    this.bind2 =false;
                } else { this.bind2 = true }
            },
            Spacing1() {
                if (this.Mo2 != null && this.Mo1 != null && this.Spacing1 != null) {
                    this.bind2 = false;
                } else { this.bind2 =true}
            },
            Spacing() {
                if (this.Spacing != null && this.Least != null && this.Maximum != null) {
                    this.bind1 = false;
                } else {
                    this.bind1 = true
                };
                if (this.Spacing != this.Spacing.replace(/[\W]/g, '')) {
                    this.$message({ message: '只能输入字母和数字', type: 'success' })
                    this.bind1 = true;
                };
            },
            Least() {
                if (this.Spacing != null && this.Least != null && this.Maximum != null) {
                    this.bind1 = false;
                } else { this.bind1 = true }
            },
            Maximum() {
                if (this.Spacing != null && this.Least != null && this.Maximum != null) {
                    this.bind1 = false;
                } else { this.bind1 = true }
            },
        }
    });

    //编辑IC型号数据
    function changeInput(index, row) {
        var targetTr = $(".table-container").find(".el-table__row")[index];
        targetTr.children[0].innerHTML = `<input type='text' value="${row.IC_Model}" />`;
        targetTr.children[1].innerHTML = `<input type='text' value="${row.V_REXT}" />`;
        targetTr.children[2].innerHTML = `<input type='text' value="${row.N_Value}" />`;
        targetTr.children[3].innerHTML = `<input type='text' value="${row.Gain}" />`;
        $(targetTr.children[4].children[0].children[0]).hide();
        $(targetTr.children[4].children[0].children[1]).hide();
        $(targetTr.children[4].children[0].children[2]).show();
        $(targetTr.children[4].children[0].children[3]).show();
    }
    //编辑PH间距数据
    function changeInput1(index, row) {
        var targetTr1 = $(".table-container0").find(".el-table__row")[index];
        targetTr1.children[0].innerHTML = `<input type='text' value="${row.Spacing}" />`;
        targetTr1.children[1].innerHTML = `<input type='text' value="${row.Least}" />`;
        targetTr1.children[2].innerHTML = `<input type='text' value="${row.Maximum}" />`;
        $(targetTr1.children[3].children[0].children[0]).hide();
        $(targetTr1.children[3].children[0].children[1]).hide();
        $(targetTr1.children[3].children[0].children[2]).show();
        $(targetTr1.children[3].children[0].children[3]).show();
    }

    //编辑模块型号数据
    function changeInput2(index, row) {
        var targetTr2 = $(".table-container1").find(".el-table__row")[index];
        targetTr2.children[0].innerHTML = `<input type='text' value="${row.Mo2}" />`;
        targetTr2.children[1].innerHTML = `<input type='text' value="${row.Spacing}" >`;
        $(targetTr2.children[2].children[0].children[0]).hide();
        $(targetTr2.children[2].children[0].children[1]).hide();
        $(targetTr2.children[2].children[0].children[2]).show();
        $(targetTr2.children[2].children[0].children[3]).show();
    }

    //保存编辑IC型号数据
    function saveICdata(index, row) {
        var targetTr = $(".table-container").find(".el-table__row")[index].cells;
        var inputvalue = [];
        for (let i = 0; i < targetTr.length - 1; i++) {
            inputvalue.push(targetTr[i].children[0].value)
        }
        var obj = { Id: row.Id, IC_Model: inputvalue[0], V_REXT: inputvalue[1], N_Value: inputvalue[2], Gain: inputvalue[3],ModifyTime: new Date(), Modifier:"@UserName" };
        axios.post("/Small_Sample/Small_Sample_IC_Model_Arguments_modify", { record_modify: obj }).then(res => {
            app.$message({ message: res.data,type: 'success'});
            var targetTr = $(".table-container").find(".el-table__row")[index];
            targetTr.children[0].innerHTML = inputvalue[0]
            targetTr.children[1].innerHTML = inputvalue[1]
            targetTr.children[2].innerHTML = inputvalue[2]
            targetTr.children[3].innerHTML = inputvalue[3]
            $(targetTr.children[4].children[0].children[0]).show();
            $(targetTr.children[4].children[0].children[1]).show();
            $(targetTr.children[4].children[0].children[2]).hide();
            $(targetTr.children[4].children[0].children[3]).hide();
        }).catch(err => { })
    }

    //保存编辑PH间距数据
    function saveJjdata(index, row) {
        var targetTr1 = $(".table-container0").find(".el-table__row")[index].cells;
        var inputph = [];
        for (let i = 0; i < targetTr1.length - 1; i++) {
            inputph.push(targetTr1[i].children[0].value)
        }
        var objph = { Id: row.Id, Spacing: inputph[0], Least: inputph[1], Maximum: inputph[2], ModifyTime: new Date(), Modifier:"@UserName" }
        axios.post("/Small_Sample/Small_Sample_Spacing_Value_modify", { record: objph }).then(res => {
            app.$message({ message: res.data,type: 'success'});
            if (res.data === '保存成功') {
                var targetTr1 = $(".table-container0").find(".el-table__row")[index];
                targetTr1.children[0].innerHTML = inputph[0]
                targetTr1.children[1].innerHTML = inputph[1]
                targetTr1.children[2].innerHTML = inputph[2]
                $(targetTr1.children[3].children[0].children[0]).show();
                $(targetTr1.children[3].children[0].children[1]).show();
                $(targetTr1.children[3].children[0].children[2]).hide();
                $(targetTr1.children[3].children[0].children[3]).hide();
            }
        }).catch(err => { })
    }
    //保存编辑模块型号数据
    function saveMxdata(index, row) {
        var targetTr2 = $(".table-container1").find(".el-table__row")[index].cells;
        var inputmx = [];
        for (let i = 0; i < targetTr2.length - 1; i++) {
            inputmx.push(targetTr2[i].children[0].value)
        }
        var objmx = { Id: row.Id, Mo2: inputmx[0], Spacing: inputmx[1],ModifyTime: new Date(), Modifier:"@UserName" }
        axios.post("/Small_Sample/Small_Sample_ICmodel_Spacing_modify", { record: objmx }).then(res => {
            app.$message({ message: res.data,type: 'success'});
            if (res.data === '保存成功') {
                var targetTr2 = $(".table-container1").find(".el-table__row")[index];
                targetTr2.children[0].innerHTML = inputmx[0]
                targetTr2.children[1].innerHTML = inputmx[1]
                $(targetTr2.children[2].children[0].children[0]).show();
                $(targetTr2.children[2].children[0].children[1]).show();
                $(targetTr2.children[2].children[0].children[2]).hide();
                $(targetTr2.children[2].children[0].children[3]).hide();
            }
        }).catch(err => {})
    }

    //取消保存
    function cancelData(index, row) {
        var targetTr = $(".table-container").find(".el-table__row")[index];
        targetTr.children[0].innerHTML = app.oldTrVal.IC_Model;
        targetTr.children[1].innerHTML = app.oldTrVal.V_REXT;
        targetTr.children[2].innerHTML = app.oldTrVal.N_Value;
        targetTr.children[3].innerHTML = app.oldTrVal.Gain;
        $(targetTr.children[4].children[0].children[0]).show();
        $(targetTr.children[4].children[0].children[1]).show();
        $(targetTr.children[4].children[0].children[2]).hide();
        $(targetTr.children[4].children[0].children[3]).hide();
    }
    //取消保存PH
    function cancelDataph(index, row) {
        var targetTr1 = $(".table-container0").find(".el-table__row")[index];
        targetTr1.children[0].innerHTML = app.oldTrVal1.Spacing;
        targetTr1.children[1].innerHTML = app.oldTrVal1.Least;
        targetTr1.children[2].innerHTML = app.oldTrVal1.Maximum;
        $(targetTr1.children[3].children[0].children[0]).show();
        $(targetTr1.children[3].children[0].children[1]).show();
        $(targetTr1.children[3].children[0].children[2]).hide();
        $(targetTr1.children[3].children[0].children[3]).hide();
    }
    //取消保存模块型号
    function cancelDatamx(index, row) {
        var targetTr2 = $(".table-container1").find(".el-table__row")[index];
        targetTr2.children[0].innerHTML = app.oldTrVal2.Mo2;
        targetTr2.children[1].innerHTML = app.oldTrVal2.Spacing;
        $(targetTr2.children[2].children[0].children[0]).show();
        $(targetTr2.children[2].children[0].children[1]).show();
        $(targetTr2.children[2].children[0].children[2]).hide();
        $(targetTr2.children[2].children[0].children[3]).hide();
    }
</script>
