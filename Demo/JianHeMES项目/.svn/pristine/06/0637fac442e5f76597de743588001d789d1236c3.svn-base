@model JianHeMES.Models.FinalQC

@{
    ViewBag.Title = "FinalQC";
}

<style>
    .barcodeFrame {
        width: 250px;
        height: 100px;
        border: 1px solid #000000;
        overflow: auto;
    }

    .abnormalFrame {
        width: 330px;
        min-height: 100px;
        max-height: 250px;
        border: 1px solid #000000;
        overflow: auto;
    }

    .titlerow div {
        font-size: 15px;
        font-weight: bold;
    }

    .titlerowone div {
        font-size: 16px;
        font-weight: bold;
    }

    .table-bordered > thead > tr > th {
        border-bottom-width: 1px;
    }

    .table > thead:first-child > tr:first-child > th, .table-bordered > tbody > tr > td, .table-bordered > thead > tr > th {
        border: 1px solid #000000;
    }

    .tdDiv {
        display: inline-block;
        padding-right: 5px;
    }

    .tablebody {
        max-height: 300px;
        overflow: auto;
        border-top: 1px solid #000;
        margin: 1px 0;
    }

    .table {
        margin-bottom: 0px;
        margin-top: 1px;
        width: 1122px;
    }

    .glyphicon-arrow-right {
        color: #FF6666;
    }
</style>
@{
    var JsonObj = ViewBag.JsonObj;
}
<div style="margin-top: 20px;margin-bottom: 10px;">
    <h2 style="display:inline">@ViewBag.OrderNum FQC工序详细情况</h2>
</div>

<div>
    <form action="/ProductionControl/Assemble" target='_blank' method='post' style="display:inline">
        <input name='OrderNum' value="@JsonObj.OrderNum" class="hidden">
        <button class="btn-link" style="border:0;">查看组装工序详细情况</button>
    </form>|
    <a href="/Query/ordernumModuleInfo?order=@JsonObj.OrderNum" target="_blank">订单模组概况</a>
</div>
<hr />
<div class="row titlerowone">
    <div class="col-md-3">
        订单号：<a href="#" class="aOrderNum" myAttr="">@JsonObj.OrderNum</a>
    </div>
    <div class="col-md-3">
        平台类型：@JsonObj.PlatformType
    </div>
    <div class="col-md-3">
        出货日期：<span id="deliveryDate">@JsonObj.DeliveryDate</span>
    </div>
    <div class="col-md-3">
        模组数：@JsonObj.Boxes
    </div>
</div>
<br />
<div class="row titlerow">
    <div class="col-md-3">
        异常次数：<a href="#" class="aOrderNum" myAttr="异常">@JsonObj.FQC_Abnormal_Count</a>
    </div>
    <div class="col-md-3">
        已完成FQC数：<a href="#" class="aOrderNum" myAttr="正常" firstFQC="首次FQC">@JsonObj.FQC_Finish_Count</a>
    </div>
    <div class="col-md-3">
        总FQC次数：<a href="#" class="aOrderNum" myAttr="">@JsonObj.FQC_Record_Count</a>
    </div>
    <div class="col-md-3">
        直通个数：@JsonObj.FirstPassYieldCount
    </div>
</div>
<br />
<div class="row titlerow">
    <div class="col-md-3">
        异常工时：@*@JsonObj.abnormal_time*@
    </div>
    <div class="col-md-3">
        完成率：@JsonObj.FinalQC_Finish_Rate
    </div>
    <div class="col-md-3">
        合格率：@JsonObj.FinalQC_Pass_Rate
    </div>
    <div class="col-md-3">
        直通率：@JsonObj.FirstPassYield_Rate
    </div>
</div>
<br />
<div class="row titlerow">
    <div class="col-md-3">
        操作记录时长：@JsonObj.OperationTime
    </div>
    <div class="col-md-3">
        平均操作时长：@JsonObj.OperationAverageTime
    </div>
    <div class="col-md-3">
        异常操作记录时长：@JsonObj.OperationAbnormalTime
    </div>
    <div class="col-md-3">
        异常平均操作时长：@JsonObj.OperationAverageAbnormalTime
    </div>
</div>
<hr />
@*@{
        var going_list = JsonObj.going_list;
        var passed_list = JsonObj.passed_list;
        var abnormalList = JsonObj.abnormalList;
    }*@

<div class="row" id="app">
    <div class="col-md-12" style="padding:0;">
        <div class="col-md-4">
            <div>
                正在进行FQC条码清单：（@JsonObj.going_list_Count 个）
                <div class="barcodeFrame">
                    <ul>
                        @foreach (var item in ViewBag.going_list as List<JianHeMES.Models.FinalQC>)
                        {
                            @*<li>@Html.RouteLink(item.BarCodesNum, "Default", new { Controller = "FinalQCs", Action = "Details", id = item.Id }, new { target = "_blank" })</li>*@
                            <li><a href="/Query/barcodeInfo?1=@item.BarCodesNum" target="_blank">@item.BarCodesNum</a></li>
                        }
                    </ul>
                </div>
            </div>
            <br />
            <div>
                已完成FQC条码清单：（@JsonObj.FQC_Finish_Count 个）
                <div class="barcodeFrame">
                    <ul>
                        @foreach (var item in ViewBag.passed_list as List<JianHeMES.Models.FinalQC>)
                        {
                            @*<li>@Html.RouteLink(item.BarCodesNum, "Default", new { Controller = "FinalQCs", Action = "Details", id = item.Id }, new { target = "_blank" })</li>*@
                            <li><a href="/Query/barcodeInfo?1=@item.BarCodesNum" target="_blank">@item.BarCodesNum</a></li>
                        }
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div>
                未完成FQC条码清单：（@JsonObj.Never_FinishFQC_List_Count 个）
                <div class="barcodeFrame">
                    <ul>
                        @foreach (var item in ViewBag.unbeginRecord_temp as List<string>)
                        {
                            <li>@item</li>
                        }
                    </ul>
                </div>
            </div>
            <br />
            <div>
                <span style="color:red">超24小时未进入老化工序清单：（@JsonObj.Overtime_never_join_burn_in_Count 个）</span>
                <div class="barcodeFrame">
                    <ul>
                        @foreach (var item in ViewBag.Overtime_never_join_burn_in as List<JianHeMES.Models.FinalQC>)
                        {
                            @*<li>@Html.RouteLink(item.BarCodesNum, "Default", new { Controller = "FinalQCs", Action = "Details", id = item.Id }, new { target = "_blank" })</li>*@
                            <li><a href="/Query/barcodeInfo?1=@item.BarCodesNum" target="_blank">@item.BarCodesNum</a></li>
                        }
                    </ul>
                </div>
            </div>
            <br />
        </div>
        <div class="col-md-4">
            <div>
                异常记录清单与异常信息：（@JsonObj.abnormalList_Count 个）
                <div class="abnormalFrame">
                    <ol>
                        @foreach (var item in ViewBag.abnormalList as List<JianHeMES.Models.FinalQC>)
                        {
                            <li>
                                @*@Html.RouteLink(item.BarCodesNum, "Default", new { Controller = "FinalQCs", Action = "Details", id = item.Id }, new { target = "_blank" })*@
                                <a href="/Query/barcodeInfo?1=@item.BarCodesNum" target="_blank">@item.BarCodesNum</a>
                                <br />@item.FinalQC_FQCCheckAbnormal
                            </li>
                        }
                    </ol>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th colspan="2" class="text-center">
                        挪用情况清单：
                    </th>
                </tr>
            </thead>
        </table>
        <div class="tablebody">
            <table class="table table-bordered">
                <colgroup>
                    <col width="622" />
                    <col width="500" />
                </colgroup>
                <thead>
                    <tr>
                        <th style="text-align:right">挪用关系 ( 旧模组 <i class="glyphicon glyphicon-arrow-right"></i>  新模组 ) </th>
                        <th>历史条码FQC完成状态</th>
                    </tr>
                </thead>
                <tbody style="max-height:600px;overflow:auto">
                    <tr v-for="item in nuoNormalList">
                        <td style="text-align:right">
                            <div v-for="(i,index) in item.info" class="tdDiv">
                                {{i}} <i v-if="index<item.info.length-1" class="glyphicon glyphicon-arrow-right"></i>
                            </div>
                        </td>
                        <td>
                            <div v-for="i in item.barcodeInfo" class="tdDiv">
                                {{i.barcode}}:{{i.statue}};
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="tablebody" v-show="nuoAbnormalList.length>0">
            <table class="table table-bordered">
                <colgroup>
                    <col width="622" />
                    <col width="500" />
                </colgroup>
                <thead>
                    <tr>
                        <th style="text-align:right;">挪用条码</th>
                        <th>FQC异常</th>
                    </tr>
                </thead>
                <tbody style="max-height:600px;overflow:auto">
                    <tr v-for="item in nuoAbnormalList">
                        <td style="text-align:right">
                            {{item.barcode}}<br />
                        </td>
                        <td>
                            {{item.abnormal}}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="spinnerModel" v-show="loading">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
    </div>
</div>

<form id="fqcForm" action="/FinalQCs/Index" method="post" target="_blank" style="display:none">
    <input type="text" name="orderNum" value="@JsonObj.OrderNum" id="formOrderNum" />
    @*<input type="text" name="BarCodesNum" value="" />*@
    <input type="text" name="repetition" value="" id="firstFQC" />
    <input type="text" name="Remark" value="" />
    <input type="text" name="FQCNormal" value="" id="formNormal" />
</form>

<script>
    var app = new Vue({
        el: "#app",
        data: {
            loading: false,
            nuoNormalList: [],
            nuoAbnormalList: [],
        },
        mounted: function () {
            this.loading = true;
            //挪用处理
            axios.post("/ProductionControl/FinalNuo", { OrderNum: "@JsonObj.OrderNum" }).then(res => {
                this.nuoNormalList = res.data.normal;
                this.nuoAbnormalList = res.data.abnormal;
                this.loading = false;
            }).catch(err => {
                console.warn(err);
                this.loading = false;
            });



            $(".aOrderNum").click(function (event) {
                event.preventDefault();
                $("#formNormal").val($(this).attr("myAttr"));
                $("#firstFQC").val($(this).attr("firstFQC"));
                //$("form").attr("action", event.target.pathname).submit();
                $("#fqcForm").submit();
            });
            $("#deliveryDate").text('@ViewBag.DeliveryDate'.split(" ")[0]);
        }
    });


    //formpost(event.target.pathname, event.target.text)
    //function formpost(url,params) {
    //    var newForm = $("<form action=" + url + " target='_blank' method='post' style='display:none' ><input name='OrderNum' value=" + params + " ><input type='text' name='BoxBarCode' value='' /></form>");
    //    $("#setForm").append(newForm);
    //    newForm.submit();
    //    newForm.remove();
    //}
</script>


