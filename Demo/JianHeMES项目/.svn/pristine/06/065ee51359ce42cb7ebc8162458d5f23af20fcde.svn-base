@{
    ViewBag.Title = "外箱(重新)装箱和标签打印";
}
<link href="~/Content/styleFile/packaging/index.css" rel="stylesheet" />
<script src="~/Content/styleFile/packaging/index.js"></script>
<script src="~/Scripts/axios.min.js"></script>
<script src="~/Scripts/printJS/JsBarcode.all.min.js"></script>
<script src="~/Content/styleFile/solder/solderJavascript.js"></script>
@*<link href="~/Content/styleFile/printStyle.css" rel="stylesheet" />*@

<style>
    .el-header {
        height: auto !important;
        padding: 0;
    }

    .el-main {
        min-height: 600px;
        padding: 0;
    }


    /*全局样式*/
    *, body {
        margin: 0;
        padding: 0;
    }

    .body-content, .container {
        padding-left: 0px;
        padding-right: 0px;
    }

    #app {
        padding: 50px 0 0;
    }

    .el-input, .el-input-number {
        width: 220px;
    }

    [v-cloak] {
        display: none;
    }

    .textCenter {
        text-align: center;
    }

    /*外箱条码样式*/
    #masterCarton {
        margin: 20px 0 10px;
        /*padding: 5px;*/
    }

    #masterBarcode {
        width: 240px;
    }

    .mcFrame {
        margin: 0 auto;
        width: 308px;
        height: 524px;
        border: 1px solid #000;
    }

    .mcFrame_top {
        height: 278px;
    }

    .mcFrame_bottom {
        height: 240px;
    }

    .mcFrame_top > div {
        height: 80px;
    }


    .mcFrame_top_1 {
        position: relative;
    }

    .imgicon {
        position: absolute;
        width: 110px;
        top: 5px;
        left: 5px;
    }

    .mcFrame_top_1_h {
        margin: 0;
        padding-top: 35px;
        text-align: center;
    }

    .mcFrame_top_1_h_noimg {
        margin: 0;
        padding-top: 25px;
        text-align: center;
    }

    .mcFrame_top_3_1_1, .mcFrame_top_3_1_2 {
        display: inline-block;
        line-height: 38px;
        text-align: center;
    }

    .mcFrame_top_3_1_1 {
        font-size: 11px;
    }

        .mcFrame_top_3_1_1:nth-child(1) {
            width: 100px;
        }

        .mcFrame_top_3_1_1:nth-child(2) {
            width: 58px;
        }

        .mcFrame_top_3_1_1:nth-child(3) {
            width: 76px;
        }

        .mcFrame_top_3_1_1:nth-child(4) {
            width: 58px;
        }

    .mcFrame_top_3_1_2 {
        width: 227px;
        font-size: 20px;
    }

    .mcFrame_top_3_1_1:not(:last-child) {
        border-right: 1px solid #000;
    }

    .borderTop {
        border-top: 1px solid #000;
    }

    .mcFrame_bottom_1 {
        /*width: 100%;
    height: 100%;*/
        padding: 5px;
        font-size: 16px;
        text-align: left;
    }

    .mcFrame_top_2 {
        position: relative;
    }

    .masterBarDiv {
        width: 100%;
        position: absolute;
        top: -3px;
    }

    a:hover {
        text-decoration: none;
        color: #000;
    }


    .el-button--small {
        padding: 8px 12px;
    }


    /*全局样式*/
    .inputframe {
        width: 300px;
        text-align: right;
        margin: 1px auto;
    }

    .divframe {
        width: 300px;
        margin: 1px auto;
        text-align: center;
        display: inline-block;
        border: 1px solid #ccc;
        min-height: 300px;
    }

    .el-button--small {
        padding: 8px 12px;
    }

    .el-table th {
        font-size: 13px;
        padding: 5px 0;
        background-color: #f4df42;
        color: #000;
        text-align: center;
    }

    .el-table td {
        font-size: 13px;
        padding: 2px 0;
        text-align: center;
    }

    .el-table .cell, .el-table--border td:first-child .cell {
        padding: 0;
    }

    .el-table .warning-row {
        background: #fcd2d2;
    }

    .el-table .success-row {
        background: #f0f9eb;
    }

    .green {
        color: #67c23a;
    }

    .red {
        color: #f56c6c;
    }

    .boxspan {
        display: inline-block;
        padding: 2px 4px;
    }

    .container, .body-content {
        padding-left: 0;
    }

    p {
        margin-bottom: 0;
    }

    @@media screen and (max-width: 768px) {
        .el-message, .el-notification, .el-message-box {
            min-width: 90%;
            max-width: 90%;
        }

        .el-select-dropdown__wrap {
            max-height: 82px;
        }

        .el-select-dropdown__item {
            font-size: 13px;
            height: 28px;
            line-height: 28px;
        }

        .el-select-dropdown__list {
            padding: 0;
        }

        .el-select-dropdown__wrap {
            margin-bottom: 0px;
        }
    }

    .adiv {
        display: inline-block;
    }


    .changecolor {
        color: red;
    }

        .changecolor input {
            color: red;
        }

    .el-autocomplete ul li {
        text-align: center;
    }

    .borderRed > .el-input__inner {
        border: 1px solid red;
    }
</style>

<div id="app" v-cloak>
    <el-container>
        <el-header class="text-center">
            <div v-show="screenSize>=768">
                <h2 class="text-center">@ViewBag.Title</h2>
                <div class="adiv PoutsideBinningPrintOne" href="/Packagings/outsideBinningPrint"><el-button size="small" type="primary" plain disabled style="cursor:default">外箱装箱和标签打印</el-button></div>
                <a class="PoutsideBinningPrintTwo" href="/Packagings/lookTag"><el-button size="small">查看标签</el-button></a>
                <a class="PoutsideBinningPrintThree" href="/Packagings/DeleteConfirm"><el-button size="small">外箱删除</el-button></a>
                <a class="PoutsideBinningPrintFour" href="/Packagings/OutsideBoxLableLogoChange"><el-button size="small">修改外箱标签LOGO</el-button></a>
                <a href="/Packagings/SPC_QueryByOrderNumber"><el-button size="small">备品配件</el-button></a>
            </div>
            <div v-show="screenSize<768">
                <h3>@ViewBag.Title</h3>
                <el-dropdown placement="bottom">
                    <el-button size="medium ">
                        更多菜单<i class="el-icon-arrow-down el-icon--right"></i>
                    </el-button>
                    <el-dropdown-menu slot="dropdown">
                        <div class="PoutsideBinningPrintOne" href="/Packagings/outsideBinningPrint"><el-dropdown-item disabled>外箱装箱和标签打印</el-dropdown-item></div>
                        <a class="PoutsideBinningPrintTwo" href="/Packagings/lookTag"><el-dropdown-item>查看标签</el-dropdown-item></a>
                        <a class="PoutsideBinningPrintThree" href="/Packagings/DeleteConfirm"><el-dropdown-item>外箱删除</el-dropdown-item></a>
                        <a class="PoutsideBinningPrintFour" href="/Packagings/OutsideBoxLableLogoChange"><el-dropdown-item>修改外箱标签LOGO</el-dropdown-item></a>
                        <a href="/Packagings/SPC_QueryByOrderNumber"><el-dropdown-item>备品配件</el-dropdown-item></a>
                    </el-dropdown-menu>
                </el-dropdown>
            </div>
        </el-header>
        <el-main v-loading="loading" class="PoutsideBinningPrintOne">
            <el-row style="text-align:center;margin-top:10px;">
                <el-col :md="12">
                    <div class="lineblock">
                        <div class="inputframe">
                            <span>班组：</span>
                            <group-select></group-select>
                        </div>
                        <div class="inputframe">
                            <span>原订单号：</span>
                            <select-input v-model.trim="selectVal" v-bind:disabled="mozutable.length>0" :options="selectOptions" :isfocus="true" :ismultiple="false" size="medium" @@select-val="selectHandle"></select-input>
                        </div>
                        <div class="inputframe">
                            <span>显示单号：</span>
                            <select-input v-model.trim="selectVal2" v-bind:class="selectVal2!=''?'changecolor':''" v-bind:disabled="mozutable.length>0" :options="selectOptions2" :isfocus="true" :ismultiple="false" size="medium" @@select-val="selectHandle"></select-input>
                        </div>
                        <div class="inputframe">
                            <span>装箱类型：</span>
                            <el-select v-model.trim="typeVal" placeholder="选择类型" filterable clearable size="medium">
                                <el-option v-for="item in typeOptions"
                                           :key="item.value"
                                           :value="item.value">
                                </el-option>
                            </el-select>
                        </div>
                        <div class="inputframe" v-show="isBatch">
                            <span>批次：</span>
                            <el-select v-model.trim="batchNum" placeholder="先选择类型，再选批次" filterable clearable size="medium">
                                <el-option v-for="item in batchOptions"
                                           :key="item.value"
                                           :value="item.value">
                                </el-option>
                            </el-select>
                        </div>
                        <div class="inputframe" v-show="isScreen">
                            <span>屏序：</span>
                            <el-select v-model.trim="screenNum" placeholder="先选择类型/批次，再选屏序" filterable clearable size="medium">
                                <el-option v-for="item in screenOptions"
                                           :key="item.value"
                                           :value="item.value">
                                </el-option>
                            </el-select>
                        </div>
                        <div class="inputframe">
                            <span>物料描述：</span>
                            <el-input placeholder="请输入物料描述"
                                      v-model.trim="wuliao"
                                      style="text-align:right;display:inline-block;"
                                      :class="[(wuliao=='')?'borderRed':'']"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                        <div class="inputframe">
                            <span>毛重量：</span>
                            <el-input-number placeholder="请输入毛重量"
                                             v-model.trim="maozhongliang"
                                             :precision="1"
                                             :step="0.1"
                                             :min="0"
                                             style="text-align:right;display:inline-block;"
                                             size="medium"
                                             clearable>
                            </el-input-number>
                        </div>
                        <div class="inputframe">
                            <span>净重：</span>
                            <el-input-number placeholder="请输入净重"
                                             v-model.trim="jingzhong"
                                             :precision="1"
                                             :step="0.1"
                                             :min="0"
                                             style="text-align:right;display:inline-block;"
                                             size="medium"
                                             clearable>
                            </el-input-number>
                        </div>
                        <div class="inputframe">
                            <span>选打印机：</span>
                            <el-select v-model="printSelect" clearable placeholder="选择打印机" size="medium">
                                <el-option v-for="item in printOptions"
                                           :key="item.value"
                                           :label="item.label"
                                           :value="item.value">
                                </el-option>
                            </el-select>
                        </div>
                        <div class="inputframe" v-show="printSelect!='0'&&printSelect!=''">
                            <span>打印浓度：</span>
                            <el-slider :max="30"
                                       :min="-30"
                                       v-model="nongDu"></el-slider>
                        </div>
                        <div class="inputframe" v-show="printSelect!='0'&&printSelect!=''">
                            <span>打印数量：</span>
                            <el-input-number v-model.trim="pageCount"
                                             size="medium"
                                             :min="1"
                                             :max="5"
                                             style="width:220px"
                                             clearable>
                            </el-input-number>
                        </div>
                        @*<div class="inputframe">
                                <span>(SN/TN)：</span>
                                <el-input placeholder="请输入"
                                          v-model.trim="sntn"
                                          style="text-align:right;display:inline-block;"
                                          size="medium"
                                          clearable>
                                </el-input>
                            </div>*@
                        @*<div class="inputframe">
                                <span>数量QTY：</span>
                                <el-input placeholder="请输入数量"
                                          v-model.trim="shuliang"
                                          style="text-align:right;display:inline-block;"
                                          size="medium"
                                          clearable>
                                </el-input>
                            </div>*@
                        <div class="inputframe">
                            <span>语言：</span>
                            <el-select v-model.trim="leng" placeholder="请选择语言" clearable size="medium">
                                <el-option v-for="item in lengOptions"
                                           :key="item.value"
                                           :value="item.value"></el-option>
                            </el-select>
                        </div>
                        <div class="inputframe">
                            <el-row>
                                <span v-if="customize">自定义：</span>
                                <span v-else>模组条码：</span>
                                @*<el-input placeholder="请输入模组号"
                                              v-model.trim="printMozhu"
                                              ref="inputRef"
                                              style="text-align:right;display:inline-block;"
                                              v-on:keyup.enter.native="mozuscan"
                                              size="medium"
                                              clearable>
                                    </el-input>*@
                                <div class="el-input el-input--medium el-input--suffix">
                                    <input v-model.trim="printMozhu"
                                           ref="inputRef"
                                           v-on:keyup.enter="mozuscan"
                                           type="text"
                                           autocomplete="off"
                                           placeholder="请输入"
                                           class="el-input__inner">
                                </div>
                                <el-switch v-model="customize"
                                           width="35"
                                           active-text="自定义"
                                           inactive-text="模组条码">
                                </el-switch>&nbsp;&nbsp;&nbsp;
                            </el-row>
                            <el-row>
                                <el-switch v-model="isMix"
                                           width="35"
                                           v-show="isWeixiang"
                                           active-text="混装"
                                           inactive-text="">
                                </el-switch>
                                <el-divider direction="vertical" v-if="isWeixiang"></el-divider>
                                <el-switch v-model="isWeixiang"
                                           width="35"
                                           active-text="尾箱"
                                           inactive-text="">
                                </el-switch>
                                <el-divider direction="vertical"></el-divider>
                                <el-switch v-model="imgShow"
                                           width="35"
                                           active-text="使用logo"
                                           inactive-text="">
                                </el-switch>
                            </el-row>
                            @*<el-button size="medium" @@click="imgShow=!imgShow">Logo</el-button>*@
                            <el-row>
                                <el-button size="medium" @@click="clear">重置</el-button>
                                <el-button v-on:click="postConfirm" type="primary" :disabled="printShow==true">确认</el-button>
                                <el-button v-on:click="masterPrint" type="primary" v-show="printShow">打印标签</el-button>
                            </el-row>
                        </div>
                        <div class="inputframe" style="text-align:left">
                            <el-table :data="completeInfo"
                                      max-height="300"
                                      border>
                                <el-table-column prop="type"
                                                 label="类型"
                                                 width="63">
                                </el-table-column>
                                <el-table-column prop="batchNum"
                                                 label="批次"
                                                 width="50">
                                </el-table-column>
                                <el-table-column prop="screenNum"
                                                 label="屏序"
                                                 width="50">
                                </el-table-column>
                                <el-table-column prop="completeNum"
                                                 label="已完成"
                                                 width="60">
                                </el-table-column>
                                <el-table-column prop="complete"
                                                 label="完成率"
                                                 width="75">
                                </el-table-column>
                            </el-table>
                        </div>
                        <div class="divframe">
                            <el-table :data="mozutable"
                                      height="300"
                                      border>
                                <el-table-column prop="barcode"
                                                 label="条码号"
                                                 width="150">
                                </el-table-column>
                                <el-table-column prop="boxcode"
                                                 label="箱体号">
                                </el-table-column>
                                <el-table-column prop="edit"
                                                 label=""
                                                 width="50">
                                    <template slot-scope="scope">
                                        <el-button @@click.native.prevent="deleteRow(scope.$index,scope.row ,mozutable)"
                                                   type="text"
                                                   size="mini"
                                                   style="margin:0;padding:0;width:100%;">
                                            <i class="el-icon-error"></i>
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <span v-if="mozutable.length!=0">条码数量：{{mozutable.length}}</span>
                        </div>
                    </div>
                </el-col>
                <el-col :md="12">
                    <div class="lineblock">
                        <div class="grid-content textCenter">
                            <el-row>
                                <div id="masterCarton">
                                    <div class="mcFrame">
                                        <div class="mcFrame_top">
                                            <div class="mcFrame_top_1">
                                                <img v-show="imgShow" class="imgicon" src="~/Images/LOGO.jpg" />
                                                <h1 v-bind:class="[selectVal2!=''?'changecolor':'',imgShow?'mcFrame_top_1_h':'mcFrame_top_1_h_noimg']"
                                                    v-text="selectVal2!=''?selectVal2:selectVal"></h1>
                                            </div>
                                            <div class="borderTop mcFrame_top_2">
                                                <div class="masterBarDiv textCenter">
                                                    <svg id="masterBarcode"></svg>
                                                </div>
                                            </div>
                                            <div class="borderTop mcFrame_top_3" style="height:120px;">
                                                <div class="mcFrame_top_3_1">
                                                    <div class="mcFrame_top_3_1_1">
                                                        <span v-if="leng=='中'">毛重量(kg)</span>
                                                        <span v-else-if="leng=='英'">G.W.(kg)</span>
                                                        <span v-else>毛重量G.W.(kg)</span>
                                                    </div>
                                                    <div class="mcFrame_top_3_1_1" style="border-right:none;"><span>{{maozhongliang}}</span></div>
                                                    <div class="mcFrame_top_3_1_1" style="border-left:1px solid #000;">
                                                        <span v-if="leng=='中'">净重(kg)</span>
                                                        <span v-else-if="leng=='英'">N.W.(kg)</span>
                                                        <span v-else>净重N.W.(kg)</span>
                                                    </div>
                                                    <div class="mcFrame_top_3_1_1"><span>{{jingzhong}}</span></div>
                                                </div>
                                                <div class="borderTop mcFrame_top_3_1">
                                                    <div class="mcFrame_top_3_1_1">
                                                        <span v-if="leng=='中'">物料描述</span>
                                                        <span v-else-if="leng=='英'">DESC</span>
                                                        <span v-else>物料描述(DESC)</span>
                                                    </div>
                                                    <div class="mcFrame_top_3_1_1" style="border-right:none;"><span>{{wuliao}}</span></div>
                                                    <div class="mcFrame_top_3_1_1" style="border-left:1px solid #000;">
                                                        <span v-if="leng=='中'">屏序号</span>
                                                        <span v-else-if="leng=='英'">No.</span>
                                                        <span v-else>屏序(No.)</span>
                                                    </div>
                                                    <div class="mcFrame_top_3_1_1"><span>{{screenNum}}</span></div>
                                                </div>
                                                <div class="borderTop mcFrame_top_3_1">
                                                    <div class="mcFrame_top_3_1_1">
                                                        <span v-if="leng=='中'">件号/数</span>
                                                        <span v-else-if="leng=='英'">SN/TN</span>
                                                        <span v-else>件号/数(SN/TN)</span>
                                                    </div>
                                                    <div class="mcFrame_top_3_1_1" style="border-right:none;"><span>{{sntn}}</span></div>
                                                    <div class="mcFrame_top_3_1_1" style="border-left:1px solid #000;">
                                                        <span v-if="leng=='中'">数量</span>
                                                        <span v-else-if="leng=='英'">QTY</span>
                                                        <span v-else>数量(QTY)</span>
                                                    </div>
                                                    <div class="mcFrame_top_3_1_1"><span>{{customize?'':mozutable.length}} PCS</span></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mcFrame_bottom borderTop">
                                            <div class="mcFrame_bottom_1">
                                                <template v-for="item in mozutable">
                                                    <span class="boxspan" @*v-bind:class="mozutable.length>20?'font20md':'font20xs'"*@ v-text="item.boxcode==''?item.barcode:item.boxcode"></span>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </el-row>
                        </div>
                    </div>
                </el-col>
            </el-row>
        </el-main>
    </el-container>
</div>
@RenderPage("~/Views/Shared/_SelectInput.cshtml")
@{
    var UserName = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).UserName;
}
@*  引入组件：
    1/_groupSelect，下拉选择框组件
*@
@RenderPage("~/Views/Users/_groupSelect.cshtml")
<script>
    var app = new Vue({
        el: "#app",
        data: {
            selectOptions: [],
            selectOptions2:[],
            selectVal: '',
            selectVal2: '',
            typeOptions: [],
            typeVal: '',
            isScreen: false,
            screenOptions: [],
            screenNum: '',
            isBatch: false,
            batchOptions: [],
            batchNum: '',
            loading: false,
            screenSize: document.body.clientWidth,
            imgShow: true,
            isWeixiang: false,
            isMix:false,
            masterVal: "",
            printMozhu: "",
            mozutable: [],
            maozhongliang: '',
            jingzhong:'',
            wuliao: "  LED 模组",
            sntn: "",
            shuliang: "",
            completeInfo: [],
            printShow: false,
            pageCount: 1,
            nongDu: 30,
            printOptions: printIpAddress,
            printSelect: '',
            leng: '中/英',
            lengOptions: [{
                value: '中',
                label: '中'
            }, {
                value: '英',
                label: '英',
            }, {
                value: '中/英',
                label: '中/英'
                }],
            customize: false
        },
        created: function () {
            axios.post('/Packagings/GetOrderList').then(rer => {
                this.selectOptions = rer.data;
                this.selectOptions2 = rer.data;
            }).catch(err => {
                console.warn("获取选择列表失败")
            });
            window.onresize = function () {
                app.screenSize = document.body.clientWidth;
            };
        },
        mounted: function () {
            let localOrder = localStorage.getItem('Order');
            if (localOrder != null) {
                this.selectVal = localOrder;
                this.selectHandle(this.selectVal);
            };

            let locallogo = localStorage.getItem('logoimg');
            if (locallogo != null) {
                if (locallogo == "true") {
                    this.imgShow = true;
                } else {
                    this.imgShow = false;
                };
            };
            let localwei = localStorage.getItem('weixiang');
            if (localwei != null) {
                if (localwei == "true") {
                    this.isWeixiang = true;
                } else {
                    this.isWeixiang = false;
                };
            };

            let localmix = localStorage.getItem('mix');
            if (localmix != null) {
                if (localmix == "true") {
                    this.isMix = true;
                } else {
                    this.isMix = false;
                };
            };

            //let localLeng = localStorage.getItem('leng');
            //if (localLeng != null) {
            //    this.leng = localLeng;
            //};
            let printIP = localStorage.getItem('printIP');
            if (printIP != null) {
                this.printSelect = printIP;
            };
            let localpage = localStorage.getItem('printPageCount');
            if (localpage != null) {
                this.pageCount = localpage;
            };
            let localnongdu = localStorage.getItem('printNongDuCount');
            if (localnongdu != null) {
                this.nongDu = +localnongdu;
            };
        },
        methods: {
            masterPrint: () => {
                app.loading = true;
                let pageNum = app.pageCount;
                let nongDu = app.nongDu;
                if (pageNum < 0 || pageNum > 5 || pageNum == "") {
                    alert("打印的数量要在0~5之间！");
                    app.loading = false;
                    return;
                };
                localStorage.setItem('printPageCount', pageNum);
                localStorage.setItem('printNongDuCount', nongDu);


                let mzList = [], mztable = app.mozutable;
                for (let i in mztable) {
                    if (mztable[i].boxcode == "") {
                        mzList.push(mztable[i].barcode)
                    } else {
                        mzList.push(mztable[i].boxcode)
                    };
                };
                axios.post('/Packagings/OutsideBoxLablePrint', {
                    ordernum: app.selectVal,
                    packagingordernum: app.selectVal2 == '' ? null : app.selectVal2,
                    screennum: app.screenNum,
                    leng: app.leng,
                    outsidebarcode: app.masterVal,
                    g_Weight: app.maozhongliang,
                    n_Weight: app.jingzhong,
                    material_discription: app.wuliao,
                    sntn: app.sntn,
                    qty: app.customize?'':app.mozutable.length,
                    mn_list: mzList,
                    logo: app.imgShow,
                    pagecount: app.pageCount,
                    concentration: app.nongDu,
                    ip: app.printSelect,//ip地址
                    port: 9101,//端口
                }).then(function (res) {
                    //console.log(res.data);
                        if (res.data == '打印成功！') {
                            //app.$confirm('是否重置信息,进行下一组录入?', res.data, {
                            //    confirmButtonText: '确定',
                            //    cancelButtonText: '取消',
                            //    type: 'success',
                            //    center: true,
                            //}).then(() => {
                            //    app.clear();
                            //}).catch(() => {
                            //});
                            app.clear();
                            app.loading = false;
                        } else {
                            app.$message({
                                showClose: true,
                                message: res.data,
                                type: 'error'
                            });
                            app.loading = false;
                        }
                        //document.getElementById("ww").setAttribute("src", data)
                    }).catch(err => {
                        app.$message({
                            showClose: true,
                            message: '打印出错！',
                            type: 'error'
                        });
                        app.loading = false;
                    });
            },
            setmasterBarDiv: (v) => {
                JsBarcode("#masterBarcode", v.toUpperCase(), {
                    height: 60, //条形码的高度
                    //fontOptions: "bold",//使文字加粗体或变斜体
                    format: "CODE128",
                    font: "monospace",
                    textAlign: "center",
                    textMargin: 0,//设置条形码和文本之间的间距
                    fontSize: 26,//设置文本的大小
                    lineColor: "#000",//条形码颜色
                    margin: 0,//设置条形码周围的空白边距
                    marginTop: 0
                });
            },
            mozuscan: function () {
                if (this.customize) {
                    if (this.mozutable.length >= 1) {
                        this.$message({
                            showClose: true,
                            message: '只能输入一个自定义描述',
                            type: 'error'
                        });
                    } else {
                        this.mozutable.push({
                            barcode: this.printMozhu,
                            boxcode: '',
                            ordernum: this.selectVal
                        });
                        this.printMozhu = "";
                    };
                } else {
                    if (this.printMozhu.length != 0) {
                        //检查重复
                        for (let i in this.mozutable) {
                            if (this.mozutable[i].barcode == this.printMozhu) {
                                this.$message({
                                    showClose: true,
                                    message: '已有重复条码！',
                                    type: 'warning'
                                });
                                this.printMozhu = "";
                                return;
                            };
                        };

                        //验证条码号和所选订单是否匹配
                        axios.post('/Packagings/IsCheckBarcode',
                            {
                                ordernum: this.selectVal,
                                barcode: this.printMozhu,
                                hybrid: this.isMix
                            }
                        ).then(res => {
                            if (res.data == true) {
                                axios.post('/Packagings/CheckBarcode',
                                    { barcode: this.printMozhu }
                                ).then(res => {
                                    if (res.data == true) {
                                        this.getNum(this.printMozhu, this.mozutable);
                                    } else {
                                        this.$notify({
                                            title: '警告',
                                            message: '条码"' + this.printMozhu + '"已打印，请确认条码！',
                                            type: 'error'
                                        });
                                        this.printMozhu = "";
                                    };
                                }).catch(err => {
                                    console.warn("验证失败");
                                    this.printMozhu = "";
                                });
                            } else {
                                this.$message({
                                    showClose: true,
                                    message: res.data,
                                    type: 'error'
                                });
                                this.printMozhu = "";
                            };
                        }).catch(err => {
                            console.warn("验证失败");
                            this.printMozhu = "";
                        });
                    };
                };
            },
            //确认post
            postConfirm: function () {
                this.loading = true;
                if ($("#banzuGroup").val() == "") {
                    this.$message.warning("请选择班组");
                    this.loading = false;
                    return;
                };
                let postList = [],
                    errormes = "",
                    order = this.selectVal,
                    masterVal = this.masterVal,
                    //maozhongliang = this.maozhongliang,
                    //jingzhong = this.jingzhong,
                    wuliao = this.wuliao,
                    sntn = this.sntn,
                    shuliang = this.shuliang,
                    mozuList = this.mozutable,
                    type = this.typeVal,
                    screenNum = this.screenNum,
                    batchNum = this.batchNum,
                    leng = this.leng,
                    customize = this.customize,
                    username = "@UserName",
                    date = new Date(),
                    nooknum = 0;
                if (order == "") {
                    errormes = errormes + (nooknum + 1) + "、订单号不能为空<br/>";
                    nooknum++;
                };
                if (type == "") {
                    errormes = errormes + (nooknum + 1) + "、装箱类型不能为空<br/>";
                    nooknum++;
                };
                if (this.isScreen == true) {
                    if (screenNum == "") {
                        errormes = errormes + (nooknum + 1) + "、屏序不能为空<br/>";
                        nooknum++;
                    };
                };
                if (this.isBatch == true) {
                    if (batchNum == "") {
                        errormes = errormes + (nooknum + 1) + "、批次不能为空<br/>";
                        nooknum++;
                    };
                };
                if (leng == '') {
                    errormes = errormes + (nooknum + 1) + "、请选择标签语言<br/>";
                    nooknum++;
                }
                if (masterVal == "") {
                    errormes = errormes + (nooknum + 1) + "、箱体条码不能为空<br/>";
                    nooknum++;
                };
                //if (maozhongliang == "") {
                //    errormes = errormes + (nooknum + 1) + "、毛重量不能为空<br/>";
                //    nooknum++;
                //};
                //if (jingzhong == "") {
                //    errormes = errormes + (nooknum + 1) + "、净重不能为空<br/>";
                //    nooknum++;
                //};
                if (wuliao == "") {
                    errormes = errormes + (nooknum + 1) + "、物料描述不能为空<br/>";
                    nooknum++;
                };
                if (sntn == "") {
                    errormes = errormes + (nooknum + 1) + "、(SN/TN)不能为空<br/>";
                    nooknum++;
                };
                //if (shuliang == "") {
                //    errormes = errormes + (nooknum + 1) + "、数量QTY不能为空<br/>";
                //    nooknum++;
                //};
                if (mozuList.length == 0) {
                    errormes = errormes + (nooknum + 1) + "、模组不能为空<br/>";
                    nooknum++;
                };
                if (!customize) {
                    if (this.isWeixiang == false) {
                        if (mozuList.length != shuliang) {
                            errormes = errormes + (nooknum + 1) + "、装箱模组数（" + mozuList.length + "）不等于装箱类型的数量（" + shuliang + "）！<br/>";
                            nooknum++;
                        };
                    } else {
                        if (mozuList.length > shuliang) {
                            errormes = errormes + (nooknum + 1) + "、装箱模组数（" + mozuList.length + "）大于装箱类型的数量（" + shuliang + "）！<br/>";
                            nooknum++;
                        };
                    };
                };


                    if (mozuList.length != 0) {
                        let bar = [], box = [];
                        for (let i of mozuList) {
                            bar.push(i.barcode);
                            box.push(i.boxcode);
                        };
                        if (this.cfcheck(bar)) {
                            errormes = errormes + (nooknum + 1) + "、存在重复的条码号，请检查！<br/>";
                            nooknum++;
                        };
                        if (this.cfcheck(box)) {
                            errormes = errormes + (nooknum + 1) + "、存在重复的模组号，请检查！<br/>";
                            nooknum++;
                        };
                };

                if (nooknum > 0) {
                    this.$alert(errormes, "标签不合格", {
                        confirmButtonText: '确定',
                        closeOnClickModal: true,
                        closeOnPressEscape: true,
                        dangerouslyUseHTMLString: true,
                        type: "error",
                    });
                    this.loading = false;
                } else {
                    let sntnz = sntn.split("/")[0];
                    for (let item in mozuList) {
                        postList.push({
                            OrderNum: mozuList[item].ordernum,
                            packagingordernum: app.selectVal2 == '' ? null : app.selectVal2,
                            Type: type,
                            ScreenNum: screenNum,
                            Batch: batchNum,
                            leng: leng,
                            OuterBoxBarcode: masterVal,
                            BarCodeNum: mozuList[item].barcode,
                            ModuleGroupNum: mozuList[item].boxcode,
                            Operator: username,
                            Date: date,
                            SNTN: sntnz,
                            G_Weight: this.maozhongliang,
                            N_Weight: this.jingzhong,
                            Materiel: this.wuliao,
                            IsLogo: this.imgShow,
                        });
                    };
                    axios.post('/Packagings/CreatePackangPrint',
                        {
                            printings: postList,
                            ordernum: order,
                            Department1: $("#banzuDepartment").val(),
                            Group: $("#banzuGroup").val()
                        }
                    ).then(res => {
                        if (res.data == true) {
                            //this.$alert('确认成功！', {
                            //    confirmButtonText: '确定',
                            //    closeOnClickModal: true,
                            //    closeOnPressEscape: true,
                            //    type: "success",
                            //    //callback: () => {
                            //    //    this.clear();
                            //    //}
                            //});
                            this.printShow = true;
                            this.masterPrint();
                        } else {
                            this.$alert(res.data, {
                                confirmButtonText: '确定',
                                closeOnClickModal: true,
                                closeOnPressEscape: true,
                                type: "error",
                            });
                            this.loading = false;
                        };
                    }).catch(err => {
                        console.warn("获取模组号失败")
                        this.loading = false;
                    });
                };
            },
            cfcheck(arr) {
                let hash = {};
                for (let i of arr) {
                    if (hash[i]) {
                        return true;
                    };
                    if (i != '') {
                        hash[i] = true;
                    };
                };
                return false;
            },
            //获取箱体号
            getNum: function (bar, table) {
                if (bar != "") {
                    axios.post('/Packagings/GetModulbarCode',
                        { barcode: bar }
                    ).then(res => {
                        //console.log(res.data)
                        //if (res.data == "") {
                        //    this.$message({
                        //        message: '此条码没有箱体号！',
                        //    });
                        //};
                        table.push({
                            barcode: bar,
                            boxcode: res.data.module,
                            ordernum: res.data.orderNum
                        });
                        this.printMozhu = "";
                    }).catch(err => {
                        console.warn("获取模组号失败");
                        this.printMozhu = "";
                    });
                } else {
                    this.printMozhu = "";
                };
            },
            //删除行
            deleteRow: function (index, row, data) {
                data.splice(index, 1);
            },
            //重置
            clear: function () {
                this.printMozhu = "";
                this.mozutable = [];
                this.shuliang = "";
                this.printShow = false;
                this.isWeixiang = false;
                //this.typeVal = "";
                this.getorder();
                this.getqtyNum();
                this.getcompleteInfo();
                this.$message({
                    showClose: true,
                    message: '重置完毕'
                });
                this.$refs.inputRef.focus();
            },
            //获取类型
            getType: function () {
                this.typeOptions = [];
                this.typeVal = "";
                if (this.selectVal != "") {
                    axios.post('/Packagings/GetBoxType', { ordernum: this.selectVal }).then(res => {
                        //console.log(res.data);
                        if (res.data.length == 0) {
                            this.$notify({
                                title: '警告',
                                message: '此条码没有装箱类型！',
                                type: 'warning'
                            });
                        } else {
                            this.typeOptions = res.data;
                        };
                    }).catch(err => {
                        console.warn("获取选择列表失败")
                    });
                };
            },
            //获取批次
            getBatch: function () {
                this.batchOptions = [];
                this.batchNum = "";
                if (this.selectVal != "" && this.typeVal != "") {
                    axios.post('/Packagings/GetBatchNum', { ordernum: this.selectVal, type: this.typeVal }).then(res => {
                        //console.log(res.data);
                        if (res.data.IsBatch == true) {
                            this.isBatch = true;
                            this.batchOptions = res.data.List;
                        } else {
                            this.isBatch = false;
                            this.batchOptions = [{ value: 1 }];
                            this.batchNum = 1;
                        };
                    }).catch(err => {
                        console.warn("获取选择列表失败")
                    });
                };
            },
            //获取屏序
            getScreen: function () {
                this.screenOptions = [];
                this.screenNum = "";
                if (this.selectVal != "" && this.typeVal != "" && this.batchNum!="") {
                    axios.post('/Packagings/GetScreenNum', { ordernum: this.selectVal, type: this.typeVal, batchNum: this.batchNum}).then(res => {
                        //console.log(res.data);
                        if (res.data.IsScreen == true) {
                            this.isScreen = true;
                            this.screenOptions = res.data.List;
                        } else {
                            this.isScreen = false;
                            this.screenOptions = [{ value: 1 }];
                            this.screenNum = 1;
                            this.getqtyNum();
                        };
                    }).catch(err => {
                        console.warn("获取选择列表失败")
                    });
                };
            },
            //获取数量
            getqtyNum: function () {
                this.shuliang = "";
                if (this.selectVal != "" && this.typeVal != "" ) {
                    this.loading = true;
                    axios.post('/Packagings/GetNum', {
                        ordernum: this.selectVal,
                        type: this.typeVal,
                        screenNum: this.screenNum,
                        batchNum: this.batchNum
                    }).then(res => {
                        //console.log(res.data);
                        if (res.data == 0) {
                            this.$notify({
                                title: '警告',
                                message: '此装箱类型已无数量可打印！',
                                type: 'error'
                            });
                        };
                        this.shuliang = res.data;
                        this.loading = false;
                    }).catch(err => {
                        console.warn("获取信息失败")
                        this.loading = false;
                    });
                };
            },
            //获取完成信息
            getcompleteInfo: function () {
                this.completeInfo = [];
                if (this.selectVal != "") {
                    axios.post('/Packagings/GetcompleteInfo', {
                        ordernum: this.selectVal
                    }).then(res => {
                        //console.log(res.data);
                        this.completeInfo = res.data;
                    }).catch(err => {
                        console.warn("获取信息失败")
                    });
                } else {
                    this.completeInfo = [];
                };
            },
            //获取条码信息
            getorder: function () {
                if (this.selectVal != "" && this.screenNum != "" && this.batchNum!="") {
                    axios.post('/Packagings/GetOuterBoxBarCodeInfo', {
                        ordernum: this.selectVal,
                        screenNum: this.screenNum,
                        batchNum: this.batchNum
                    }).then(res => {
                        //console.log(res.data);
                        if (res.data != "") {
                            this.masterVal = res.data.boxNum;
                            this.sntn = res.data.SNTN;
                        } else {
                            this.$notify({
                                title: '警告',
                                message: '此订单没有需要打印的外箱条码！',
                                type: 'warning'
                            });
                            this.masterVal = "";
                        };
                    }).catch(err => {
                        console.warn("获取选择列表失败")
                    });
                };
            },
            selectHandle: function (v) {
                if (v != "") {
                    localStorage.setItem('Order', v);
                    this.getType();
                    this.getorder();
                    this.getcompleteInfo();
                };
            }
        },
        watch: {
            masterVal: (val) => {
                if (val != "") {
                    app.setmasterBarDiv(val);
                } else {
                    $(".masterBarDiv").html('<svg id="masterBarcode"></svg>');
                };
            },
            //订单号
            selectVal: function (v) {
                if (v == '') {
                    this.getcompleteInfo();
                    this.typeVal = "";
                    this.masterVal == "";
                }
            },
            imgShow: function (v) {
                localStorage.setItem('logoimg', v);
            },
            isWeixiang: function (v) {
                localStorage.setItem('weixiang', v);
                if (v == false) {
                    this.isMix = false;
                };
            },
            isMix: function (v) {
                localStorage.setItem('mix', v);
            },
            typeVal: function (v) {
                if (v != "") {
                    this.getBatch();
                    this.$refs.inputRef.focus();
                } else {
                    this.masterVal = "";
                    this.isScreen = false;
                    this.screenNum = "";
                    this.screenOptions = [];
                    this.isBatch = false;
                    this.batchNum = "";
                    this.batchOptions = [];
                };
            },
            printSelect: (v) => {
                localStorage.setItem('printIP', v);
            },
            screenNum: function (v) {
                if (v != "") {
                    this.getorder();
                    this.getqtyNum();
                } else {
                    this.masterVal = "";
                };
            },
            batchNum: function (v) {
                if (v != "") {
                    this.getScreen();
                } else {
                    this.masterVal = "";
                    this.isScreen = false;
                    this.screenNum = 1;
                    this.screenOptions = [];
                };
            },
            leng: function (v) {
                //localStorage.setItem('leng', v);
                if (v === '英') {
                    this.wuliao = 'LED Module';
                } else {
                    this.wuliao = '  LED 模组';
                };
            },
            customize: function (v) {
                this.printMozhu = '';
                if (v) {
                    this.wuliao = '';
                } else {
                    if (this.leng === '英') {
                        this.wuliao = 'LED Module';
                    } else {
                        this.wuliao = '  LED 模组';
                    };
                };
            }
        },
    });
</script>