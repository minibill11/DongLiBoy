@model IEnumerable<JianHeMES.Models.Warehouse_Material_BaseInfo>

@{
    ViewBag.Title = "物料查询";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/axios.min.js"></script>
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Content/styleFile/solder/solderJavascript.js"></script>
<style>
    h2 {
        text-align: center;
        font-size: 1.8rem;
    }

    .el-form-item {
        margin-bottom: 2px;
    }

    @@media screen and (min-width:800px) {
        #app {
            display: flex;
            justify-content: center;
            width: 80%;
            margin: 0 auto;
        }

        .leftCcontainer {
            width: 40%;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            /*background-color:cyan;*/
        }

        .rightContainer {
            width: 40%;
            max-height: 560px;
            overflow: scroll;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            margin-left: 8px;
            /*background-color:greenyellow;*/
        }
        
    }
    @@media screen and (max-width:410px){
       
    }
</style>
<h2>物料查询</h2>

<div id="app">
    @* 左测表格 *@
    <div class="leftCcontainer">
        <el-form model="ruleForm" status-icon ref="ruleForm" label-width="80px" class="demo-ruleForm">
            <el-form-item label="物料编号" prop="img01">
                <el-input id="searchinput" size="small" type="text" v-model="ruleForm.img01" autocomplete="off"></el-input>
                <el-button v-on:click="search" id="search" size="mini" type="success">查询</el-button>
                <el-button v-on:click="clearinfos" id="clearinfos" size="mini" type="primary">清空</el-button>
                <el-button v-on:click="records" id="records" size="mini" type="primary">记录</el-button>
            </el-form-item>
            <el-form-item label="品名" prop="ima02">
                <el-input size="small" disabled type="text" v-model="ruleForm.ima02" autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item label="规格" prop="ima021">
                <el-input size="small" disabled type="textarea" v-model="ruleForm.ima021"></el-input>
            </el-form-item>
            <el-form-item label="仓库" prop="img02">
                <el-input size="small" disabled type="text" v-model="ruleForm.img02" autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item label="库位" prop="img03">
                <el-input style="width:150px;" size="small" type="text" v-model="ruleForm.img03" autocomplete="off"></el-input>
                <el-button v-on:click="saveChange" size="mini" type="success">保存</el-button>
            </el-form-item>
            <el-form-item label="批号" prop="img04">
                {{ruleForm.img04}}
            </el-form-item>
            <el-form-item label="库存数量" prop="checkPass">
                {{ruleForm.img10}}
            </el-form-item>
            <el-form-item label="库存单位" prop="checkPass">
                {{ruleForm.img09}}
            </el-form-item>
            <el-form-item label="参考号码" prop="checkPass">
                {{ruleForm.img05}}
            </el-form-item>
            <el-form-item label="有效期" prop="checkPass">
                {{ruleForm.img18 | YMD}}
            </el-form-item>
            <el-form-item label="供应商" prop="checkPass">
                未提供
            </el-form-item>

        </el-form>
    </div>
    @* 右侧表单 *@
    <div class="rightContainer">
        <el-form model="ruleForm2" status-icon ref="ruleForm2" label-width="155px" class="demo-ruleForm2">
            <el-form-item label="参考序号" prop="checkPass">
                {{ruleForm2.img06}}
            </el-form-item>
            <el-form-item label="收货数量" prop="checkPass">
                {{ruleForm2.img08}}
            </el-form-item>
            <el-form-item label="采购单位/生产单位" prop="checkPass">
                {{ruleForm2.img07}}
            </el-form-item>
            <el-form-item label="制造日期" prop="checkPass">
                {{ruleForm2.img13 | YMD}}
            </el-form-item>
            <el-form-item label="最近一次盘点日期" prop="checkPass">
                {{ruleForm2.img14 | YMD}}
            </el-form-item>
            <el-form-item label="最近一次收料日期" prop="checkPass">
                {{ruleForm2.img15 | YMD}}
            </el-form-item>
            <el-form-item label="最近一次发料日期" prop="checkPass">
                {{ruleForm2.img16 | YMD}}
            </el-form-item>
            <el-form-item label="最近一次异动日期" prop="checkPass">
                {{ruleForm2.img17 | YMD}}
            </el-form-item>
            <el-form-item label="库存等级" prop="checkPass">
                {{ruleForm2.img19}}
            </el-form-item>
            <el-form-item label="单位数量换算率" prop="checkPass">
                {{ruleForm2.img20}}
            </el-form-item>
            <el-form-item label="单位数量换算率-对料件库存单" prop="checkPass">
                {{ruleForm2.img21}}
            </el-form-item>
            <el-form-item label="仓储类别" prop="checkPass">
                {{ruleForm2.img22}}
            </el-form-item>
            <el-form-item label="是否为可用仓储" prop="checkPass">
                {{ruleForm2.img23}}
            </el-form-item>
            <el-form-item label="是否为ＭＲＰ可用仓储" prop="checkPass">
                {{ruleForm2.img24}}
            </el-form-item>
            <el-form-item label="保税与否" prop="checkPass">
                {{ruleForm2.img25}}
            </el-form-item>
            <el-form-item label="仓储所属会计科目" prop="checkPass">
                {{ruleForm2.img26}}
            </el-form-item>
            <el-form-item label="工单发料优先顺序" prop="checkPass">
                {{ruleForm2.img27}}
            </el-form-item>
            <el-form-item label="销售出货优先顺序" prop="checkPass">
                {{ruleForm2.img28}}
            </el-form-item>
            <el-form-item label="直接材料成本" prop="checkPass">
                {{ruleForm2.img30}}
            </el-form-item>
            <el-form-item label="间接材料成本" prop="checkPass">
                {{ruleForm2.img31}}
            </el-form-item>
            <el-form-item label="厂外加工材料成本" prop="checkPass">
                {{ruleForm2.img32}}
            </el-form-item>
            <el-form-item label="厂外加工人工成本" prop="checkPass">
                {{ruleForm2.img33}}
            </el-form-item>
            <el-form-item label="库存单位对成本单位的转换率" prop="checkPass">
                {{ruleForm2.img34}}
            </el-form-item>
            <el-form-item label="专案号码" prop="checkPass">
                {{ruleForm2.img35}}
            </el-form-item>
            <el-form-item label="外观编号" prop="checkPass">
                {{ruleForm2.img36}}
            </el-form-item>
            <el-form-item label="呆滞日期" prop="checkPass">
                {{ruleForm2.img37 | YMD}}
            </el-form-item>
            <el-form-item label="备注" prop="checkPass">
                {{ruleForm2.img38}}
            </el-form-item>
        </el-form>
    </div>
</div>
@*<p>
    @Html.ActionLink("Create New", "Create")
</p>*@


<script>
    // 监听回车事件
    document.onkeydown = function (event) {
        var e = event || window.event;    // 兼容IE
        if (e && e.keyCode == 13) { //回车键的键值为13
            $("#search").click();
        }
    };
    Vue.filter('YMD', function (val) {
        if (val == null) return '';
        if (val.indexOf("9999") != -1) {
            return '无期限'
        } else {
            let dd = new Date(val);
            let year = dd.getFullYear();
            let month = (dd.getMonth() + 1).toString().padStart(2, 0);
            let days = dd.getDate().toString().padStart(2, 0);
            let hours = dd.getHours().toString().padStart(2, 0);
            let minius = dd.getMinutes().toString().padStart(2, 0);
            let seconds = dd.getSeconds().toString().padStart(2, 0);
            return `${year}-${month}-${days}`
        }
    });
    let app = new Vue({
        el: "#app",
        data:{
            ruleForm: {
                pass: '',
                checkPass: '',
                age: ''
            },
            ruleForm2:{}
        },
        methods: {
            // 根据物料编号查找
            getInfos(nums) {
                axios.post("/Warehouse_Material/QueryMaterial", { material:nums}).then(res=> {
                    console.log(res.data)
                    if (res.data.length > 0) {
                        this.ruleForm = res.data[0];
                        this.ruleForm2 = res.data[0];
                    } else {
                        this.$notify({
                            message: "查无数据",
                            type: "warning"
                        })
                    }
                }).catch(err=> {
                    this.$notify({
                        message: "网络错误",
                        type:"warning"
                    })
                })
            },
            // 保存修改库位
            saveChange() {
                if (this.ruleForm.img03 !== '') {
                    axios.post("/Warehouse_Material/ModifyLocation", { material: this.ruleForm.img01, position: this.ruleForm.img03 }).then(res=> {
                        console.log(res.data)
                        if (res.data.Site == true) {
                            this.$notify({
                                message: "修改成功！",
                                type: "success"
                            })
                        } else {
                            this.$notify({
                                message: "ERP的库位号和MES的库位号不一样,修改失败！",
                                type: "warning"
                            })
                        }

                    }).catch(err=> {
                        this.$notify({
                            message: "网络错误！",
                            type: "warning"
                        })
                    })
                } else {
                    this.$notify({
                        message: "请填写库位号！",
                        type: "warning"
                    })
                }

            },
            // 查询按钮
            search() {
                this.getInfos(this.ruleForm.img01)
            },
            // 清空
            clearinfos() {
                this.ruleForm = {};
                this.ruleForm2 = {};
                $("#searchinput").focus();
            },
            // 记录
            records() {
                window.location.href = "/Warehouse_Material/Create"
            }
        },
        mounted() {
            $("#searchinput").focus();
        }
    })
</script>
