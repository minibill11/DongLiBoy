@model JianHeMES.Models.EquipmentBasicInfo

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/axios.min.js"></script>
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>

<style>
    .fuck{
        display:flex;
        justify-content:center;
    }
    .el-dialog__body{
        padding:5px;
    }
    .el-dialog__body>div{
        display:inline-block;
        width:46%;
    }
    .el-input{
        display:inline-block;
        width:60%;
        padding:0;
    }
    .el-input input{
        padding:0 !important;
    }
    .tabletop,thead,th,td,.tablebottom{
        text-align:center;
    }
    .tabletop tr,.tablebottom tr{
        height:34px;
    }
    .tabletop tr td:nth-child(1){
        width:100px;
    }
    .tabletop tr td:nth-child(2){
        width:150px;
    }
    .tabletop tr td:nth-child(3){
        width:100px;
    }
    .tabletop tr td:nth-child(4){
        width:150px;
    }
    .tabletop tr td:nth-child(5){
        width:100px;
    }
    .tabletop tr td:nth-child(6){
        width:350px;
    }

    .tablebottom tr td:nth-child(1){

    }
    .tablebottom tr td:nth-child(2){

    }
    .tablebottom tr td:nth-child(3){

    }
    .tablebottom tr td:nth-child(4){

    }
    .tablebottom tr td:nth-child(5){

    }
    .tablebottom tr td:nth-child(6){

    }
    .tablebottom tr td:nth-child(7){

    }
    .tablebottom tr td:nth-child(8){

    }
    .tablebottom tr td:nth-child(9){
        width:150px;
    }
    
</style>
<h2>Details</h2>
@Html.ActionLink("批量添加维修记录", "InputEquipmentRepairRecord")||@Html.ActionLink("单个添加维修记录", "InputEquipmentRepairRecordSingle")
<div id="app">
    <form id="myform"  style="display:none;" action="/Equipment/UploadEquipmentPicture" method="post"> 
        <input class="upload" v-model="file" name="uploadfile" type="file" />
        <input class="upload1" v-model="AssetNumber" name="assetNumber" type="text" />
        <input type="reset" class="reset" />
    </form>
    <table class="tabletop" border="1" style="width:100%">
        <thead>
            <tr>
                <th colspan="6">
                    SMT部设备保养、维修履历资料汇总表
                    <select id="selectChange" style="margin-left:150px;height:100%;width:120px;">
                        <option>{{tabletop.Status}}</option>
                        <option>运行</option>
                        <option>调机</option>
                        <option>保养</option>
                        <option>停机</option>
                        <option>维修</option>
                    </select>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>资产编号</td>
                <td>{{tabletop.AssetNumber}}</td>
                <td>设备名称</td>
                <td>{{tabletop.EquipmentName}}</td>
                <td>使用部门</td>
                <td>{{tabletop.UserDepartment}}</td>
            </tr>
            <tr>
                <td>设备编码</td>
                <td>{{tabletop.EquipmentNumber}}</td>
                <td>型号规格</td>
                <td>{{tabletop.ModelSpecification}}</td>
                <td rowspan="3">设备图片<br /><button v-on:click="chiose">选择</button>||<button v-on:click="postImgs">上传</button>{{fname}}</td>
                <td rowspan="3">
                    <el-carousel height="150px">
                        <el-carousel-item v-for="item in imgArr" key="item">
                            <img v-bind:src="item.FullPath" />
                        </el-carousel-item>
                    </el-carousel>
                </td>
            </tr>
            <tr>
                <td>出厂编号</td>
                <td>{{tabletop.ManufacturingNumber}}</td>
                <td>生产厂家</td>
                <td>{{tabletop.Brand}}</td>
            </tr>
            <tr>
                <td>购入日期</td>
                <td>{{tabletop.CreateTime}}</td>
                <td>启用日期</td>
                <td>{{tabletop.ActionDate}}</td>
            </tr>
            <tr>
                <td colspan="6">
                    <strong>
                        <button v-on:click="dialogVisible = true">增加维修记录</button>   
                        <span style="margin: auto 245px;font-size:15px;">设备维修记录 </span>  
                        
                        <span>请选择需要修改的序号：</span>
                        <select>
                            <option v-for="(item,index) in statusrecord">{{index+1}}</option>
                        </select>  
                        <button v-on:click="dialogVisibles = true">修改维修记录</button>
                    </strong>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="tablebottom" border="1" style="width:100%">
        <thead>
            <tr>
                <th>
                    序号
                </th>
                <th>
                    故障现象描述
                </th>
                <th>
                    原因分析
                </th>
                <th>
                    维修或检测内容
                </th>
                <th>
                    接单时间
                </th>
                <th>
                    计划完成时间
                </th>
                <th>
                    实际完成时间
                </th>
                <th>
                    维修人
                </th>
                <th>
                    备注
                </th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="(item,index) in statusrecord">
                <td>{{index + 1}}</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
                <td>测试</td>
            </tr>
        </tbody>
    </table>
    <button onclick="goback()">返回</button>
   
    <el-dialog title="提示"
               v-bind:visible.sync="dialogVisible"
               width="60%"
               style="text-align:center;"
               v-bind:before-close="handleClose">
        <span>新增设备维修记录</span>
        <hr />
        
        <div>
            <div class="fuck">
                设备编号
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input1"
                          clearable>
                </el-input>
            </div>
        </div>
        <div>
            <div class="fuck">
                资产编号
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input2"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                设备名称
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input3"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                订单号
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input4"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                设备状态
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input5"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                状态开始时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input6"
                          clearable>
                </el-input>
            </div>

            
        </div>
        <div>
            <div class="fuck">
                状态结束时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input7"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                报修人
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input8"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                故障现象描述
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input9"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                原因分析
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input10"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                维修或检测内容
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input11"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                维修接单时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input12"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                计划完成时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input13"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                实际完成时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input14"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                维修人
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input15"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                配件信息
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input16"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                使用部门
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input17"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                车间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input18"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                产线号
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input19"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                工段
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input20"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                创建时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input21"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <div>
            <div class="fuck">
                备注
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form1.input22"
                          clearable>
                </el-input>
            </div>
            
        </div>
        <span slot="footer" class="dialog-footer">
            <el-button v-on:click="dialogVisible = false">取 消</el-button>
            <el-button type="primary" v-on:click="dialogVisible = false">保存</el-button>
        </span>
    </el-dialog>

    <el-dialog title="提示"
               v-bind:visible.sync="dialogVisibles"
               width="65%"
               v-bind:before-close="handleClose">
        <span>修改设备维修记录</span>
        <hr />

        <div>
            <div class="fuck">
                设备编号
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input1"
                          clearable>
                </el-input>
            </div>
        </div>
        <div>
            <div class="fuck">
                资产编号
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input2"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                设备名称
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input3"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                订单号
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input4"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                设备状态
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input5"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                状态开始时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input6"
                          clearable>
                </el-input>
            </div>


        </div>
        <div>
            <div class="fuck">
                状态结束时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input7"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                报修人
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input8"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                故障现象描述
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input9"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                原因分析
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input10"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                维修或检测内容
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input11"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                维修接单时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input12"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                计划完成时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input13"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                实际完成时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input14"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                维修人
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input15"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                配件信息
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input16"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                使用部门
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input17"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                车间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input18"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                产线号
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input19"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                工段
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input20"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                创建时间
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input21"
                          clearable>
                </el-input>
            </div>

        </div>
        <div>
            <div class="fuck">
                备注
                <el-input placeholder="请输入内容"
                          size="mini"
                          v-model="form2.input22"
                          clearable>
                </el-input>
            </div>

        </div>
        <span slot="footer" class="dialog-footer">
            <el-button v-on:click="dialogVisibles = false">取 消</el-button>
            <el-button type="primary" v-on:click="dialogVisibles = false">保存</el-button>
        </span>
    </el-dialog>
</div>

<script>
    //时间格式化
    function GMTToStr(time) {
        let date = new Date(time)
        //console.log(date);
        let Str = date.getFullYear() + '-' +
            (date.getMonth() + 1) + '-' +
            date.getDate() + ' ' +
            date.getHours() + ':' +
            date.getMinutes() + ':' +
            date.getSeconds()
        return Str
    }

    //返回历史记录
    function goback() {
        window, history.back();
    }

    // 增加维修记录
    function addIndos() {

    }

    

    let vm = new Vue({
        el: "#app",
        data: {
            AssetNumber: null,
            tabletop: '',
            imgs: null,
            file: null,
            fname:'',
            imgArr: [],
            statusrecord: [{ s: '1' }, { s: '1' }, { s: '1' }, { s: '1' }],
            status: null,
            dialogVisible: false,
            dialogVisibles: false,
            input10: null,
            form1: {
                input1: null,
                input2: null,
                input3: null,
                input4: null,
                input5: null,
                input6: null,
                input7: null,
                input8: null,
                input9: null,
                input10: null,
                input11: null,
                input12: null,
                input13: null,
                input14: null,
                input15: null,
                input16: null,
                input17: null,
                input18: null,
                input19: null,
                input20: null,
                input21: null,
                input22: null,
            },
            form2: {
                input1: null,
                input2: null,
                input3: null,
                input4: null,
                input5: null,
                input6: null,
                input7: null,
                input8: null,
                input9: null,
                input10: null,
                input11: null,
                input12: null,
                input13: null,
                input14: null,
                input15: null,
                input16: null,
                input17: null,
                input18: null,
                input19: null,
                input20: null,
                input21: null,
                input22: null,
            }

        },
        mounted() {
            let hrefStr = window.location.href;
            let indexofequl = hrefStr.indexOf("=") + 1;
            this.AssetNumber = hrefStr.slice(indexofequl) // 获取index传过来的资产编号
            this.getDefaultInfos(this.AssetNumber)
            //console.log(this.AssetNumber)
        },
        methods: {
            handleClose(done) {
                this.$confirm('确认关闭？')
                  .then(_ => {
                      done();
                  })
                  .catch(_ => {});
            },
            getDefaultInfos(nums) {
                axios.post("/Equipment/Details", { assetNumber: this.AssetNumber }).then(res=> {
                    console.log(res.data)
                    // 获取基本信息
                    let basicInfos = JSON.parse(res.data.basicinfo);
                    basicInfos.ActionDate = GMTToStr(basicInfos.ActionDate);
                    basicInfos.CreateTime = GMTToStr(basicInfos.CreateTime);
                    //console.log(basicInfos)
                    this.tabletop = basicInfos;

                    // 获取图片 
                    if (res.data.picture != '未上传图片。') {
                        let img = JSON.parse(res.data.picture);
                        this.imgArr = img
                        console.log(img)
                    } else {

                    }

                    //获取维修记录

                    let statusrecord = JSON.parse(res.data.statusrecord);
                    console.log(statusrecord)
                    //this.statusrecord = statusrecord;
                }).catch(err=> {

                })
            },
            postImgs() {
                let tt = $('.upload')[0].files[0];
                if (tt != null) {
                    console.log($('.upload'))
                    let f = new FormData();
                    let tt = $('.upload')[0].files[0];
                    f.append("assetNumber", this.AssetNumber);
                    f.append("uploadfile", tt);
                    console.log(tt)
                    axios.post("/Equipment/UploadEquipmentPicture", f).then(res=> {  // 
                        console.log(res.data)
                        if (res.data == '上传成功！') {
                            this.$message({
                                message: res.data,
                                type: 'success'
                            });
                            $('.reset').click();

                        } else {
                            this.$message({
                                message: res.data,
                                type: 'success'
                            })
                        }; 
                    }).catch(err=> {
                        this.$message({
                            message: "连接服务器失败!",
                            type: 'warning'
                        })
                    })

                } else {
                    this.$message({
                        message: "请选择需要上传的图片！",
                        type: 'warning'
                    })
                }
            },
            chiose() {
                $(".upload").click();  // 用户选择图片
                
            },
        }
    });


    // 修改设备状态
    window.onload = function () {
        $("#selectChange").change(function () {
            axios.post("/Equipment/ModifyEquipmentStatusAsync", { id: vm.tabletop.Id, status: $("#selectChange").val() }).then(res=> {
                console.log(res.data)
                if (res.data == 'False') {
                    vm.$message({
                        message: "修改设备状态失败！",
                        type: "warning"
                    })
                } else {
                    vm.$message({
                        message: "修改成功！",
                        type: "success"
                    })
                }
            }).catch(err=> {

            })
        });

        // 监听输入框的改变
        $(".upload").bind('input porpertychange', function () {
            vm.fname = ''
            let tt = $('.upload')[0].files[0];
            vm.fname = tt.name
            console.log("it changed")
        });

    }
    
</script>

@*<div>
    <h4>EquipmentBasicInfo</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.SerialNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.SerialNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EquipmentNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EquipmentNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.AssetNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.AssetNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EquipmentName)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EquipmentName)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Brand)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Brand)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ModelSpecification)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ModelSpecification)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.InfoPlate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.InfoPlate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ManufacturingNumber)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ManufacturingNumber)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Quantity)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Quantity)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ActionDate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ActionDate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.DepreciableLife)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.DepreciableLife)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.UserDepartment)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.UserDepartment)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.StoragePlace)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.StoragePlace)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.WorkShop)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.WorkShop)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.LineNum)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.LineNum)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Section)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Section)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.FunctionDiscription)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.FunctionDiscription)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Status)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Status)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Creator)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Creator)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.CreateTime)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.CreateTime)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Modifier)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Modifier)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.ModifyTime)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.ModifyTime)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Remark)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Remark)
        </dd>

    </dl>
</div>
<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.Id }) |
    @Html.ActionLink("Back to List", "Index")
</p>*@
