@{
    ViewBag.Title = "挪用条码查询";
}
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Scripts/Bootstraps/bootstrap-select.min.js"></script>
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<link href="~/Scripts/Bootstraps/bootstrap-select.min.css" rel="stylesheet" />
<style>
    .container, .body-content {
        padding-left: 0px;
        padding-right: 0px;
    }

    .selectpicker, .bootstrap-select > .btn {
        border: 1px solid #ccc;
    }

    .form-control {
        max-width: 220px;
    }

    .el-table td {
        border-top: 1px solid #EBEEF5;
    }

    .el-table td, .el-table th {
        padding: 5px 0;
    }

    .container {
        width: 1200px;
    }

    .el-table {
        font-size: 13px;
    }

    .red {
        color: #0083d2;
    }
</style>


<div id="app">
    <el-container>
        <el-header style="height:auto">
            <el-row class="text-center">
                <h2>挪用条码查询</h2>
                <span>
                    订单号：@Html.DropDownList("orderNum", (List<SelectListItem>)ViewBag.OrderNumList, "全部", new { @class = "selectpicker", data_live_search = "true", data_style = "form-control" })
                    条码号：<input id="barcode" class="form-control" style="display:inline-block" />
                    <el-button type="primary" v-on:click="getData" size="small">查询</el-button>
                </span>
            </el-row>
        </el-header>
        <el-main v-loading="loading">
            <el-row>
                <div class="el-table el-table--fit el-table--border el-table--fluid-height el-table--enable-row-hover">
                    <div class="el-table__header-wrapper">
                        <table class="el-table__header" style="width: 1140px;" cellspacing="0" cellpadding="0" border="0">
                            <thead class="has-gutter">
                                <tr class="">
                                    <template v-for="(i,index) in listcount">
                                        <th colspan="1" rowspan="1">
                                            <div v-if="index==0" class="cell">订单号 →</div>
                                            <div v-else class="cell">第{{index}}次挪用订单 <span v-if="(index+1)<listcount">→</span></div>
                                        </th>
                                        <th colspan="1" rowspan="1">
                                            <div v-if="index==0" class="cell">条码号 →</div>
                                            <div v-else class="cell">第{{index}}次挪用条码 <span v-if="(index+1)<listcount">→</span></div>
                                        </th>
                                        <th colspan="1" rowspan="1" v-if="index>0">
                                            <div class="cell">第{{index}}次挪用工序 <span v-if="(index+1)<listcount">→</span></div>
                                        </th>
                                    </template>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="el-table__body-wrapper is-scrolling-none" style="width: 100%;overflow:auto; text-align: center; max-height: 600px;">
                        <table class="el-table__body" style="width: 1140px;" cellspacing="0" cellpadding="0" border="0">
                            <tbody>
                                <tr v-for="item in tableData" class="el-table__row">
                                    <template v-for="(i,index) in item">
                                        <td rowspan="1" colspan="1"><div class="cell" v-bind:class="orderRed(i.ordernum)">{{i.ordernum}}</div></td>
                                        <td rowspan="1" colspan="1"><div class="cell" v-bind:class="barcodeRed(i.barcode)">{{i.barcode}}</div></td>
                                        <td rowspan="1" colspan="1" v-if="index>0"><div class="cell">{{i.gongx}}</div></td>
                                    </template>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </el-row>
        </el-main>
    </el-container>
</div>
<script>
    var app = new Vue({
        el: "#app",
        data: {
            tableData: [],
            loading: false,
            listcount: 0
        },
        methods: {
            getData: () => {
                app.loading = true;
                axios.post("/BarCodes/BarcodeRelation", {
                    orderNum: $("#orderNum").val(),
                    barcode: $("#barcode").val(),
                }).then(response => {
                    //console.log(response.data)
                    app.tableData = response.data;
                    //获取最大长度
                    let lengthList = response.data.map(function (value, index, arr) {
                        return value.length;
                    });
                    app.listcount = Math.max.apply(null, lengthList);

                    app.loading = false;
                }).catch(error => {
                    console.warn("读取数据失败" + error)
                    app.loading = false;
                });
            },
            orderRed(order) {
                let orderVal = $("#orderNum").val();
                if (orderVal == order) {
                    return "red";
                } else {
                    return "";
                };
            },
            barcodeRed(barcode) {
                let barcodeVal = $("#barcode").val();
                if (barcodeVal == barcode) {
                    return "red";
                } else {
                    return "";
                };
            }
        }
    });
</script>

