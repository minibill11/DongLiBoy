@{
    ViewBag.Title = "锡膏入库";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<link href="~/Content/styleFile/solder/solderStyle.css?v=" +Math.random() rel="stylesheet" />
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Scripts/printJS/JsBarcode.all.min.js"></script>

<div id="app" v-cloak>
    <el-container>
        <el-header class="text-center">
            <div v-show="screenSize>=768">
                <h2 class="text-center">@ViewBag.Title</h2>
                <a href="/SMT_Sulderpaster/board"><el-button size="small">看板</el-button></a>
                <a href="/SMT_Sulderpaster/AddWareHouseBaseInfo"><el-button size="small">锡膏入库</el-button></a>
                <a href="/SMT_Sulderpaster/AddWarehouseFreezer"><el-button size="small">锡膏入冰柜</el-button></a>
                <a href="/SMT_Sulderpaster/AddSMTFreezer"><el-button size="small">入SMT冰柜</el-button></a>
                <a href="/SMT_Sulderpaster/Rewarming"><el-button size="small">回温</el-button></a>
                <a href="/SMT_Sulderpaster/Stir"><el-button size="small">搅拌</el-button></a>
                <a href="/SMT_Sulderpaster/Use"><el-button size="small">使用</el-button></a>
                <a href="/SMT_Sulderpaster/recovery"><el-button size="small">回收</el-button></a>
            </div>
            <div v-show="screenSize<768">
                <h3>@ViewBag.Title</h3>
                <el-dropdown placement="bottom">
                    <el-button size="medium ">
                        更多菜单<i class="el-icon-arrow-down el-icon--right"></i>
                    </el-button>
                    <el-dropdown-menu slot="dropdown">
                        <a href="/SMT_Sulderpaster/board"><el-dropdown-item>看板</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/AddWareHouseBaseInfo"><el-dropdown-item>锡膏入库</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/AddWarehouseFreezer"><el-dropdown-item>锡膏入冰柜</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/AddSMTFreezer"><el-dropdown-item>入SMT冰柜</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/Rewarming"><el-dropdown-item>回温</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/Stir"><el-dropdown-item>搅拌</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/Use"><el-dropdown-item>使用</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/recovery"><el-dropdown-item>回收</el-dropdown-item></a>
                    </el-dropdown-menu>
                </el-dropdown>
            </div>
        </el-header>
        <el-main v-loading="loading">
            <el-row>
                <div class="inputframe">
                    <span class="inputtext">锡膏型号：</span>
                    <el-input placeholder="请输入锡膏型号"
                              v-model.trim="solderpasteType"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">锡膏数量：</span>
                    <el-input placeholder="请输入锡膏数量"
                              v-model.trim="solderpasteNum"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">供应商：</span>
                    <el-input placeholder="请输入供应商"
                              v-model.trim="supplier"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">厂家：</span>
                    <el-input placeholder="请输入厂家"
                              v-model.trim="manufactor"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">出厂日期：</span>
                    <el-date-picker v-model="leaveFactoryTime"
                                    type="datetime"
                                    placeholder="选择出厂日期"
                                    size="medium">
                    </el-date-picker>
                </div>
                <div class="inputframe">
                    <span class="inputtext">出货日期：</span>
                    <el-date-picker v-model="shipmentTime"
                                    type="datetime"
                                    placeholder="选择出货日期"
                                    size="medium">
                    </el-date-picker>
                </div>
                <div class="inputframe">
                    <span class="inputtext">收料人姓名：</span>
                    <el-input placeholder="请输入收料人姓名"
                              v-model.trim="receivingClerk"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">批次：</span>
                    <el-input placeholder="请输入批次"
                              v-model.trim="batch"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">料号：</span>
                    <el-input placeholder="请输入料号"
                              v-model.trim="receivingNum"
                              size="medium"
                              clearable>
                    </el-input>
                    <el-button size="medium" @@click="postPrint">打印条码</el-button>
                    <el-button size="medium" @@click="previewBarcode">条码预览</el-button>
                </div>
                <div class="inputframe">
                    <div class="solderBarDiv">
                        <svg id="solderBarcode"></svg>
                    </div>
                </div>
            </el-row>
        </el-main>
    </el-container>
</div>

<script>
    var app = new Vue({
        el: "#app",
        data: {
            loading: false,
            screenSize: document.body.clientWidth,
            //入库
            solderpasteType: "",
            solderpasteNum: "",
            supplier: "",
            manufactor: "",
            leaveFactoryTime: "",
            shipmentTime: "",
            receivingClerk: "",
            batch: "",
            receivingNum: "",
        },
        created: function () {
            window.onresize = function () {
                app.screenSize = document.body.clientWidth;
            };
        },
        methods: {
            previewBarcode: function () {
                let printCode, nowDate = new Date(), sn = (Math.random() * 1000).toFixed(0);
                printCode = `${this.receivingNum}${nowDate.getFullYear()}${nowDate.getMonth() < 10 ? 0 : ""}${nowDate.getMonth() + 1}${nowDate.getDate()}${sn < 100 ? "0" + sn : sn}`;
                if (this.receivingNum != "") {
                    this.printBarcode(printCode);
                } else {
                    $(".solderBarDiv").html('<svg id="solderBarcode"></svg>');
                    this.$message({
                        showClose: true,
                        message: "料号为空，无法生成条码！",
                        type: 'warning'
                    });
                };
            },
            printBarcode: function (v) {
                JsBarcode("#solderBarcode", v.toUpperCase(), {
                    height: 60, //条形码的高度
                    //fontOptions: "bold",//使文字加粗体或变斜体
                    format: "CODE128",
                    font: "monospace",
                    textAlign: "center",
                    textMargin: 0,//设置条形码和文本之间的间距
                    fontSize: 26,//设置文本的大小
                    lineColor: "#000",//条形码颜色
                    margin: 0,//设置条形码周围的空白边距
                    marginTop: 0
                });
            },
            //验证条码，录入信息，打印条码，
            postPrint: function () {
                this.loading = true;
                let postList = [],
                    nooknum = 0,
                    errormes = "",
                    solderpasteType = this.solderpasteType,
                    solderpasteNum = this.solderpasteNum,
                    supplier = this.supplier,
                    manufactor = this.manufactor,
                    leaveFactoryTime = this.leaveFactoryTime,
                    shipmentTime = this.shipmentTime,
                    receivingClerk = this.receivingClerk,
                    batch = this.batch,
                    receivingNum = this.receivingNum;
                //验证不能为空
                if (solderpasteType == "") {
                    errormes = errormes + (nooknum + 1) + "、锡膏型号不能为空<br/>";
                    nooknum++;
                };
                if (solderpasteNum == "") {
                    errormes = errormes + (nooknum + 1) + "、锡膏数量不能为空<br/>";
                    nooknum++;
                };
                if (supplier == "") {
                    errormes = errormes + (nooknum + 1) + "、供应商不能为空<br/>";
                    nooknum++;
                };
                if (manufactor == "") {
                    errormes = errormes + (nooknum + 1) + "、厂家不能为空<br/>";
                    nooknum++;
                };
                if (leaveFactoryTime == "") {
                    errormes = errormes + (nooknum + 1) + "、出厂日期不能为空<br/>";
                    nooknum++;
                };
                if (shipmentTime == "") {
                    errormes = errormes + (nooknum + 1) + "、出货日期不能为空<br/>";
                    nooknum++;
                };
                if (receivingClerk == "") {
                    errormes = errormes + (nooknum + 1) + "、收料人姓名不能为空<br/>";
                    nooknum++;
                };
                if (batch == "") {
                    errormes = errormes + (nooknum + 1) + "、批次不能为空<br/>";
                    nooknum++;
                };
                if (receivingNum == "") {
                    errormes = errormes + (nooknum + 1) + "、料号不能为空<br/>";
                    nooknum++;
                };
                if (nooknum > 0) {
                    this.$alert(errormes, "标签不合格", {
                        confirmButtonText: '确定',
                        closeOnClickModal: true,
                        closeOnPressEscape: true,
                        dangerouslyUseHTMLString: true,
                        type: "error",
                    });
                    this.loading = false;
                } else {
                    //录入数据
                    postList = {
                        solderpasteType: solderpasteType,
                        solderpasteNum: solderpasteNum,
                        supplier: supplier,
                        manufactor: manufactor,
                        leaveFactoryTime: leaveFactoryTime,
                        ShipmenTime: shipmentTime,
                        receivingClerk: receivingClerk,
                        batch: batch,
                        receivingNum: receivingNum,
                    };
                    axios.post('/SMT_Sulderpaster/AddWarehouseBaseInfo',
                        { warehouse_BaseInfo: postList }
                    ).then(res => {
                        if (res.data == true) {
                            this.$alert('打印成功！', {
                                confirmButtonText: '确定',
                                closeOnClickModal: true,
                                closeOnPressEscape: true,
                                type: "success",
                                //callback: () => {
                                //    this.clear();
                                //}
                            });
                        } else {
                            this.$alert('打印失败！', {
                                confirmButtonText: '确定',
                                closeOnClickModal: true,
                                closeOnPressEscape: true,
                                type: "error",
                            });
                        };
                        this.loading = false;
                    }).catch(err => {
                        console.warn("post失败")
                        this.loading = false;
                    });
                };
            },
        }
    });
</script>