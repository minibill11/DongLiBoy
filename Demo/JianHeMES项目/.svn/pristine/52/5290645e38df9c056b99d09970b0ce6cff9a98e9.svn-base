@{
    ViewBag.Title = "仓库入库信息";
}

<link href="~/Content/styleFile/packaging/index.css" rel="stylesheet" />@*2.13版本 elementui css文件*@
<link rel="stylesheet/less" type="text/css" href="~/Content/styleFile/warehouseMaterial/warehouse.less" />

<div id="app" v-cloak>
    <el-container>
        <el-header class="text-center">
            @*菜单*@
            <module-menu-component name="MaterialBasicInfo" title="@ViewBag.Title" :limit="limitsRole"></module-menu-component>
        </el-header>
        <el-main v-loading="loading">
            <el-row class="main">
                <el-col :span="12" :xs="24">
                    <div class="flex-item">
                        <label>班组</label>
                        <div>
                            <el-select v-model="Group"
                                       placeholder="请选择班组"
                                       @*:disabled="disabledState"*@
                                       size="medium">
                                <el-option v-for="item in groupOptions"
                                           :key="item"
                                           :label="item"
                                           :value="item">
                                </el-option>
                            </el-select>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>物料编号</label>
                        <div>
                            <el-input placeholder="请输入物料编号"
                                      v-model.trim="Material.MaterialNumber"
                                      size="medium"
                                      autofocus
                                      clearable>
                            </el-input>
                        </div>
                    </div>

                    <div class="flex-item">
                        <label>物料类型</label>
                        <div>
                            <el-input placeholder="请输入物料类型"
                                      v-model.trim="Material.MaterialType"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>单位</label>
                        <div>
                            <el-input placeholder="请输入单位"
                                      v-model.trim="Material.Unit"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>供应商</label>
                        <div>
                            <el-input placeholder="请输入供应商"
                                      v-model.trim="Material.Supplier"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>生产日期</label>
                        <div>
                            <el-date-picker v-model="Material.LeaveFactoryTime"
                                            @@change="changeLeaveFactoryTime"
                                            type="date"
                                            placeholder="选择生产日期"
                                            size="medium">
                            </el-date-picker>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>来料数量</label>
                        <div>
                            <el-input-number v-model.trim="Material.MaterialNum"
                                             size="small"
                                             :min="0"
                                             style="width:auto"
                                             clearable>
                            </el-input-number>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>来料日期</label>
                        <div>
                            <el-date-picker v-model="Material.InvoiceDate"
                                            type="date"
                                            placeholder="选择来料日期"
                                            size="medium">
                            </el-date-picker>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>收料人姓名</label>
                        <div>
                            <el-input placeholder="请输入收料人姓名"
                                      v-model.trim="Material.ReceivingClerk"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>批次</label>
                        <div>
                            <el-input placeholder="请输入批次"
                                      v-model.trim="Material.Batch"
                                      size="medium"
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>物料规格描述</label>
                        <div>
                            <el-input placeholder="请输入物料规格描述"
                                      v-model.trim="Material.MaterialDiscription"
                                      type="textarea"
                                      autofocus
                                      clearable>
                            </el-input>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>有效期(天)</label>
                        <div>
                            <el-input-number v-model.trim="Material.EffectiveDay"
                                             size="small"
                                             :min="0"
                                             style="width:auto"
                                             clearable>
                            </el-input-number>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>追加有效期(天)</label>
                        <div>
                            <el-input-number v-model.trim="Material.AddEffectiveDay"
                                             size="small"
                                             :min="0"
                                             style="width:auto"
                                             clearable>
                            </el-input-number>
                        </div>
                    </div>
                    <div class="flex-item">
                        <label>物料条码所包含物料个数</label>
                        <div>
                            <el-input-number v-model.trim="materialContainNum"
                                             size="small"
                                             :min="0"
                                             style="width:auto"
                                             clearable>
                            </el-input-number>
                        </div>
                    </div>
                    <div class="flex-item">
                        <div>
                            <el-button v-on:click="clear" type="primary" size="small">重置</el-button>
                            <el-button v-on:click="postPrint" type="primary" size="small">确认</el-button>
                        </div>
                    </div>
                </el-col>
                <el-col :span="12" :xs="24" class="rightFrame">
                    <ware-print-component v-model="printData">
                        <print-component v-model="printInfo"></print-component>
                    </ware-print-component>
                </el-col>
            </el-row>
        </el-main>
    </el-container>
</div>
@*  引入组件  *@
@RenderPage("_warehouseMenu.cshtml")
@RenderPage("~/Views/ModuleManagement/_print.cshtml")
@RenderPage("_warePrint.cshtml")
<script src="~/Scripts/printJS/JsBarcode.all.min.js"></script>
<script src="~/Content/styleFile/packaging/index.js"></script>@*2.13版本 elementui js文件*@
<script src="~/Content/styleFile/less.min.js"></script>
<script src="~/Content/styleFile/warehouseMaterial/warehouse.js"></script>
<script>
    //通过mixins将代码注入vue实例
    var app = new Vue({
        el: "#app",
        mixins: [mixin],
        data: {
            //入库
            Material: {
                MaterialNumber: "",
                MaterialDiscription: "",
                Batch: "",
                MaterialNum: 0,
                Unit: "",
                Department: "",
                Group: "",
                ReceivingClerk: "",
                InvoiceDate: "",
                LeaveFactoryTime: "",
                Supplier: "",
                MaterialType: "",
                EffectiveDay: 180,
                AddEffectiveDay: 0,
            },
            materialContainNum: 0,
            printData: {
                list: [],
                discription: ''
            }
        },
        mounted: function () {
        },
        methods: {
            //验证条码，录入信息，打印条码，
            postPrint() {
                this.loading = true;
                this.Material.Group = this.Group;
                this.Material.Department = this.Department;
                //录入数据
                axios.post('/Warehouse_Material/MaterialBasicInfo', {
                    materialBasicInfo_Collection: this.Material,
                    materialContainNum: this.materialContainNum
                }).then(res => {
                    if (res.data.Res) {
                        console.log(res.data.BarcodeList);
                        console.log(res.data.MaterialDiscription);
                        this.printData = {
                            list: res.data.BarcodeList,
                            discription: res.data.MaterialDiscription
                        };
                        this.message.success("录入成功");
                        this.clear();
                        this.loading = false;
                    } else {
                        this.$alert(res.data.Meg, {
                            closeOnClickModal: true,
                            closeOnPressEscape: true,
                            type: "error",
                        });
                        this.loading = false;
                    };
                }).catch(err => {
                    console.warn("post失败")
                    this.loading = false;
                });
            },
            //清空
            clear() {
                this.Material = {
                    MaterialNumber: "",
                    MaterialDiscription: "",
                    Batch: "",
                    MaterialNum: 0,
                    Unit: "",
                    Department: this.Department,
                    Group: this.Group,
                    ReceivingClerk: "",
                    InvoiceDate: "",
                    LeaveFactoryTime: "",
                    Supplier: "",
                    MaterialType: "",
                    EffectiveDay: 180,
                    AddEffectiveDay: 0,
                };
                this.materialContainNum = 0;
            },
            changeLeaveFactoryTime(v) {
                if (v) {
                    let y = v.getFullYear().toString(),
                        m = (v.getMonth() + 1).toString().padStart(2, "0"),
                        d = v.getDate().toString().padStart(2, "0");
                    this.Material.Batch = `${y.substr(y.length - 2)}${m}${d}`;
                } else {
                    this.Material.Batch = '';
                };
            }
        },
    });
</script>