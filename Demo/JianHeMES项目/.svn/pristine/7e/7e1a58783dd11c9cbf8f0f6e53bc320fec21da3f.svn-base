@model JianHeMES.Models.OrderMgm
@{
    ViewBag.Title = "创建订单";
}
<style>
    .table {
        table-layout: fixed;
    }

        .table span {
            color: rgb(51, 122, 183);
        }

    .panel-title {
    }

    .table select, .table input {
        width: 60px;
    }

    .s56789m {
        height: 21px;
        padding: 1px;
        text-align: center;
    }

    .isempty {
        border: 1px solid red;
    }

    input[type="date"].form-control {
        line-height: 1.42857143;
    }
</style>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div id="app" class="form-horizontal">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="col-md-4">
            <div class="form-group">
                <div class="col-md-5">
                    <h3>@ViewBag.Title</h3>
                    <a href="/BarCodes/SetJsonFile">录入模组编号</a>
                </div>
                <div class="col-md-7" style="padding-top:10px;color:green;">
                    <span>Excel内容粘贴在此处</span>
                    <textarea v-model="pasteExcel" class="form-control" style="width:130px;height:35px;resize: none;"></textarea>
                </div>
            </div>
            <hr />
            <div class="form-group">
                <label class="control-label col-md-4">班组</label>
                <div class="col-md-8">
                    <group-select></group-select>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model.OrderNum, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    <input data-val="true" data-val-required="订单号 字段是必需的。" id="OrderNum" name="OrderNum" v-model="autoOrdernum" onkeyup="this.value=this.value.toUpperCase()" class="form-control text-box single-line input-validation-error" aria-describedby="OrderNum-error" aria-invalid="true" type="text">
                    @Html.ValidationMessageFor(model => model.OrderNum, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                <label for="BarCode_Prefix" class="control-label col-md-4">条码前缀</label>
                <div class="col-md-8">
                    <input data-val="true" data-val-required="条码前缀 字段是必需的。" v-model="trueOrderNum" id="BarCode_Prefix" name="BarCode_Prefix" readonly="readonly" class="form-control text-box single-line valid" type="text">
                    <span data-valmsg-for="BarCode_Prefix" data-valmsg-replace="true" class="field-validation-valid text-danger"></span>
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.CustomerName, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.CustomerName, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.CustomerName, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.ContractDate, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.ContractDate, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.ContractDate, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.DeliveryDate, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.DeliveryDate, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.DeliveryDate, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.PlanInputTime, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.PlanInputTime, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.PlanInputTime, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.PlanCompleteTime, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.PlanCompleteTime, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.PlanCompleteTime, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.PlatformType, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.PlatformType, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.PlatformType, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.Area, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Area, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Area, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.ProcessingRequire, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @*@Html.EditorFor(model => model.ProcessingRequire, new { htmlAttributes = new { @class = "form-control" } })*@
                    <input type="radio" name="ProcessingRequire" value="有铅" /><label class="control-label">有铅</label>&nbsp;&nbsp;
                    <input type="radio" name="ProcessingRequire" value="无铅" /><label class="control-label">无铅</label>
                    @*<select class="form-control" name="ProcessingRequire">
                            <option value="">请选择</option>
                            <option value="有铅，灯面">有铅，灯面</option>
                            <option value="有铅，IC面">有铅，IC面</option>
                            <option value="无铅，灯面">无铅，灯面</option>
                            <option value="无铅，IC面">无铅，IC面</option>
                        </select>*@
                    @Html.ValidationMessageFor(model => model.ProcessingRequire, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.StandardRequire, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @*@Html.EditorFor(model => model.StandardRequire, new { htmlAttributes = new { @class = "form-control" } })*@
                    <input type="radio" name="StandardRequire" value="商用" /><label class="control-label">商用</label>
                    <input type="radio" name="StandardRequire" value="军用" /><label class="control-label">军用</label>&nbsp;&nbsp;
                    @Html.ValidationMessageFor(model => model.StandardRequire, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.CapacityQ, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.CapacityQ, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.CapacityQ, "", new { @class = "text-danger" })
                </div>
            </div>
            @*<div class="form-group">
                    @Html.LabelFor(model => model.AssembleDepartment, htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-8">
                        @Html.DropDownList("AssembleDepartment", (List<SelectListItem>)ViewBag.AssembleDepartmentList, "请选择", new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.AssembleDepartment, "", new { @class = "text-danger" })
                    </div>
                </div>*@
            @*<div class="form-group">
                    @Html.LabelFor(model => model.HandSampleScedule, htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.HandSampleScedule, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.HandSampleScedule, "", new { @class = "text-danger" })
                    </div>
                </div>*@

            <div class="form-group">
                @Html.LabelFor(model => model.Boxes, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Boxes, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Boxes, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.Models, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Models, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Models, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.ModelsMore, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.ModelsMore, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.ModelsMore, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.Powers, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Powers, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Powers, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.PowersMore, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.PowersMore, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.PowersMore, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.AdapterCard, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.AdapterCard, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.AdapterCard, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.AdapterCardMore, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.AdapterCardMore, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.AdapterCardMore, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model.IsRepertory, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.IsRepertory, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.IsRepertory, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model.Remark, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.Remark, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Remark, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model.BarCodeCreated, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.BarCodeCreated, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                    @Html.ValidationMessageFor(model => model.BarCodeCreated, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.BarCodeCreateDate, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.BarCodeCreateDate, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                    @Html.ValidationMessageFor(model => model.BarCodeCreateDate, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.BarCodeCreator, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.BarCodeCreator, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                    @Html.ValidationMessageFor(model => model.BarCodeCreator, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.CompletedRate, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.EditorFor(model => model.CompletedRate, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                    @Html.ValidationMessageFor(model => model.CompletedRate, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-offset-4 col-md-8">
                    <input type="submit" value="创建" class="btn btn-default" />
                </div>
            </div>
            <div>
                @Html.ActionLink("返回", "Index")
            </div>
        </div>

        <div class="col-md-offset-1 col-md-7">
            <br />
            <br />
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h5 class="panel-title" style="text-align:center;">创建条码前缀</h5>
                </div>
                <div class="panel-body">
                    <table class="table">
                        <tr>
                            <td></td>
                            <td>一二码：</td>
                            <td>三码：</td>
                            <td>四码：</td>
                            <td>五六七码：</td>
                            <td>八九码：</td>
                        </tr>
                        <tr>
                            <td>条码选项：</td>
                            <td>
                                <select v-model="s12m" v-bind:class="(s12m=='')?'isempty':''">
                                    @*16P6-1025-1*@
                                    <option></option>
                                    <option>15</option>
                                    <option>16</option>
                                    <option>17</option>
                                    <option>18</option>
                                    <option>19</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>23</option>
                                    <option>24</option>
                                    <option>25</option>
                                </select>
                            </td>
                            <td>
                                <select v-model="s3m" v-bind:class="(s3m=='')?'isempty':''">
                                    <option></option>
                                    <option>A</option>
                                    <option>B</option>
                                    <option>C</option>
                                    <option>D</option>
                                    <option>E</option>
                                </select>
                            </td>
                            <td>
                                <select v-model="s4m" v-bind:class="(s4m=='')?'isempty':''">
                                    <option></option>
                                    <option>A</option>
                                    <option>B</option>
                                    <option>C</option>
                                    <option>D</option>
                                    <option>E</option>
                                    <option>F</option>
                                    <option>J</option>
                                    <option>K</option>
                                    <option>G</option>
                                </select>
                            </td>
                            <td><input v-model="s567m" v-bind:class="(s567m=='')?'isempty':''" class="s56789m" type="text" maxlength="3" onkeyup="value=value.replace(/[^\d]/g,'')" /></td>
                            <td><input v-model="s89m" v-bind:class="(s89m=='')?'isempty':''" class="s56789m" type="text" maxlength="2" onkeyup="value=value.replace(/[^\d]/g,'')" /></td>
                        </tr>
                        <tr><th colspan="6" style="font-size:18px; text-align:center;padding:20px">编码说明-共十五码(XX X X XXX XX X XXXXX)</th></tr>
                        <tr>
                            <th style="text-align:right">一二码：</th>
                            <td colspan="5">
                                数字码，表示订单年份字母码，A表示正常订单、B表示补单；
                                <span> 例如： 17-17年</span>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align:right">三码：</th>
                            <td colspan="5">
                                字母码，A表示正常订单、B表示补单、表示二次补单D表示三次补单、E表示其他订单；
                                <span> 例如：A-正常订单，B-P1，C-P2，D-P3，E-其它订单</span>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align:right">四码：</th>
                            <td colspan="5">
                                字母码，表示订单区域；
                                <span> 例如：A-GA系列订单，B-GY系列订单，C-LA系列订单，D-LY系列订单，E-YA系列订单，F-YY系列订单，J-借样订单，K-库存订单，G-其它订单</span>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align:right">五六七码：</th>
                            <td colspan="5">
                                数字码：表示订单号；
                                <span> 例如：001-001</span>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align:right">八九码：</th>
                            <td colspan="5">
                                数字码，表示订单批次；
                                <span> 例如：01— -1的工单，02— -2的工单，03— -3的工单，04— -4的工单，05— -5的工单</span>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align:right">十码：</th>
                            <td colspan="5">
                                字母码，由系统生成，表示预留码，用A表示，后续有需求时再定义；
                                <span> 例如：A表示模组</span>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align:right">十一到十五：</th>
                            <td colspan="5">
                                数字码，由系统生成，表示流水号；
                                <span> 例如:00001-流水号1，00002-流水号2，00003-流水号3，00004-流水号4</span>
                            </td>
                        </tr>
                        <tr style="font-size:16px;">
                            <th colspan="2">例如:18AA13201A0001</th>
                            <th colspan="4" class="text-danger">表示：2018-GA132-1订单编号0001模组</th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        @*//防位移*@
        <div class="form-group"><div class="col-md-offset-2 col-md-8"></div></div>
    </div>
}

@*  引入组件：
    1/_groupSelect，下拉选择框组件
*@
@RenderPage("~/Views/Users/_groupSelect.cshtml")
@section Scripts {
    @*@Scripts.Render("~/bundles/jqueryval")*@
    <script type="text/javascript">
        var app = new Vue({
            el: '#app',
            data: {
                s12m: "",
                s3m: "",
                s4m: "",
                s567m: "",
                s89m: "",
                ordernum: "",
                trueOrderNum: "",
                autoOrdernum: "",
                pasteExcel: "",
            },
            watch: {
                ordernum: function (val) {
                    if (val.length == 9) {
                        this.trueOrderNum = val;
                    } else {
                        this.trueOrderNum = "";
                    };
                },
                autoOrdernum: function (val) {
                    let rtdVal = this.CtoH(val);
                    //console.log(val);
                    //console.log("--------------分割--------------");
                    //console.log(rtdVal);
                    this.autoOrdernum = rtdVal;
                    var cutVal = rtdVal.split("-");
                    //第一部分
                    this.s12m = (cutVal[0][2] + cutVal[0][3]);
                    //第二部分
                    if (cutVal.length > 1 && cutVal[1] != "") {
                        var s4m = cutVal[1].match(/[a-zA-Z]+/g)[0].toUpperCase();
                        switch (s4m) {
                            case "GA": s4m = "A"; break;
                            case "GY": s4m = "B"; break;
                            case "LA": s4m = "C"; break;
                            case "LY": s4m = "D"; break;
                            case "YA": s4m = "E"; break;
                            case "YY": s4m = "F"; break;
                            case "J": s4m = "J"; break;
                            case "K": s4m = "K"; break;
                            case "G": s4m = "G"; break;
                            default: s4m = "";
                        };
                        this.s4m = s4m;
                        if (isNaN(parseInt(cutVal[1].match(/\d{3}/g))) == false) {
                            this.s567m = cutVal[1].match(/\d{3}/g);
                        } else {
                            this.s567m = "";
                        };
                    };
                    //第三部分
                    if (cutVal.length > 2) {
                        if (cutVal[2].length == 1) {
                            this.s89m = ("0" + cutVal[2]);
                        } else if (cutVal[2].length == 2) {
                            this.s89m = (cutVal[2]);
                        } else {
                            this.s89m = "";
                        };
                    };
                },
                s12m: function (val) {
                    this.s12m = val;
                },
                s4m: function (val) {
                    if (val == "K") {
                        $("#IsRepertory").prop('checked', true);
                    } else {
                        $("#IsRepertory").prop('checked', false);
                    };
                },
                s567m: function (val) {
                    if (val[0] == val[0].replace(/[^\d]/g, '')) {
                        app.ordernum = app.s12m + app.s3m + app.s4m + app.s567m + app.s89m;
                    } else {
                        app.s567m = "";
                    };
                },
                s89m: function (val) {
                    if (val == val.replace(/[^\d]/g, '')) {
                        app.ordernum = app.s12m + app.s3m + app.s4m + app.s567m + app.s89m;
                    } else {
                        app.s89m = "";
                    };
                },
                pasteExcel: function (val) {
                    if (val == "") {
                        return false;
                    };
                    let pasteQuantity = val.split("\t");
                    //console.log(pasteQuantity);
                    app.autoOrdernum = pasteQuantity[5];//订单号
                    $("#CustomerName").val(pasteQuantity[6]);//客户名称
                    $("#ContractDate").val(addzero(pasteQuantity[1]));//下单日期
                    $("#DeliveryDate").val(addzero(pasteQuantity[2]));//合同交期  出货日期
                    $("#PlanCompleteTime").val(addzero(pasteQuantity[2]));//计划完成时间
                    $("#PlanInputTime").val(addzero(new Date().toLocaleDateString('zh')));//计划投入时间
                    $("#PlatformType").val(pasteQuantity[8]);//平台
                    $("#Boxes").val(pasteQuantity[10]);//模组
                    $("#Models").val(pasteQuantity[11]);//模块
                    app.pasteExcel = "";
                },
            },
            mounted: function () {
                $("#ModelsMore").val(0);
                $("#PowersMore").val(0);
                $("#AdapterCardMore").val(0);
            },
            methods: {
                //全角转换为半角函数,去掉Unicode编码为8206的字符
                CtoH: function (str) {
                    var tmp = "";
                    for (var i = 0; i < str.length; i++) {
                        if (str.charCodeAt(i) == 12288) {
                            tmp += String.fromCharCode(str.charCodeAt(i) - 12256);
                            continue;
                        };
                        if (str.charCodeAt(i) == 8206) {
                            continue;
                        };
                        if (str.charCodeAt(i) > 65280 && str.charCodeAt(i) < 65375) {
                            tmp += String.fromCharCode(str.charCodeAt(i) - 65248);
                        } else {
                            tmp += String.fromCharCode(str.charCodeAt(i));
                        };
                    }
                    return tmp;
                },
            }
        });

        $("select").change(function () {
            app.ordernum = app.s12m + app.s3m + app.s4m + app.s567m + app.s89m;
        });
        $('#IsRepertory').css('cursor', "not-allowed").bind('click', function () {
            return false;
        });
        //日期 月/日 补零
        function addzero(date) {
            let cutDate = date.split("-").length == 3 ? date.split("-") : date.split("/");
            return (cutDate[0] + "-" + (cutDate[1] < 10 ? '0' + cutDate[1] : cutDate[1]) + "-" + (cutDate[2] < 10 ? '0' + cutDate[2] : cutDate[2]));
        };
    </script>
}