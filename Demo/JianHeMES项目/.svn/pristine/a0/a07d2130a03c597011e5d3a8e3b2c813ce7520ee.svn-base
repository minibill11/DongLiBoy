
@{
    ViewBag.Title = "Create";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Scripts/axios.min.js"></script>
<link href="~/Content/tableStyle/index.css" rel="stylesheet" />
<style>
    #app {
        width: 100%;
        margin: 0 auto;
    }

    .container {
        width: 83.8%;
    }

    .el-button {
        padding: 4px !important;
    }

    .red {
        color: red;
        font-size: 16px;
    }

    h2 {
        text-align: center;
    }

    .color2 {
        color: red;
        font-size: 16px;
    }

    .has-gutter tr th .cell, .el-table__row td .cell {
        text-align: center;
    }

    .el-table .cell {
        padding: 0 !important;
    }

    .el-table__header tr,
    .el-table__header th {
        font-size: 12px;
        padding: 0;
        height: 30px;
    }

    .el-table__body tr,
    .el-table__body td {
        font-size: 12px;
        padding: 0;
        height: 30px;
    }

    textarea {
        height: 30px;
        width: 15%;
    }

    .inputtext {
        margin-top: 25px;
        display: inline-flex;
        width: 100%;
    }
    .bottomInfo {
        display: flex;
        justify-content: space-between;
    }

    .pone {
        align-self: flex-end;
        font-size: 14px;
    }
</style>
<h2>批量添加员工</h2>

<div class="container" id="app">
    <div class="inputtext">
        <textarea v-model="inputInfo" placeholder="表格粘贴处..."></textarea>
    </div>
    <el-table v-bind:data="tableData" style="width: 100%" max-height="690" border stripe>
        <el-table-column prop="jobNum" label="工号" width="62">
        </el-table-column>
        <el-table-column prop="Name" label="中文名" width="63">
        </el-table-column>
        <el-table-column prop="Department_leaving" label="部门名称" width="68">
        </el-table-column>
        <el-table-column prop="Position" label="职位名称" width="68">
        </el-table-column>
        <el-table-column prop="levelType" label="族群" width="52">
        </el-table-column>
        <el-table-column prop="Resign" label="离退类型" width="52">
        </el-table-column>
        <el-table-column prop="HireDate" label="入职日期" width="78">
        </el-table-column>
        <el-table-column prop="LastDate" label="离职日期" width="78">
        </el-table-column>
        <el-table-column prop="Remark" label="备注" width="158">
        </el-table-column>
        <el-table-column prop="Department_of_conclusion" label="部门结论" width="63">
        </el-table-column>
        <el-table-column prop="HR_conclusion" label="人力资源部结论" width="65">
        </el-table-column>
        <el-table-column prop="HealthyBody" label="身体健康" width="55">
        </el-table-column>
        <el-table-column prop="Family_Reasons" label="家庭原因" width="55">
        </el-table-column>
        <el-table-column prop="Better_development" label="更好的发展" width="55">
        </el-table-column>
        <el-table-column prop="Pay_dissatisfaction" label="薪酬福利不满意" width="60">
        </el-table-column>
        <el-table-column prop="NotSystem" label="制度不满意" width="55">
        </el-table-column>
        <el-table-column prop="Notmanagement" label="管理不满意" width="55">
        </el-table-column>
        <el-table-column prop="NotWork_Itself" label="工作本身不满意" width="60">
        </el-table-column>
        <el-table-column prop="Jobenvironment" label="工作环境不满意" width="60">
        </el-table-column>
        <el-table-column prop="NotCultural_Atmosphere" label="文化气氛不满意" width="60">
        </el-table-column>
        <el-table-column prop="NotProbation_Period" label="试用期不合格" width="55">
        </el-table-column>
        <el-table-column prop="Negotiate_Remove" label="协商解除" width="55">
        </el-table-column>
        <el-table-column prop="Other_Reasons" label="其他" width="55">
        </el-table-column>
        <el-table-column label="操作" width="60">
            <template slot-scope="scope">
                <el-button v-on:click.native.prevent="deleteRow(scope.$index)" size="small">
                    <spoan v-bind:class="scope.row.color==true?'red':''">移除</spoan>
                </el-button>
            </template>
        </el-table-column>
    </el-table>

    <div class="bottomInfo" v-if="flag">
        <p class="pone">本次共提交<span style="color:red;font-size:18px;">{{count}}</span>条数据！<span v-if="flags">存在重复数据，请移除！</span></p>
        <p>
            <el-button v-on:click="postData" type="primary" size="mini">上传<i class="el-icon-upload el-icon--right"></i></el-button>
            <el-button v-on:click="clearAll" type="primary" size="mini">清空<i class="el-icon-delete el-icon--right"></i></el-button>
        </p>
    </div>

</div>

<script>

    var vm = new Vue({
        el: "#app",
        data: {
            inputInfo: '',
            tableData: [],
            count: 0,
            flags: false,
            flag: false
        },
        methods: {
            deleteRow(index, rows) {
                $(rows).removeClass("color2");
                this.tableData.splice(index, 1);
                this.count--;
            },
            postData() {
                if (this.tableData.length > 0) {
                    var finalPost = this.tableData
                    finalPost.forEach(item => {
                        let str = "";
                        if (item.Resign == "辞职") {
                            str = '1'
                        } else if (item.Resign == "自离") {
                            str = '2'
                        } else if (item.Resign == "辞退") {
                            str = '3'
                        } else if (item.Resign == "退休") {
                            str = '4'
                        }
                        item.Resign = str;//离职类型
                        item.HealthyBody = item.HealthyBody == '' ? '0' : item.HealthyBody;//身体健康
                        item.Family_Reasons = item.Family_Reasons == '' ? '0' : item.Family_Reasons;//家庭原因
                        item.Better_development = item.Better_development == '' ? '0' : item.Better_development//更好的发展
                        item.Pay_dissatisfaction = item.Pay_dissatisfaction == '' ? '0' : item.Pay_dissatisfaction//薪酬福利不满意
                        item.NotSystem = item.NotSystem == '' ? '0' : item.NotSystem//制度不满意
                        item.Notmanagement = item.Notmanagement == '' ? '0' : item.Notmanagement//管理不满意
                        item.Jobenvironment = item.Jobenvironment == '' ? '0' : item.Jobenvironment//工作环境不满意
                        item.NotWork_Itself = item.NotWork_Itself == '' ? '0' : item.NotWork_Itself;//工作本身不满意
                        item.NotCultural_Atmosphere = item.NotCultural_Atmosphere == '' ? '0' : item.NotCultural_Atmosphere;//文化气氛不满意
                        item.NotProbation_Period = item.NotProbation_Period == '' ? '0' : item.NotProbation_Period;//试用期不合格
                        item.Negotiate_Remove = item.Negotiate_Remove == '' ? '0' : item.Negotiate_Remove;//协商解除
                        item.Other_Reasons = item.Other_Reasons == '' ? '0' : item.Other_Reasons;//其他
                    })
                    console.log(finalPost)
                    axios.post("/Personnel_Reasons_for_leaving/Batch_leave", { inputList: finalPost }).then(res => {
                        if (res.data == true) {
                            this.flags = false;
                            this.$message({
                                message: '上传成功',
                                type: 'success'
                            });
                            this.inputInfo = '';
                            this.tableData = [];
                        } else if (res.data == false) {
                            this.flags = false;
                            this.$message({
                                message: '上传失败!',
                                type: 'warning'
                            });
                        } else {
                            this.flags = true;
                            let arrs = res.data.split(',');
                            let addtable = this.tableData;
                            arrs.pop();
                            for (let i = 0; i < addtable.length; i++) {
                                if (addtable[i].jobNum == arrs[i]) {
                                    addtable[i].color = true
                                }
                            }
                            addtable.reverse()
                            this.tableData = addtable;
                            console.log(this.tableData)
                        }
                    }).catch(err => {

                    })
                }
            },
            clearAll() {
                this.inputInfo = '';
            }
        },
        watch: {
            inputInfo(val) {
                if (this.inputInfo == '') { this.flag = false } else { this.flag = true };
                var valOfPaste = val.split("\n");
                valOfPaste.pop();
                var initDatas = []
                valOfPaste.forEach((item, i) => {
                    var items = item.split("\t");
                    initDatas.push(items)
                })
                var datas = [];
                for (let i = 0; i < initDatas.length; i++) {
                    var jobNum = initDatas[i][0]  //工号
                    var Name = initDatas[i][1]  //姓名
                    var Department_leaving = initDatas[i][2]  //部门名称
                    var Position = initDatas[i][3]  //职位名称
                    var levelType = initDatas[i][4]  //族群                   
                    var Resign = initDatas[i][5]//离职类型
                    var HireDate = initDatas[i][6]  //入职日期
                    var LastDate = initDatas[i][7]  //离职日期
                    var Remark = initDatas[i][8]  //备注
                    var Department_of_conclusion = initDatas[i][9]  //部门结论
                    var HR_conclusion = initDatas[i][10]  //人力资源部结论
                    var HealthyBody = initDatas[i][11]  //身体健康
                    var Family_Reasons = initDatas[i][12] //家庭原因
                    var Better_development = initDatas[i][13]  //更好的发展
                    var Pay_dissatisfaction = initDatas[i][14]  //薪酬不满意
                    var NotSystem = initDatas[i][15]  //制度不满意
                    var Notmanagement = initDatas[i][16]  //管理不满意
                    var NotWork_Itself = initDatas[i][17]  //工作本身不满意
                    var Jobenvironment = initDatas[i][18]  //工作环境不满意
                    var NotCultural_Atmosphere = initDatas[i][19]//文化气氛不满意
                    var NotProbation_Period = initDatas[i][20]  //试用期不合格
                    var Negotiate_Remove = initDatas[i][21]  //协商解除
                    var Other_Reasons = initDatas[i][22]  //其他
                   // console.log(initDatas)
                    var data = {
                        jobNum, Name, Department_leaving, Position, levelType,
                        Resign, HireDate, LastDate, Remark, Department_of_conclusion,
                        HR_conclusion, HealthyBody, Family_Reasons, Better_development,
                        Pay_dissatisfaction, NotSystem, Notmanagement, NotWork_Itself,
                        NotCultural_Atmosphere, Jobenvironment, NotProbation_Period, Negotiate_Remove, Other_Reasons,
                    }
                    datas.push(data)
                }              
                this.tableData = datas
                this.count = this.tableData.length;
                console.log(this.tableData )
            },
            count() {
                if (this.count == 0) {
                    this.flag = false;
                    this.inputInfo = '';
                }
            }
        }
    })
</script>
