@model IEnumerable<JianHeMES.Models.FinalQC>

@{
    ViewBag.Title = "FQC信息查询";
}
@Scripts.Render("~/Scripts/highcharts")
<link href="~/Scripts/Bootstraps/bootstrap-select.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/bootstrap-select.js"></script>

<style type="text/css">
     /*LOADING-begin*/
    .spinner2 {
        width: 40px;
        height: 40px;
        position: absolute;
        top: 45%;
        left: 50%;
        display: none;
    }

    .container1 > div, .container2 > div, .container3 > div {
        width: 12px;
        height: 12px;
        background-color: #333;
        border-radius: 100%;
        position: absolute;
        -webkit-animation: bouncedelay 1.2s infinite ease-in-out;
        animation: bouncedelay 1.2s infinite ease-in-out;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
    }

    .spinner2 .spinner-container {
        position: absolute;
        width: 100%;
        height: 100%;
    }

    .container2 {
        -webkit-transform: rotateZ(45deg);
        transform: rotateZ(45deg);
    }

    .container3 {
        -webkit-transform: rotateZ(90deg);
        transform: rotateZ(90deg);
    }

    .circle1 {
        top: 0;
        left: 0;
    }

    .circle2 {
        top: 0;
        right: 0;
    }

    .circle3 {
        right: 0;
        bottom: 0;
    }

    .circle4 {
        left: 0;
        bottom: 0;
    }

    .container2 .circle1 {
        -webkit-animation-delay: -1.1s;
        animation-delay: -1.1s;
    }

    .container3 .circle1 {
        -webkit-animation-delay: -1.0s;
        animation-delay: -1.0s;
    }

    .container1 .circle2 {
        -webkit-animation-delay: -0.9s;
        animation-delay: -0.9s;
    }

    .container2 .circle2 {
        -webkit-animation-delay: -0.8s;
        animation-delay: -0.8s;
    }

    .container3 .circle2 {
        -webkit-animation-delay: -0.7s;
        animation-delay: -0.7s;
    }

    .container1 .circle3 {
        -webkit-animation-delay: -0.6s;
        animation-delay: -0.6s;
    }

    .container2 .circle3 {
        -webkit-animation-delay: -0.5s;
        animation-delay: -0.5s;
    }

    .container3 .circle3 {
        -webkit-animation-delay: -0.4s;
        animation-delay: -0.4s;
    }

    .container1 .circle4 {
        -webkit-animation-delay: -0.3s;
        animation-delay: -0.3s;
    }

    .container2 .circle4 {
        -webkit-animation-delay: -0.2s;
        animation-delay: -0.2s;
    }

    .container3 .circle4 {
        -webkit-animation-delay: -0.1s;
        animation-delay: -0.1s;
    }

    @@-webkit-keyframes bouncedelay {
        0%, 80%, 100% {
            -webkit-transform: scale(0.0);
        }

        40% {
            -webkit-transform: scale(1.0);
        }
    }

    @@keyframes bouncedelay {
        0%, 80%, 100% {
            transform: scale(0.0);
            -webkit-transform: scale(0.0);
        }

        40% {
            transform: scale(1.0);
            -webkit-transform: scale(1.0);
        }
    }
    /*LOADING--end*/
    /*手型指针*/
    .progress {
        cursor: pointer;
        margin-bottom: 0px;
    }

    td {
        width: auto;
        display: inline-block;
        border-top: none;
    }

    .table > tbody > tr > td {
        border: none;
    }

    .table > tbody > tr {
        border-bottom: 1px solid #808080;
    }

    td:nth-child(1) {
        width: 105px;
        text-align: center;
    }

    td:nth-child(2) {
        width: 139px;
        text-align: center;
    }

    td:nth-child(3) {
        width: 120px;
        text-align: center;
    }

    td:nth-child(4) {
        width: 80px;
        text-align: center;
    }

    td:nth-child(5) {
        width: 120px;
        text-align: center;
    }

    td:nth-child(6) {
        width: 135px;
        text-align: center;
    }

    td:nth-child(7) {
        width: 85px;
        text-align: center;
    }

    td:nth-child(8) {
        width: 40px;
        text-align: center;
    }

    td:nth-child(9) {
        width: 90px;
        text-align: center;
    }

    td:nth-child(10) {
        width: 50px;
        text-align: center;
    }

    td:nth-child(11) {
        width: 90px;
        text-align: center;
    }

    th {
        display: inline-block;
    }

        th:nth-child(1) {
            width: 105px;
            text-align: center;
        }

        th:nth-child(2) {
            width: 139px;
            text-align: center;
        }

        th:nth-child(3) {
            width: 120px;
            text-align: center;
        }

        th:nth-child(4) {
            width: 80px;
            text-align: center;
        }

        th:nth-child(5) {
            width: 120px;
            text-align: center;
        }

        th:nth-child(6) {
            width: 135px;
            text-align: center;
        }

        th:nth-child(7) {
            width: 85px;
            text-align: center;
        }

        th:nth-child(8) {
            width: 40px;
            text-align: center;
        }

        th:nth-child(9) {
            width: 90px;
            text-align: center;
        }

        th:nth-child(10) {
            width: 50px;
        }

        th:nth-child(11) {
            width: 90px;
            text-align: center;
        }

    #Legend {
        font-size: 10px;
    }

        #Legend div {
            margin-bottom: 5px;
            height: 15px;
        }

    .modal-body > .container {
        width: auto;
        padding: 0;
    }

    .notdo {
        width: 200px;
        height: 100px;
        overflow: auto;
        padding: 0px 15px;
        border: none;
    }

    .selectpicker {
        border: 1px solid #ccc;
    }

    .dropdown-menu > li > a {
        padding: 3px 10px;
    }

    .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
        width: 150px;
    }

    @@media screen and (max-width: 768px) {
        .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
            width: 135px;
        }

        .selectpicker {
            font-size: 13px;
        }
    }
    /*Cage*/
    .fqc-first {
        height: 48px;
    }

    .fqc-content-topbutton {
        width: 130px;
        height: 34px;
        margin-top: 12px;
        border: none;
        border-radius: 5px;
        box-shadow: 0 2px 3px #888888;
        background-color: #e0e0e0;
        transition: all linear .2s;
    }

        .fqc-content-topbutton:hover {
            background-color: burlywood;
        }

    .fqc-index-content {
        height: 35px;
        margin-top: 8px;
        margin-bottom: 0px;
    }

    .fqc-index-content-inner {
        text-align: left;
        float: left;
        height: 35px;
        width: 250px;
    }

        .fqc-index-content-inner:nth-child(1) {
            width: 230px;
            margin-left: 125px;
        }

        .fqc-index-content-inner:nth-child(2) {
            width: 210px;
        }

        .fqc-index-content-inner:nth-child(3) {
            width: 180px;
            margin-left: 0px;
        }

    .btn-group > .btn:first-child {
        border: 1px solid rgba(178, 167, 167, 0.5);
    }

    .fqc-index-content-inner:nth-child(3) > input {
        width: 150px;
    }

    .fqc-index-content-inner:nth-child(4) > input {
        width: 135px;
        height: 34px;
        display: inline-block;
    }

    .fqc-index-content-inner:nth-child(4) > button {
        float: right;
        margin-left: 10px;
        height: 34px;
        border: none;
        background-color: #e0e0e0;
        border-radius: 5px;
        transition: all linear .1s;
    }

        .fqc-index-content-inner:nth-child(4) > button:hover {
            background-color: burlywood;
            color: #fff;
            box-shadow: 0 2px 3px #888888;
        }
    /*中间隐藏部分样式*/
    .fqc-medle-content-left {
        width: 730px;
        height: 100%;
        margin-left: 23px;
        display: inline-block;
    }

    .fqc-medle-content-left-top {
        height: 68px;
        border-bottom: 1px solid #808080;
    }



    .fqc-medle-content-left-bottom {
        height: 60%;
        width: 155px;
        float: left;
    }

        .fqc-medle-content-left-bottom:nth-child(3) {
            margin-left: 55px;
        }

        .fqc-medle-content-left-bottom:nth-child(4) {
            margin-left: 55px;
        }

    .fqc-medle-content-left-top-inner {
        height: 20px;
        width: 155px;
        float: left;
        margin-left: 0px;
    }

        .fqc-medle-content-left-top-inner:nth-child(8) {
            margin-left: 5px;
        }

    .fqc-medle-content-left-top > span {
        display: block;
        height: 30px;
        font-size: 16px;
    }

    .fqc-medle-content-left-bottom > span {
        height: 13%;
        display: block;
    }

    .fqc-medle-content-left-bottom-inner {
        height: 120px;
        width: 170px;
        text-align: center;
        overflow-y: auto;
    }

        .fqc-medle-content-left-bottom-inner > p {
            font-size: 10px;
            height: 13px;
            width: 150px;
            margin: 1px;
            display: inline-block;
            padding-bottom: 2px;
            border-radius: 8px;
            background-color: none;
            transition: all linear 0.1s;
        }

            .fqc-medle-content-left-bottom-inner > p:hover {
                font-size: 16px;
                height: 20px;
                background-color: burlywood;
            }

    .fqc-medle-content-left-top-inner:nth-child(8) {
        width: 290px;
    }

    .fqc-medle-content-left-top-inner:nth-child(3) {
        width: 200px;
    }

    .fqc-medle-content-left-top-inner:nth-child(7) {
        width: 195px;
    }
    /*RIGHT*/
    .fqc-medle-content-right {
        height: 220px;
        width: 320px;
        float: right;
    }

    .highcharts-title > tspan {
        font-size: 16px;
    }

    tspan {
        font-size: 11px;
    }
    /*输出的表头部分*/
    .fqc-for-tableheader {
        height: 35px;
        margin-top: 5px;
        float: left;
        width: 500px;
    }

    .fqc-for-tableheader-inner {
        font-size: 18px;
    }

    strong {
        color: black;
    }

    .fqc-hidden-content {
        border-bottom: 1px solid #808080;
    }
    /*输出表格样式--无效样式？*/
    .table > tbody > tr > th {
        font-size: 12px;
    }

    .table > tbody > tr {
        height: 25px;
    }

    tablescroll {
        height: 300px;
        overflow-y: hidden;
    }
    /*媒体查询--此为主要媒体查询样式编写区域：bootstrap移动端优先，所以必须移动端为常规样式。pc端为媒体查询样式*/
    @@media (min-width:450px) and (max-width:1500px) {
        strong {
            color: black;
        }

        .fqc-medle-content-left-top-inner {
            margin-left: 0px;
        }

        .fqc-hidden-content {
            height: 222px;
            border-bottom: 1px solid #808080;
        }
    }
    /*媒体查询--此为补充项*/
    @@media (max-width:450px) {
        .fqc-index-content-inner {
            margin-top: 5px;
        }

        .fqc-medle-content-right {
            display: none;
        }

        .fqc-medle-content-left-bottom {
            margin-left: 0px;
        }

        .fqc-for-tableheader-inner {
            font-size: 16px;
        }
    }

    .fqc-index-content-inner > button {
        box-shadow: 0 2px 3px #888888;
        margin-left: 5px;
    }

    .highcharts-background {
        width: 400px;
        height: 300px;
    }

    .fortableposition {
        float: right;
    }

    @@media (max-width:400px) {
        .fqc-medle-content-left {
            margin-left: 0px;
        }

        .fqc-medle-content-left-top {
            width: 290px;
            height: 185px;
        }

        .fqc-index-content-inner:nth-child(1) {
            margin-left: 0px;
        }

        .fqc-index-content-inner:nth-child(3) {
        }

        .fqc-index-content-inner:nth-child(4) {
        }
    }
     span:hover{
        background-color:#888888;
    }
</style>
<div class="container text-center fqc-first jianyan">
    @Html.ActionLink("开始FQC检验", "FinalQC_B", "", new { @class = "btn fqc-content-topbutton" })
    @Html.ActionLink("客户订单模块扫码", "recordBarcode", "", new { @class = "btn fqc-content-topbutton" })
</div>
<div class="spinner2">
    <div class="spinner-container container1">
        <div class="circle1"></div>
        <div class="circle2"></div>
        <div class="circle3"></div>
        <div class="circle4"></div>
    </div>
    <div class="spinner-container container2">
        <div class="circle1"></div>
        <div class="circle2"></div>
        <div class="circle3"></div>
        <div class="circle4"></div>
    </div>
    <div class="spinner-container container3">
        <div class="circle1"></div>
        <div class="circle2"></div>
        <div class="circle3"></div>
        <div class="circle4"></div>
    </div>
</div>
@using (Html.BeginForm("Index", "FinalQCs", FormMethod.Post, new { id = "searchForm", @class = "text-center" }))
{
    @Html.AntiForgeryToken()
    //更新版本
    <div class="container fqc-index-content">
        <form asp-controller="FinalQCs" asp-action="Index" method="post">
            <div class="fqc-index-content-inner">
                <span>订单号：</span>@Html.DropDownList("orderNum", (List<SelectListItem>)ViewBag.OrderList, "全部", new { @class = "selectpicker",id = "orderNum", data_live_search = "true", data_style = "form-control" })
            </div>
            <div class="fqc-index-content-inner">
                <span>是否重复FQC：</span>@Html.DropDownList("repetition", (List<SelectListItem>)ViewBag.Repetition, "全部", new { @class = "form-control", style = "display:inline; width: 80px" })
            </div>
            <div class="fqc-index-content-inner">
                <span>
                    FQC结果：
                    @Html.DropDownList("FQCNormal", (List<SelectListItem>)ViewBag.FQCNormal, "全部", new { @class = "form-control", style = "display:inline; width: 80px" })
                </span>
            </div>
            <div class="fqc-index-content-inner">
                <span>备注：</span>
                <input type="text" class="form-control" style="display:inline;width:150px;" name="Remark" />
                @*<input type="hidden" id="PageIndex" name="PageIndex" value="0" />*@
                <button id="searchcButton" data-val="12">查找</button>
                <input type="submit" id="searchButton" class="btn btn-default hidden" value="查找" />
            </div>
        </form>
    </div>
}



<div id="query" class="container fqc-hidden-content" style="@ViewBag.Display">
    <div class="fqc-medle-content-left">
        <div id="theTop" class="fqc-medle-content-left-top">
            <span style="height:25px;">订单 <strong class="testcolor">@ViewBag.orderNum</strong>模组FQC基本情况</span>
            <div class="fqc-medle-content-left-top-inner">
                <p>订单的模组总量：<strong>@ViewBag.Quantity</strong></p>
            </div>
            <div class="fqc-medle-content-left-top-inner">
                <p>经过FQC次数：<strong>@ViewBag.RecordCount</strong></p>
            </div>
            <div class="fqc-medle-content-left-top-inner">
                <p>正常数量：<strong>@ViewBag.NormalCount</strong></p>
            </div>
            <div class="fqc-medle-content-left-top-inner">
                <p>异常数量：<strong>@ViewBag.AbnormalCount</strong></p>
            </div>
            <div class="fqc-medle-content-left-top-inner">
                <p>完成率：<strong><span>{{FinishRate}}</span>%</strong> </p>
            </div>
            <div class="fqc-medle-content-left-top-inner" style="width:295px">
                <p>查询时间： <strong><span>{{message}}</span> </strong></p>
            </div>
        </div>
        @if (ViewBag.NotDo != null)
            {

            <div class="fqc-medle-content-left-bottom">
                <span class="testspan">未进行FQC模组 <strong>@ViewBag.NotDoCount</strong> 个：</span>
                <div class="fqc-medle-content-left-bottom-inner">
                    @foreach (var item in ViewBag.NotDo)
                    {
                        <p>@item</p>
                    }
                </div>
            </div>
        }
        @if (ViewBag.DoingNowList != null)
            {

            <div class="fqc-medle-content-left-bottom">
                <span class="testspan">正在FQC模组<strong>@ViewBag.DoingNowListCount</strong> 个：</span>
                <div class="fqc-medle-content-left-bottom-inner">
                    @foreach (var item in ViewBag.DoingNowList)
                    {
                        <p>@item</p>
                    }
                </div>
            </div>
        }
        @if (ViewBag.NeverFinishList != null)
            {

            <div class="fqc-medle-content-left-bottom">
                <span class="testspan">未完成FQC模组<strong>@ViewBag.NeverFinishListCount</strong> 个：</span>
                <div class="fqc-medle-content-left-bottom-inner">
                    @foreach (var item in ViewBag.NeverFinishList)
                    {
                        <p>@item</p>
                    }
                </div>
            </div>
        }
    </div>
    <div id="container2" class="fqc-medle-content-right"></div>
</div>
<script type="text/javascript">
    var query = new Vue({
        el: '#query',    //与div中的id名对应
        data: {
            message: new Date().toLocaleString(),  //输出查询时间
            floatmessage: '订单号'+'@ViewBag.orderNum',
            Quantity:@ViewBag.Quantity,
            NormalCount:@ViewBag.NormalCount,
        },
        computed:{
            FinishRate: function (){
                return (this.NormalCount/this.Quantity*100).toFixed(1)
            }
        }
    });

    Highcharts.chart('container2', {
        chart: {
            type: 'pie',
            options3d: {
                enabled: true,
                alpha: 30,
                beta: 0
            }
        },
        title: {
            text: '订单 @ViewBag.orderNum 基本情况'
        },
        tooltip: {
            pointFormat: '<b>{point.percentage:.1f}%</b>'//'{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                depth: 35,
                dataLabels: {
                    enabled: true,
                    formatter:function(){           // '{point.name}'
                        if(this.percentage >0 )
                        { return this.point.name;}
                        else if (this.percentage >=100 )
                        { return '已全部完成';}
                    }
                }
            }
        },
        series: [{
            type: 'pie',
            name: '',
            data: [
                ['已完成 @ViewBag.NormalCount 个',@ViewBag.NormalCount],
                ['未完成 @ViewBag.NeverFinish 个',@ViewBag.NeverFinish]
            ]
        }]
    });
</script>
<div style="width:1140px;clear:left;">
    <table class="tableTop">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.OrderNum)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.BarCodesNum)
                <span class="glyphicon glyphicon-chevron-up" role="button" onclick="sortTable('tagetTable',1,'up','tt')"></span>
                <span class="glyphicon glyphicon-chevron-down" role="button" onclick="sortTable('tagetTable',1,'down','tt')"></span>
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FQCCheckBT)
                <span class="glyphicon glyphicon-chevron-up" role="button" onclick="sortTable('tagetTable',2,'up','times')"></span>
                <span class="glyphicon glyphicon-chevron-down" role="button" onclick="sortTable('tagetTable',2,'down','times')"></span>
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FQCPrincipal)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FQCCheckFT)
                <span class="glyphicon glyphicon-chevron-up" role="button" onclick="sortTable('tagetTable',4,'up','times')"></span>
                <span class="glyphicon glyphicon-chevron-down" role="button" onclick="sortTable('tagetTable',4,'down','times')"></span>
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FQCCheckTimeSpan)
                <span class="glyphicon glyphicon-chevron-up" role="button" onclick="sortTable('tagetTable',5,'up','tt')"></span>
                <span class="glyphicon glyphicon-chevron-down" role="button" onclick="sortTable('tagetTable',5,'down','tt')"></span>
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FinalQC_FQCCheckAbnormal)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.RepetitionFQCCheck)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.RepetitionFQCCheckCause)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FQCCheckFinish)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Remark)
            </th>
            <th></th>
        </tr>
    </table>
</div>
<div style="height:640px;width:1140px;overflow:auto;">
    <table class="table" id="tagetTable">

        @if (Model != null)
        {
            foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.OrderNum)
                    </td>
                    <td>
                        <span class="barcodeNum">@Html.DisplayFor(modelItem => item.BarCodesNum)</span>
                        @*@Html.DisplayFor(modelItem => item.BarCodesNum)*@
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FQCCheckBT)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FQCPrincipal)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FQCCheckFT)
                    </td>
                    @*<td>
                            @Html.DisplayFor(modelItem => item.FQCCheckDate)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.FQCCheckTime)
                        </td>*@
                    <td>
                        @Html.DisplayFor(modelItem => item.FQCCheckTimeSpan)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FinalQC_FQCCheckAbnormal)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.RepetitionFQCCheck)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.RepetitionFQCCheckCause)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FQCCheckFinish)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Remark)
                    </td>
                    @*<td>
                            @Html.ActionLink("Edit", "Edit", new { id = item.Id })
                            @Html.ActionLink("Details", "Details", new { id = item.Id })
                            @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                        </td>*@
                </tr>
            }
        }
    </table>
    <input class="hidden" id="overtime" value="@ViewBag.Overtime" />
    <form id="gotoBarCode" action="/BarCodes/Index" method="post" target="_blank" style="display:none">
        @Html.AntiForgeryToken()
        <input type="text" name="OrderNum" value="" />
        <input type="text" name="BarCodeType" value="" />
        <input type="text" name="BarCodeNum" value="" id="formBarCodeNum" />
    </form>
</div>
<script>

    function checkRoles(list, roleName) {   //检测权限
        var flag = false
        if (list && roleName) {
            for (let item in list) {
                if (list[item] == roleName) {
                    flag = true
                }
            }
        }
        return flag
    }

    var roles = JSON.parse(localStorage.getItem("rigths"));
    if (checkRoles(roles, '开始FQC检验')) {
        $('.jianyan').show()
    } else {
        $('.jianyan').hide()
    }

    function sortTable(tableId,indexs,upOrDown,types) {//点击按钮实现表格排序的方法；目前支持纯字符串排序+整数排序+标准时间格式排序
        var oTab = document.getElementById(tableId);
        var arr = [];
        var indexs = indexs;
        if (upOrDown === "up") {
            if (types === "init") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                console.log(arr)
                arr.sort(function (tr1, tr2) {       //整数排序
                    var n1 = parseInt(tr1.cells[indexs].innerHTML);
                    var n2 = parseInt(tr2.cells[indexs].innerHTML);
                    return n2 - n1;
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            } else if (types === "times") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                console.log(arr)
                arr.sort(function (tr1, tr2) {       //标准时间格式排序排序
                    var n1 = new Date((tr1.cells[indexs].innerHTML)).getTime();
                    var n2 = new Date((tr2.cells[indexs].innerHTML)).getTime();
                    return n2 - n1;
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            } else if (types === "strings") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                console.log(arr)
                arr.sort(function (tr1, tr2) {       //纯字符串排序
                    var n1 = (tr1.cells[indexs].innerHTML).charCodeAt();
                    var n2 = (tr2.cells[indexs].innerHTML).charCodeAt();
                    return n2 - n1;
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            } else if (types === "checkbox") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                console.log(arr)
                arr.sort(function (tr1, tr2) {       //选择框排序
                    var n1 = tr1.cells[indexs].children;
                    var n2 = tr2.cells[indexs].children;
                    if ($(n1).attr('checked')) {
                        n1.value = 1
                    } else {
                        n1.value = 0
                    }
                    if ($(n2).attr('checked')) {
                        n2.value = 1
                    } else {
                        n2.value = 0
                    }
                    return n2.value - n1.value

                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            } else if (types === "tt") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                arr.sort(function (tr1, tr2) {        //时分秒排序
                    var n1 = timeToSec(tr1.cells[indexs].innerText);
                    var n2 = timeToSec(tr2.cells[indexs].innerText);
                    return n2 - n1;
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            }
        } else if (upOrDown === "down") {
            if (types === "init") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                console.log(arr)
                arr.sort(function (tr1, tr2) {       //整数排序
                    var n1 = parseInt(tr1.cells[indexs].innerHTML);
                    var n2 = parseInt(tr2.cells[indexs].innerHTML);
                    return n1 - n2;
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            } else if (types === "times") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                console.log(arr)
                arr.sort(function (tr1, tr2) {       //标准时间格式排序排序
                    var n1 = new Date((tr1.cells[indexs].innerHTML)).getTime();
                    var n2 = new Date((tr2.cells[indexs].innerHTML)).getTime();
                    return n1 - n2;
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            } else if (types === "strings") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                console.log(arr)
                arr.sort(function (tr1, tr2) {       //纯字符串排序
                    var n1 = (tr1.cells[indexs].innerHTML).charCodeAt();
                    var n2 = (tr2.cells[indexs].innerHTML).charCodeAt();
                    return n1 - n2;
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            } else if (types === "checkbox") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                console.log(arr)
                arr.sort(function (tr1, tr2) {       //选择框排序
                    var n1 = tr1.cells[indexs].children;
                    var n2 = tr2.cells[indexs].children;
                    if ($(n1).attr('checked')) {
                        n1.value = 1
                    } else {
                        n1.value = 0
                    }
                    if ($(n2).attr('checked')) {
                        n2.value = 1
                    } else {
                        n2.value = 0
                    }
                    return n1.value - n2.value
                        
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            } else if (types === "tt") {
                for (var i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    arr[i] = oTab.tBodies[0].rows[i];
                }
                arr.sort(function (tr1, tr2) {        //时分秒排序
                    var n1 = timeToSec(tr1.cells[indexs].innerText);
                    var n2 = timeToSec(tr2.cells[indexs].innerText);
                    return n1 - n2;
                });
                for (var i = 0; i < arr.length; i++) {
                    oTab.tBodies[0].appendChild(arr[i]);
                }
            }
        }
    }

    function timeToSec(time) {     //时分秒字符串格式转换为毫秒
        if(time.indexOf("时")!=-1 || time.indexOf("分")!=-1 || time.indexOf("秒")!=-1){
            console.log(time.indexOf("时"))
            var time  = time.replace(/秒/,"");
            var sec = time
            var s = Number(sec)
            return s * 1000
        }else if(time.indexOf("A")!=-1 || time.indexOf("B")!=-1){
            //console.log(123)
            //var time = time +''
            var targetNum = time.substring(10);
            console.log(targetNum)
            
            return Number(targetNum,10);
        }
        
    }


    function chackboxVal(input) {    //checkbox状态转换为数值

        if (input.checked == false) {
            input = 1
        } else {
            input = 0
        }
        return input;
    }

    $(function () {
        var overTimeList = JSON.parse($("#overtime").val());
        $(".barcodeNum").each(function(index,val){
            for(var item in overTimeList){
                if(val.textContent==item){
                    $(this).css("color","red");
                    $(this).popover({trigger:'hover',title:"条码号\"<span style=\"color:blue\">"+item+"</span>\"异常原因",html:true,content:overTimeList[item],placement:"top"});
                };
            };

            $(this).css("cursor","pointer");
            $(this).click(function(v){
                $("#formBarCodeNum").val(v.target.textContent);
                $("#gotoBarCode").submit();
            });
        });
    });

    $("#searchButton").click(function(){
        $(".spinner2").show();
    })

    document.onreadystatechange = loadingChange;  //已 证实为生效句柄
    function loadingChange(){
        if(document.readyState == "complete"){   //当页面加载状态为：全部加载完成时执行这个分支
            $(".spinner2").hide();
        }
    }

    var prevent = true;  //防止按钮重复点击提交--间隔5秒
    $("#searchcButton").on("click", function () {
        if (prevent) {
            prevent = false;
            $(this).attr("disabled", "disabled");
            console.log($(this).attr("data-val"));  //测试防止功能是否生效--生效。
            setTimeout(function () {
                prevent = true;
                $("#searchcButton").removeAttr("disabled");
            }, 5000);
        }

    })
</script>
@section scripts {
    <script>
        function submitForm(pagenumber) {
            pagenumber = parseInt(pagenumber, 10);
            $('#PageIndex').val(pagenumber - 1);
            $('#searchForm').submit();
        }
        $(function () {
            $('.selectpicker').selectpicker();
            $('#searchButton').click(function () {
                submitForm($('#pagebar .currentpagenumber').text());
            });

            $('#pagebar .pagenumber').click(function () {
                submitForm($(this).text());
            });
            $("#searchcButton").click(function (event) {
                event.preventDefault();
                if ($("#orderNum").val() != "" || $("#barcodeNumber").val() != "") {
                    $("#searchButton").click();
                }
            })
        });
    </script>
}