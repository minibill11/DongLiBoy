<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>@ViewBag.Title - 健和光电MES</title>

    <link href="~/Content/main/elementui.css" rel="stylesheet" />
    <link href="~/Content/main/main.less" rel="stylesheet/less" type="text/css" />
    <script src="~/Scripts/main/vue.min.js"></script>
    @RenderSection("cssStyle", false)
</head>
<body>
    <el-container id="mainVM" v-cloak>
        <el-header class="topTitle">
            <div class="titleimg">
                @*<i class="el-icon-menu"></i>*@
                <a href="/Home/Index3"><img class="logo" src="~/Images/top_logo.png" /></a>
            </div>
            <top-title :username="userName" :userid="userId" :admin="isAdmin" :limits="limitsList"></top-title>
        </el-header>
        <el-container>
            <el-aside class="leftMenu">
                <left-menu :menulist="menuList" :activeindex="activeIndex" :openedsarr="openedsArr"></left-menu>
            </el-aside>
            <el-container>
                <el-main class="rightMain">
                    <el-row class="rightMainTitle">
                        <el-page-header @@back="goBack">
                            <template slot="content">
                                <el-breadcrumb separator-class="el-icon-arrow-right">
                                    <el-breadcrumb-item v-for="i in openedsArr">{{i.split('→')[0]}}</el-breadcrumb-item>
                                </el-breadcrumb>
                            </template>
                        </el-page-header>
                    </el-row>
                    <el-row class="rightMainContent" v-loading="mainLoading">
                        @RenderBody()
                    </el-row>
                </el-main>
                <el-footer class="bottomFooter">
                    &copy;@DateTime.Now.Year - 健和光电MES&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;指定浏览器：
                    <a href="~/MES_Data/ChromeCore_1277_3.0.1.6.exe">Chrome浏览器</a>，
                    &nbsp;(火狐 for Windows)
                    &nbsp;<a href="~/MES_Data/Firefox Setup x64.exe">64位</a>/
                    &nbsp;<a href="~/MES_Data/Firefox Setup x86.exe">32位</a>/
                    &nbsp;<a href="~/MES_Data/Firefox Setup XP.exe">XP版</a>
                </el-footer>
            </el-container>
        </el-container>
    </el-container>
    @{
        var sessionID = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).ID.ToString();
        var sessionUserNum = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).UserNum.ToString();
        var sessionUserName = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).UserName;
        var sessionRole = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).Role;
        var sessionDepartment = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).Department;
    }
    @RenderPage("_TopTitle.cshtml")
    @RenderPage("_LeftMenu.cshtml")
    @RenderSection("renderPage", false)
    <script src="~/Scripts/main/elementui.js"></script>
    <script src="~/Scripts/main/less.min.js"></script>
    <script src="~/Scripts/main/axios.min.js"></script>
    <script src="~/Scripts/main/print.ip.js"></script>
    <script src="~/Scripts/menu-list/menuList.js"></script>
    <script src="~/Scripts/main/limits.js"></script>
    <script src="~/Scripts/main/main.js"></script>
    @RenderSection("jsScript", false)
    <script>
        //type="module"   ../.js/export
        //import { limit } from '../Scripts/main/limits.js'
        //import { mixin } from '../Scripts/main/main.js'
        let mixinArr = [limit, mixin];
        if (typeof app != 'undefined') mixinArr.push(app);
        var vm = new Vue({
            el: "#mainVM",
            mixins: mixinArr,
            data: {
                userId: '@sessionID',
                userNum: '@sessionUserNum',
                userName: '@sessionUserName',
                userRole: '@sessionRole',
                userDepartment: '@sessionDepartment'
            }
        });

        // 添加请求拦截器
        axios.interceptors.request.use(function (config) {
            vm.mainLoading = true;
            return config;
        }, function (error) {
            return Promise.reject(error);
        });

        // 添加响应拦截器
        axios.interceptors.response.use(function (response) {
            vm.mainLoading = false;
            return response;
        }, function (error) {
            vm.mainLoading = false;
            return Promise.reject(error);
        });

        ////执行多个并发请求

        //function getUserAccount() {
        //    return axios.get('/user/12345');
        //}

        //function getUserPermissions() {
        //    return axios.get('/user/12345/permissions');
        //}

        //axios.all([getUserAccount(), getUserPermissions()])
        //.then(axios.spread(function (acct, perms) {
        //    // 两个请求现在都执行完成
        //}));
    </script>
</body>
</html>
