@{
    ViewBag.Title = "打印测试";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Scripts/axios.min.js"></script>
<style>
    .el-input {
        max-width: 220px;
    }

    .inputframe {
        width: 300px;
        text-align: right;
        margin: 5px auto;
    }
</style>
<div id="app" v-cloak>
    <el-container>
        <el-main>
            <el-col :span="8">
                <div class="inputframe">
                    <span>订单：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="selectVal"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span>内箱条码：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="innerVal"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span>模组：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="printMozhu"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span>外箱条码：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="masterVal"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span>物料描述：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="wuliao"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span>SNTN：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="sntn"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span>QTY：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="shuliang"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <el-switch v-model="imgShow"
                               active-text="使用logo"
                               inactive-text="关闭logo">
                    </el-switch>
                </div>
                <div class="inputframe">
                    <span>模组数量：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="mozutable"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span>格式：</span>
                    <el-input placeholder="请输入"
                              v-model.trim="geshi"
                              style="text-align:right;display:inline-block;"
                              size="medium"
                              clearable>
                    </el-input><br />
                    <span>显示为：{{geshi}}01，{{geshi}}02.....</span>
                </div>
                <div class="inputframe">
                    <el-button v-on:click="innerText" @*class="printBtn"*@ type="primary" size="medium">内箱测试</el-button>
                    <el-button v-on:click="masterImg" @*class="printBtn"*@ type="primary" size="medium">外箱测试</el-button>

                </div>
            </el-col>
            <el-col :span="16" class="text-center">
                <el-row>
                    <div style="padding:5px; background: #f5da55">
                        <h3 style="color: #000; ">显示区</h3>
                    </div>
                    <div>
                        <img id="cc" />
                    </div>
                </el-row>
            </el-col>
        </el-main>
    </el-container>
</div>
<script>
    var app = new Vue({
        el: "#app",
        data: {
            innerVal: "18AA77701A00008",
            masterVal: "19YA2091-001",
            printMozhu: "1-A08",
            selectVal: '2019-YA209-1',
            imgShow: true,
            mozutable: 15,
            wuliao: "LED模组",
            sntn: "1/15",
            shuliang: "15",
            geshi:"A-"
        },
        methods: {
            masterImg: () => {
                let mzList = [], mztable = app.mozutable, g = app.geshi;
                for (let i = 1; i <= mztable; i++) {
                    if (i < 10) {
                        mzList.push(g+"0" + i);
                    } else {
                        mzList.push(g + i);
                    };
                };
                axios.post('/Packagings/OutsideBoxLablePrint', {
                    ordernum: app.selectVal,
                    outsidebarcode: app.masterVal,
                    material_discription: app.wuliao,
                    sntn: app.sntn,
                    qty: app.shuliang,
                    mn_list: mzList,
                    logo: app.imgShow,
                }, {
                        responseType: "arraybuffer",
                    }).then(function (response) {
                        //console.log(response.data)
                        //将从后台获取的图片流进行转换
                        return 'data:image/png;base64,' + btoa(
                            new Uint8Array(response.data).reduce((data, byte) => data + String.fromCharCode(byte), '')
                        );
                    }).then(function (data) {
                        //接收转换后的Base64图片
                        console.log(data);
                        document.getElementById("cc").setAttribute("src", data)
                    }).catch(err => {
                        console.warn("打印出错")
                    });
            },
            innerText: () => {
                axios.post('/Appearances/InsideBoxLablePrint', {
                    barcode: app.innerVal,
                    modulenum: app.printMozhu,
                    pagecount: 2,
                }, {
                        responseType: "arraybuffer",
                    }).then(function (response) {
                        //console.log(response.data)
                        //将从后台获取的图片流进行转换
                        return 'data:image/png;base64,' + btoa(
                            new Uint8Array(response.data).reduce((data, byte) => data + String.fromCharCode(byte), '')
                        );
                    }).then(function (data) {
                        //接收转换后的Base64图片
                        console.log(data);
                        document.getElementById("cc").setAttribute("src", data)
                    }).catch(err => {
                        console.warn("打印出错")
                    });
            },
        },
    });
</script>