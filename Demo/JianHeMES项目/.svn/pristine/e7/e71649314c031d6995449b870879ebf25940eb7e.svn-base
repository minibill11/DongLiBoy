@{
    ViewBag.Title = "锡膏入库";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<link href="~/Content/styleFile/solder/solderStyle.css?v=" +Math.random() rel="stylesheet" />
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Scripts/printJS/JsBarcode.all.min.js"></script>

<div id="app" v-cloak>
    <el-container>
        <el-header class="text-center">
            <div v-show="screenSize>=768">
                <h2 class="text-center">@ViewBag.Title</h2>
                <a href="/SMT_Sulderpaster/board"><el-button size="small">看板</el-button></a>
                <a href="/SMT_Sulderpaster/AddWarehouse_Material"><el-button size="small">录入物料信息</el-button></a>
                <a href="/SMT_Sulderpaster/AddWareHouseBaseInfo"><el-button size="small">锡膏入库</el-button></a>
                <a href="/SMT_Sulderpaster/AddWarehouseFreezer"><el-button size="small">锡膏入冰柜</el-button></a>
                <a href="/SMT_Sulderpaster/outWarehouseFreezer"><el-button size="small">锡膏出库</el-button></a>
                <a href="/SMT_Sulderpaster/AddSMTFreezer"><el-button size="small">入SMT冰柜</el-button></a>
                <a href="/SMT_Sulderpaster/Rewarming"><el-button size="small">回温</el-button></a>
                <a href="/SMT_Sulderpaster/RewarmRecord"><el-button size="small">回温记录</el-button></a>
                <a href="/SMT_Sulderpaster/Stir"><el-button size="small">搅拌</el-button></a>
                <a href="/SMT_Sulderpaster/Use"><el-button size="small">使用</el-button></a>
                <a href="/SMT_Sulderpaster/recovery"><el-button size="small">回收</el-button></a>
            </div>
            <div v-show="screenSize<768">
                <h3>@ViewBag.Title</h3>
                <el-dropdown placement="bottom">
                    <el-button size="medium ">
                        更多菜单<i class="el-icon-arrow-down el-icon--right"></i>
                    </el-button>
                    <el-dropdown-menu slot="dropdown">
                        <a href="/SMT_Sulderpaster/board"><el-dropdown-item>看板</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/AddWarehouse_Material"><el-dropdown-item>录入物料信息</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/AddWareHouseBaseInfo"><el-dropdown-item>锡膏入库</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/AddWarehouseFreezer"><el-dropdown-item>锡膏入冰柜</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/outWarehouseFreezer"><el-dropdown-item>锡膏出库</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/AddSMTFreezer"><el-dropdown-item>入SMT冰柜</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/Rewarming"><el-dropdown-item>回温</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/RewarmRecord"><el-dropdown-item>回温记录</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/Stir"><el-dropdown-item>搅拌</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/Use"><el-dropdown-item>使用</el-dropdown-item></a>
                        <a href="/SMT_Sulderpaster/recovery"><el-dropdown-item>回收</el-dropdown-item></a>
                    </el-dropdown-menu>
                </el-dropdown>
            </div>
        </el-header>
        <el-main v-loading="loading">
            <el-row>
                <div class="inputframe">
                    <span class="inputtext">料号：</span>
                    <el-input placeholder="请输入料号"
                              v-model.trim="ReceivingNum"
                              v-on:keyup.enter.native="GetMaterialInfo"
                              size="medium"
                              autofocus
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">厂商编号：</span>
                    <el-input @*placeholder="厂商编号"*@
                              v-model.trim="Manufactor"
                              size="medium"
                              disabled
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">厂商简称：</span>
                    <el-input @*placeholder="厂商简称"*@
                              v-model.trim="Supplier"
                              size="medium"
                              disabled
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">锡膏型号：</span>
                    <el-input @*placeholder="锡膏型号"*@
                              v-model.trim="SolderpasteType"
                              size="medium"
                              disabled
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">锡膏数量：</span>
                    <el-input-number v-model.trim="SolderpasteNum"
                                     size="mudium"
                                     :min="0"
                                     style="width:auto"
                                     clearable>
                    </el-input-number>
                </div>
                <div class="inputframe">
                    <span class="inputtext">生产日期：</span>
                    <el-date-picker v-model="LeaveFactoryTime"
                                    type="date"
                                    placeholder="选择生产日期"
                                    size="medium">
                    </el-date-picker>
                </div>
                <div class="inputframe">
                    <span class="inputtext">出货日期：</span>
                    <el-date-picker v-model="ShipmenTime"
                                    type="date"
                                    placeholder="选择出货日期"
                                    size="medium">
                    </el-date-picker>
                </div>
                <div class="inputframe">
                    <span class="inputtext">收料人姓名：</span>
                    <el-input placeholder="请输入收料人姓名"
                              v-model.trim="ReceivingClerk"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">批次：</span>
                    <el-input placeholder="请输入批次"
                              v-model.trim="Batch"
                              size="medium"
                              clearable>
                    </el-input>
                </div>
                <div class="inputframe">
                    <span class="inputtext">有效期(天)：</span>
                    <el-input-number v-model.trim="EffectiveDay"
                                     size="medium"
                                     :min="0"
                                     style="width:auto"
                                     clearable>
                    </el-input-number>
                    <el-button size="mini" @@click="previewBarcode">随机条码预览</el-button>
                    <el-button size="medium" @@click="postPrint">打印条码</el-button>
                </div>
                <div class="inputframe" style="margin-top:20px;width:500px;text-align:center;">
                    <div class="solderBarDiv">
                        <svg id="solderBarcode"></svg>
                    </div>
                </div>
            </el-row>
        </el-main>
    </el-container>
</div>

<script>
    var app = new Vue({
        el: "#app",
        data: {
            loading: false,
            screenSize: document.body.clientWidth,
            //入库
            SolderpasteType: "",
            SolderpasteNum: "",
            Supplier: "",
            Manufactor: "",
            LeaveFactoryTime: "",
            ShipmenTime: "",
            ReceivingClerk: "",
            Batch: "",
            ReceivingNum: "",
            EffectiveDay: ""
        },
        created: function () {
            window.onresize = function () {
                app.screenSize = document.body.clientWidth;
            };
        },
        methods: {
            previewBarcode: function () {
                let printCode, nowDate = new Date(), sn = (Math.random() * 1000).toFixed(0);
                printCode = `${this.ReceivingNum}-${nowDate.getFullYear().toString().substring(2)}${nowDate.getMonth() < 10 ? 0 : ""}${nowDate.getMonth() + 1}${nowDate.getDate()}-${sn < 100 ? "0" + sn : sn}`;
                if (this.ReceivingNum != "") {
                    this.printBarcode(printCode);
                } else {
                    $(".solderBarDiv").html('<svg id="solderBarcode"></svg>');
                    this.$message({
                        showClose: true,
                        message: "料号为空，无法生成条码！",
                        type: 'warning'
                    });
                };
            },
            printBarcode: function (v) {
                JsBarcode("#solderBarcode", v.toUpperCase(), {
                    height: 60, //条形码的高度
                    //fontOptions: "bold",//使文字加粗体或变斜体
                    format: "CODE128",
                    font: "monospace",
                    textAlign: "center",
                    textMargin: 0,//设置条形码和文本之间的间距
                    fontSize: 26,//设置文本的大小
                    lineColor: "#000",//条形码颜色
                    margin: 0,//设置条形码周围的空白边距
                    marginTop: 0
                });
            },
            //验证条码，录入信息，打印条码，
            postPrint: function () {
                this.loading = true;
                let postList = [],
                    nooknum = 0,
                    errormes = "",
                    SolderpasteType = this.SolderpasteType,
                    SolderpasteNum = this.SolderpasteNum,
                    Supplier = this.Supplier,
                    Manufactor = this.Manufactor,
                    LeaveFactoryTime = this.LeaveFactoryTime,
                    ShipmenTime = this.ShipmenTime,
                    ReceivingClerk = this.ReceivingClerk,
                    Batch = this.Batch,
                    ReceivingNum = this.ReceivingNum,
                    EffectiveDay = this.EffectiveDay;
                //验证不能为空
                if (SolderpasteType == "") {
                    errormes = errormes + (nooknum + 1) + "、锡膏型号不能为空<br/>";
                    nooknum++;
                };
                if (SolderpasteNum == "") {
                    errormes = errormes + (nooknum + 1) + "、锡膏数量不能为空<br/>";
                    nooknum++;
                };
                if (Supplier == "") {
                    errormes = errormes + (nooknum + 1) + "、供应商不能为空<br/>";
                    nooknum++;
                };
                if (Manufactor == "") {
                    errormes = errormes + (nooknum + 1) + "、厂家不能为空<br/>";
                    nooknum++;
                };
                if (LeaveFactoryTime == "") {
                    errormes = errormes + (nooknum + 1) + "、出厂日期不能为空<br/>";
                    nooknum++;
                };
                if (ShipmenTime == "") {
                    errormes = errormes + (nooknum + 1) + "、出货日期不能为空<br/>";
                    nooknum++;
                };
                if (ReceivingClerk == "") {
                    errormes = errormes + (nooknum + 1) + "、收料人姓名不能为空<br/>";
                    nooknum++;
                };
                if (Batch == "") {
                    errormes = errormes + (nooknum + 1) + "、批次不能为空<br/>";
                    nooknum++;
                };
                if (ReceivingNum == "") {
                    errormes = errormes + (nooknum + 1) + "、料号不能为空<br/>";
                    nooknum++;
                };
                if (EffectiveDay <= 0) {
                    errormes = errormes + (nooknum + 1) + "、有效期不能为0<br/>";
                    nooknum++;
                }
                if (nooknum > 0) {
                    this.$alert(errormes, "标签不合格", {
                        confirmButtonText: '确定',
                        closeOnClickModal: true,
                        closeOnPressEscape: true,
                        dangerouslyUseHTMLString: true,
                        type: "error",
                    });
                    this.loading = false;
                } else {
                    //录入数据
                    postList = {
                        SolderpasteType: SolderpasteType,
                        SolderpasteNum: SolderpasteNum,
                        Supplier: Supplier,
                        Manufactor: Manufactor,
                        LeaveFactoryTime: LeaveFactoryTime,
                        ShipmenTime: ShipmenTime,
                        ReceivingClerk: ReceivingClerk,
                        Batch: Batch,
                        ReceivingNum: ReceivingNum,
                        EffectiveDay: EffectiveDay
                    };
                    axios.post('/SMT_Sulderpaster/AddWarehouseBaseInfo',
                        { warehouse_BaseInfo: postList }
                    ).then(res => {
                        if (res.data == "True") {
                            //成功存储和打印
                            this.$confirm('打印成功，是否进行下一组录入?', res.data, {
                                confirmButtonText: '确定',
                                cancelButtonText: '取消',
                                type: 'success',
                                center: true,
                            }).then(() => {
                                this.clear();
                            }).catch(() => {
                            });
                            this.loading = false;
                        } else {
                            this.$alert('打印失败！', {
                                confirmButtonText: '确定',
                                closeOnClickModal: true,
                                closeOnPressEscape: true,
                                type: "error",
                            });
                            this.loading = false;
                        };
                    }).catch(err => {
                        console.warn("post失败")
                        this.loading = false;
                    });
                };
            },
            //清空
            clear: function () {
                this.SolderpasteType = "";
                this.SolderpasteNum = "";
                this.Supplier = "";
                this.Manufactor = "";
                this.LeaveFactoryTime = "";
                this.ShipmenTime = "";
                this.ReceivingClerk = "";
                this.Batch = "";
                this.ReceivingNum = "";
                this.EffectiveDay = "";
                this.$message({
                    showClose: true,
                    message: '已清空！'
                });
            },
            //获取厂商信息
            GetMaterialInfo: function () {
                if (this.ReceivingNum != "") {
                    this.loading = true;
                    axios.post('/SMT_Sulderpaster/GetMaterialInfo',
                        { Material: this.ReceivingNum }
                    ).then(res => {
                        //console.log(res.data)
                        let rtd = res.data;
                        this.SolderpasteType = rtd.type;
                        this.Supplier = rtd.ManufactorName;
                        this.Manufactor = rtd.ManufactorNum;
                        this.loading = false;
                    }).catch(err => {
                        console.warn("post失败")
                        this.loading = false;
                    });
                } else {
                    this.$message({
                        message: "料号为空！",
                        type: "warning",
                        showClose: true
                    });
                };
            }
        }
    });
</script>