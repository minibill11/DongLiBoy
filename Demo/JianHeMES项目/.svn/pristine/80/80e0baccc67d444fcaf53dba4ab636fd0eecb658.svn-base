
@{
    ViewBag.Title = "汇总表";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Scripts/axios.min.js"></script>

<style>
    table .cell, table td {
        text-align: center;
        padding: 2px !important;
    }

    .timeinputcontainer {
        margin: 12px auto;
        text-align:center;
    }
</style>

@*<h3>汇总表</h3>*@





<div id="app">
    <div class="timeinputcontainer">
        <el-date-picker size="mini"
                        v-model="times"
                        type="month"
                        placeholder="选择月">
        </el-date-picker>
        月度优秀班组评优汇总表
    </div>
    <el-table v-bind:data="tableData"
              max-height="650"
              style="width: 100%">
        <el-table-column type="index"
                         label="序号"
                         fixed
                         width="54"
                         v-bind:index="indexMethod">
        </el-table-column>
        <el-table-column prop="AssetDepartment"
                         label="被考核部门"
                         fixed
                         width="130">
        </el-table-column>
        <el-table-column prop="DP_Group"
                         width="130"
                         fixed
                         label="班组">
        </el-table-column>
        <el-table-column label="效率指标35%">
            <el-table-column prop="IndexName1"
                             label="指标名称"
                             width="130">
            </el-table-column>
            <el-table-column prop="Target_value1"
                             label="目标值"
                             width="80">
            </el-table-column>
            <el-table-column prop="Actual_completion_value1"
                             label="实际完成值"
                             width="90">
            </el-table-column>
            <el-table-column prop="danx1"
                             label="单项得分"
                             width="80">
            </el-table-column>
            <el-table-column prop="defen1"
                             label="得分小计"
                             width="80">
            </el-table-column>
            <el-table-column prop="DepartmentData1"
                             label="数据来源和提供部门"
                             width="140">
            </el-table-column>

        </el-table-column>
        <el-table-column label="品质指标35%">
            <el-table-column prop="IndexName2"
                             label="指标名称"
                             width="130">
            </el-table-column>
            <el-table-column prop="Target_value2"
                             label="目标值"
                             width="80">
            </el-table-column>
            <el-table-column prop="Actual_completion_value2"
                             label="实际完成值"
                             width="90">
            </el-table-column>
            <el-table-column prop="danx2"
                             label="单项得分"
                             width="80">
            </el-table-column>
            <el-table-column prop="defen2"
                             label="得分小计"
                             width="80">
            </el-table-column>
            <el-table-column prop="DepartmentData2"
                             label="数据来源和提供部门"
                             width="140">
            </el-table-column>

        </el-table-column>

        <el-table-column label="月度流失率指标15%">
            <el-table-column prop="IndexName3"
                             label="指标名称"
                             width="130">
            </el-table-column>
            <el-table-column prop="Target_value3"
                             label="目标值"
                             width="80">
            </el-table-column>
            <el-table-column prop="Actual_completion_value3"
                             label="实际完成值"
                             width="90">
            </el-table-column>
            <el-table-column prop="danx3"
                             label="单项得分"
                             width="80">
            </el-table-column>
            <el-table-column prop="defen3"
                             label="得分小计"
                             width="80">
            </el-table-column>
            <el-table-column prop="DepartmentData3"
                             label="数据来源和提供部门"
                             width="140">
            </el-table-column>

        </el-table-column>
        <el-table-column label="7S评比指标15%">
            <el-table-column prop="IndexName4"
                             label="指标名称"
                             width="130">
            </el-table-column>
            <el-table-column prop="Target_value4"
                             label="目标值"
                             width="80">
            </el-table-column>
            <el-table-column prop="Actual_completion_value4"
                             label="实际完成值"
                             width="90">
            </el-table-column>
            <el-table-column prop="danx4"
                             label="单项得分"
                             width="80">
            </el-table-column>
            <el-table-column prop="defen4"
                             label="得分小计"
                             width="80">
            </el-table-column>
            <el-table-column prop="defen4"
                             label="数据来源和提供部门"
                             width="140">
            </el-table-column>

        </el-table-column>
        <el-table-column prop="total_points"
                         label="总得分"
                         width="100">
        </el-table-column>
        <el-table-column label="当月排名"
                         width="100">
            <template slot-scope="scope">
                <el-popover trigger="hover" placement="top">
                    <p>违纪: {{ scope.row.wj }}</p>
                    <p>出勤率: {{ scope.row.ccl }}</p>
                    <div slot="reference" class="name-wrapper">
                        {{ scope.row.PM }}
                    </div>
                </el-popover>
            </template>
        </el-table-column>
        <el-table-column prop="JF"
                         label="当月积分"
                         width="100">
            <template slot-scope="scope">
                <el-popover trigger="hover" placement="top">
                    <h4>积分管理</h4>
                    <p>各班组按总分的高低排序给予积分</p>
                    <p>第一名奖励10分，第二、三名奖励5分</p>
                    <p>第四、五名奖励2分，倒数第一名扣10分</p>
                    <p>倒数第二名扣5分，倒数第三名扣2分</p>
                    <div slot="reference" class="name-wrapper">
                        {{ scope.row.JF }}
                    </div>
                </el-popover>
            </template>
        </el-table-column>
        <el-table-column prop="name"
                         label="备注"
                         width="100">
        </el-table-column>

    </el-table>
    <div style="display:flex;justify-content:space-between;">
        <el-button size="small" type="primary" v-on:click="goback">返回</el-button>
        <div v-show="showBtnTop" class="">
            @using (Html.BeginForm("ExcelOutPut", "Personnel_Quality_objectives", FormMethod.Post))
            {
                <input id="yyy" value="" type="text" class="hidden" style="display:inline;width:150px;" name="year" />
                <input id="mmm" value="" type="text" class="hidden" style="display:inline;width:150px;" name="month" />
                <input type="submit" id="excelBtn" class="btn btn-success pull-right" value="导出Excel表" />
            }
        </div>
    </div>
</div>

<script>
    let app = new Vue({
        el: "#app",
        data: {
            tableData: [],
            times: null,
            tableData3: [],
            showBtnTop:false
        },
        methods: {
            indexMethod(index) {
                return index + 1;
            },
            compare(property) {
                return function (a, b) {
                    var value1 = a[property];
                    var value2 = b[property];
                    return value1 - value2;
                }
            },
            goback() {
                window, history.back();
            }
        },
        watch: {
            times() {
                if (this.times != null) {
                    this.tableData = [];
                    let year = new Date(this.times).getFullYear();
                    let month = new Date(this.times).getMonth() + 1;
                    axios.post("/Personnel_Quality_objectives/Excellent", { year, month }).then(res=> {
                        console.log(res.data)
                        if (res.data.length > 0) {
                            //let arr = res.data;
                            res.data.forEach(item=> {
                                item.DepartmentData1 = item.DepartmentData1.substring(0, item.DepartmentData1.length - 1);
                                item.DepartmentData2 = item.DepartmentData2.substring(0, item.DepartmentData2.length - 1);
                                item.DepartmentData3 = item.DepartmentData3.substring(0, item.DepartmentData3.length - 1);
                                item.DepartmentData4 = item.DepartmentData4.substring(0, item.DepartmentData4.length - 1);
                                item.ccl = item.ccl * 100 + "%"

                            })
                            console.log(res.data)
                            this.tableData = res.data
                            this.$message({
                                message: "获取数据成功！",
                                type: "success"
                            });
                            this.showBtnTop = true;
                            $("#yyy").val(year);
                            $("#mmm").val(month);
                        } else {
                            this.showBtnTop = false;
                            this.$message({
                                message: "本月无数据！",
                                type: "warning"
                            })
                        }

                    }).catch(err=> {
                        this.$message({
                            message: "连接失败！",
                            type: "warning"
                        })
                    })
                } else {
                    this.showBtnTop = false;
                    this.tableData = [];
                }
            }
        }
    });



</script>
