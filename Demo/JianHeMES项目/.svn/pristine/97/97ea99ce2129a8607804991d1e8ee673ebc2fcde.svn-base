@{
    ViewBag.Title = "打印测试";
}
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/printJS/JsBarcode.all.min.js"></script>
<script src="~/Scripts/printJS/html2canvas.min.js"></script>
<script src="~/Scripts/axios.min.js"></script>
@*<link href="~/Content/styleFile/printStyle.css" rel="stylesheet" />*@
<style>
    /*全局样式*/
    *, body {
        margin: 0;
        padding: 0;
    }

    #app {
        padding: 50px 0 0;
    }

    .el-input {
        max-width: 280px;
    }

    [v-cloak] {
        display: none;
    }

    .textCenter {
        text-align: center;
    }

    /*内箱条码样式*/
    #innerBarcode {
        width: 250px;
    }

    .mozhu {
        font-size: 88px;
        line-height: 58px;
    }

    #innerCarton {
        margin: 15px auto 10px;
        padding: 20px 0 10px;
        max-width: 400px
    }


    /*外箱条码样式*/
    #masterCarton {
        margin: 20px 0 10px;
        padding: 5px;
    }

    #masterBarcode {
        width: 240px;
    }

    .mcFrame {
        margin: 0 auto;
        width: 308px;
        height: 484px;
        border: 1px solid #000;
    }

    .mcFrame_top, .mcFrame_bottom {
        height: 240px;
    }

        .mcFrame_top > div {
            height: 80px;
        }


    .mcFrame_top_1 {
        position: relative;
    }

    .imgicon {
        position: absolute;
        width: 110px;
        top: 5px;
        left: 5px;
    }

    .mcFrame_top_1_h {
        margin: 0;
        padding-top: 35px;
        text-align: center;
    }

    .mcFrame_top_1_h_noimg {
        margin: 0;
        padding-top: 25px;
        text-align: center;
    }

    .mcFrame_top_3_1_1, .mcFrame_top_3_1_2 {
        display: inline-block;
        line-height: 38px;
        text-align: center;
    }

    .mcFrame_top_3_1_1 {
        width: 73px;
        font-size: 15px;
    }

        .mcFrame_top_3_1_1 > span {
            font-weight: 600;
        }

    .mcFrame_top_3_1_2 {
        width: 227px;
        font-size: 20px;
    }

    .mcFrame_top_3_1_1:not(:last-child) {
        border-right: 1px solid #000;
    }

    .borderTop {
        border-top: 1px solid #000;
    }

    .mcFrame_bottom_1 {
        /*width: 100%;
    height: 100%;*/
        padding: 5px;
        text-align: left;
    }

    .mcFrame_top_2 {
        position: relative;
    }

    .masterBarDiv {
        width: 100%;
        position: absolute;
        top: -3px;
    }

    .boxspan {
        display: inline-block;
        padding: 2px 8px;
        font-size: 19px;
    }

    .font20md {
        font-size: 20px;
    }

    .font20xs {
        font-size: 27px;
        padding: 0px 8px;
    }
</style>
<div id="app" v-cloak>
    <el-container>
        <el-main>
            <el-col :span="12">
                <div class="grid-content textCenter">
                    <el-row>
                        <span>模组：</span>
                        <el-input placeholder="请输入模组号"
                                  v-model.trim="printMozhu"
                                  style="text-align:right;display:inline-block;"
                                  clearable>
                        </el-input>
                    </el-row>
                    <el-row>
                        <span>条码：</span>
                        <el-input placeholder="请输入条码号"
                                  v-model.trim="innerVal"
                                  style="text-align:right;display:inline-block;"
                                  onKeyUp="value=value.replace(/[^A-Za-z0-9]/g, '')"
                                  clearable>
                        </el-input>
                    </el-row>
                    <el-row>
                        <div id="innerCarton">
                            <div class="textCenter">
                                <b class="mozhu">{{printMozhu}}</b>
                                <div class="innerBarDiv">
                                    <svg id="innerBarcode"></svg>
                                </div>
                                @*<svg id="innerBarcode"></svg>
                                    <canvas id="innerBarcode"></canvas>
                                    <img id="innerBarcode" />*@
                            </div>
                        </div>
                    </el-row>
                    <el-row>
                        <el-button v-on:click="innerPrint" type="primary">打印pdf</el-button>
                        @*<el-button v-on:click="innerImg" type="primary">上传img截图</el-button>*@
                        <el-button v-on:click="innerText" type="primary">发送条码模组号</el-button>
                    </el-row>
                </div>
            </el-col>
            <el-col :span="12">
                <div class="grid-content textCenter">
                    <el-row>
                        <span>订单：</span>
                        <el-input placeholder="请输入订单号"
                                  v-model.trim="printOrder"
                                  style="text-align:right;display:inline-block;"
                                  clearable>
                        </el-input>
                    </el-row>
                    <el-row>
                        <span>条码：</span>
                        <el-input placeholder="请输入条码号"
                                  v-model.trim="masterVal"
                                  style="text-align:right;display:inline-block;"
                                  clearable>
                        </el-input>
                    </el-row>
                    <el-row>
                        <div id="masterCarton">
                            <div class="mcFrame">
                                <div class="mcFrame_top">
                                    <div class="mcFrame_top_1">
                                        <img v-show="imgShow" class="imgicon" src="~/Images/LOGO.jpg" />
                                        <h1 v-show="imgShow" class="mcFrame_top_1_h">{{selectVal}}</h1>
                                        <h1 v-show="!imgShow" class="mcFrame_top_1_h_noimg">{{selectVal}}</h1>
                                    </div>
                                    <div class="borderTop mcFrame_top_2">
                                        <div class="masterBarDiv textCenter">
                                            <svg id="masterBarcode"></svg>
                                            @*<svg id="masterBarcode"></svg>
                                                <canvas id="masterBarcode"></canvas>
                                                <img id="masterBarcode" />*@
                                        </div>
                                    </div>
                                    <div class="borderTop mcFrame_top_3">
                                        <div class="mcFrame_top_3_1">
                                            <div class="mcFrame_top_3_1_1">物料描述</div>
                                            <div class="mcFrame_top_3_1_2">{{wuliao}}</div>
                                        </div>
                                        <div class="borderTop mcFrame_top_3_1">
                                            <div class="mcFrame_top_3_1_1"><span>(SN/TN)</span></div>
                                            <div class="mcFrame_top_3_1_1" style="border-right:none;"><span>{{sntn}}</span></div>
                                            <div class="mcFrame_top_3_1_1" style="border-left:1px solid #000;">数量 <span>QTY</span></div>
                                            <div class="mcFrame_top_3_1_1"><span>{{shuliang}}&nbsp;PCS</span></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mcFrame_bottom borderTop">
                                    <div class="mcFrame_bottom_1">
                                        <template v-for="item in mozutable">
                                            <span class="boxspan" v-bind:class="mozutable>20?'font20md':'font20xs'">A-<span v-if="item<10">0</span>{{item}}</span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </el-row>
                    <el-row>
                        <el-button v-on:click="masterPrint" type="primary">打印pdf</el-button>
                        @*<el-button v-on:click="masterImg" type="primary">上传img截图</el-button>*@
                    </el-row>
                </div>
            </el-col>
            <el-col :span="24" class="text-center">
                <el-row>
                    <div id="capture" style="padding:10px; background: #f5da55">
                        <h3 style="color: #000; ">截图区</h3>
                    </div>
                    <div id="cc">
                        <img id="dd" />
                    </div>
                </el-row>
            </el-col>
        </el-main>
    </el-container>
</div>
<script>
    var app = new Vue({
        el: "#app",
        data: {
            innerVal: "18AA77701A00008",
            masterVal: "19YA2091-001",
            printMozhu: "1-A08",
            printOrder: "2019-YY012-01",
            selectVal: '2019-YA209-1',
            imgShow: true,
            mozutable: 20,
            wuliao: "LED模组",
            sntn: "1/12",
            shuliang: "12",
        },
        watch: {
            innerVal: (val) => {
                if (val != "") {
                    app.setinnerBarDiv(val);
                } else {
                    $(".innerBarDiv").html('<svg id="innerBarcode"></svg>');
                };
            },
            masterVal: (val) => {
                if (val != "") {
                    app.setmasterBarDiv(val);
                } else {
                    $(".masterBarDiv").html('<svg id="masterBarcode"></svg>');
                };
            },
        },
        mounted: function () {
            this.setinnerBarDiv(this.innerVal);
            this.setmasterBarDiv(this.masterVal);
        },
        methods: {
            innerPrint: () => {
                app.testinnerPrint();
            },
            masterPrint: () => {
                app.testmasterPrint();
            },
            setinnerBarDiv: (v) => {
                JsBarcode("#innerBarcode", v.toUpperCase(), {
                    height: 60, //条形码的高度
                    fontOptions: "bold",//使文字加粗体或变斜体
                    format: "CODE128",
                    font: "monospace",
                    textAlign: "center",
                    textMargin: 0,//设置条形码和文本之间的间距
                    fontSize: 42,//设置文本的大小
                    lineColor: "#000",//条形码颜色
                    margin: 0,//设置条形码周围的空白边距
                    marginTop: 0
                });
            },
            setmasterBarDiv: (v) => {
                JsBarcode("#masterBarcode", v.toUpperCase(), {
                    height: 60, //条形码的高度
                    //fontOptions: "bold",//使文字加粗体或变斜体
                    format: "CODE128",
                    font: "monospace",
                    textAlign: "center",
                    textMargin: 0,//设置条形码和文本之间的间距
                    fontSize: 26,//设置文本的大小
                    lineColor: "#000",//条形码颜色
                    margin: 0,//设置条形码周围的空白边距
                    marginTop: 0
                });
            },
            testinnerPrint: () => {
                //判断iframe是否存在，不存在则创建iframe
                var iframe = document.getElementById("innerprint-iframe");
                if (!iframe) {
                    var el = document.getElementById("innerCarton");
                    iframe = document.createElement('IFRAME');
                    var doc = null;
                    iframe.setAttribute("id", "innerprint-iframe");
                    iframe.setAttribute('style', 'position:absolute;width:240px;height:120px;left:000px;top:100px;');
                    document.body.appendChild(iframe);
                    doc = iframe.contentWindow.document;
                    //这里可以自定义样式
                    doc.write("<link href='/Content/styleFile/printStyle.css?" + Math.random() + "' rel='stylesheet' />");
                    doc.write('<div>' + el.innerHTML + '</div>');
                    doc.close();
                    iframe.contentWindow.focus();
                };
                iframe.onload = function () {
                    iframe.contentWindow.print();
                    document.body.removeChild(iframe);
                };
            },
            testmasterPrint: () => {
                //判断iframe是否存在，不存在则创建iframe
                var iframe = document.getElementById("masterprint-iframe");
                if (!iframe) {
                    var el = document.getElementById("masterCarton");
                    iframe = document.createElement('IFRAME');
                    var doc = null;
                    iframe.setAttribute("id", "masterprint-iframe");
                    iframe.setAttribute('style', 'position:absolute;width:360px;height:480px;left:000px;top:100px;');
                    document.body.appendChild(iframe);
                    doc = iframe.contentWindow.document;
                    //这里可以自定义样式
                    doc.write("<link href='/Content/styleFile/printStyle.css?" + Math.random() + "' rel='stylesheet' />");
                    doc.write('<div>' + el.innerHTML + '</div>');
                    doc.close();
                    iframe.contentWindow.focus();
                };
                iframe.onload = function () {
                    iframe.contentWindow.print();
                    document.body.removeChild(iframe);
                };
            },
            innerImg: () => {
                html2canvas(document.getElementById("innerCarton"), {
                    onrendered: function (canvas) {
                        let url = canvas.toDataURL();//图片地址
                        axios.post('/Test/printTest', { data: url }).then(res => {
                            console.log(res)
                        }).catch(err => {
                            console.warn("获取选择列表失败")
                        });
                        //document.getElementById("cc").appendChild(canvas);
                        document.getElementById("dd").setAttribute("src", url)
                    },
                    allowTaint: true,
                    useCORS: true,
                    //width: 600,
                    //height: 300
                });
            },
            innerText: () => {
                axios.post('/Test/printTest', {
                    barcode: app.innerVal,
                    modulenum: app.printMozhu
                }).then(res => {
                    console.log(res)
                }).catch(err => {
                    console.warn("获取选择列表失败")
                });
            },
            masterImg: () => {
                html2canvas(document.getElementById("masterCarton"), {
                    allowTaint: true,
                    useCORS: true,
                }).then(canvas => {
                    let url = canvas.toDataURL();//图片地址
                    axios.post('/Test/printTest', { data: url }).then(res => {
                        console.log(res)
                    }).catch(err => {
                        console.warn("获取选择列表失败")
                    });
                    //document.getElementById("cc").appendChild(canvas);
                    document.getElementById("dd").setAttribute("src", url)
                });
            }
        },
    });
</script>