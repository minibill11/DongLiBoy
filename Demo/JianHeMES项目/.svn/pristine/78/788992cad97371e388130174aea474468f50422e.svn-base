
<script type="text/template" id="Version_Management_Component">
    <el-row>
        <el-row class="table-top">
            <div class="table-top-left">
                <el-row class="header-input">
                    版本号：<el-input v-model="versionNum" size="small"></el-input>
                    日期范围：<el-date-picker v-model="dateRange"
                                         type="daterange"
                                         size="small"
                                         range-separator="至"
                                         start-placeholder="开始日期"
                                         end-placeholder="结束日期"></el-date-picker>
                    &nbsp;<el-button type="primary" size="small" @@click="SelectVersion">查询</el-button>
                </el-row>
            </div>
            <div class="table-top-right">
                <el-button type="primary" @@click="showChange" size="small" plain>版本录入</el-button>
            </div>
        </el-row>
        <el-row class="table-mid">
            <el-table :data="tableList"
                      row-class-name="zero-padding"
                      max-height="600"
                      size="small"
                      stripe
                      border>
                <el-table-column type="index" label="序号"></el-table-column>
                <el-table-column prop="MESVersion" label="版本号"></el-table-column>
                <el-table-column prop="UpdateMesArray" label="更新内容">
                    <template slot-scope="scope">
                        <ul v-for="i in scope.row.UpdateMesArray">
                            <li>{{i.Section}}</li>
                            <li>{{i.UpdateMes}}</li>
                        </ul>
                    </template>
                </el-table-column>
                <el-table-column prop="UpdateTime" label="更新日期"></el-table-column>
                <el-table-column label="操作">
                    <template slot-scope="scope">
                        <el-button @@click="GetNewVersion(scope.row)" type="danger" size="small" plain>变为新版</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </el-row>
    </el-row>
</script>
<script>
    Vue.component('version-management-component', {
        template: document.getElementById("Version_Management_Component"),
        data: function () {
            return {
                dateRange: null,
                versionNum: '',
                tableList: [],
            }
        },
        methods: {
            SelectVersion() {
                let st = null, et = null;
                if (this.dateRange != null) {
                    st = this.dateRange[0];
                    et = this.dateRange[1];
                };
                axios.post('/VersionManagement/SelectVersion', { version: this.versionNum, startTime: st, endTime: et }).then(res => {
                    this.tableList = res.data;
                });
            },
            GetNewVersion(row) {
                axios.post('/VersionManagement/GetNewVersion', { newVersion: row.MESVersion }).then(res => {
                    if (res.data.pass === true) {
                        this.$message.success(res.data.mes);
                    } else {
                        this.$message.error("更改版本失败");
                    };
                }).catch(err => {
                });
            },
            showChange() {
                vm.mainLoading = true;
                setTimeout(() => {
                    this.tableList = [];
                    this.versionNum = '';
                    this.dateRange = null;
                    this.$emit("input", false);
                    vm.mainLoading = false;
                }, 300);
            },
        },
    });
</script>