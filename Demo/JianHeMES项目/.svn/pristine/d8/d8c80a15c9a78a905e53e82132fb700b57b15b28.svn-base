@model IEnumerable<JianHeMES.Models.Small_Sample>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/styleFile/packaging/index.css" rel="stylesheet" />
<script src="~/Content/styleFile/packaging/index.js"></script>
<script src="~/Scripts/axios.min.js"></script>
<style>
    .searchContainer{
        /*display:flex;
        justify-content:space-around;*/
        text-align:center;
    }
    .el-input{
        width:209px !important;
    }

    .bottomContainer{
        display:flex;
        justify-content:center;
        margin-top:15px;
    }
    table>thead>tr>th,table>tbody>tr>td{
        text-align:center!important;
    }
</style>
<h2>Index</h2>

<p>
    @Html.ActionLink("新建小样报告", "Create")
    @Html.ActionLink("小样相关参数", "Small_Sample_Arguments")
</p>

<div id="app">
    <div class="searchContainer">
        <el-input placeholder="请输入内容"
                  v-model="customerName"
                  size="small"
                  clearable>
        </el-input>
        <el-select v-model="orderNum" size="small" filterable clearable placeholder="请选择">
            <el-option v-for="item in options"
                       v-bind:key="item.value"
                       v-bind:label="item.label"
                       v-bind:value="item.value">
            </el-option>
        </el-select>
        <el-input placeholder="请输入内容"
                  size="small"
                  v-model="mo1"
                  clearable>
        </el-input>
        <el-input placeholder="请输入内容"
                  size="small"
                  v-model="mo2"
                  clearable>
        </el-input>
        <el-button id="searchinfos" size="small" type="success" v-on:click="searchInfos">查询</el-button>
    </div>
    <div class="bottomContainer">
        <div style="width:71%">
            <el-table v-bind:data="tableData"
                      border
                      style="width: 100%">
                <el-table-column prop="Customer"
                                 label="客户"
                                 width="125">
                </el-table-column>
                <el-table-column prop="OrderNumber"
                                 label="订单号"
                                 width="180">
                </el-table-column>
                <el-table-column prop="Mo1"
                                 width="120"
                                 label="规格型号">
                </el-table-column>
                <el-table-column prop="Mo2"
                                 width="120"
                                 label="模块型号">
                </el-table-column>
                <el-table-column prop="ReportDate"
                                 width="180"
                                 label="报告时间">
                </el-table-column>
                <el-table-column prop=""
                                 width="83"
                                 label="地址">
                    <template slot-scope="scope">
                        <el-button size="small" type="primary" v-on:click="goDisplay(scope.row)">详细</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
    </div>
</div>

<script>
    let app = new Vue({
        el: "#app",
        data: {
            customerName: null,
            mo1: null,
            mo2: null,
            orderNum: null,
            options: [],
            tableData: []
        }, methods: {
            searchInfos() {
                
                if (this.customerName != null || this.orderNum != null || this.mo1 != null || this.mo2 != null) {
                    axios.post("/Small_Sample/Index", { customer: this.customerName, ordernum: this.orderNum, mo1: this.mo1, mo2: this.mo2 }).then(res=> {
                        console.log(res.data);
                        if (res.data.length > 0) {
                            let tt = res.data;
                            tt.forEach(item=> {
                                let dd = new Date(item.ReportDate);
                                let year = dd.getFullYear();
                                let month = dd.getMonth() + 1;
                                let days = dd.getDay();
                                item.ReportDate = `${year}年${month}月${days}日`
                            })
                            this.tableData = res.data
                        } else {
                            this.$message({
                                message: "无对应数据",
                                type: "warning"
                            })
                        }
                    }).catch(err=> {
                        this.$message({
                            message: "连接失败",
                            type: "warning"
                        })
                    })
                } else {
                    this.$message({
                        message: "请输入需要查询的内容",
                        type: "warning"
                    });
                }
            },
            getOrderList() {
                axios.post("/Commonality/GetOrderNumListJSON").then(res=> {
                    for (let item in res.data) {
                        let obj = { label: res.data[item], value: res.data[item] }
                        this.options.push(obj)
                    }
                }).catch(err=> {
                    alert("clicked!")
                    this.$message({
                        message: "连接失败",
                        type: "warning"
                    })
                })
            },
            goDisplay(item) {
                window.location.href = "http://localhost:18863/Small_Sample/Display?" + "id=" + item.Id;
            }
        },
        mounted() {
            this.getOrderList();
        }
    });
    document.onkeydown = function (event) {
        var e = event || window.event;    // 兼容IE
        if (e && e.keyCode == 13) { //回车键的键值为13
            $("#searchinfos").click();
        }
    };
</script>

