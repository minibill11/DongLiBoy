@{
    ViewBag.Title = "录入包装箱基本信息";
}
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/axios.min.js"></script>
<style>
    * {
        margin: 0;
        padding: 0;
    }

    [v-cloak] {
        display: none;
    }

    .el-header {
        height: auto !important;
        padding: 0;
    }

    .el-main {
        min-height: 600px;
        padding: 20px 0 0;
    }

    .el-input {
        width: auto;
    }

    .mesDiv {
        padding: 5px 0;
        /*border: 1px solid #ccc;*/
    }

    .mesDiv_div {
        display: inline-block;
    }
</style>

<div id="app" v-cloak>
    <el-container>
        <el-header>
            <h2 class="text-center">@ViewBag.Title</h2>
            <a href="/Packagings/inputPackaging"><el-button size="small">录入包装箱基本信息</el-button></a>
            <a href="/Packagings/insidePrint"><el-button size="small">内箱标签打印</el-button></a>
            <a href="/Packagings/insideConfirm"><el-button size="small">内箱装箱确认</el-button></a>
            <a href="/Packagings/outsideBinningPrint"><el-button size="small">外箱(重新)装箱和标签打印</el-button></a>
            <a href="/Packagings/outsideConfirm"><el-button size="small">外箱装箱确认</el-button></a>
            <a href="/Packagings/inStockConfirm"><el-button size="small">外箱入库确认</el-button></a>
            <a href="/Packagings/PingZhioutStockConfirm"><el-button size="small">品质外箱入库确认</el-button></a>
            <a href="/Packagings/stockNumEdit"><el-button size="small">外箱库位号修改</el-button></a>
            <a href="/Packagings/outStockConfirm"><el-button size="small">外箱出库确认</el-button></a>
        </el-header>
        <el-main>
            <div class="text-center" style="width:700px;margin:0 auto;">
                <div class="text-left" style="padding-left:38px;">
                    订单号：
                    <el-select v-model="selectVal" placeholder="输入内容可查询" filterable clearable size="medium">
                        <el-option v-for="item in selectOptions"
                                   :key="item.value"
                                   :value="item.value">
                        </el-option>
                    </el-select>
                </div>
                <div style="margin:10px 0;">
                    <div v-for="(item,index) in rowCount" :key="item">
                        <div class="mesDiv">
                            <div class="mesDiv_div">包装箱类型：<el-input placeholder="请输入内容" v-model="typeVal[index]" clearable size="mini"></el-input></div>
                            <div class="mesDiv_div">每箱件数：<el-input-number size="mini" :min="0" v-model="quantity1[index]"></el-input-number></div>
                            <div class="mesDiv_div">包装箱数量：<el-input-number size="mini" :min="0" v-model="quantity2[index]"></el-input-number></div>
                        </div>
                    </div>
                </div>
                <div>
                    <el-button size="medium" @@click="rowCount++;typeVal.push('');quantity1.push(0);quantity2.push(0)">添加行</el-button>
                    <el-button size="medium" @@click="reset">重置</el-button>
                    <el-button size="medium" @@click="postSubmit">提交</el-button>
                </div>
            </div>

        </el-main>
    </el-container>
</div>
@{var UserName = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).UserName;}

<script>
    var app = new Vue({
        el: "#app",
        data: {
            rowCount: 6,
            selectOptions: [],
            selectVal: '',
            typeVal: new Array(6).fill(""),
            quantity1: new Array(6).fill(0),
            quantity2: new Array(6).fill(0),
            userName: "@UserName",
        },
        methods: {
            postSubmit: function () {
                let mesDivData = this.typeVal,
                    order = this.selectVal,
                    mesDivNum1 = this.quantity1,
                    mesDivNum2 = this.quantity2,
                    user = this.userName,
                    packinginfo = [],
                    oknum=0;
                for (let i in mesDivData) {
                    if (mesDivData[i] != "") {
                        packinginfo.push({
                            OrderNum: order,
                            Type: mesDivData[i],
                            OuterBoxCapacity: mesDivNum1[i],
                            Quantity: mesDivNum2[i],
                            Creator: user,
                            CreateDate: new Date(),
                            Remark: "",
                        });
                        oknum++;
                    };
                };
                if (order != "") {
                    if (oknum != 0) {
                        axios.post('/Packagings/CreatePacking', packinginfo).then(res => {
                            if (res.data == "ok") {
                                this.$alert('录入成功！', {
                                    confirmButtonText: '确定',
                                    closeOnClickModal: true,
                                    closeOnPressEscape: true,
                                    type: "success",
                                    callback: () => {
                                        this.reset();
                                    }
                                });
                            } else {
                                this.$alert('录入失败！', {
                                    confirmButtonText: '确定',
                                    type: "error",
                                });
                            };
                        }).catch(err => {
                            this.$alert('录入失败！', {
                                confirmButtonText: '确定',
                                type: "error",
                            });
                        });
                    } else {
                        this.$message({
                            showClose: true,
                            message: '包装箱类型不能全为空',
                            type: 'error'
                        });
                    };
                } else {
                    this.$message({
                        showClose: true,
                        message: '订单号不能为空',
                        type: 'error'
                    });
                };
            },
            reset: function () {
                this.rowCount = 6;
                this.typeVal = new Array(6).fill('');
                this.quantity1 = new Array(6).fill(0);
                this.quantity2 = new Array(6).fill(0);
            }
        },
        created: function () {
            axios.post('/Packagings/GetOrderList').then(rer => {
                this.selectOptions = rer.data;
            }).catch(err => {
                console.warn("获取选择列表失败")
            });
        },
        mounted: function () {
            let localOrder = localStorage.getItem('Order');
            if (localOrder != null) {
                this.selectVal = localOrder;
            };
        },
        watch: {
            selectVal: function (v) {
                localStorage.setItem('Order', v);
            },
        },
    });
</script>