@{
    ViewBag.Title = "打印条码测试";
    Layout = "~/Views/Shared/_Layout2.cshtml";
}
@* css放置处 *@
@section cssStyle {

}

<div id="app">
    <el-button @@click="CreateOneFormPage" type="primary" size="small">打印条形码</el-button>
    @*<canvas id="barcode"></canvas>*@
    <div id="printArea">
        <div v-for="(item,index) in codelist">
            <div>
                <div>{{item.num}}</div>
                <img :id="item.id" />
                @*<canvas :id="item.id"></canvas>*@
                <div>{{item.str}}</div>
            </div>
        </div>
    </div>
</div>
@* 分部页放置处 *@
@section renderPage {
}
@* js放置处 *@
@section jsScript {
    <script src="~/Scripts/printJS/jquery-2.1.0.js"></script>
    <script src="~/Scripts/printJS/jquery.PrintArea.js"></script>
    <script src="~/Scripts/printJS/jquery-barcode.min.js"></script>
    <script src="~/Scripts/printJS/JsBarcode.all.min.js"></script>
    <script src="~/Scripts/printJS/LodopFuncs.js"></script>
    <script>
        const app = {
            data: function () {
                return {
                    codelist: [
                        {
                            id: 'barcode0',
                            proportion: '1:1',
                            num: "220050180-200710-00001",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode1',
                            proportion: '1:1',
                            num: "220050180-200710-00002",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode2',
                            proportion: '1:1',
                            num: "220050180-200710-00003",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode3',
                            proportion: '1:1',
                            num: "220050180-200710-00004",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode4',
                            proportion: '1:1',
                            num: "220050180-200710-00005",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode5',
                            proportion: '1:1',
                            num: "220050180-200710-00006",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode6',
                            proportion: '1:1',
                            num: "220050180-200710-00001",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode7',
                            proportion: '1:1',
                            num: "220050180-200710-00002",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode8',
                            proportion: '1:1',
                            num: "220050180-200710-00003",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode9',
                            proportion: '1:1',
                            num: "220050180-200710-00004",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode10',
                            proportion: '1:1',
                            num: "220050180-200710-00005",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }, {
                            id: 'barcode11',
                            proportion: '1:1',
                            num: "220050180-200710-00006",
                            str: "联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件",
                        }
                    ]
                }
            },
            created: function () {
            },
            mounted: function () {
                this.initData();

            },
            //函数方法
            methods: {
                //生成数据
                initData() {
                    //for (let i = 0; i < 5; i++) {
                    //    let obj = {
                    //        id: 'barcode' + i,
                    //        proportion: '1:1',
                    //        num: '220050180-200710-0000' + i,
                    //        str:'联建视频控制器，LCTRL1600.内含某某控制器嵌入式软件'
                    //    }
                    //    this.codelist.push(obj);
                    //}
                    this.codelist.forEach(item => {
                        JsBarcode(`#${item.id}`, item.num, {
                            format: "CODE128",
                            width: 2,
                            height: 40,
                            displayValue: false
                        });
                    })
                },
                onPrint() {
                    //this.codelist.forEach(item => {
                    //    JsBarcode(`#${item.id}`, item.num, {
                    //        format: "CODE128",
                    //        width: 2,
                    //        height: 40,
                    //        displayValue: false
                    //    });
                    //})
                    $("div#printArea").attr("style", "display:block");
                    $("div#printArea").printArea();

                    $("div#printArea").attr("style", "display:none");

                },
                prn1_preview() {
                    this.CreateOneFormPage();
                    LODOP.PREVIEW();
                },
                prn1_print() {
                    this.CreateOneFormPage();
                    LODOP.PRINT();
                },
                CreateOneFormPage() {
                     let LODOP = getLodop();
                    LODOP.PRINT_INIT("");//初始化在循环外
                    LODOP.SET_PRINT_PAGESIZE(1, 300, 500, "");
                    let codelist = this.codelist;
                    let arr = [];
                    this.codelist.forEach(item => {
                        let html = `<div>${item.num}</div><img :id="${item.id}" /><div>${item.str}</div>`;
                        JsBarcode(`#${item.id}`, item.num, {
                            format: "CODE128",
                            width: 2,
                            height: 40,
                            displayValue: false
                        });
                        arr.push(html);
                    })
                    for (i = 0; i < codelist.length; i++) {
                        LODOP.NewPage();
                        //let html = `<div>${codelist[i].num}</div><img :id="${codelist[i].id}" /><div>${codelist[i].str}</div>`;
                        //JsBarcode(`#${codelist[i].id}`, codelist[i].num, {
                        //    format: "CODE128",
                        //    width: 2,
                        //    height: 40,
                        //    displayValue: false
                        //});
                        LODOP.ADD_PRINT_TEXT(75, 6, 100, 20, arr[i]);
                    }
                    LODOP.PREVIEW();

                }
            }
        };
    </script>
}