@{
    ViewBag.Title = "设备维修履历汇总";
    Layout = "~/Views/Shared/_Layout2.cshtml";
}

@* css放置处 *@
@section cssStyle {
    <link rel="stylesheet/less" type="text/css" href="~/Content/Equipment/equipment_index.less" />
    <style>
        .btn-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px;
        }

        .tabletop {
            width: 100%;
            font-size: 14px;
            border: 1px solid #c9d3dd;
            border-bottom: none;
        }

            .tabletop th, .tabletop td {
                border: 1px solid #c9d3dd;
            }

            .tabletop th {
                width: 10%;
            }

            .tabletop td {
                padding: 8px;
                width: 12%;
            }

            .tabletop .table-title {
                font-size: 16px;
                padding: 8px;
                background-color: #e4ecf7;
            }
    </style>
}
<el-container id="app" v-cloak>
    <el-header class="text-center">
        @*标题*@
        <div class="eq-title">设备维修履历汇总</div>
    </el-header>
    <el-main class="main-box">
        <div class="btn-box">
            <span>
                <el-button type="primary" size="mini" plain v-on:click="onToTurn(0)">关键元器件清单</el-button>
                <el-button type="primary" size="mini" plain v-on:click="onToTurn(1)">安全库存清单</el-button>
            </span>
            <el-button type="primary" size="mini" v-on:click="onEdit">{{isEdit?'保存':'编辑'}}</el-button>
        </div>
        <table class="tabletop" border="1">
            <thead>
                <tr>
                    <th colspan="7">
                        <div class="table-title"> '  ' 设备保养、维修履历资料汇总表</div>

                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>设备名称：</th>
                    <td colspan="3">
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  v-model="tableTopData.EquipmentName">
                        </el-input>
                        <span v-else>{{tableTopData.EquipmentName}}</span>
                    </td>
                    <th>设备状态：</th>
                    <td>
                        <el-select v-if="isEdit" size="mini" v-model="tableTopData.Status" placeholder="请选择...">
                            <el-option v-for="item in status_options"
                                       :key="item.value"
                                       :label="item.label"
                                       :value="item.value">
                            </el-option>
                        </el-select>
                        <span v-else>{{tableTopData.Status}}</span>
                    </td>
                    <td rowspan="5" style="width:600px;">hhh</td>
                </tr>
                <tr>
                    <th>资产编号：</th>
                    <td>
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  v-model="tableTopData.AssetNumber">
                        </el-input>
                        <span v-else>{{tableTopData.AssetNumber}}</span>
                    </td>
                    <th>使用部门：</th>
                    <td>
                        <el-select v-if="isEdit" size="mini" v-model="tableTopData.UserDepartment" placeholder="请选择...">
                            <el-option v-for="item in department_options"
                                       :key="item.value"
                                       :label="item.label"
                                       :value="item.value">
                            </el-option>
                        </el-select>
                        <span v-else>{{tableTopData.UserDepartment}}</span>
                    </td>
                    <th>设备编号：</th>
                    <td>
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  disabled
                                  v-model="tableTopData.EquipmentNumber">
                        </el-input>
                        <span v-else>{{tableTopData.EquipmentNumber}}</span>
                    </td>
                </tr>
                <tr>
                    <th>型号规格：</th>
                    <td>
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  v-model="tableTopData.ModelSpecification">
                        </el-input>
                        <span v-else>{{tableTopData.ModelSpecification}}</span>
                    </td>
                    <th>出厂编号：</th>
                    <td>
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  v-model="tableTopData.ManufacturingNumber">
                        </el-input>
                        <span v-else>{{tableTopData.ManufacturingNumber}}</span>
                    </td>
                    <th>生产厂家：</th>
                    <td>
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  v-model="tableTopData.Brand">
                        </el-input>
                        <span v-else>{{tableTopData.Brand}}</span>
                    </td>
                </tr>
                <tr>
                    <th>供应商：</th>
                    <td>
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  v-model="tableTopData.Supplier">
                        </el-input>
                        <span v-else>{{tableTopData.Supplier}}</span>
                    </td>
                    <th>购入日期：</th>
                    <td>
                        <el-date-picker v-if="isEdit" size="mini" v-model="tableTopData.PurchaseDate"
                                        type="date"
                                        placeholder="选择日期...">
                        </el-date-picker>
                        <span v-else>{{tableTopData.PurchaseDate}}</span>
                    </td>
                    <th>启用日期：</th>
                    <td>
                        <el-date-picker v-if="isEdit" size="mini" v-model="tableTopData.ActionDate"
                                        type="date"
                                        placeholder="选择日期...">
                        </el-date-picker>
                        <span v-else>{{tableTopData.ActionDate}}</span>
                    </td>
                </tr>
                <tr>
                    <th>存放地点：</th>
                    <td>
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  v-model="tableTopData.StoragePlace">
                        </el-input>
                        <span v-else>{{tableTopData.StoragePlace}}</span>
                    </td>
                    <th>备注：</th>
                    <td colspan="3">
                        <el-input v-if="isEdit" size="mini"
                                  placeholder="请输入..."
                                  v-model="tableTopData.Remark">
                        </el-input>
                        <span v-else>{{tableTopData.Remark}}</span>
                    </td>
                </tr>
                <tr>
                    <th colspan="7">
                        <div class=""> 设备维修记录</div>

                    </th>
                </tr>
                <tr>
                    <th colspan="7">
                        <div class=""> 设备维修记录</div>

                    </th>
                </tr>
            </tbody>
        </table>
        <el-table v-bind:data="tableData"
                  size="small"
                  max-height="600"
                  style="width: 100%" border stripe>
            <el-table-column prop="index" label="序号" width="50">
            </el-table-column>
            <el-table-column prop="EquipmentNumber"
                             label="故障现象描述"
                             sortable
                             width="180">
            </el-table-column>
            <el-table-column prop="EquipmentName"
                             label="原因分析"
                             sortable
                             width="180">
            </el-table-column>
            <el-table-column prop="FaultTime"
                             label="维修或检测内容">
            </el-table-column>
            <el-table-column prop="Emergency"
                             label="接单时间">
            </el-table-column>
            <el-table-column prop="FauDescription"
                             label="计划完成时间">
            </el-table-column>
            <el-table-column prop="RepairProblem"
                             label="实际完成时间">
            </el-table-column>
            <el-table-column prop="FauDescription"
                             label="维修人">
            </el-table-column>
            <el-table-column prop="RepairProblem"
                             label="备注">
            </el-table-column>
            <el-table-column label="操作">
                <template slot-scope="scope">
                    <el-button type="text" size="mini" v-on:click="onModify(scope.row)" style="text-decoration:underline;">修改</el-button>
                </template>
            </el-table-column>
        </el-table>
    </el-main>
</el-container>
@* 分部页放置处 *@
@section renderPage {
}
@* js放置处 *@
@section jsScript {
    <script>
        const app = {
            data: {
                isEdit: true,
                tableTopData: {},
                status_options: [
                    {
                        laber: '运行',
                        value: '运行'
                    }, {
                        laber: '正常',
                        value: '正常'
                    }, {
                        laber: '保养',
                        value: '保养'
                    }, {
                        laber: '停机',
                        value: '停机'
                    }, {
                        laber: '维修',
                        value: '维修'
                    }
                ],
                department_options: [],
                tableData: [],
            },
            mounted() {
                this.getInitData();
                this.getDefaultInfos();
            },
            watch: {

            },
            methods: {
                //跳转页面
                onToTurn(val) {
                    if (val == 0) {
                        window.open()
                    }
                },
                //打开编辑
                onEdit() {
                    if (this.isEdit) {
                        this.isEdit = false;
                    } else {
                        this.isEdit = true;
                    }
                },
                //获取下拉数据
                getInitData() {
                    //获取部门列表
                    axios.post("/Equipment/Deparlist").then(res => {
                        res.data.forEach(item => {
                            let obj = { value: item, label: item };
                            this.department_options.push(obj);
                        })
                    }).catch(err => {
                        console.log(err);
                    });
                },
                // 获取初始表格数据
                getDefaultInfos() {
                    axios.post("/Equipment/Details", { equipmentNumber: 'MD040044' }).then(res => {
                        console.log(res.data);
                        this.tableTopData = JSON.parse(res.data.basicinfo);
                        console.log(this.tableTopData);
                    }).catch(err => {

                    })
                },
                //修改维修行数据
                onModify() { },
            }

        }
    </script>

}