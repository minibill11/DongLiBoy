using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Web;
using System.Web.Mvc;
using JianHeMES.Models;

namespace JianHeMES.Controllers
{
    public class Small_SampleController : Controller
    {
        private ApplicationDbContext db = new ApplicationDbContext();

        // GET: Small_Sample
        public ActionResult Index()
        {
            return View();
        }


        public ActionResult Create()
        {
            return View();
        }

        [HttpPost]
        public ActionResult Create(Small_Sample small_Sample)
        {
            //db.Small_Sample.Add(small_Sample);
            //db.SaveChanges();
            return Content("");
        }

        [HttpPost]
        public ActionResult Upload_small_Sample_report()
        {
            try
            {
                HttpPostedFileBase uploadfile = Request.Files["fileup"];
                if (uploadfile == null)
                {
                    return Content("no:非法上传");
                }
                if (uploadfile.FileName == "")
                {
                    return Content("no:请选择文件");
                }

                string fileExt = Path.GetExtension(uploadfile.FileName);
                StringBuilder sbtime = new StringBuilder();
                sbtime.Append(DateTime.Now.Year).Append(DateTime.Now.Month).Append(DateTime.Now.Day).Append(DateTime.Now.Hour).Append(DateTime.Now.Minute).Append(DateTime.Now.Second);
                string dir = "/UploadFile/" + sbtime.ToString() + fileExt;
                string realfilepath = Request.MapPath(dir);
                string readDir = Path.GetDirectoryName(realfilepath);
                if (!Directory.Exists(readDir))
                    Directory.CreateDirectory(readDir);
                uploadfile.SaveAs(realfilepath);
                //提取数据 
                var dt = ExcelTool.ExcelToDataTable(true, realfilepath);
                Small_Sample small_Sample_report = new Small_Sample();

                var reportdate = dt.Rows[0][9].ToString();//报告日期

                small_Sample_report.Customer = dt.Rows[2][2].ToString();//客户名称
                small_Sample_report.OrderNumber = dt.Rows[2][5].ToString();//生产单号
                small_Sample_report.Mo1 = dt.Rows[2][8].ToString();//规格型号
                small_Sample_report.Module_Number = Convert.ToInt32(dt.Rows[2][11]); //模块数量PCS
                //small_Sample_report.Te1 =  dt.Rows[][];//测试目的
                //small_Sample_report.Actual_point =  dt.Rows[][];//实际点间距
                //small_Sample_report.Te2 = dt.Rows[][];//测试工具
                //small_Sample_report.ReceivingCard = dt.Rows[][];//订单接收卡
                //small_Sample_report.Mo2 = dt.Rows[][];//模块型号
                //small_Sample_report.Points = dt.Rows[][];//点数
                //small_Sample_report.Scanningway = dt.Rows[][];//扫描数
                //small_Sample_report.system = dt.Rows[][];//调式系统
                //small_Sample_report.Te3 = dt.Rows[][];//测试条件
                //small_Sample_report.fixed_value = dt.Rows[][];//固定值（温度）
                //small_Sample_report.Driveplate = dt.Rows[][];//驱动板电压
                //small_Sample_report.Mo3 = dt.Rows[][];//电源型号
                small_Sample_report.Angle_R1 = Convert.ToDecimal(dt.Rows[11][3]);//角度.颜色.R.亮度
                small_Sample_report.Angle_R2 = Convert.ToDouble(dt.Rows[12][3]);//角度.颜色.R.坐标.min
                small_Sample_report.Angle_R3 = Convert.ToDouble(dt.Rows[12][4]);//角度.颜色.R.坐标.max
                small_Sample_report.Angle_G1 = Convert.ToDecimal(dt.Rows[11][5]);//角度.颜色.G.亮度
                small_Sample_report.Angle_G2 = Convert.ToDouble(dt.Rows[12][5]);//角度.颜色.G.坐标.min
                small_Sample_report.Angle_G3 = Convert.ToDouble(dt.Rows[12][6]);//角度.颜色.G.坐标.max
                small_Sample_report.Angle_B1 = Convert.ToDecimal(dt.Rows[11][7]);//角度.颜色.B.亮度
                small_Sample_report.Angle_B2 = Convert.ToDouble(dt.Rows[12][7]);//角度.颜色.B.坐标.min
                small_Sample_report.Angle_B3 = Convert.ToDouble(dt.Rows[12][8]);//角度.颜色.B.坐标.max
                small_Sample_report.Angle_W1 = Convert.ToDecimal(dt.Rows[11][9]);//角度.颜色.W.亮度
                small_Sample_report.Angle_W2 = Convert.ToDouble(dt.Rows[12][9]);//角度.颜色.W.坐标.min
                small_Sample_report.Angle_W3 = Convert.ToDouble(dt.Rows[12][11]);//角度.颜色.W.坐标.max
                //small_Sample_report.Client_R1 = dt.Rows[][];//角度.客户要求.亮度.R
                //small_Sample_report.Client_R2 = dt.Rows[][];//角度.客户要求.坐标.R.min
                //small_Sample_report.Client_R3 = dt.Rows[][];//角度.客户要求.坐标.R.max
                //small_Sample_report.Client_G1 = dt.Rows[][];//角度.客户要求.亮度.G
                //small_Sample_report.Client_G2 = dt.Rows[][];//角度.客户要求.坐标.G.min
                //small_Sample_report.Client_G3 = dt.Rows[][];//角度.客户要求.坐标.G.max
                //small_Sample_report.Client_B1 = dt.Rows[][];//角度.客户要求.亮度.B
                //small_Sample_report.Client_B2 = dt.Rows[][];//角度.客户要求.坐标.B.min
                //small_Sample_report.Client_B3 = dt.Rows[][];//角度.客户要求.坐标.B.max
                //small_Sample_report.Client_W1 = dt.Rows[][];//角度.客户要求.亮度.W.min
                //small_Sample_report.Client_W2 = dt.Rows[][];//角度.客户要求.亮度.W.max
                //small_Sample_report.Client_W3 = dt.Rows[][];//角度.客户要求.坐标.W.min
                //small_Sample_report.Client_W4 = dt.Rows[][];//角度.客户要求.坐标.W.max
                small_Sample_report.Points_R = Convert.ToInt32(dt.Rows[15][3]);//分压电/排阻阻值（欧）.R
                //small_Sample_report.Points_G = dt.Rows[15][5];//分压电/排阻阻值（欧）.G
                //small_Sample_report.Points_B = dt.Rows[15][7];//分压电/排阻阻值（欧）.B
                //small_Sample_report.Points_W = dt.Rows[15][9];//分压电/排阻阻值（欧）.W
                small_Sample_report.Adju_R = Convert.ToInt32(dt.Rows[16][3]);//可调电阻阻值（欧）.R
                small_Sample_report.Adju_G = Convert.ToInt32(dt.Rows[16][5]);//可调电阻阻值（欧）.G
                small_Sample_report.Adju_B = Convert.ToInt32(dt.Rows[16][7]);//可调电阻阻值（欧）.B
                //small_Sample_report.Adju_W = dt.Rows[16][9];//可调电阻阻值（欧）.W
                small_Sample_report.IC_R1 = Convert.ToDecimal(dt.Rows[17][3]);//单IC引脚电流（mA）.R
                small_Sample_report.IC_G1 = Convert.ToDecimal(dt.Rows[17][5]);//单IC引脚电流（mA）.G
                small_Sample_report.IC_B1 = Convert.ToDecimal(dt.Rows[17][7]);//单IC引脚电流（mA）.B
                small_Sample_report.IC_W1 = Convert.ToDecimal(dt.Rows[17][9]);//单IC引脚电流（mA）.W


                small_Sample_report.IC_R2  = Convert.ToDecimal(dt.Rows[18][3]);//IC.VDS.R
                small_Sample_report.IC_G2 = Convert.ToDecimal(dt.Rows[18][5]);//IC.VDS.G
                small_Sample_report.IC_B2 = Convert.ToDecimal(dt.Rows[18][7]);//IC.VDS.B
                //small_Sample_report.IC_W2 = Convert.ToDecimal(dt.Rows[18][9]);//IC.VDS.W
                small_Sample_report.Module_current = Convert.ToDecimal(dt.Rows[19][3]);//模块电流
                small_Sample_report.IC3 = dt.Rows[19][9].ToString();//IC型号
                small_Sample_report.R1 = Convert.ToInt32(dt.Rows[20][3]);//刷新频率
                small_Sample_report.R2 = dt.Rows[20][7].ToString();//接收卡Data包
                small_Sample_report.R3 = Convert.ToInt32(dt.Rows[21][3]);//接收卡带载点数
                small_Sample_report.LCT = dt.Rows[21][7].ToString();//LCT版本
                small_Sample_report.De1 = Convert.ToDouble(dt.Rows[22][3]);//亮度有效率
                small_Sample_report.De2 = Convert.ToInt32(dt.Rows[22][7]);//灰度等级
                small_Sample_report.DCLK = Convert.ToDecimal(dt.Rows[22][10]);//DCLK
                small_Sample_report.Load = Convert.ToDouble(dt.Rows[23][3]);//电源带载率
                small_Sample_report.Per = Convert.ToInt32(dt.Rows[23][7]);//每平方最大功耗
                small_Sample_report.GCLK = Convert.ToDecimal(dt.Rows[23][10]);//GCLK
                small_Sample_report.MOS1 = dt.Rows[24][3].ToString();//MOS管型号
                small_Sample_report.MOS2 = Convert.ToDecimal(dt.Rows[24][7]);//MOS压降(V)
                small_Sample_report.Current = Convert.ToDouble(dt.Rows[24][10]);//电流增益

                small_Sample_report.LED_R1 = dt.Rows[27][1].ToString();//LED厂家及型号.R
                small_Sample_report.LED_R2 = Convert.ToDecimal(dt.Rows[27][5]);//LED厂家及型号.R.实际范围.IV.Min
                small_Sample_report.LED_R3 = Convert.ToDecimal(dt.Rows[28][5]);//LED厂家及型号.R.Min:Max.IV.Min
                small_Sample_report.LED_R4 = Convert.ToDecimal(dt.Rows[27][6]);//LED厂家及型号.R.实际范围.IV.Max
                small_Sample_report.LED_R5 = Convert.ToDecimal(dt.Rows[28][6]);//LED厂家及型号.R.Min:Max.IV.Max
                //small_Sample_report.LED_R6 = Convert.ToDecimal(dt.Rows[27][7]);//LED厂家及型号.R.实际范围.WD.Min
                //small_Sample_report.LED_R7 = Convert.ToDecimal(dt.Rows[27][8]);//LED厂家及型号.R.实际范围.WD.Max
                //small_Sample_report.LED_R8 = Convert.ToDecimal(dt.Rows[28][7]);//LED厂家及型号.R.Min:Max.WD
                small_Sample_report.LED_R9 = Convert.ToDecimal(dt.Rows[27][9]);//LED厂家及型号.R.正向电压.Min
                small_Sample_report.LED_R10 = Convert.ToDecimal(dt.Rows[27][10]);//LED厂家及型号.R.正向电压.Max
                //small_Sample_report.LED_R11 = Convert.ToInt32(dt.Rows[27][11]);//LED厂家及型号.R.IV@IF
            
                small_Sample_report.LED_G1 = dt.Rows[29][1].ToString();//LED厂家.G
                small_Sample_report.LED_G2 = Convert.ToDecimal(dt.Rows[29][5]);//LED厂家.G.实际范围.IV.Min
                small_Sample_report.LED_G3 = Convert.ToDecimal(dt.Rows[30][5]);//LED厂家.G.Min:Max.IV.Min
                small_Sample_report.LED_G4 = Convert.ToDecimal(dt.Rows[29][6]);//LED厂家.G.实际范围.IV.Max
                small_Sample_report.LED_G5 = Convert.ToDecimal(dt.Rows[30][6]);//LED厂家.G.Min:Max.IV.Max
                small_Sample_report.LED_G6 = Convert.ToDecimal(dt.Rows[29][7]);//LED厂家.G.实际范围.WD.Min
                small_Sample_report.LED_G7 = Convert.ToDecimal(dt.Rows[29][8]);//LED厂家.G.实际范围.WD.Max
                //small_Sample_report.LED_G8 = Convert.ToDecimal(dt.Rows[30][7]);//LED厂家.G.Min:Max.WD
                small_Sample_report.LED_G9 = Convert.ToDecimal(dt.Rows[29][9]);//LED厂家.G.正向电压.Min
                small_Sample_report.LED_G10 = Convert.ToDecimal(dt.Rows[29][10]);//LED厂家.G.正向电压.Max
                //small_Sample_report.LED_G11 = Convert.ToInt32(dt.Rows[29][11]);//LED厂家.G.IV@IF
                
                small_Sample_report.LED_B1 = dt.Rows[31][1].ToString();//厂家及型号.B
                small_Sample_report.LED_B2 = Convert.ToDecimal(dt.Rows[31][5]);//厂家及型号.B.实际范围.IV.Min
                small_Sample_report.LED_B3 = Convert.ToDecimal(dt.Rows[32][5]);//厂家及型号.B.Min:Max.IV.Min
                small_Sample_report.LED_B4 = Convert.ToDecimal(dt.Rows[31][6]);//厂家及型号.B.实际范围.IV.Max
                small_Sample_report.LED_B5 = Convert.ToDecimal(dt.Rows[32][6]);//厂家及型号.B.Min:Max.IV.Max
                small_Sample_report.LED_B6 = Convert.ToDecimal(dt.Rows[31][7]);//厂家及型号.B.实际范围.WD.Min
                small_Sample_report.LED_B7 = Convert.ToDecimal(dt.Rows[31][8]);//厂家及型号.B.实际范围.WD.Max
                //small_Sample_report.LED_B8 = Convert.ToDecimal(dt.Rows[32][7]);//厂家及型号.B.Min:Max.WD
                small_Sample_report.LED_B9 = Convert.ToDecimal(dt.Rows[31][9]);//厂家及型号.B.正向电压.Min
                small_Sample_report.LED_B10 = Convert.ToDecimal(dt.Rows[31][10]);//厂家及型号.B.正向电压.Max
                //small_Sample_report.LED_B11 = Convert.ToInt32(dt.Rows[31][11]);//厂家及型号.B.IV@IF
                
                
                small_Sample_report.Small_R1 = dt.Rows[35][1].ToString();//LED厂家及型号.R
                small_Sample_report.Small_R2 = Convert.ToDecimal(dt.Rows[35][5]);//LED厂家及型号.R.实际范围.IV.Min
                small_Sample_report.Small_R3 = Convert.ToDecimal(dt.Rows[36][5]);//LED厂家及型号.R.Min:Max.IV.Min
                small_Sample_report.Small_R4 = Convert.ToDecimal(dt.Rows[35][6]);//LED厂家及型号.R.实际范围.IV.Max
                small_Sample_report.Small_R5 = Convert.ToDecimal(dt.Rows[36][6]);//LED厂家及型号.R.Min:Max.IV.Max
                small_Sample_report.Small_R6 = Convert.ToDecimal(dt.Rows[35][7]);//LED厂家及型号.R.实际范围.WD.Min
                small_Sample_report.Small_R7 = Convert.ToDecimal(dt.Rows[35][8]);//LED厂家及型号.R.实际范围.WD.Max
                small_Sample_report.Small_R8 = Convert.ToDecimal(dt.Rows[36][7]);//LED厂家及型号.R.Min:Max.WD
                small_Sample_report.Small_R9 = Convert.ToDecimal(dt.Rows[35][9]);//LED厂家及型号.R.正向电压.Min
                small_Sample_report.Small_R10 = Convert.ToDecimal(dt.Rows[35][10]);//LED厂家及型号.R.正向电压.Max
                small_Sample_report.Small_R11 = Convert.ToInt32(dt.Rows[35][11]);//LED厂家及型号.R.IV@IF

                small_Sample_report.Small_G1 = dt.Rows[37][1].ToString();//LED厂家.G
                small_Sample_report.Small_G2 = Convert.ToDecimal(dt.Rows[37][5]);//LED厂家.G.实际范围.IV.Min
                small_Sample_report.Small_G3 = Convert.ToDecimal(dt.Rows[38][5]);//LED厂家.G.Min:Max.IV.Min
                small_Sample_report.Small_G4 = Convert.ToDecimal(dt.Rows[37][6]);//LED厂家.G.实际范围.IV.Max
                small_Sample_report.Small_G5 = Convert.ToDecimal(dt.Rows[38][6]);//LED厂家.G.Min:Max.IV.Max
                small_Sample_report.Small_G6 = Convert.ToDecimal(dt.Rows[37][7]);//LED厂家.G.实际范围.WD.Min
                small_Sample_report.Small_G7 = Convert.ToDecimal(dt.Rows[37][8]);//LED厂家.G.实际范围.WD.Max
                small_Sample_report.Small_G8 = Convert.ToDecimal(dt.Rows[38][7]);//LED厂家.G.Min:Max.WD
                small_Sample_report.Small_G9 = Convert.ToDecimal(dt.Rows[37][9]);//LED厂家.G.正向电压.Min
                small_Sample_report.Small_G10 = Convert.ToDecimal(dt.Rows[37][10]);//LED厂家.G.正向电压.Max
                small_Sample_report.Small_G11 = Convert.ToInt32(dt.Rows[37][11]);//LED厂家.G.IV@IF


                small_Sample_report.Small_B1 = dt.Rows[39][1].ToString();//厂家及型号.B
                small_Sample_report.Small_B2 = Convert.ToDecimal(dt.Rows[39][5]);//厂家及型号.B.实际范围.IV.Min
                small_Sample_report.Small_B3 = Convert.ToDecimal(dt.Rows[40][5]);//厂家及型号.B.Min:Max.IV.Min
                small_Sample_report.Small_B4 = Convert.ToDecimal(dt.Rows[39][6]);//厂家及型号.B.实际范围.IV.Max
                small_Sample_report.Small_B5 = Convert.ToDecimal(dt.Rows[40][6]);//厂家及型号.B.Min:Max.IV.Max
                small_Sample_report.Small_B6 = Convert.ToDecimal(dt.Rows[39][7]);//厂家及型号.B.实际范围.WD.Min
                small_Sample_report.Small_B7 = Convert.ToDecimal(dt.Rows[39][8]);//厂家及型号.B.实际范围.WD.Max
                small_Sample_report.Small_B8 = Convert.ToDecimal(dt.Rows[40][7]);//厂家及型号.B.Min:Max.WD
                small_Sample_report.Small_B9 = Convert.ToDecimal(dt.Rows[39][9]);//厂家及型号.B.正向电压.Min
                small_Sample_report.Small_B10 = Convert.ToDecimal(dt.Rows[39][10]);//厂家及型号.B.正向电压.Max
                small_Sample_report.Small_B11 = Convert.ToInt32(dt.Rows[39][11]);//厂家及型号.B.IV@IF

                small_Sample_report.ReportRemark = dt.Rows[41][0].ToString();//备注
                small_Sample_report.Approved = dt.Rows[42][3].ToString();//核准人
                small_Sample_report.Assessor = dt.Rows[42][6].ToString();//审核人
                small_Sample_report.Tester = dt.Rows[42][9].ToString();//测试人


                var order_recieve_car = dt.Rows[6][9];//订单接收卡
                //int rcount = dt.Rows.Count;
                //for (int i = 0; i < rcount; i++)
                //{
                //    new Small_Sample()
                //    {
                //        No = Convert.ToInt32(dt.Rows[i][0]),
                //        Name = dt.Rows[i][1].ToString(),
                //        Age = Convert.ToInt32(dt.Rows[i][2]),
                //        Sex = dt.Rows[i][3].ToString()
                //    };
                //}
                return Json(small_Sample_report, JsonRequestBehavior.AllowGet);
            }
            catch (Exception ex)
            {
                return Content(ex.Message);
            }
        }


    }
}