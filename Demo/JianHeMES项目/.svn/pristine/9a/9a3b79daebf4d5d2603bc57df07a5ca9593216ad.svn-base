@model IEnumerable<JianHeMES.Models.Personnel_Reasons_for_leaving>

@{
    ViewBag.Title = "Index";
}
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<script src="~/Scripts/axios.min.js"></script>
<script src="~/Scripts/echarts.js"></script>
@*<h2>Index</h2>*@
<style>
    .el-input{
        width:130px;
    }
    .el-table--small th,.el-table .cell, .el-table th div,.el-table--small td,.el-table .cell,.el-table .cell{
        padding:2px;
        padding-left:2px !important;
    }
    .el-button--mini{
        padding:5px;
    }
    .timePicker{
        text-align:center;
        margin: 15px auto;
    }
    .echartContainer {
        display: flex;
        justify-content: space-between;
        margin-top:10px;
      }

      #lineMain {
        margin: 0 auto;
        width: 48%;
        height: 300px;
      }

      #lineMain2 {
        margin: 0 auto;
        width: 48%;
        height: 300px;
      }
      .popoverTable input{
          width:100%;
      }
      .popoverTable select{
          width:100%;
          height:22px;
      }
</style>
<p>
    @Html.ActionLink("批量添加", "Create")
</p>

<div id="app">
    <div class="timePicker" >
        <el-select v-model="selectYear" size="small" width="150" placeholder="请选择">
            <el-option v-for="item in optionsYear"
                       v-bind:key="item.value"
                       v-bind:label="item.label"
                       v-bind:value="item.value">
            </el-option>
        </el-select>年
        <el-select v-model="selectMonth" size="small" clearable placeholder="请选择">
            <el-option v-for="item in optionsMonth"
                       v-bind:key="item.value"
                       v-bind:label="item.label"
                       v-bind:value="item.value">
            </el-option>
        </el-select>月


        <el-date-picker v-model="times"
                        v-show ="false"
                        type="month"
                        size="small"
                        placeholder="选择月">
        </el-date-picker>
        各部门离职情况汇总
    </div>
    <el-table v-bind:data="tableData" style="width: 100%" size="small" show-summary v-bind:summary-method="getSummaries" v-loading.fullscreen="loading" >
        <el-table-column prop="department" label="部门" align="center" width="110" >
            <template slot-scope="scope">
                <el-popover placement="right"
                            width="auto"
                            trigger="click">
                    <el-table v-bind:id=`table${scope.$index}` class="popoverTable" v-bind:data="gridData" max-height="450" size="small" >
                        <el-table-column width="50" align="center" property="Name" label="姓名"></el-table-column>
                        <el-table-column width="60" align="center" property="jobNum" label="工号"></el-table-column>
                        <el-table-column width="80" align="center" property="department" label="部门"></el-table-column>
                        <el-table-column width="80" align="center" property="Position" label="职位"></el-table-column>
                        <el-table-column width="68" align="center" property="levelType" label="族群"></el-table-column>
                        <el-table-column width="80" align="center" property="DP_group" label="组名"></el-table-column>
                        <el-table-column width="232" align="center" property="Remark" label="备注"></el-table-column>
                        <el-table-column width="60" align="center" property="Department_of_conclusion" label="部门结论"></el-table-column>
                        <el-table-column width="60" align="center" property="HR_conclusion" label="人事结论"></el-table-column>
                        <el-table-column width="50" align="center" property="Pay_dissatisfaction" label="薪酬不满意"></el-table-column>
                        <el-table-column width="50" align="center" property="NotSystem" label="制度不满意"></el-table-column>
                        <el-table-column width="50" align="center" property="Notmanagement" label="管理不满意"></el-table-column>
                        <el-table-column width="60" align="center" property="Jobenvironment" label="工作环境不满意"></el-table-column>
                        <el-table-column width="50" align="center" property="Better_development" label="更好的发展"></el-table-column>
                        <el-table-column prop="date" label="操作" align="center" width="108">
                            <template slot-scope="scope">
                                <el-button class="btnone" size="mini" v-on:click="handleEdit(scope.$index, scope.row)">编辑</el-button>
                                <el-button class="btntwo" size="mini" style="display:none;" v-on:click="handleSave(scope.$index, scope.row)">保存</el-button>
                                <el-button class="btnthree" size="mini" style="display:none;" v-on:click="handleCancel(scope.$index, scope.row)">取消</el-button>
                                <el-button class="btnfour" size="mini" type="danger" v-on:click="handleDelete(scope.$index, scope.row)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <el-button slot="reference" size="small" v-on:click="showDetials(scope.$index, scope.row)" >{{scope.row.department}}</el-button>
                </el-popover>
            </template>
        </el-table-column>
        <el-table-column prop="begin_day_of_month" align="center" label="月初人数" width="60">
        </el-table-column>
        <el-table-column prop="end_day_of_month" align="center" label="月末人数" width="60">
        </el-table-column>
        <el-table-column prop="average" align="center" label="平均人数" width="40">
        </el-table-column>
        <el-table-column prop="ru_departure_sum" align="center" label="入职人数" width="60">
        </el-table-column>
        <el-table-column prop="li_departure_sum" align="center" label="离职人数" width="60">
        </el-table-column>
        <el-table-column align="center" label="离职族群汇总">
            <el-table-column prop="levelTypecaozuo" align="center" label="操作族" width="55">
            </el-table-column>
            <el-table-column prop="levelTypejishu" align="center" label="技术族" width="55">
            </el-table-column>
            <el-table-column prop="levelTypezhuanye" align="center" label="专业族" width="55">
            </el-table-column>
            <el-table-column prop="levelTypefuwu" align="center" label="服务族" width="55">
            </el-table-column>
            <el-table-column prop="levelTypeguanli" align="center" label="管理族" width="55">
            </el-table-column>
        </el-table-column>
        <el-table-column align="center" label="离职原因">
            <el-table-column align="center" prop="py_couxin" label="薪酬不满意" width="70">
            </el-table-column>
            <el-table-column align="center" prop="py_zhidu" label="制度不满意" width="70">
            </el-table-column>
            <el-table-column align="center" prop="py_guan" label="管理不满意" width="70">
            </el-table-column>
            <el-table-column align="center" prop="py_gong" label="工作环境不满意" width="95">
            </el-table-column>
            <el-table-column align="center" prop="py_geng" label="更好的发展" width="70">
            </el-table-column>
        </el-table-column>
        <el-table-column prop="for_leaving" align="center" label="离职率
（含入职未满7天人员）" width="98">
        </el-table-column>
        
    </el-table>
    
    <el-table v-bind:data="tableBottmData" style="width: 100%;margin-top:10px;" size="small" show-summary v-bind:summary-method="bottomGetSummaries" >
        <el-table-column v-bind:label=`${Year}${Months}员工离职原因` align="center">
            <el-table-column prop="taps" align="center" label="离职原因" width="35">
            </el-table-column>
            <el-table-column align="center" label="操作族" width="100">
                <el-table-column prop="leave_xinzi" align="center" label="薪酬不满意" width="53">
                </el-table-column>
                <el-table-column prop="leave_zhidu" align="center" label="制度不满意" width="69">
                </el-table-column>
                <el-table-column prop="leave_guanli" align="center" label="管理不满意" width="69">
                </el-table-column>
                <el-table-column prop="leave_huanji" align="center" label="工作环境不满意" width="82">
                </el-table-column>
                <el-table-column prop="leave_genghao" align="center" label="更好的发展" width="69">
                </el-table-column>
            </el-table-column>
            <el-table-column prop="date" align="center" label="非操作族" width="100">
                <el-table-column prop="cause_couxin" align="center" label="薪酬不满意" width="69">
                </el-table-column>
                <el-table-column prop="cause_zhidu" align="center" label="制度不满意" width="69">
                </el-table-column>
                <el-table-column prop="cause_guanli" align="center" label="管理不满意" width="69">
                </el-table-column>
                <el-table-column prop="cause_gongzuo" align="center" label="工作环境不满意" width="82">
                </el-table-column>
                <el-table-column prop="cause_fazhang" align="center" label="更好的发展" width="69">
                </el-table-column>
            </el-table-column>
            <el-table-column prop="date" align="center" label="各项小计" width="100">
                <el-table-column prop="Pay_diss" align="center" label="薪酬不满意" width="69">
                </el-table-column>
                <el-table-column prop="System" align="center" label="制度不满意" width="69">
                </el-table-column>
                <el-table-column prop="management" align="center" label="管理不满意" width="69">
                </el-table-column>
                <el-table-column prop="Joben" align="center" label="工作环境不满意" width="82">
                </el-table-column>
                <el-table-column prop="Better" align="center" label="更好的发展" width="69">
                </el-table-column>
            </el-table-column>
            <el-table-column prop="cause_heji" align="center" label="合计" width="45">
            </el-table-column>
        </el-table-column>
    </el-table>
    @*{{Year}}*@
    <div class="echartContainer">
        <div id="lineMain"></div>
        <div id="lineMain2"></div>
    </div>
</div>



<script>
      var vm = new Vue({
        el: "#app",
        data: {
            selectYear:'',
            selectMonth:'',
            optionsYear:[],
            optionsMonth:[],
            index:null,
            flags:false,
            gridData:[],
            times: "",
            Year:'',
            Months:'',
            loading: false,
            totalCompleteRange:'',
            tableData: [],  //表格加载的数据必须是数组，否则报错
            tableBottmData:[],
            tableBottomRange:'',
            coporationTypeVal:[],
            leavingRangr:[],
            trOldVal:'',  //点击编辑之前的本行的数据---为了取消保存时方便给本行重新 赋值
        },
        mounted(){
            var yearNow = new Date().getFullYear();   //动态为选择框获取年份
            for(let i =0;i<5;i++){
                var obj = {label:yearNow-i,value:yearNow-i};
                this.optionsYear.push(obj)
            }
            for(let i =0;i<12;i++){     //动态输出月份
                var vals = (i+1).toString().padStart(2,'0')
                var obj = {label:vals,value:vals};
                this.optionsMonth.push(obj);
            }
            axios.post("/Personnel_Reasons_for_leaving/DefaualInfo").then(res=>{
                var arr = res.data.split(',');
                var time = `${arr[0]}-${arr[1]}`;      //时间格式问题：火狐不支持的格式：yyyy/mm//dd  需要转换成：  yyyy-mm-dd(正好谷歌也支持此格式);
                this.selectYear = arr[0];
                this.selectMonth = arr[1];
               // console.log(arr)
            }).catch(err=>{

            })
        },
        methods: {
            handleEdit(index, row) {    //在线编辑功能
                var btn1 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[0];
                var btn2 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[1];
                var btn3 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[2];
                var btn4 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[3];
                //$(btn3).click();
                this.trOldVal = row;
                var targetTr = $(`#table${this.index} .el-table__row`)[index]
                targetTr.children[0].innerHTML = "<input type='text' value=" + row.Name + " />";
                targetTr.children[1].innerHTML = "<input type='text' value=" + (row.jobNum==undefined ? '' : row.jobNum) + " >";
                targetTr.children[2].innerHTML = "<input type='text' value=" + (row.department == undefined ? '' : row.department) + " >";
                targetTr.children[3].innerHTML = "<input type='text' value=" + (row.Position == undefined ? '' : row.Position) + " >";
                targetTr.children[4].innerHTML = "<select><option>"+ (row.levelType == undefined ? '' : row.levelType) +"</option><option>操作族</option><option>技术族</option><option>专业族</option><option>服务族</option><option>管理族</option></select>";
                targetTr.children[5].innerHTML = "<input type='text' value=" + (row.DP_group == undefined ? '' : row.DP_group) + " >";
                targetTr.children[6].innerHTML = "<input type='text' value=" + (row.Remark == undefined ? '' : row.Remark) + " >";
                targetTr.children[7].innerHTML = "<input type='text' value=" + (row.Department_of_conclusion == undefined ? '' : row.Department_of_conclusion) + " >";
                targetTr.children[8].innerHTML = "<input type='text' value=" + (row.HR_conclusion == undefined ? '' : row.HR_conclusion) + " >";
                targetTr.children[9].innerHTML = "<select><option>" + (row.Pay_dissatisfaction == undefined ? '' : row.Pay_dissatisfaction) + "</option><option>0</option><option>1</option></select>";
                targetTr.children[10].innerHTML = "<select><option>" + (row.NotSystem == undefined ? '' : row.NotSystem) + "</option><option>0</option><option>1</option></select>";
                targetTr.children[11].innerHTML = "<select><option>" + (row.Notmanagement == undefined ? '' : row.Notmanagement) + "</option><option>0</option><option>1</option></select>";
                targetTr.children[12].innerHTML = "<select><option>" + (row.Jobenvironment == undefined ? '' : row.Jobenvironment) + "</option><option>0</option><option>1</option></select>";
                targetTr.children[13].innerHTML = "<select><option>" + (row.Better_development == undefined ? '' : row.Better_development) + "</option><option>0</option><option>1</option></select>";
                var btn1 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[0];
                var btn2 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[1];
                var btn3 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[2];
                var btn4 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[3];
                $(btn1).hide()
                $(btn4).hide()
                $(btn2).show()
                $(btn3).show()
            },
            handleCancel(index, row){   //取消保存方法
                var targetTr = $(`#table${this.index} .el-table__row`)[index];
                targetTr.children[0].innerHTML =  row.Name ;
                targetTr.children[1].innerHTML = (row.jobNum==undefined ? '' : row.jobNum) ;
                targetTr.children[2].innerHTML = (row.department == undefined ? '' : row.department);
                targetTr.children[3].innerHTML = (row.Position == undefined ? '' : row.Position);
                targetTr.children[4].innerHTML = (row.levelType == undefined ? '' : row.levelType);
                targetTr.children[5].innerHTML = (row.DP_group == undefined ? '' : row.DP_group) ;
                targetTr.children[6].innerHTML = (row.Remark == undefined ? '' : row.Remark) ;
                targetTr.children[7].innerHTML = (row.Department_of_conclusion == undefined ? '' : row.Department_of_conclusion);
                targetTr.children[8].innerHTML = (row.HR_conclusion == undefined ? '' : row.HR_conclusion) ;
                targetTr.children[9].innerHTML = (row.Pay_dissatisfaction == undefined ? '' : row.Pay_dissatisfaction) ;
                targetTr.children[10].innerHTML = (row.NotSystem == undefined ? '' : row.NotSystem);
                targetTr.children[11].innerHTML = (row.Notmanagement == undefined ? '' : row.Notmanagement);
                targetTr.children[12].innerHTML = (row.Jobenvironment == undefined ? '' : row.Jobenvironment) ;
                targetTr.children[13].innerHTML = (row.Better_development == undefined ? '' : row.Better_development);
                var btn1 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[0];
                var btn2 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[1];
                var btn3 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[2];
                var btn4 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[3];
                $(btn1).show()
                $(btn4).show()
                $(btn2).hide()
                $(btn3).hide()
            },
            handleSave(index,row){     //单条编辑保存
                console.log(row.Id)
                var targetTr_td = $(`#table${this.index} .el-table__row`)[index].cells;
                var formVals = [];
                for(let i =0;i<targetTr_td.length;i++){
                    formVals.push(targetTr_td[i].children[0].value);
                }
               
                axios.post("/Personnel_Reasons_for_leaving/Create",{Name:formVals[0],jobNum:formVals[1],Department_leaving:formVals[2],DP_group:formVals[5],Position:formVals[3],levelType:formVals[4],
                    Remark:formVals[6],Department_of_conclusion:formVals[7],HR_conclusion:formVals[8],
                    Pay_dissatisfaction:formVals[9],NotSystem:formVals[10],Notmanagement:formVals[11],Jobenvironment:formVals[12],Better_development:formVals[13],Id:row.Id}).then(res=>{
                        if(res.data=='ok'){
                            var targetTr = $(`#table${this.index} .el-table__row`)[index];
                            targetTr.children[0].innerHTML =  formVals[0] ;
                            targetTr.children[1].innerHTML = formVals[1] ;
                            targetTr.children[2].innerHTML = formVals[2];
                            targetTr.children[3].innerHTML = formVals[3];
                            targetTr.children[4].innerHTML = formVals[4];
                            targetTr.children[5].innerHTML = formVals[5] ;
                            targetTr.children[6].innerHTML = formVals[6] ;
                            targetTr.children[7].innerHTML = formVals[7];
                            targetTr.children[8].innerHTML = formVals[8] ;
                            targetTr.children[9].innerHTML = formVals[9] ;
                            targetTr.children[10].innerHTML = formVals[10];
                            targetTr.children[11].innerHTML = formVals[11];
                            targetTr.children[12].innerHTML = formVals[12];
                            targetTr.children[13].innerHTML = formVals[13];
                            var btn1 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[0];
                            var btn2 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[1];
                            var btn3 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[2];
                            var btn4 = $(`#table${this.index} .el-table__row`)[index].lastChild.children[0].children[3];
                            $(btn1).show()
                            $(btn4).show()
                            $(btn2).hide()
                            $(btn3).hide()
                            this.$message({
                                message: '保存成功！',
                                type: 'success'
                            });
                        }
                }).catch(err=>{

                })
            },
          handleDelete(index, row) {   //删除方法
           // console.log(index, row);
          },
          getInfos() {
              this.tableData = [];
              this.tableBottmData = [];
              this.tableBottomRange = '';
              //console.log(this.times)
              if (this.selectYear != '') {
                  var d = new Date(this.selectYear+'-'+this.selectMonth);
                  var timestamp = Date.parse(new Date());
                  if(d>timestamp){
                      this.$notify({
                          title: '警告',
                          message: '所选时间超前！',
                          type: 'warning'
                      });
                      this.tableData = [];
                      this.tableBottmData = [];
                      this.tableBottomRange = '';
                      return false;
                  }else{
                      this.loading = true;
                      year = d.getFullYear();
                      month = d.getMonth()+1;
                      months = month.toString().padStart(2, '0')
                      this.Year = this.selectYear + '年';
                      this.Months = this.selectMonth!=''?this.selectMonth + '月':''
                      axios.post("/Personnel_Reasons_for_leaving/For_leaving", { Year: this.selectYear, Month: this.selectMonth }).then(res=> {
                          //console.log(res.data)
                          if(res.data.status == '202'){
                              this.$notify({
                                  title: '警告',
                                  message: res.data.msg,
                                  type: 'warning'
                              });
                              this.tableBottmData = [];
                              this.leavingRangr = []
                              this.loading = false;
                          }else{
                              this.tableBottmData = [];
                              for (let item in res.data.for_leaving_Table) {
                                  if (item == 'month_average') {
                                      this.totalCompleteRange = res.data.for_leaving_Table[item];
                                      delete res.data.for_leaving_Table[item];
                                  }
                              }
                              var arr = [];
                              //console.log(res.data)
                              for (let item in res.data.for_leaving_Table) {
                                  res.data.for_leaving_Table[item].average = res.data.for_leaving_Table[item].average=='0'?'':res.data.for_leaving_Table[item].average;
                                  res.data.for_leaving_Table[item].begin_day_of_month = res.data.for_leaving_Table[item].begin_day_of_month=='0'?'':res.data.for_leaving_Table[item].begin_day_of_month;
                                  res.data.for_leaving_Table[item].end_day_of_month = res.data.for_leaving_Table[item].end_day_of_month=='0'?'':res.data.for_leaving_Table[item].end_day_of_month;
                                  res.data.for_leaving_Table[item].levelTypecaozuo = res.data.for_leaving_Table[item].levelTypecaozuo=='0'?'':res.data.for_leaving_Table[item].levelTypecaozuo;
                                  res.data.for_leaving_Table[item].levelTypefuwu = res.data.for_leaving_Table[item].levelTypefuwu=='0'?'':res.data.for_leaving_Table[item].levelTypefuwu;
                                  res.data.for_leaving_Table[item].levelTypeguanli = res.data.for_leaving_Table[item].levelTypeguanli=='0'?'':res.data.for_leaving_Table[item].levelTypeguanli;
                                  res.data.for_leaving_Table[item].levelTypejishu = res.data.for_leaving_Table[item].levelTypejishu=='0'?'':res.data.for_leaving_Table[item].levelTypejishu;
                                  res.data.for_leaving_Table[item].levelTypezhuanye = res.data.for_leaving_Table[item].levelTypezhuanye=='0'?'':res.data.for_leaving_Table[item].levelTypezhuanye;
                                  res.data.for_leaving_Table[item].li_departure_sum = res.data.for_leaving_Table[item].li_departure_sum=='0'?'':res.data.for_leaving_Table[item].li_departure_sum;
                                  res.data.for_leaving_Table[item].py_couxin = res.data.for_leaving_Table[item].py_couxin=='0'?'':res.data.for_leaving_Table[item].py_couxin;
                                  res.data.for_leaving_Table[item].py_geng = res.data.for_leaving_Table[item].py_geng=='0'?'':res.data.for_leaving_Table[item].py_geng;
                                  res.data.for_leaving_Table[item].py_gong = res.data.for_leaving_Table[item].py_gong=='0'?'':res.data.for_leaving_Table[item].py_gong;
                                  res.data.for_leaving_Table[item].py_guan = res.data.for_leaving_Table[item].py_guan=='0'?'':res.data.for_leaving_Table[item].py_guan;
                                  res.data.for_leaving_Table[item].py_zhidu = res.data.for_leaving_Table[item].py_zhidu=='0'?'':res.data.for_leaving_Table[item].py_zhidu;
                                  res.data.for_leaving_Table[item].ru_departure_sum = res.data.for_leaving_Table[item].ru_departure_sum=='0'?'':res.data.for_leaving_Table[item].ru_departure_sum;
                                  arr.push(res.data.for_leaving_Table[item])
                              }
                              res.data.leave_record3.leave_record1.taps = '人数'
                              this.tableBottmData.push(res.data.leave_record3.leave_record1);
                              //console.log(this.tableBottmData)
                              this.tableBottomRange = res.data.leave_record3.leave_record2;
                              this.tableData = arr;
                              this.loading = false;
                          }
                          
                      }).catch(err=>{
                          this.$notify({
                              title: '警告',
                              message: '连接失败！',
                              type: 'warning'
                          });
                      })
                  }
                  
              }else{
                  this.tableData = [];
                  this.tableBottmData = [];
                  this.tableBottomRange = '';
              }
          },
          getSummaries(param) {
              const { columns, data } = param;
              const sums = [];
              columns.forEach((column, index) => {
                  if (index === 0) {
                      sums[index] = '总计';
                      return;
                  }else if(index === 16){
                      sums[index] = this.totalCompleteRange;
                      return;
                  }
                  const values = data.map(item => Number(item[column.property]));
                  if (!values.every(value => isNaN(value))) {
                      sums[index] = values.reduce((prev, curr) => {
                          const value = Number(curr);
                          if (!isNaN(value)) {
                              return prev + curr;
                          } else {
                              return prev;
                          }
                      }, 0);
                      sums[index] += ' ';
                  } else {
                      sums[index] = '';
                  }
              });

              return sums;
          },
          bottomGetSummaries(param){
              const { columns, data } = param;
              const sums = [];
              columns.forEach((column, index) => {
                  if (index === 0) {
                      sums[index] = '占比';
                      return;
                  }else if(index === 1){
                      sums[index] = this.tableBottomRange.proportion_couxin;
                      return;
                  }
                  else if(index === 2){
                      sums[index] = this.tableBottomRange.proportion_zhidu;
                      return;
                  }
                  else if(index === 3){
                      sums[index] = this.tableBottomRange.proportion_guanli;
                      return;
                  }
                  else if(index === 4){
                      sums[index] = this.tableBottomRange.proportion_huanji;
                      return;
                  }
                  else if(index === 5){
                      sums[index] = this.tableBottomRange.proportion_genghao;
                      return;
                  }
                  else if(index === 6){
                      sums[index] = this.tableBottomRange.account_couxin;
                      return;
                  }
                  else if(index === 7){
                      sums[index] = this.tableBottomRange.account_zhidu;
                      return;
                  }
                  else if(index === 8){
                      sums[index] = this.tableBottomRange.account_guanli;
                      return;
                  }
                  else if(index === 9){
                      sums[index] = this.tableBottomRange.account_gongzuo;
                      return;
                  }
                  else if(index === 10){
                      sums[index] = this.tableBottomRange.account_fazhang;
                      return;
                  }
                  else if(index === 11){
                      sums[index] = this.tableBottomRange.Leaving_salary;
                      return;
                  }
                  else if(index === 12){
                      sums[index] = this.tableBottomRange.Leaving_System;
                      return;
                  }
                  else if(index === 13){
                      sums[index] = this.tableBottomRange.Leaving_management;
                      return;
                  }
                  else if(index === 14){
                      sums[index] = this.tableBottomRange.Leaving_Joben;
                      return;
                  }
                  else if(index === 15){
                      sums[index] = this.tableBottomRange.Leaving_Better;
                      return;
                  }
                  //const values = data.map(item => Number(item[column.property]));
                  //if (!values.every(value => isNaN(value))) {
                  //    sums[index] = values.reduce((prev, curr) => {
                  //        const value = Number(curr);
                  //        if (!isNaN(value)) {
                  //            return prev + curr;
                  //        } else {
                  //            return prev;
                  //        }
                  //    }, 0);
                  //    sums[index] += ' ';
                  //} else {
                  //    sums[index] = '';
                  //}
              });

              return sums;
          },
          showDetials(index,row){
              
              this.gridData = [];
              this.index = index
              if(this.selectMonth ==''){
                  vm.$notify({
                      title: '警告',
                      message: '仅支持查看各部门单月详细，请选择月份！',
                      type: 'warning'
                  });
              }else{
                  axios.post("/Personnel_Reasons_for_leaving/Leaving_reason",{department:row.department,year:parseInt(this.selectYear),mouth:parseInt(this.selectMonth)}).then(res=>{
                     console.log(res.data);
                      if(res.data !={}){
                          for(let item in res.data){
                              this.gridData.push(res.data[item]); 
                          }
                      }
                  }).catch(err=>{
                      vm.$notify({
                          title: '警告',
                          message: '连接失败！',
                          type: 'warning'
                      });
                  })
              }
          },
        },
        watch: {
            selectYear(){
                this.getInfos();
            },
            selectMonth(){
                if(this.selectYear !=''){
                    this.getInfos();
                }
            },
            times() {
                this.getInfos();
            },
            tableBottomRange(){
                this.coporationTypeVal = [];
                this.leavingRangr = [];
                if(this.tableBottomRange !=''){
                    this.flags = true;
                   // console.log(this.tableBottomRange)
                    var obj1 = {name:'薪酬不满意',value:this.tableBottomRange.proportion_couxin.replace(/%/,'')};
                    var obj2 = {name:'制度不满意',value:this.tableBottomRange.proportion_zhidu.replace(/%/,'')};
                    var obj3 = {name:'管理不满意',value:this.tableBottomRange.proportion_guanli.replace(/%/,'')};
                    var obj4 = {name:'工作环境不满意',value:this.tableBottomRange.proportion_huanji.replace(/%/,'')};
                    var obj5 = {name:'更好的发展',value:this.tableBottomRange.proportion_genghao.replace(/%/,'')};
                    this.coporationTypeVal.push(obj1,obj2,obj3,obj4,obj5);

                    var obj11 = {name:'薪酬不满意',value:this.tableBottomRange.account_couxin.replace(/%/,'')};
                    var obj22 = {name:'制度不满意',value:this.tableBottomRange.account_zhidu.replace(/%/,'')};
                    var obj33 = {name:'管理不满意',value:this.tableBottomRange.account_guanli.replace(/%/,'')};
                    var obj44 = {name:'工作环境不满意',value:this.tableBottomRange.account_gongzuo.replace(/%/,'')};
                    var obj55 = {name:'更好的发展',value:this.tableBottomRange.account_fazhang.replace(/%/,'')};

                    this.leavingRangr.push(obj11,obj22,obj33,obj44,obj55)
                    var LineChart = echarts.init(document.getElementById('lineMain'));
                    var LineChart2 = echarts.init(document.getElementById('lineMain2'));
                    //LineChart.showLoading();
                    //LineChart.hideLoading();
                    let option1 = {
                        title: {
                            text: '操作族离职原因',
                            //subtext: '纯属虚构',
                            x: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: "{a} <br />{b} : {c} ({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'right',
                            data: ['薪酬不满意', '制度不满意', '管理不满意', '工作环境不满意', '更好的发展']
                        },
                        series: [{
                            name: '详细占比',
                            type: 'pie',
                            radius: '55%',
                            center: ['50%', '60%'],
                            data:this.coporationTypeVal ,
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }]
                    };
                    let option2 = {
                        title: {
                            text: '非操作族离职原因',
                            //subtext: '纯属虚构',
                            x: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: "{a} <br />{b} : {c} ({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'right',
                            data: ['薪酬不满意', '制度不满意', '管理不满意', '工作环境不满意', '更好的发展']
                        },
                        series: [{
                            name: '访问来源',
                            type: 'pie',
                            radius: '55%',
                            center: ['50%', '60%'],
                            data: this.leavingRangr,
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }]
                    };
                    LineChart.setOption(option1);
                    LineChart2.setOption(option2);


                }
            }
        }
      })
      $(".el-table__footer").click(function(){
          vm.$notify({
              title: '警告',
              message: '点击总计行显示相应信息！',
              type: 'warning'
          });
      })   //点击总计栏事件
     
    
</script>
