
@{
    ViewBag.Title = "录入基本信息";
    Layout = "~/Views/Shared/_Layout2.cshtml";
}

@* css放置处 *@
@section cssStyle {
    <link rel="stylesheet/less" type="text/css" href="~/Content/tableStyle/StockAmount.less" />
    <style>
        .inputbox {
            margin: 2px;
        }

        .main .inputbox {
            width: 335px;
            padding-right: 0;            
            display: flex;
            flex-flow: row wrap;
            justify-content: flex-end;
            align-items: center;            
            text-align: left;
        }
        .main {
            margin-top:44px
        }
        .inputbox {
            margin-bottom: 5px;
        }
        .fontstyle, .fontstyle1 {
            font-size: 14px;
        }
        .fontstyle1 {
        margin-right:5px
        }
        .leftstyle {
            text-align: right;
        }
        @@media screen and (max-width:992px) {
            .leftstyle {
                text-align: left;
                width: 335px;
                padding-right: 0;
                display: flex;
                flex-flow: row wrap;
                justify-content: flex-end;
                align-items: center;
            }
        }
    </style>
}
<el-container id="app" v-cloak>
    <el-header class="text-center">
        <mp-header :active="active"></mp-header>
    </el-header>
    <el-row :gutter="5" style="margin-top:30px" >
            <el-col :md="12" class="leftstyle">
                <div class="inputbox">
                    <label class="fontstyle">订单号</label>
                    <el-select v-model="ordernum"
                               clearable
                               allow-create filterable
                               placeholder="请选择订单号"
                               style="width:195px">
                        <el-option v-for="item in ordernumOptions"
                                   :key="item.value"
                                   :value="item.value">
                        </el-option>
                    </el-select>
                </div>
                <!--散件-->
                <div class="inputbox">
                    <label class="fontstyle">散件数量</label>
                    <el-input v-model="loose.Quantity" placeholder="请输入数量" style="width:195px" clearable>
                    </el-input>
                </div>
                <div class="inputbox">
                    <label class="fontstyle">散件下单日期</label>
                    <el-date-picker v-model="loose.ProductScheduleStartTime"
                                    type="date"
                                    placeholder="选择下单日期"
                                    style="width:195px">
                    </el-date-picker>
                </div>
                <div class="inputbox">
                    <label class="fontstyle">散件工单交期</label>
                    <el-date-picker v-model="loose.DepartmentalDeliveryTime"
                                    type="date"
                                    placeholder="选择工单交期"
                                    style="width:195px">
                    </el-date-picker>
                </div>
                <div class="inputbox">
                    <label class="fontstyle">散件实际交期</label>
                    <el-date-picker v-model="loose.PracticalDeliveryTime"
                                    type="date"
                                    placeholder="选择实际交期"
                                    style="width:195px">
                    </el-date-picker>
                </div>
                <div class="inputbox">
                    <label class="fontstyle">散件调整后交期</label>
                    <el-date-picker v-model="loose.AdjustDeliveryTime"
                                    type="date"
                                    placeholder="选择调整后交期"
                                    style="width:195px">
                    </el-date-picker>
                </div>
                <div class="inputbox">
                    <label class="fontstyle">散件生产开始时间</label>
                    <el-date-picker v-model="loose.ProductionStartTime"
                                    type="datetime"
                                    placeholder="选择生产开始时间"
                                    style="width:195px">
                    </el-date-picker>
                </div>
                <el-button v-on:click="saveBasicInfo" size="mini" type="primary" v-show="createBasic">保存</el-button>
            </el-col>

            <!--箱体-->
            <el-col :md="12" class="main">
                <div class="inputbox">
                    <label  class="fontstyle1">箱体数量</label>
                    <el-input v-model="box.Quantity" placeholder="请输入数量" style="width:197px" clearable>
                    </el-input>
                </div>
                <div class="inputbox">
                    <label  class="fontstyle1">箱体下单日期</label>
                    <el-date-picker v-model="box.ProductScheduleStartTime"
                                    type="date"
                                    placeholder="选择下单日期"
                                    style="width:197px">
                    </el-date-picker>
                </div>
                <div class="inputbox">
                    <label class="fontstyle1">箱体工单交期</label>
                    <el-date-picker v-model="box.DepartmentalDeliveryTime"
                                    type="date"
                                    placeholder="选择工单交期"
                                    style="width:197px">
                    </el-date-picker>
                </div>
                <div class="inputbox">
                    <label class="fontstyle1">箱体实际交期</label>
                    <el-date-picker v-model="box.PracticalDeliveryTime"
                                    type="date"
                                    placeholder="选择实际交期"
                                    style="width:197px">
                    </el-date-picker>
                </div>
                <div class="inputbox">
                    <label class="fontstyle1">箱体调整后交期</label>
                    <el-date-picker v-model="box.AdjustDeliveryTime"
                                    type="date"
                                    placeholder="选择调整后交期"
                                    style="width:197px">
                    </el-date-picker>
                </div>
                <div class="inputbox">
                    <label class="fontstyle1">箱体生产开始时间</label>
                    <el-date-picker v-model="box.ProductionStartTime"
                                    type="datetime"
                                    placeholder="选择生产开始时间"
                                    style="width:195px">
                    </el-date-picker>
                </div>
            </el-col>
        </el-row>

</el-container>
@* 分部页放置处 *@
@section renderPage {
    @RenderPage("~/Views/MetalPlate/_MP_Header.cshtml")
}
@* js放置处 *@
@section jsScript {
    <script>
        const app = {
            data: function () {
                return {
                    active: "基本信息录入",
                    createBasic: false,//录入权限
                    ordernum: '',
                    ordernumOptions: [],
                    productionTypeOptions: [{ label: '选项一', value: '散件' }, { label: '选项二', value: '箱体' }],
                    productionType: '',
                    loose: {
                        OrderNum: '',
                        Quantity: '',//散件数量
                        ProductScheduleStartTime: '',//散件下单日期
                        DepartmentalDeliveryTime: '',//散件工单交期
                        PracticalDeliveryTime: '',//散件实际交期
                        AdjustDeliveryTime: '',//散件调整后交期
                        ProductionStartTime: '',//散件生产开始时间
                        ProductionType: '散件'
                    },
                    box: {
                        OrderNum: '',
                        Quantity: '',//箱体数量
                        ProductScheduleStartTime: '',//箱体下单日期
                        DepartmentalDeliveryTime: '',//箱体工单交期
                        PracticalDeliveryTime: '',//箱体实际交期
                        AdjustDeliveryTime: '',//箱体调整后交期
                        ProductionStartTime: '',//箱体生产开始时间
                        ProductionType: '箱体'
                    }
                }
            },
            mounted() {
                axios.post('/Packagings/GetOrderList').then(res => {
                    this.ordernumOptions = res.data;
                    console.log(res.data)
                }).catch(err => {
                    console.warn("获取选择列表失败") 
                });              
                if (this.islimit('钣金基本信息录入')) {                  
                    this.createBasic = true
                } else {
                    this.createBasic = false
                };
            },
            methods: {
                saveBasicInfo() {
                    let arr = []
                    let loose = this.loose//散件
                    let box = this.box //箱体
                    let i = 0;
                    if (this.ordernum != '') {
                        if (loose.Quantity != '') {
                            if (loose.ProductScheduleStartTime != '' && loose.DepartmentalDeliveryTime != '' && loose.PracticalDeliveryTime != '' && loose.AdjustDeliveryTime != '' && loose.ProductionStartTime != '') {
                                loose.OrderNum = this.ordernum
                                arr.push(loose)
                            } else {
                                i += 1;
                                this.$message({
                                    message: "请将散件日期填写完整！",
                                    type: 'warning',
                                    duration: 6000,
                                });
                            }
                        };
                        if (box.Quantity != '') {
                            if (box.ProductScheduleStartTime != '' && box.DepartmentalDeliveryTime != '' && box.PracticalDeliveryTime != '' && box.AdjustDeliveryTime != '' && box.ProductionStartTime != '') {
                                box.OrderNum = this.ordernum
                                arr.push(box)
                            } else {
                                i += 1;
                                this.$message({
                                    message: "请将箱体日期填写完整！",
                                    type: 'warning',
                                    duration: 6000,
                                });
                            }
                        }
                    } else {
                        this.$message({
                            message: "请选择订单号！",
                            type: 'warning',
                            duration: 6000,
                        });
                    }
                    console.log(arr)
                    if (arr.length > 0 && i == 0) {
                        axios.post('/MetalPlate/CreatBasicInfo', {
                            record: arr
                        }).then(res => {
                            console.log(res.data)
                            if (res.data == "保存成功！") {
                                this.$message({
                                    message: res.data,
                                    type: 'success',
                                    duration: 6000,
                                });
                                this.ordernum = '';
                                this.loose = { OrderNum: '', Quantity: '', ProductScheduleStartTime: '', DepartmentalDeliveryTime: '', PracticalDeliveryTime: '', AdjustDeliveryTime: '', ProductionStartTime: '', ProductionType: '散件' }
                                this.box = { OrderNum: '', Quantity: '', ProductScheduleStartTime: '', DepartmentalDeliveryTime: '', PracticalDeliveryTime: '', AdjustDeliveryTime: '', ProductionStartTime: '', ProductionType: '箱体' }
                            } else {
                                this.$message({
                                    message: res.data,
                                    type: 'warning',
                                    duration: 6000,
                                });
                                this.loose = { OrderNum: '', Quantity: '', ProductScheduleStartTime: '', DepartmentalDeliveryTime: '', PracticalDeliveryTime: '', AdjustDeliveryTime: '', ProductionStartTime: '', ProductionType: '散件' }
                                this.box = { OrderNum: '', Quantity: '', ProductScheduleStartTime: '', DepartmentalDeliveryTime: '', PracticalDeliveryTime: '', AdjustDeliveryTime: '', ProductionStartTime: '', ProductionType: '箱体' }
                            }
                        }).catch(err => {
                            console.log("请求失败")
                        })
                    } else {
                        //this.$message({
                        //    message: '没有要保存的数据',
                        //    type: 'warning',
                        //    duration: 6000,
                        //});
                    }
                }
            }
        };        
    </script>
}

