@*@{
        ViewBag.Title = "健和光电MES";
    }*@
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - 健和光电MES</title>

    @Scripts.Render("~/Scripts/jquery")
    @Scripts.Render("~/Scripts/jqueryval")
    @*@Scripts.Render("~/Scripts_home")*@
    @*@Scripts.Render("~/Scripts/echarts")*@
    @*@Scripts.Render("~/Scripts/easyui")*@
    @*@Scripts.Render("~/Scripts/modernizr")*@
    @Scripts.Render("~/Scripts/bootstrap")
    @Scripts.Render("~/Scripts/vue")
    @*@Scripts.Render("~/Scripts/highcharts")*@
    @Styles.Render("~/Content/easyuicss")
    @Styles.Render("~/Content/css")
    <style>
        .navbar-toggle {
            float: left;
            margin-left: 20px;
            margin-right: 0;
        }

        .navbar-fixed-top .navbar-collapse {
            max-height: 450px;
        }

        @@media(max-width:768px) {
            .navbar-nav > li > a {
                padding-top: 6px;
                padding-bottom: 6px;
            }

            .dropdown-menu .divider {
                margin: 2px 0;
            }

            .navbar-nav .open .dropdown-menu > li > a {
                padding: 3px;
            }

            .navbar-nav .open .dropdown-menu li{
                text-align:left;
                padding:0 25px
            }
        }

        @@media (min-width:768px) and (max-width: 992px) {
            .navbar .dropdownToolbarButton a {
                font-size: 13px;
                padding: 15px 10px;
            }
        }

        @@media (min-width: 768px) {
            .titleul {
                width: 718px;
            }
            .navbar > .container .navbar-brand{
                margin-left:0;
            }
        }

        @@media (min-width: 992px) {
            .titleul {
                width: 930px;
            }

            .loginlabel {
                text-align: right;
            }
        }

        @@media (min-width: 1200px) {
            .titleul {
                width: 1000px;
            }
        }
        .navbar-nav{
            float:none;
        }
    </style>
</head>
@*@using StackExchange.Profiling;*@

<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <img src="~/Images/CompanyLogo1.png" class="navbar-brand" style="padding:15px 0; " />
                @Html.ActionLink("健和光电MES", "Index2", "Home", new { area = "" }, new { @class = "navbar-brand", style = "padding:15px 5px; " })
            </div>
            <div class="navbar-collapse collapse">
                <div class="dropdownToolbarButton">
                    <ul class="nav navbar-nav titleul">
                        @*获取UserRoles*@
                        @{var UserRoles = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).Role; }


                        @*用户管理*@
                        @if (UserRoles == "系统管理员")
                        {
                            <li>@Html.RouteLink("用户管理", "Default", new { controller = "Users", Action = "Index" })</li>
                        }
                        @{
                            var UserName = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).UserName;
                            var Userid = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).ID.ToString();
                        }

                        @*用户状态*@
                        @if (Session["User"] == null)
                        {
                            <li class="navbar-right">
                                <a id="logingo" data-toggle="modal" data-target="#login" href=""><span class="glyphicon glyphicon-log-in"></span>  登录</a>
                            </li>
                        }
                        else
                        {
                            <li class="dropdown navbar-right">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <span class="glyphicon glyphicon-user"></span>  @UserName
                                    <b class="caret"></b>
                                </a>

                                <ul class="dropdown-menu collapse" style="min-width: 104px;">
                                    <li>
                                        @Html.RouteLink("修改密码", "Default", new { id = Userid, Controller = "Users", Action = "Modifypwd" })
                                    </li>
                                    <li>
                                        <a href="/Users/Logoff">退出</a>
                                    </li>
                                </ul>
                            </li>
                        }
                    </ul>
                    @*@Html.Partial("_LoginPartial")*@
                </div>
            </div>
        </div>
    </div>
    <div class="container body-content">
        @RenderBody()
        @RenderSection("scripts", false)
        <footer class="footer hidden-xs hidden-sm text-center">
            <hr />
            <p align="center">&copy; @DateTime.Now.Year - 健和光电MES</p>
        </footer>
    </div>

    <div id="login" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h3 class="modal-title text-center" id="myModalLabel">
                        登录
                    </h3>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="col-md-3 loginlabel" style="padding:8px"><label for="UserNum">员工编号</label></div>
                        <input autofocus="autofocus" class="form-control" id="UserNum" v-model="UserNum" placeholder="请输入员工编号" type="text" value="">
                    </div>
                    <div class="form-group ">
                        <div class="col-md-3 loginlabel" style="padding:8px"><label for="PassWord">密码</label></div>
                        <input class="form-control" id="PassWord" v-model="PassWord" placeholder="请输入密码" type="password">
                    </div>
                    <div class="form-group">
                        <div class="col-md-3 hidden-xs hidden-sm" style="padding:8px"><label></label></div>
                        <span class="text-danger">{{loginPrompt}}</span>
                    </div>
                    <div class="form-group">
                        <input id="nowfocus" type="button" v-on:click="userlogin" class="btn btn-primary" value="登录">
                        <button class="btn btn-danger" data-dismiss="modal">取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var login = new Vue({
            el: "#login",
            data: {
                UserNum: "",
                PassWord: "",
                clickAddress: "",
                loginPrompt: ""
            },
            mounted: function () {
                $("#UserNum").keypress(function (e) {
                    if (e.which == 13) {// 判断所按是否回车键
                        $("#PassWord").focus(); // 设置焦点
                        return false;// 取消默认的提交行为
                    };
                });
                $("#PassWord").keypress(function (e) {
                    if (e.keyCode == 13) {// 判断所按是否回车键
                        login.$options.methods.userlogin();
                    };
                });
                $('.dropdown').mouseover(function () {
                    $(this).addClass('open');
                }).mouseout(function () { $(this).removeClass('open'); });

                $(".checkstatus").click(function () {
                    if ("@Session["User"]" == "") {
                        login.clickAddress = $(this).attr("href");
                        $("#login").modal();
                        return false;
                    } else {
                        return true;
                    }
                });

                $('#login').on('show.bs.modal', function () {
                    login.loginPrompt = "";
                    if (login.clickAddress == "") {
                        login.clickAddress = window.location.pathname == "/Users/Login" ? "" : window.location.pathname;
                    };
                });
                $('#login').on('shown.bs.modal', function () {
                    if ($("#UserNum").val() == "") {
                        $("#UserNum").focus();
                    } else if ($("#PassWord").val() == "") {
                        $("#PassWord").focus();
                    } else {
                        $("#nowfocus").focus();
                    }
                });
                $('#login').on('hide.bs.modal', function () {
                    login.clickAddress = "";
                    login.loginPrompt = "";
                });
            },
            methods: {
                userlogin: function () {
                    login.loginPrompt = "";
                    $.ajax({
                        url: "/Users/loginCheck",
                        type: "post",
                        data: {
                            user: {
                                UserNum: login.UserNum,
                                PassWord: login.PassWord,
                            }
                        },
                        success: function (returnVal) {
                            if (returnVal == "success") {
                                window.location.href = "http://" + window.location.host + login.clickAddress;
                            } else if (returnVal == "error") {
                                login.loginPrompt = "登录失败，请检查员工编号及密码是否有误！";
                            }
                        },
                        error: function (err) {
                            alert("登录出错！");
                        }
                    });
                }
            }
        });
    </script>
</body>
@*@MiniProfiler.RenderIncludes();*@
</html>
