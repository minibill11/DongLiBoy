@{
    ViewBag.Title = "SMT产线看板";
}
<link href="~/Scripts/Bootstraps/bootstrap-select.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/bootstrap-select.js"></script>
<link href="~/Scripts/Bootstraps/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/bootstrap-datetimepicker.js"></script>
<script src="~/Scripts/Bootstraps/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="~/Scripts/axios.min.js"></script>
<style>
    * {
        margin: 0;
        padding: 0;
    }

    .table-bordered > thead > tr > th, .table-bordered > tbody > tr > td {
        border: 1px solid #000;
        padding: 0;
    }

    .table-bordered > tfoot > tr > th {
        border: none;
    }

    .hdDiv {
        width: 100%;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        vertical-align: middle;
    }

    .scroll_table_content {
        width: 100%;
        max-height: 600px;
        overflow: auto;
    }

    #app {
        width: 1170px;
    }

    .table {
        width: 1153px;
        margin-bottom: 0;
    }

        .table > tbody > tr:first-child > td {
            border-top: none;
        }

        .table > thead:first-child > tr:first-child > th, .table > colgroup + thead > tr:first-child > th {
            border-top: 1px solid rgba(35, 35, 35, 0.9);
        }

    .bgYellow {
        background-color: yellow;
    }

    .selectpicker {
        border: 1px solid #ccc;
    }

    input[type="date"].form-control {
        line-height: normal;
    }

    [v-cloak] {
        display: none;
    }

    .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn), input, select {
        max-width: 150px;
    }
</style>
<div id="app" v-cloak>
    <div class="row" style="position:relative;padding-left:200px;">
        <h3 style="padding-left:250px;">SMT生产信息历史记录查询</h3>
        <div class="row form-group">
            <label>按订单与制程面查询：</label>

            <span>@Html.DropDownList("OrderNum", (List<SelectListItem>)ViewBag.OrderNumList, "选择订单", new { @class = "selectpicker", data_live_search = "true", data_style = "form-control" })</span>
            <span>@Html.DropDownList("jobcontent", (List<SelectListItem>)ViewBag.jobContentList, "选择制程面", new { @class = "selectpicker", data_live_search = "true", data_style = "form-control" })</span>
            <span>
                <input id="queryBtn" v-on:click="postLineNum(0)" class="btn btn-default" value="查找" type="submit">
            </span>
        </div>
        <div class="row form-group">
            &nbsp;&nbsp;&nbsp;<label>按线别与日期查询：</label>
            <select data-live-search="true" data-style="form-control" id="LineNum" name="LineNum" class="selectpicker" style="display: none;">
                <option value="0">选择产线</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
            </select>
            <span>
                <select class="form-control btn" v-model="timeStyle" style="display:inline-block;max-width:120px;border: 1px solid #ccc;text-align: left;">
                    <option value="0">日期→</option>
                    <option value="1">时间范围→</option>
                </select>
            </span>
            <span>
                <input v-if="timeStyle==0" class="form-control btn" id="startTime" name="startTime" type="date" style="display:inline-block;border: 1px solid #ccc;text-align: left;">

                <input v-else class="form-control btn" id="startTime" name="startTime" type="datetime" style="display:inline-block;border: 1px solid #ccc;text-align: left;" placeholder="选择开始时间">
            </span>
            <span>
                <input v-show="timeStyle==1" class="form-control btn" id="endtime" name="endtime" type="datetime" style="display:inline-block;border: 1px solid #ccc;text-align: left;" placeholder="选择结束时间">
            </span>
            <span>
                <input id="queryBtn2" v-on:click="postLineNum(1)" class="btn btn-default" value="查找" type="submit">
            </span>
        </div>
    </div>
    <div class="row">
        <div v-show="resultroot">
            <div v-if="showQuery==0">订单与制程面查询结果：</div>
            <div v-else>线别与日期查询结果： </div>
        </div>
        <table class="table table-bordered" style="margin-bottom:0;">
            <colgroup>
                <col width="125 ">
                <col width="55 ">
                <col width="110 ">
                <col width="157 ">
                <col width="85 ">
                <col width="85 ">
                <col width="90 ">
                <col width="85 ">
                <col width="90 ">
                <col width="270 ">
            </colgroup>
            <thead>
                @*<tr>
                                <th colspan="2"><div class="hdDiv">生产日期：{{titleList.todaty}}</div></th>
                    <th colspan="2"><div class="hdDiv">组长：{{titleList.groupLeader}}</div></th>
                    <th colspan="4"><div class="hdDiv">生产人数：{{titleList.personNum}}</div></th>
                                <th rowspan="2"><div class="hdDiv" style="height:80px;">备注</div></th>
                            </tr>*@
                <tr>
                    <th><div class="hdDiv">订单号</div></th>
                    <th><div class="hdDiv">线别</div></th>
                    <th><div class="hdDiv">制程面</div></th>
                    <th>
                        <div class="hdDiv">
                            <span>生产时段</span>
                        </div>
                    </th>
                    <th><div class="hdDiv bgYellow">标准产能<br />(PCS/H)</div></th>
                    <th><div class="hdDiv bgYellow">实际完成<br />(PCS)</div></th>
                    <th><div class="hdDiv bgYellow">达成率(%)</div></th>
                    <th><div class="hdDiv bgYellow">不良数<br />(PCS)</div></th>
                    <th><div class="hdDiv bgYellow">不良率(%)</div></th>
                    <th><div class="hdDiv">备注</div></th>
                </tr>
            </thead>
        </table>
        <div class="scroll_table_content">
            <table class="table table-bordered">
                <colgroup>
                    <col width="125 ">
                    <col width="55 ">
                    <col width="110 ">
                    <col width="157 ">
                    <col width="85 ">
                    <col width="85 ">
                    <col width="90 ">
                    <col width="85 ">
                    <col width="90 ">
                    <col width="270 ">
                </colgroup>
                <tbody>
                    <template v-if="showQuery==0">
                        <tr v-for="(item,index) in tablelist">
                            <td><div class="hdDiv">{{item.orderNum}}</div></td>
                            <td><div class="hdDiv">{{item.LineNum}}</div></td>
                            <td><div class="hdDiv">{{item.jobContent}}</div></td>
                            <td><div class="hdDiv"> &nbsp; {{item.startime}}<br /> - {{item.endtime}}</div></td>
                            <td><div class="hdDiv">{{item.Capacity}}</div></td>
                            <td><div class="hdDiv">{{item.NormalCount}}</div></td>
                            <td><div class="hdDiv">{{item.achievement}}</div></td>
                            <td><div class="hdDiv">{{item.AbnormalCount}}</div></td>
                            <td><div class="hdDiv">{{item.Defective}}</div></td>
                            <td><div class="hdDiv">{{item.Remark}}</div></td>

                        </tr>
                    </template>
                    <template v-else>
                        <template v-if="timeStyle==0" v-for="(item,index) in tablelist">
                            <tr v-for="i in item">
                                <td><div class="hdDiv">{{i.orderNum}}</div></td>
                                <td><div class="hdDiv">{{i.LineNum}}</div></td>
                                <td><div class="hdDiv">{{i.jobContent}}</div></td>
                                <td><div class="hdDiv"> &nbsp; {{i.startime}}<br /> - {{i.endtime}}</div></td>
                                <td><div class="hdDiv">{{i.Capacity}}</div></td>
                                <td><div class="hdDiv">{{i.NormalCount}}</div></td>
                                <td><div class="hdDiv">{{i.achievement}}</div></td>
                                <td><div class="hdDiv">{{i.AbnormalCount}}</div></td>
                                <td><div class="hdDiv">{{i.Defective}}</div></td>
                                <td><div class="hdDiv">{{i.Remark}}</div></td>
                            </tr>
                        </template>
                        <template v-else v-for="(item,index) in tablelist">
                            <tr>
                                <td colspan="10" class="text-center">{{index.toString().split(" ")[0]}}</td>
                            </tr>
                            <tr v-for="i in item">
                                <td><div class="hdDiv">{{i.orderNum}}</div></td>
                                <td><div class="hdDiv">{{i.LineNum}}</div></td>
                                <td><div class="hdDiv">{{i.jobContent}}</div></td>
                                <td><div class="hdDiv"> &nbsp; {{i.startime}}<br /> - {{i.endtime}}</div></td>
                                <td><div class="hdDiv">{{i.Capacity}}</div></td>
                                <td><div class="hdDiv">{{i.NormalCount}}</div></td>
                                <td><div class="hdDiv">{{i.achievement}}</div></td>
                                <td><div class="hdDiv">{{i.AbnormalCount}}</div></td>
                                <td><div class="hdDiv">{{i.Defective}}</div></td>
                                <td><div class="hdDiv">{{i.Remark}}</div></td>
                            </tr>
                        </template>
                    </template>
                </tbody>
            </table>
        </div>
        <table class="table table-bordered" style="margin-bottom:0;border:none;">
            <colgroup>
                <col width="130 ">
                <col width="110 ">
                <col width="130 ">
                <col width="100 ">
                <col width="100 ">
                <col width="100 ">
                <col width="100 ">
                <col width="100 ">
                <col width="282 ">
            </colgroup>
            <tfoot>
                <tr>
                    <th colspan="9">
                        <div style="padding:5px 0 0;">
                            统计：{{totalList.totalNum}}.&nbsp;&nbsp;
                            计划生产总数：{{totalList.totalCapacity?totalList.totalCapacity.toFixed(0):""}}；&nbsp;
                            实际完成：{{totalList.totalNormalCount}}；&nbsp;
                            总达成率：{{totalList.totalAchievement}}；&nbsp;
                            总不良数：{{totalList.totalAbnormalCount}}；&nbsp;
                            良率：{{totalList.totalDefective}}；&nbsp;
                        </div>
                    </th>
                </tr>
            </tfoot>
        </table>
    </div>
    @*loding*@
    <div class="spinnerModel" v-show="loading">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
    </div>
    <div class="row col-md-12">
        @Html.ActionLink("返回", "SMT_Manage")
    </div>
</div>
<script>
    var app = new Vue({
        el: "#app",
        data: {
            tablelist: [],
            //titleList: "",
            totalList: "",
            loading: false,
            showQuery: 0,
            timeStyle: 0,
            resultroot: 0
        },
        methods: {
            //获取产线数据
            postLineNum: (L) => {
                //console.log($("#OrderNum").val())
                //console.log($("#jobcontent").val())
                //console.log($("#LineNum").val())
                //console.log($("#startTime").val())
                //console.log($("#endtime").val())
                app.resultroot = 1;
                app.tablelist = [];
                app.totalList = "";
                let postJson;
                if (L == 0) {
                    app.showQuery = 0;
                    postJson = {
                        OrderNum: $("#OrderNum").val(),
                        jobcontent: $("#jobcontent").val(),
                        LineNum: 0,
                        startTime: null,
                        endtime: null,
                    };
                };
                if (L == 1) {
                    app.showQuery = 1;
                    if (app.timeStyle == 0) {
                        postJson = {
                            OrderNum: null,
                            jobcontent: null,
                            LineNum: $("#LineNum").val(),
                            startTime: $("#startTime").val(),
                            endtime: null,
                        };
                    } else {
                        postJson = {
                            OrderNum: null,
                            jobcontent: null,
                            LineNum: $("#LineNum").val(),
                            startTime: $("#startTime").val(),
                            endtime: $("#endtime").val(),
                        };
                    }
                };
                //let postJson = {
                //    OrderNum: $("#OrderNum").val(),
                //    jobcontent: $("#jobcontent").val(),
                //    LineNum: $("#LineNum").val(),
                //    startTime: $("#startTime").val(),
                //    endtime: $("#endtime").val(),
                //};
                axios.post("/SMT/SMT_ProductionLineInfoHistory", postJson).then(response => {
                    console.log(response);
                    let nowData = response.data;
                    //app.titleList = {
                    //    todaty: nowData.todaty,
                    //    groupLeader: nowData.groupLeader,
                    //    personNum: nowData.personNum,
                    //};
                    app.totalList = {
                        totalNum: nowData.totalNum,
                        totalCapacity: nowData.totalCapacity,
                        totalNormalCount: nowData.totalNormalCount,
                        totalAchievement: nowData.totalAchievement,
                        totalAbnormalCount: nowData.totalAbnormalCount,
                        totalDefective: nowData.totalDefective,
                    };
                    if (Object.keys(nowData.message).length == 0) {
                        app.tablelist = "k"
                    } else {
                        //if (app.timeStyle == 0) {
                        //    for (let i in nowData.message) {
                        //        app.tablelist.push(nowData.message[i]);
                        //    };
                        //} else {

                        //}
                        app.tablelist = nowData.message;
                    };

                    //console.log(app.tablelist)
                }).catch(error => {
                    console.warn(error);
                });
            }
        },
        watch: {
            timeStyle: function (v) {
                this.totalList = "";
                this.tablelist = [];
                if (v == 1) {
                    this.$nextTick(function () {
                        $("#startTime").datetimepicker({
                            language: 'zh-CN',
                            format: 'yyyy-mm-dd hh:ii',//显示格式
                            todayHighlight: 1,//今天高亮
                            todayBtn: 1,
                            startView: 2,
                            forceParse: 0,
                            showMeridian: 1,
                            autoclose: 1,//选择后自动关闭
                            endDate: new Date()
                        }).on('changeDate', function (ev) {
                            $("#endtime").datetimepicker('setStartDate', $(this).val());
                        });
                    });
                };
            }
        },
        created: function () {
        }
    });
    // 添加请求拦截器
    axios.interceptors.request.use(function (config) {
        app.loading = true;
        return config;
    }, function (error) {
        return Promise.reject(error);
    });

    // 添加响应拦截器
    axios.interceptors.response.use(function (response) {
        app.loading = false;
        return response;
    }, function (error) {
        app.loading = false;
        return Promise.reject(error);
    });

    //$("#startTime").datetimepicker({
    //    language: 'zh-CN',
    //    format: 'yyyy-mm-dd hh:ii',//显示格式
    //    todayHighlight: 1,//今天高亮
    //    todayBtn: 1,
    //    startView: 2,
    //    forceParse: 0,
    //    showMeridian: 1,
    //    autoclose: 1,//选择后自动关闭
    //    endDate: new Date()
    //}).on('changeDate', function (ev) {
    //    $("#endtime").datetimepicker('setStartDate', $(this).val());
    //});
    $("#endtime").datetimepicker({
        language: 'zh-CN',
        format: 'yyyy-mm-dd hh:ii',//显示格式
        todayHighlight: 1,//今天高亮
        todayBtn: 1,
        startView: 2,
        forceParse: 0,
        showMeridian: 1,
        autoclose: 1,//选择后自动关闭
        endDate: new Date()
    }).on('changeDate', function (ev) {
        $("#startTime").datetimepicker('setEndDate', $(this).val());
    });
</script>