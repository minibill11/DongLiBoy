@model IEnumerable<JianHeMES.Models.Personnel_Roster>

@{
    ViewBag.Title = "查询首页";
}
<link href="~/Scripts/Bootstraps/bootstrap-select.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/bootstrap-select.js"></script>
<link href="~/Scripts/Bootstraps/Element-ui.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/Element-ui.js"></script>
<style>
    .el-collapse-item__content{
        padding-bottom:0;
    }
    .el-collapse-item__header{
        height:30px;
    }
    .ttops{
        display:inline-flex;
        justify-content:space-between;
        width:12%;
    }
    .tbottom{
        display:inline-flex;
        justify-content:space-between;
        width:15%;
    }
    .tbottom:first-child{
        display:none;
    }
    .selectpicker {
        border: 1px solid #ccc;
    }

    .table {
        margin: 0;
    }

        .table > tbody > tr > td, .table > tbody > tr > th {
            text-align: center;
            padding: 3px;
        }

            .table > tbody > tr > td:nth-child(1), .table > tbody > tr > th:nth-child(1) {
                width: 60px;
            }

            .table > tbody > tr > td:nth-child(2), .table > tbody > tr > th:nth-child(2) {
                width: 80px;
            }

            .table > tbody > tr > td:nth-child(3), .table > tbody > tr > th:nth-child(3) {
                width: 50px;
            }

            .table > tbody > tr > td:nth-child(4), .table > tbody > tr > th:nth-child(4) {
                width: 90px;
            }

            .table > tbody > tr > td:nth-child(5), .table > tbody > tr > th:nth-child(5) {
                width: 90px;
            }

            .table > tbody > tr > td:nth-child(6), .table > tbody > tr > th:nth-child(6) {
                width: 90px;
            }

            .table > tbody > tr > td:nth-child(7), .table > tbody > tr > th:nth-child(7) {
                width: 100px;
            }

            .table > tbody > tr > td:nth-child(8), .table > tbody > tr > th:nth-child(8) {
                width: 100px;
            }

            .table > tbody > tr > td:nth-child(9), .table > tbody > tr > th:nth-child(9) {
                width: 90px;
            }

            .table > tbody > tr > td:nth-child(10), .table > tbody > tr > th:nth-child(10) {
                width: 90px;
            }

            .table > tbody > tr > td:nth-child(11), .table > tbody > tr > th:nth-child(11) {
                width: 90px;
            }

            .table > tbody > tr > td:nth-child(12), .table > tbody > tr > th:nth-child(12) {
                width: 70px;
            }

            .table > tbody > tr > td:nth-child(13), .table > tbody > tr > th:nth-child(13) {
                width: 123px;
            }

    .bootstrap-select > .btn, .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
        width: 150px;
    }
</style>
<h3 class="text-center" style="margin-bottom:3px;margin-top:5px;">查询首页</h3>
<div id="app">
    <span>
        @Html.ActionLink("新增一个员工", "Create")
    </span>
    <span>
        @Html.ActionLink("批量添加员工", "Batch_InputStaff")
    </span>
    @using (Html.BeginForm("OutputExcel", "Personnel_Roster", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        <input v-model="jobNum" type="text" class="hidden" style="display:inline;width:150px;" name="jobNum" />
        <input v-model="name" type="text" class="hidden" style="display:inline;width:150px;" name="name" />
        <input v-model="department" type="text" class="hidden" style="display:inline;width:150px;" name="department" />
        <input v-model="status" type="text" class="hidden" style="display:inline;width:150px;" name="status" />
        <input type="submit" id="excelBtn" class="btn btn-success pull-right" value="导出花名册记录到Excel表" />
    }

    @using (Html.BeginForm("Index", "Personnel_Roster", FormMethod.Post, new { id = "searchForm", @class = "text-center" }))
    {
        @Html.AntiForgeryToken()
        <div>
            <span>工号：</span><input v-model="jobNum" type="text" class="form-control" style="display:inline;width:150px;" name="jobNum" />
            <span>&nbsp;&nbsp;&nbsp;姓名：</span><input v-model="name" type="text" class="form-control" style="display:inline;width:150px;" name="name" />
            <span>&nbsp;&nbsp;&nbsp;部门:</span>@Html.DropDownList("department", (List<SelectListItem>)ViewBag.departmentList, "全部", new { @class = "selectpicker", data_live_search = "true", data_style = "form-control" })
            <span>&nbsp;&nbsp;&nbsp;员工状态:</span>@Html.DropDownList("status", (List<SelectListItem>)ViewBag.status, "全部", new { @class = "selectpicker", data_live_search = "true", data_style = "form-control" })
            <input type="submit" class="btn btn-default" value="查找" />
        </div>
    }
    <textarea id="infos" style="display:none;">@ViewBag.statistics</textarea>
    <el-collapse v-model="activeNames" accordion>
        <el-collapse-item title="总统计" name="1">
            <div class="ttops" v-for="item in totalTop">{{item.name}} : {{item.val}}</div>
        </el-collapse-item>
    </el-collapse>
    <el-collapse v-model="activeName" accordion>
        <el-collapse-item v-bind:title="item.depatment +' ------------------在职总人数 : '+ item.val[0].values" v-for="(item,index) in totalBottom" v-bind:name="index">
            <div class="tbottom" v-for="item in item.val">{{item.names}} : {{item.values}}</div>
        </el-collapse-item>
    </el-collapse>
    <div style="width:1123px; height:35px;">
        <table class="table">
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.JobNum)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Name)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Sex)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.DateOfBirth)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Education)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.DP_Group)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.HireDate)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.LastDate)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Department)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Status)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.levelType)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.OnPostMonth)
                </th>
                <th>操作</th>
            </tr>
        </table>
    </div>

    <div style="width:1140px;height:300px;overflow:auto;">
        <table class="table">
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.JobNum)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Name)
                    </td>
                    <td>
                        @if (item.Sex == false)
                        {
                            <span>女</span>
                        }
                        else if (item.Sex == true)
                        {
                            <span>男</span>
                        }
                        @*@Html.DisplayFor(modelItem => item.Sex)*@
                    </td>
                    <td>
                        <span>@item.DateOfBirth.ToString().Split(' ')[0]</span>
                        @*@Html.DisplayFor(modelItem => item.DateOfBirth)*@
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Education)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.DP_Group)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.HireDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.LastDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Department)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Status)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.levelType)
                    </td>
                    <td>
                        @{
                            if (item.OnPostMonth == 0)
                            {
                                <span></span>
                            }
                            else
                            {
                                @*<span>@item.OnPostMonth.ToString().Split('.')[0]</span>*@
                                @Html.DisplayFor(modelItem => item.OnPostMonth)
                            }
                        }
                    </td>
                    <td>
                        @{var UserRoles = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).Role; }
                        @if (((JianHeMES.Models.Users)Session["User"]) != null)
                        {
                            if (UserRoles == "系统管理员" || ((JianHeMES.Models.Users)Session["User"]).UserName == "魏顺平" || ((JianHeMES.Models.Users)Session["User"]).UserName == "刘露露")
                            {
                                <span>
                                    @Html.ActionLink("修改", "Edit", new { id = item.Id }) |
                                    @Html.ActionLink("详细", "Details", new { id = item.Id }) @*|
                                        @Html.ActionLink("删除", "Delete", new { id = item.Id })*@
                                </span>
                            }
                        }
                    </td>
                </tr>
            }
        </table>
    </div>

</div>

<script>
    var app = new Vue({
        el: "#app",
        data: {
            totalTop: "",
            totalBottom: "",
            activeName: '1',
            activeNames: "1",
            jobNum: "",
            name: "",
            department: "",
            status: ""
        },
    });
    var datas = $("#infos").val();
    var targetData = JSON.parse(datas);
    var ttop = []; //获取总统计部分的数据
    var tbottom = []; //获取部门的详细信息
    for (var keys in targetData) {
        if (keys === '总统计') {
            for (keyss in targetData[keys]) {
                ttops = { name: keyss, val: targetData[keys][keyss] };
                ttop.push(ttops);
            }
        } else {
            var tar = { depatment: keys, val: handeldata(targetData[keys])};

            tbottom.push(tar)
        }
    };
    function handeldata(value) {
        var newArr = [];
        for (var keys in value) {
            var tt = { names: keys, values: value[keys] };
            newArr.push(tt);
        };
        return newArr;
    }
    app.totalTop = ttop;
    app.totalBottom = tbottom;    
    console.log(targetData)
 
    app.department = $("#department").val();
    app.status = $("#status").val();
    $("#department").on("change", function(){
        app.department = $(this).val();
    });
    $("#status").on("change", function () {
        app.status = $(this).val();
    });
</script>
