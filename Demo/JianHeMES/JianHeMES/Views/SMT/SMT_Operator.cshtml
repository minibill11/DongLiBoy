@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model JianHeMES.Models.FinalQC
<link href="~/Scripts/Bootstraps/bootstrap-select.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/bootstrap-select.js"></script>
@*引用js、加载数据*@
<link href="~/Scripts/Bootstraps/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<script src="~/Scripts/Bootstraps/bootstrap-datetimepicker.js"></script>
<script src="~/Scripts/Bootstraps/bootstrap-datetimepicker.zh-CN.js"></script>
<style>
    /*body {
        background-color: #dff0d8;
        color: #555;
    }*/

    .selectpicker {
        border: 1px solid #ccc;
    }

    .input-group-addon, .form-control[readonly] {
        background-color: #fff;
    }

    .bootstrap-select > .btn, .bootstrap-select.form-control:not([class*="col-"]), input, select {
        max-width: 260px;
    }
</style>
@using (Html.BeginForm("SMT_Operator", "SMT", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    <div id="app" class="form-horizontal">
        <h3>SMT产线信息录入</h3>
        <hr />
        <div class="col-md-5">
            <div class="form-group">
                @Html.LabelFor(model => model.OrderNum, htmlAttributes: new { @class = "control-label col-md-4" })
                <div class="col-md-8">
                    @Html.DropDownListFor(model => model.OrderNum, ViewBag.OrderList as IEnumerable<SelectListItem>, new { @class = "selectpicker form-control", data_live_search = "true", data_style = "form-control" })
                    @Html.ValidationMessageFor(model => model.OrderNum, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4" for="LineNum">产线号</label>
                <div class="col-md-8">
                    <select id="LineNum" name="LineNum" class="form-control">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4" for="normalQ">良品数量</label>
                <div class="col-md-8">
                    <input class="form-control text-box single-line" id="normalQ" name="normalQ" type="number">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4" for="abnormalQ">不良品数量</label>
                <div class="col-md-8">
                    <input class="form-control text-box single-line" id="abnormalQ" name="abnormalQ" type="number">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4" for="start_Date">开始时间</label>
                <div class="col-md-8">
                    <div style="float:left ;">
                        <div id="start_Date" class="input-group date" data-date="" data-link-field="begintime">
                            <input id="startDateTime" class="form-control" type="text" value="" style="width:180px;" readonly>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                            <input type="hidden" id="begintime" name="begintime" value="" />
                        </div>
                        <input type="button" value="获取上次结束时间" v-on:click="getBeginTime" class="form-control" />
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4" for="end_Date">结束时间</label>
                <div class="col-md-8">
                    <div style="float:left ;">
                        <div id="end_Date" class="input-group date" data-date="" data-link-field="endtime">
                            <input id="endDateTime" class="form-control" type="text" value="" style="width:180px;" readonly>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                            <input type="hidden" id="endtime" name="endtime" value="" />
                        </div>
                    </div>
                </div>
            </div>

            @*<div class="form-group">
                    <label class="control-label col-md-4" for="result">产品状态</label>
                    <div class="col-md-8">
                        <input class="form-control text-box single-line" id="result" name="result"  type="text" value="">
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.barcodeNum, htmlAttributes: new { @class = "control-label col-md-4" })
                    <div class="col-md-8">
                        @Html.EditorFor(model => model.barcodeNum, new { htmlAttributes = new { @class = "form-control", onkeyup = "this.value=this.value.toUpperCase().replace(/\\s+/g,'')" } })
                        @Html.ValidationMessageFor(model => model.barcodeNum, "", new { @class = "text-danger" })
                    </div>
                </div>*@

            <div class="form-group">
                <div class="col-md-offset-4 col-md-8">
                    <button onclick="return inputMsg()" class="btn btn-default" type="submit">输入信息</button>
                </div>
            </div>
            @**@
        </div>
    </div>
    <br />
}

<div class="clearfix"></div>
@*<div class="row col-md-12">
        @Html.ActionLink("返回", "Index")
    </div>*@
<script>
    var app = new Vue({
        el: "#app",
        data: {
        },
        methods: {
            getBeginTime: function () {
                $.ajax({
                    url: "/SMT/SMT_Operator_getBeginTime/",
                    type: "post",
                    data: {
                        ordernum: $("#OrderNum").val(),
                        linenum: $("#LineNum").val(),
                        //OrderNum: "",
                        //LineNum: "",
                        //normalQ: "",
                        //abnormalQ: "",
                        //begintime: "",
                        //endtime: "",
                        //result: "",
                        //barcodeNum: ""
                    },
                    success: function (data) {
                        $("#end_Date").datetimepicker('setStartDate', data.replace(/\//g, "-"));
                        var returndata = data.split(/:[0-9]{2}$/)[0].replace(/\//g, "-");
                        //alert("获取成功");
                        if (data == "") {
                            alert("今天没有记录");
                        } else {
                            $("#startDateTime").val(returndata);
                            $("#begintime").val(returndata);
                        }
                    },
                    error: function (err) {
                        alert("获取失败");
                    }
                });
            }
        },
        created: function () {

        },
        mounted: function () {
            $("#start_Date").datetimepicker({
                language: 'zh-CN',
                format: 'yyyy-mm-dd hh:ii',//显示格式
                //minView: "month",//设置只显示到月份
                weekStart: 1, //一周从哪一天开始。0（星期日）到6（星期六）
                todayBtn: 1,
                autoclose: 1, //当选择一个日期之后是否立即关闭此日期时间选择器。
                todayHighlight: 1, //今天高亮
                startView: 2,
                forceParse: 0,
                pickerPosition: "bottom-left",
                showMeridian: 1,
                endDate: new Date()
            }).on('changeDate', function (ev) {
                $("#end_Date").datetimepicker('setStartDate', $("#begintime").val());
            });
            $("#end_Date").datetimepicker({
                language: 'zh-CN',
                format: 'yyyy-mm-dd hh:ii',
                weekStart: 1,
                todayBtn: 1,
                autoclose: 1,
                todayHighlight: 1,
                startView: 2,
                forceParse: 0,
                pickerPosition: "bottom-left",
                showMeridian: 1,
                endDate: new Date()
            }).on('changeDate', function (ev) {
                $("#start_Date").datetimepicker('setEndDate', $("#endtime").val());
            });

            var localOrder = localStorage.getItem('Order');
            if (localOrder != null) {
                $("#OrderNum").val(localOrder);
            };
            $("#OrderNum").change(function (val) {
                localStorage.setItem('Order', val.target.value);
            });
            var LineIdNum = localStorage.getItem('LineId');
            if (LineIdNum != null) {
                $("#LineNum").val(LineIdNum);
            };
            $("#LineNum").change(function (val) {
                localStorage.setItem('LineId', val.target.value);
            });
            $("#normalQ").select();
        }
    });
    function inputMsg() {
        if ($("#OrderNum").val() == "" || $("#LineNum").val() == "" || $("#normalQ").val() == "" || $("#abnormalQ").val() == "" || $("#begintime").val() == "" || $("#endtime").val() == "") {
            alert("内容填写不完整");
            return false;
        } else {
            return true;
        };
    };
</script>