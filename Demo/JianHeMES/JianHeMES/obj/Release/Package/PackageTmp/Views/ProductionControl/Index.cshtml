
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .table > tbody > tr > th, .table > tbody > tr > td {
        text-align: center;
        vertical-align: middle;
    }

        .rowTitle1 > th:nth-child(-n+4), .rowTitle2 > th:nth-child(-n+2), .table > tbody > tr > td:nth-child(-n+5) {
            border: 1px solid red;
        }

        .rowTitle1 > th:nth-child(n+5), .rowTitle2 > th:nth-child(n+3), .table > tbody > tr > td:nth-child(n+6) {
            border: 1px solid blue;
        }

        .rowTitle1 > th:nth-child(4), .rowTitle2 > th:nth-child(2), .table > tbody > tr > td:nth-child(5) {
            border-right: 1px solid blue;
        }
</style>
<h2 class="text-center">生产管控信息</h2>

@{var UserRole = Session["User"] == null ? string.Empty : ((JianHeMES.Models.Users)Session["User"]).Role; }
@if (UserRole == "系统管理员")
{
    <div class="text-center">
        <p class="text-success text-center btn btn-default">
            @Html.ActionLink("组装完成率", "Assemble_CompeleteRate")
        </p>
        <p class="text-success text-center btn btn-default">
            @Html.ActionLink("组装合格率", "Assemble_PassRate")
        </p>
        <p class="text-success text-center btn btn-default">
            @Html.ActionLink("老化完成率", "Burn_in_CompeleteRate")
        </p>
        <p class="text-success text-center btn btn-default">
            @Html.ActionLink("老化合格率", "Burn_in_PassRate")
        </p>
        <p class="text-success text-center btn btn-default">
            @Html.ActionLink("校正完成率", "Calibration_CompeleteRate")
        </p>
        <p class="text-success text-center btn btn-default">
            @Html.ActionLink("校正合格率", "Calibration_PassRate")
        </p>
        <p class="text-success text-center btn btn-default">
            @Html.ActionLink("外观包装完成率", "Appearances_CompeleteRate")
        </p>
        <p class="text-success text-center btn btn-default">
            @Html.ActionLink("外观包装合格率", "Appearances_PassRate")
        </p>
    </div>
}
    <br />
    <div id="app" class="form-group">
        <table class="table table-bordered">
            <colgroup>
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
                <col width="80 ">
            </colgroup>
            <tr class="rowTitle1">
                <th rowspan="2">订单号</th>
                <th rowspan="2">订单数量</th>
                <th rowspan="2">平台型号</th>
                <th colspan="2">生产排期</th>
                <th rowspan="2">实际开始生产时间</th>
                <th colspan="2">组装工序</th>
                <th colspan="2">调试老化</th>
                <th colspan="2">校正</th>
                <th colspan="2">包装</th>
            </tr>
            <tr class="rowTitle2">
                <th>起始日期</th>
                <th>出货时间</th>
                <th>完成率</th>
                <th>合格率</th>
                <th>完成率</th>
                <th>合格率</th>
                <th>完成率</th>
                <th>合格率</th>
                <th>完成率</th>
                <th>合格率</th>
            </tr>
            <tr v-for="(item, index) in marqueeList">
                <td>{{item.OrderNum}}</td>
                <td>{{item.Quantity}}</td>
                <td>{{item.PlatformType}}</td>
                <td>{{item.PlanInputTime}}</td>
                <td>{{item.PlanCompleteTime}}</td>
                <td>{{item.ActualProductionTime}}</td>
                <td>{{item.Assemble_Finish_Rate}}</td>
                <td>{{item.Assemble_Pass_Rate}}</td>
                <td>{{item.Burn_in_Finish_Rate}}</td>
                <td>{{item.Burn_in_Pass_Rate}}</td>
                <td>{{item.Calibration_Finish_Rate}}</td>
                <td>{{item.Calibration_Pass_Rate}}</td>
                <td>{{item.Appearances_Finish_Rate}}</td>
                <td>{{item.Appearances_Pass_Rate}}</td>
            </tr>
        </table>

    </div>
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                animate: false,
                marqueeList: []
            },
            created: function () {
                //setInterval(this.showMarquee, 5000)
                //setInterval(function () {
                //    $.ajax({
                //        type: 'post',
                //        url: '/ProductionControl/index',
                //        data: {
                //            OrderNum: '2019bb',
                //        },
                //        success: function (data) {
                //            //console.log(data);
                //            console.log("22222")
                //        },
                //        error: function (XMLHttpRequest, textStatus, errorThrown) {
                //            //alert("请输入条码");
                //            console.log("22222")
                //        }
                //    });
                //},5000)
            },
            methods: {
                showMarquee: function () {
                    this.animate = true;
                    setTimeout(() => {
                        this.marqueeList.push(this.marqueeList[0]);
                        this.marqueeList.shift();
                        this.animate = false;
                    }, 1000);
                }
            }
        })
    </script>

    @section scripts {
        <script src="~/Scripts/jquery-1.11.3.js"></script>
        <script src="~/Scripts/jquery.signalR-2.3.0.min.js"></script>
        <script src="~/signalr/hubs"></script>
        <script>
            $(function () {
                var mypush = $.connection.ProductionControlIndex;
                mypush.client.sendProductionControlIndex = function (ProductionControlIndex) {
                    console.log(ProductionControlIndex)
                    app.marqueeList = [];
                    //console.log(Object.keys(ProductionControlIndex).length)
                    for (index in ProductionControlIndex) {
                        app.marqueeList.push({
                            OrderNum: ProductionControlIndex[index].OrderNum,
                            Quantity: ProductionControlIndex[index].Quantity,
                            PlatformType: ProductionControlIndex[index].PlatformType,
                            PlanInputTime: ProductionControlIndex[index].PlanInputTime,
                            PlanCompleteTime: ProductionControlIndex[index].PlanCompleteTime,
                            ActualProductionTime: ProductionControlIndex[index].ActualProductionTime,
                            Assemble_Finish_Rate: ProductionControlIndex[index].Assemble_Finish_Rate,
                            Assemble_Pass_Rate: ProductionControlIndex[index].Assemble_Pass_Rate,
                            Burn_in_Finish_Rate: ProductionControlIndex[index].Burn_in_Finish_Rate,
                            Burn_in_Pass_Rate: ProductionControlIndex[index].Burn_in_Pass_Rate,
                            Calibration_Finish_Rate: ProductionControlIndex[index].Calibration_Finish_Rate,
                            Calibration_Pass_Rate: ProductionControlIndex[index].Calibration_Pass_Rate,
                            Appearances_Finish_Rate: ProductionControlIndex[index].Appearances_Finish_Rate,
                            Appearances_Pass_Rate: ProductionControlIndex[index].Appearances_Pass_Rate
                        });
                    }
                };
                //启动
                $.connection.hub.start();
            });
        </script>
    }
