<template>
  <!-- 导出安全库存清单 -->
  <div>
    <ExportExcel
      :bookType="bookType"
      :filename="filename"
      :sheet="sheet"
      :on-error="onError"
    >
      <el-button plain type="primary" size="mini" @click="onExcel"
        >导出Excel</el-button
      >
    </ExportExcel>
  </div>
</template>
<script>
import ExportExcel from "_c/export-excel";
export default {
  name: "",
  props: ["tableData"],
  watch: {
    tableData(val) {
      console.log(val, "000");
    },
  },
  data() {
    return {
      bookType: "xlsx",
      filename: "安全库存清单",
      sheet: [
        {
          title: "",
          tHeader: [
            "序号",
            "设备名称",
            "品名",
            "规格/型号",
            "料号",
            "使用寿命",
            "品名",
            "月平均用量",
            "安全库存量",
            "仓库存量",
            "仓库号",
            "库位号",
            "批次号",
            "有效期",
            "采购周期",
            "用途",
            "备注",
          ],
          table:this.tableData,
        //   table: [
        //     {
        //       Id: this.tableData.Id,
        //       EquipmentName: this.tableData.EquipmentName,
        //       Descrip: this.tableData.Descrip,
        //       Specifica: this.tableData.Specifica,
        //       Material: this.tableData.Material,
        //       Servicelife: this.tableData.Servicelife,
        //       Amount: this.tableData.Amount,
        //       Safety_stock: this.tableData.Safety_stock,
        //       Existing_inventory: this.tableData.Existing_inventory,
        //       warehouse_number: this.tableData.warehouse_number,
        //       location: this.tableData.location,
        //       batch_number: this.tableData.batch_number,
        //       validity: this.tableData.validity,
        //       Purchasing_cycle: this.tableData.Purchasing_cycle,
        //       Materused: this.tableData.Materused,
        //       Remark: this.tableData.Remark,
        //     },
        //   ],
          keys: [
            "Id",
            "EquipmentName",
            "Descrip",
            "Specifica",
            "Material",
            "Servicelife",
            "Amount",
            "Safety_stock",
            "Existing_inventory",
            "warehouse_number",
            "location",
            "batch_number",
            "validity",
            "Purchasing_cycle",
            "Materused",
            "Remark",
          ],
          sheetName: "安全库存清单",
          globalStyle: {
            font: {
              color: { rgb: "000000" },
            },
          },
          alignment: {
            horizontal: "center",
            vertical: "left",
          },
          cellStyle: [
            {
              cell: "A1",
              font: {
                name: "宋体",
                sz: 16,
                color: { rgb: "000000" },
                bold: true,
              },
            },
          ],
        },
      ],
    };
  },
  components: { ExportExcel },
  methods: {
    onError(err) {
      console.log(err);
    },
    exportTable() {
      this.$refs.excelExport.pikaExportExcel();
    },
    onExcel() {
      let arr = [];
      this.tableData.forEach((item) => {
        let detail = JSON.parse(item.Existing_inventory_Details);
        //console.log(detail);
        let obj = {
          Id: item.Id,
          EquipmentName: item.EquipmentName,
          Descrip: item.Descrip,
          Specifica: item.Specifica,
          Material: item.Material,
          Servicelife: item.Servicelife,
          Amount: item.Amount,
          Safety_stock: item.Safety_stock,
          Existing_inventory: item.Existing_inventory,
          warehouse_number: detail[0] ? detail[0].img02 : "",
          location: detail[0] ? detail[0].img03 : "",
          batch_number: detail[0] ? detail[0].img04 : "",
          validity: detail[0] ? detail[0].img18 : "",
          Purchasing_cycle: item.Purchasing_cycle,
          Materused: item.Materused,
          Remark: item.Remark,
        };
        arr.push(obj);
      });
      this.tableData=arr;
    },
  },
  created() {},
  mounted() {},
};
</script>
